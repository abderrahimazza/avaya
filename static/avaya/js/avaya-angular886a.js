var underscore=angular.module("underscore",[]);underscore.factory("_",["$window",function($window){return _}]);var avayaBlog=angular.module("avayaBlog",["ngResource","underscore","ngSanitize","ngMessages"]).config(function($locationProvider){$("a").each(function(){$a=$(this),$a.is("[target]")||$a.is("[ng-href]")||$a.attr("target","_self")}),$locationProvider.html5Mode({enabled:!0,requireBase:!1})});function Highliter(id,tag){var targetNode=document.getElementById(id)||document.body,highlightTag=tag||"EM",skipTags=new RegExp("^(?:"+highlightTag+"|SCRIPT|FORM)$"),colors=["#ff6","#a0ffff","#9f9","#f99","#f6f"],wordColor=[],colorIdx=0,matchRegex="";function dec2hex4(textString){var hexequiv=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");return hexequiv[textString>>12&15]+hexequiv[textString>>8&15]+hexequiv[textString>>4&15]+hexequiv[15&textString]}this.setMatchType=function(type){switch(type){case"left":this.openLeft=!1,this.openRight=!0;break;case"right":this.openLeft=!0,this.openRight=!1;break;case"open":this.openLeft=this.openRight=!0;break;default:this.openLeft=this.openRight=!1}},this.setRegex=function(input){var re="("+(input=function(input){return retval=input,retval=retval.replace(/([ao])e/gi,"$1"),retval=retval.replace(/\\u00E[024]/gi,"a"),retval=retval.replace(/\\u00E[89AB]/gi,"e"),retval=retval.replace(/\\u00E[EF]/gi,"i"),retval=retval.replace(/\\u00F[46]/gi,"o"),retval=retval.replace(/\\u00F[9BC]/gi,"u"),retval=retval.replace(/\\u00FF/gi,"y"),retval=retval.replace(/\\u00DF/gi,"s"),retval=retval.replace(/a/gi,"([aàâä]|ae)"),retval=retval.replace(/e/gi,"[eèéêë]"),retval=retval.replace(/i/gi,"[iîï]"),retval=retval.replace(/o/gi,"([oôö]|oe)"),retval=retval.replace(/u/gi,"[uùûü]"),retval=retval.replace(/y/gi,"[yÿ]"),retval=retval.replace(/s/gi,"(ss|[sß])"),retval}(input=(input=input.replace(/\\([^u]|$)/g,"$1")).replace(/[^\w\\\s']+/g,"").replace(/\s+/g,"|")))+")";this.openLeft||(re="(?:^|[\\b\\s])"+re),this.openRight||(re+="(?:[\\b\\s]|$)"),matchRegex=new RegExp(re,"i")},this.getRegex=function(){var retval=matchRegex.toString();return retval=retval.replace(/(^\/|\(\?:[^\)]+\)|\/i$)/g,"")},this.highlightWords=function(node){if(void 0!==node&&node&&matchRegex&&!skipTags.test(node.nodeName)){if(node.hasChildNodes())for(var i=0;i<node.childNodes.length;i++)this.highlightWords(node.childNodes[i]);if(3==node.nodeType&&(nv=node.nodeValue)&&(regs=matchRegex.exec(nv))){wordColor[regs[1].toLowerCase()]||(wordColor[regs[1].toLowerCase()]=colors[colorIdx++%colors.length]);var after,match=document.createElement(highlightTag);match.appendChild(document.createTextNode(regs[1])),match.style.color="$color-black",match.style.fontStyle="inherit",match.style.fontWeight="bolder",(after=regs[0].match(/^\s/)?node.splitText(regs.index+1):node.splitText(regs.index)).nodeValue=after.nodeValue.substring(regs[1].length),node.parentNode.insertBefore(match,after)}}},this.remove=function(){for(var arr=document.getElementsByTagName(highlightTag);arr.length&&(el=arr[0]);){var parent=el.parentNode;parent.replaceChild(el.firstChild,el),parent.normalize()}},this.apply=function(input){this.remove(),void 0!==input&&(input=input.replace(/(^\s+|\s+$)/g,""))&&(input=function(str,cstyle){for(var suppCP,pad,highsurrogate=0,outputString="",i=0;i<str.length;i++){var cc=str.charCodeAt(i);if((cc<0||65535<cc)&&(outputString+="!Error in convertCharStr2UTF16: unexpected charCodeAt result, cc="+cc+"!"),0!=highsurrogate){if(56320<=cc&&cc<=57343){if(suppCP=65536+(highsurrogate-55296<<10)+(cc-56320),cstyle){for(pad=suppCP.toString(16);pad.length<8;)pad="0"+pad;outputString+="\\U"+pad}else outputString+="\\u"+dec2hex4(55296|(suppCP-=65536)>>10)+"\\u"+dec2hex4(56320|1023&suppCP);highsurrogate=0;continue}outputString+="Error in convertCharStr2UTF16: low surrogate expected, cc="+cc+"!",highsurrogate=0}if(55296<=cc&&cc<=56319)highsurrogate=cc;else switch(cc){case 0:outputString+="\\0";break;case 8:outputString+="\\b";break;case 9:outputString+="\\t";break;case 10:outputString+="\\n";break;case 13:outputString+="\\r";break;case 11:outputString+="\\v";break;case 12:outputString+="\\f";break;case 34:outputString+='\\"';break;case 39:outputString+="\\'";break;case 92:outputString+="\\\\";break;default:if(31<cc&&cc<127)outputString+=String.fromCharCode(cc);else{for(pad=cc.toString(16).toUpperCase();pad.length<4;)pad="0"+pad;outputString+="\\u"+pad}}}return outputString}(input),this.setRegex(input),this.highlightWords(targetNode))}}function closeMessageBox(event){$(event.target).closest(".js-msg-box").hide()}$.fn.validateForm=function(){var input,select,textArea,isValid,failedOn,validationType,validationObject,radioSet,checkSet,bootstrapObjects,regexEmail=/\S+@\S+\.\S+/,regexName=/^[\p{a-zA-Z} \.'\-]+$/,regexPhone=/\+?(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)\d{1,14}$/,regexPhoneStrip=/[\s()+\-\.]|ext/gi,regexNameSpacesOnly=/^\s*$/,inputs=$(this).find("[class*=validate-]"),radioNamesets=[],checkNamesets=[],validationResults={allValid:!0,valid:[],invalid:[],inputs:[],textAreas:[],selects:[],checks:[],radios:[]};for(i=0,j=inputs.length;i<j;i++)if(input=$(inputs[i]),inputType=input.attr("type")?input.attr("type"):input.prop("tagName").toLowerCase(),"text"==inputType)isValid=!(failedOn=validationType=""),input.hasClass("validate-name")&&((input.val()!=input.attr("placeholder")&&0<input.val().length&&!input.val().match(regexName)||input.val()!=input.attr("placeholder")&&0<input.val().length&&input.val().match(regexNameSpacesOnly))&&(isValid=!1,failedOn="regexMatch"),0<!input.val().length&&(isValid=!1,failedOn="minCharCount"),35<input.val().length&&(isValid=!1,failedOn="maxCharCount"),validationType="name"),input.hasClass("validate-phone")&&(0<input.val().length&&!input.val().replace(regexPhoneStrip,"").match(regexPhone)&&(isValid=!1,failedOn="regexMatch"),validationType="phone"),input.hasClass("validate-email")&&((0<!input.val().length||!input.val().match(regexEmail))&&(isValid=!1,failedOn="regexMatch"),validationType="email"),input.hasClass("validate-required")&&((0==input.val().length||input.attr("placeholder")&&input.val()==input.attr("placeholder"))&&(isValid=!1,failedOn="required"),validationType=validationType&&0<validationType.length?validationType+=" required":"required"),validationObject={object:input,validationType:validationType,isValid:isValid},0<input.next().length&&input.next().attr("class").match(/selectList/gi)&&(validationObject.bootstrapObject=input.next()),!isValid&&0<failedOn.length&&(validationObject.failedOn=failedOn,validationResults.allValid=!1),isValid?validationResults.valid.push(validationObject):validationResults.invalid.push(validationObject),validationResults.inputs.push(validationObject);else if("textarea"==inputType)isValid=!(failedOn=validationType=""),(textArea=input).hasClass("validate-required")&&(0==textArea.val().length&&(isValid=!1,failedOn="required"),validationType="required"),textArea.hasClass("validate-minlength")&&(0<textArea.val().length&&textArea.val().length<2&&(isValid=!1,failedOn="minCharCount"),validationType="minCharCount"),validationObject={object:textArea,validationType:validationType,isValid:isValid},0<textArea.next().length&&textArea.next().attr("class").match(/selectList/gi)&&(validationObject.bootstrapObject=textArea.next()),!isValid&&failedOn&&0<failedOn.length&&(validationObject.failedOn=failedOn,validationResults.allValid=!1),isValid?validationResults.valid.push(validationObject):validationResults.invalid.push(validationObject),validationResults.textAreas.push(validationObject);else if("select"==inputType)isValid=!(failedOn=validationType=""),(select=input).hasClass("validate-required")&&(select.val()||(isValid=!1,failedOn="required"),validationType="required"),validationObject={object:select,validationType:validationType,isValid:isValid},0<select.next().length&&select.next().attr("class").match(/selectList/gi)&&(validationObject.bootstrapObject=select.next()),!isValid&&failedOn&&0<failedOn.length&&(validationObject.failedOn=failedOn,validationResults.allValid=!1),isValid?validationResults.valid.push(validationObject):validationResults.invalid.push(validationObject),validationResults.selects.push(validationObject);else if("radio"==inputType){if(radioSet=input.attr("name"),!$.inArray(radioSet,radioNamesets)){radioNamesets.push(radioSet),validationType="required",isValid=!(failedOn=""),bootstrapObjects=[];for(var i=0,j=(radioSet=$("[name="+radioSet+"][type=radio]")).length;i<j;i++)$(radioSet[i]).is(":checked")&&(isValid=!0),0<$(radioSet[i]).next().length&&$(radioSet[i]).next().attr("class").match(/selectList/gi)&&bootstrapObjects.push($(radioSet[i]).next());isValid||(failedOn="required"),validationObject={objects:radioSet,validationType:validationType,isValid:isValid},0<bootstrapObjects.length&&(validationObject.bootstrapObjects=bootstrapObjects),!isValid&&failedOn&&0<failedOn.length&&(validationObject.failedOn=failedOn,validationResults.allValid=!1),isValid?validationResults.valid.push(validationObject):validationResults.invalid.push(validationObject),validationResults.radios.push(validationObject)}}else if("checkbox"==inputType&&(checkSet=input.attr("name"),!$.inArray(checkSet,checkNamesets))){checkNamesets.push(checkSet),validationType="required",isValid=!(failedOn=""),bootstrapObjects=[];for(i=0,j=(checkSet=$("[name="+checkSet+"][type=check]")).length;i<j;i++)$(checkSet[i]).is(":checked")&&(isValid=!0),0<$(checkSet[i]).next().length&&$(checkSet[i]).next().attr("class").match(/selectList/gi)&&bootstrapObjects.push($(checkSet[i]).next());isValid||(failedOn="required"),validationObject={objects:checkSet,validationType:validationType,isValid:isValid},0<bootstrapObjects.length&&(validationObject.bootstrapObjects=bootstrapObjects),!isValid&&failedOn&&0<failedOn.length&&(validationObject.failedOn=failedOn,validationResults.allValid=!1),isValid?validationResults.valid.push(validationObject):validationResults.invalid.push(validationObject),validationResults.checks.push(validationObject)}return validationResults},window.App=window.App||{},App.helpers=App.helpers||{},App.helpers.device=App.helpers.device||{},App.video=App.video||{},App.constants=App.constants||{},App.features=App.features||{},App.urls={},-1===location.hostname.indexOf("localhost")&&-1===location.hostname.indexOf("10.0.2.2")&&-1===location.hostname.indexOf("10.0.0.1")||(App.debug=!0),-1!==location.hostname.indexOf("wwwcms")&&(App.staging=!0),App.constants.DESKTOP=990,App.constants.TABLETLG=989,App.constants.TABLETSM=768,App.constants.MOBILE=767,App.constants.MOBILEMQ="only screen and (max-width: 767px)",App.constants.TABLETMQ="only screen and (max-width: 989px)",App.constants.DESKTOPMQ="only screen and (min-width: 990px)",App.constants.CLK="click touchstart",window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console},App.helpers.BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown"},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;if(this.versionSearchString=data[i].subString,-1!=dataString.indexOf(data[i].subString))return data[i].identity}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(-1!=index)return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]},App.helpers.getWidth=function(){var newWidth=window.innerWidth?window.innerWidth:document.documentElement.clientWidth,browserString=App.helpers.BrowserDetect.browser+App.helpers.BrowserDetect.version;browserString&&"Explorer8"!==browserString&&App.helpers.innerWidth!==newWidth&&$(window).trigger("windowResize"),App.helpers.innerWidth=newWidth,App.helpers.device.desktop=App.helpers.innerWidth>App.constants.DESKTOP,App.helpers.device.tablet=App.helpers.innerWidth<=App.constants.TABLETLG&&App.helpers.innerWidth>App.constants.TABLETSM,App.helpers.device.mobile=App.helpers.innerWidth<=App.constants.MOBILE,App.helpers.device.desktopMQ=Modernizr.mq(App.constants.DESKTOPMQ),App.helpers.device.tabletMQ=Modernizr.mq(App.constants.TABLETMQ),App.helpers.device.mobileMQ=Modernizr.mq(App.constants.MOBILEMQ),App.debug},App.helpers.loadConditionalAssets=function(){},App.fileExists=function(filepath){var http=new XMLHttpRequest;return http.open("HEAD",filepath,!1),http.send(),404!=http.status},App.features={init:function(){var body=document.getElementsByTagName("head")[0],featureObjects=$("[data-features]"),features=["mobileHeaderSwitch","eqPodHeights","services","launchCustomerHelper","newsletterModal"];if(!featureObjects.length)return!1;for(var i=0,j=featureObjects.length;i<j;i++){var feature=$(featureObjects[i]).data("features");-1==$.inArray(feature,features)&&""!==feature&&features.push(feature)}for(i=0,j=features.length;i<j;i++){feature=features[i];var filepath=(App.debug?"":"/cs/AvayaCSS")+"/scripts/modules/features/"+feature+(App.debug?"":".min")+".js";if(!App.features[feature]){var script=document.createElement("script");script.type="text/javascript",script.src=filepath,"Explorer"==App.helpers.BrowserDetect.browser?script.onreadystatechange=function(){if("complete"==this.readyState||"loaded"==this.readyState){var feature=$(this).attr("src").split("/")[$(this).attr("src").split("/").length-1].split(".")[0];App.features[feature]&&"function"==typeof App.features[feature].init&&App.features[feature].init()}}:script.onload=function(){var feature=$(this).attr("src").split("/")[$(this).attr("src").split("/").length-1].split(".")[0];App.features[feature]&&"function"==typeof App.features[feature].init&&App.features[feature].init()},body.appendChild(script)}}}},App.helpers.eqMegaHeaders=function(eq){var els={};return calcHeights=function(){$("div.col-wrap").each(function(i){var innerListSelect=$("div.col-wrap:eq("+i+")").find("ul.inner-list:nth-of-type(1)"),innerDivSelect=$("div.col-wrap:eq("+i+")").find("div.title:nth-of-type(1)"),max_height=($("div.col-wrap:eq("+i+")").find("div.viewAll-levelOne"),0),max_div_height=0;$(innerListSelect).css("height","auto");for(var k=0,l=innerListSelect.length;k<l;k++){var cur_height=$(innerListSelect[k]).height();max_height=max_height<cur_height?cur_height:max_height,max_div_height=max_div_height<(cur_div_height=$(innerDivSelect[k]).height())?cur_div_height:max_div_height}for(k=0,l=innerListSelect.length;k<l;k++){var cur_div_height;innerListHeight=max_height,(cur_div_height=$(innerDivSelect[k]).height())<max_div_height&&(innerListHeight=max_height+max_div_height-cur_div_height),$(innerListSelect[k]).height(innerListHeight)}i=0;for(var len=els.megaNav.length;i<len;i++){var maxHeight,innerListHeight,menu=$(els.megaNav[i]),columns=$("li.col, li.ad",menu),heights=[];for(k=0,l=columns.length;k<l;k++)$(columns[k]).css("height","auto"),heights.push($(columns[k]).outerHeight());heights.sort().reverse(),maxHeight=heights[0];var minHeight=menu.innerHeight();if(maxHeight<minHeight&&(maxHeight=minHeight),0<maxHeight)for(k=0,l=columns.length;k<l;k++)$(columns[k]).height(maxHeight)}})},eq.init=function(parent,child){App.debug&&log("App.helpers.eqMegaHeaders.init"),els.megaNav=$("ul.secondary-nav","#main-nav"),calcHeights()},$(window).bind("windowResize",function(){eq.init()}),eq}(App.helpers.eqMegaHeaders||{}),App.helpers.setupCarousels=function(carousel){return carousel.init=function(){App.debug&&log("App.helpers.setupCarousels");var $c=$(".carousel"),carouselId=$c.attr("id");$c.append('<ol class="carousel-indicators"></ol>');var $ind=$(".carousel-indicators"),itemLen=$c.find(".carousel-inner").children(".item").length,slideCount=1;if(1<itemLen){for(var i=0;i<itemLen;i++)0===i?$ind.append('<a href="" class="touch"><li data-target="#'+carouselId+'" data-slide-to="'+i+'" class="active"></li></a>'):$ind.append('<a href="" class="touch"><li data-target="#'+carouselId+'" data-slide-to="'+i+'"></li></a>');$c.length&&($(".carousel").carousel(),$(".carousel").off("slid").on("slid","",function(){slideCount===2*itemLen&&($(".carousel").carousel("pause"),$(".carousel").carousel("kill")),slideCount++}))}else $(".carousel-control").each(function(){$(this).removeClass("carousel-control").removeClass("visible-phone").hide()})},carousel}(App.helpers.setupCarousels||{}),App.features.modalAPI=function(modal){var el={},embed={targetId:"myEmbedTarget",wid:"",uiconf_id:"",entry_id:"",flashvars:{"Kaltura.LeadWithHTML5":"false"},params:{wmode:"transparent"}},embedObj={},events=function(){$('a.video-modal[data-toggle="modal"]').off("click").on("click",function(){var $this=$(this);if(console.log("clicked!"),"#video-modal"!==$this.attr("href")||!$this.data("modal-title")||!$this.data("source")||"undefined"==typeof kWidget)return!1;console.log("passed if");var title,content,target,lMargin,modalTitle=$this.data("modal-title"),sourceStr=$this.data("source").replace(/\r?\n|\r/g,"$1"),widgetId="_"+sourceStr.replace(/.*\/p\/(.*)\/sp\/.*/,"$1"),playerId=sourceStr.replace(/.*uiconf_id\/(.*)\/partner_id.*/,"$1"),videoId=sourceStr.replace(/.*entry_id\=(.*)\&playerId.*/,"$1"),beforeContent=$this.data("before"),afterContent=$this.data("after");(embedObj=_.extend({},embed)).uiconf_id=playerId,embedObj.entry_id=videoId,embedObj.wid=widgetId,console.log(embedObj),title=modalTitle,el.modal.find("h4").html(title),content=beforeContent,el.modal.find(".before-content").html(content),function(content){el.modal.find(".after-content").html(content)}(afterContent),target=$("#myEmbedTarget"),App.helpers.device.mobile||App.helpers.device.mobileMQ?(target.css({width:"100%",height:"auto"}),target.find("iframe").css({width:"100%",height:"auto"})):(target.css({width:"550px",height:"310px"}),target.find("iframe").css({width:"550px",height:"310px"})),App.helpers.device.mobile&&App.helpers.device.mobileMQ||(lMargin=el.modal.width()/2*-1,el.modal.css({"margin-left":lMargin}))}),el.modal.off("hidden").on("hidden",function(){kWidget.destroy("myEmbedTarget"),embedObj={},el.modal.css({"margin-left":"0"})}),el.modal.off("shown").on("shown",function(){console.log("shown!"),el.videoWrap.html('<div id="myEmbedTarget"></div>');try{kWidget.embed(embedObj)}catch(e){log("error: "+e)}})};return modal.init=function(){el.videoVars=$("#videoModalVars"),el.videoWrap=$("#video_wrap"),el.modal=$("#video-modal"),events()},modal}(App.features.modalAPI||{}),App.features.oldBrowserHelper=function(old){"use strict";var cookie,el={},defaults_cookieName="AvayaOldBrowserNotice",defaults_cookieValue=!0,defaults_wrapper="#browser-notice-bar",events=function(){el.a.on("click",".close",function(){$.cookie(defaults_cookieName,defaults_cookieValue),setTimeout(function(){el.a.fadeOut()},250)}),(cookie=$.cookie(defaults_cookieName))&&void 0!==cookie||el.a.fadeIn()};return old.init=function(){if(!Modernizr.ie8compat)return!1;$("body").append('<div id="browser-notice-bar" data-features="oldBrowserHelper"><div class="container"><div class="message">For the optimal experience please <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie" target="_blank">upgrade</a> your browser.<div class="close">×</div></div></div></div>'),el.a=$(defaults_wrapper),events()},old}(App.features.oldBrowserHelper||{}),App.helpers.resizeThrottle=function(throttle){var plug=function(){var sr;jQuery,sr="debouceresize",jQuery.fn[sr]=function(fn){return fn?this.bind("resize",(func=fn,function(){var obj=this,args=arguments;timeout?clearTimeout(timeout):execAsap&&func.apply(obj,args),timeout=setTimeout(function(){execAsap||func.apply(obj,args),timeout=null},threshold||100)})):this.trigger(sr);var func,threshold,execAsap,timeout}};return throttle.init=function(){plug();var throttledFuncs=_.throttle(function(){App.debug&&log("throttled resize event"),App.helpers.getWidth()},1500);$(window).debouceresize(function(){throttledFuncs()})},throttle}(App.helpers.resizeThrottle||{}),App.helpers.checkWidthConditions=(App.helpers.checkWidthConditions,void App.helpers.getWidth()),App.initialize=function(){App.helpers.eqMegaHeaders.init(),App.helpers.resizeThrottle.init(),App.helpers.BrowserDetect.init(),App.helpers.setupCarousels.init(),App.features.oldBrowserHelper.init(),$('[data-toggle="modal"]')&&App.features.modalAPI.init(),function($){var o=$({});$.subscribe=function(){o.on.apply(o,arguments)},$.unsubscribe=function(){o.off.apply(o,arguments)},$.publish=function(){o.trigger.apply(o,arguments)}}(jQuery),App.features.init(),App.helpers.getWidth()},App.helpers.pop=function(url,width,height){var leftPosition,topPosition;leftPosition=window.screen.width/2-(width/2+10),topPosition=window.screen.height/2-(height/2+50),window.open(url,"Window2","status=no,height="+height+",width="+width+",resizable=yes,left="+leftPosition+",top="+topPosition+",screenX="+leftPosition+",screenY="+topPosition+",toolbar=no,menubar=no,scrollbars=no,location=no,directories=no")},1==App.debug?(App.urls.baseUrl="http://localhost:9000/",App.urls.tvDataUrl="tv-data.html?d=&pagename=GetVideoFilter",App.urls.tvHomePageDataUrl="tv-data.html?d=&pagename=GetVideoFilter",App.urls.tvNoDataUrl="tv-no-data.html?d=&pagename=GetVideoFilter",App.urls.tvSearchUrl="tv-data.html?q=",App.urls.tvCategoryUrl="tv-data.html?filter=",App.urls.tvDetailUrl="tv-data.html?videoid=",App.urls.tvTopicUrl="tv-topics-data.html",App.urls.tvTranscriptsDataUrl="tv-transcripts-data.html?",App.urls.tvFeaturedDataUrl="tv-featured-data.html?",App.urls.tvLandingPageUrl="avaya-tv.html",App.urls.tvHomePageUrl="3_tv_home.html",App.urls.tvCategoryPageUrl="3_tv_category.html",App.urls.tvSearchPageUrl="3_tv_search.html",App.urls.tvDetailPageUrl="3_tv_detail.html",App.urls.searchLandingPageUrl="/3_search_landing.html?",App.urls.countryListUrl="country-list.html",App.urls.solutionFinderStart="/cs/AvayaCSS/solutions-finder/data/start.html?",App.urls.solutionFinderSupportingFact="/cs/AvayaCSS/solutions-finder/data/supporting-fact.html?",App.urls.solutionFinderResults="/cs/AvayaCSS/solutions-finder/data/results.html?"):(App.urls.tvDataUrl="/cs/Satellite?d=&pagename=GetVideoFilter",App.urls.tvHomePageDataUrl="/cs/Satellite?pagename=Avasites/Avaya/VideoPortal/LandingPageAPI",App.urls.tvNoDataUrl="tv-no-data.html?d=&pagename=GetVideoFilter",App.urls.tvSearchUrl="/cs/Satellite?pagename=Avasites/Avaya/VideoPortal/SearchAPI&q=",App.urls.tvCategoryUrl="/cs/Satellite?pagename=Avasites/Avaya/VideoPortal/CategoryPageAPI&test=test&filter=",App.urls.tvDetailUrl="/cs/Satellite?pagename=Avasites/Avaya/VideoPortal/DetailPageAPI&videoid=",App.urls.tvTopicUrl="/cs/Satellite?pagename=Avasites/Avaya/VideoPortal/TopicListAPI",App.urls.tvTranscriptsDataUrl="/cs/Satellite?pagename=Avasites/Avaya/Utility/getVideoTranscript",App.urls.tvFeaturedDataUrl="/cs/Satellite?pagename=Avasites/Avaya/Utility/getFeaturedHomeVideos",1==App.staging?(App.urls.tvHomePageUrl="/cs/avaya/en/videos/",App.urls.tvCategoryPageUrl="/cs/avaya/en/videos/category/",App.urls.tvSearchPageUrl="/cs/avaya/en/videos/search-results/"):(App.urls.tvHomePageUrl="/en/videos/",App.urls.tvCategoryPageUrl="/en/videos/category/",App.urls.tvSearchPageUrl="/en/videos/search-results/"),App.urls.tvDetailPageUrl="3_tv_detail.html",App.urls.searchLandingPageMenuUrl="/en/search-results/?site=all_usa",App.urls.searchLandingPageUrl="/en/search-results/?site=products_usa",App.urls.countryListUrl="/cs/Satellite?pagename=Avasites/Avaya/Common/ListOfCoutries&test=false",App.urls.solutionFinderStart="/cs/Satellite?d=&pagename=getdata",App.urls.solutionFinderSupportingFact="/cs/Satellite?d=&pagename=getdata",App.urls.solutionFinderResults="/cs/AvayaCSS/solutions-finder/results.html"),App.constants.requestType="get",$(function(){App.initialize(),$("#butler").find('.search input[type="text"]').on("keyup",function(){var $ps=$(".predictive");""===$(this).val()?$ps.fadeOut():$ps.fadeIn()}),Modernizr.touch&&1<=$(".carousel").length&&$(".carousel").swipe({swipeLeft:function(){$(this).carousel("next")},swipeRight:function(){$(this).carousel("prev")}})});for(var selectLists=$(".selectList"),signInLink=function(){window.location.href=getSignInLink()},k=0,j=selectLists.length;k<j;k++)$(selectLists[k]).selectList();var getSignInLink=function(){return $(".app-urls").find("#sign-in").text()},getSignOutLink=function(){return $(".app-urls").find("#sign-out").text()},getShowTermsLink=function(){return $(".app-urls").find("#TNC").text()},getShowPrivacyLink=function(){return $(".app-urls").find("#pp").text()},getGenericErrorMessage=function(){return $(".app-urls").find("#generic-error-message").text()},showLoader=function(){$(".page-level-loader").addClass("show-loader")},postCartDescriptionApi=function(){return $(".app-urls").find("#post-cart-description").text()},getCartApi=function(){return $(".app-urls").find("#get-cart").text()},getCartCountApi=function(){return $(".app-urls").find("#get-cart-count").text()},getOrderApi=function(){return $(".app-urls").find("#get-order-invoice").text()},getAgentQuoteDetails=function(){return $(".app-urls").find("#agent-quote-details").text()},getCompanyApi=function(){return $(".app-urls").find("#get-company-info").text()},getMyAdminsApi=function(){return $(".app-urls").find("#get-agents-info").text()},getMyAgentsApi=function(){return $(".app-urls").find("#get-myagents-info").text()},getMyAgentsUserApi=function(){return $(".app-urls").find("#get-myagents-users-info").text()},getMyCustomersApi=function(){return $(".app-urls").find("#get-myCustomers-info").text()},getsearchAgentsUserApi=function(){return $(".app-urls").find("#get-searchAgents-info").text()},getQuoteDownload=function(){return $(".app-urls").find("#quote-download").text()},getInvoiceDownload=function(){return $(".app-urls").find("#invoice-download").text()},getRolesTypeApi=function(){return $(".app-urls").find("#get-roles-info").text()},getAddToCartApi=function(){return $(".app-urls").find("#add-cart").text()},getUpdateQuoteCartApi=function(){return $(".app-urls").find("#update-quote-items").text()},getUpdateCartApi=function(){return $(".app-urls").find("#update-cart").text()},getAccountDetailsApi=function(){return $(".app-urls").find("#get-user-details").text()},getSubscriptionsApi=function(){return $(".app-urls").find("#get-subscriptions-details").text()},getSubscriptionschangeOrderApi=function(){return $(".app-urls").find("#get-subscriptions-order-details").text()},getSubscriptionsInfoApi=function(){return $(".app-urls").find("#get-subscription-info").text()},createUser=function(){return $(".app-urls").find("#create-user").text()},createUserAgent=function(){return $(".app-urls").find("#create-user-agent").text()},updateUser=function(){return $(".app-urls").find("#update-user").text()},updatePassword=function(){return $(".app-urls").find("#update-password").text()},submitCartApi=function(){return $(".app-urls").find("#submit-cart").text()},removeCartItemApi=function(){return $(".app-urls").find("#remove-cart-item").text()},updateCartContractApi=function(){return $(".app-urls").find("#update-cart-contract").text()},getAddOnsApi=function(){return $(".app-urls").find("#get-add-ons").text()},getHardwareApi=function(){return $(".app-urls").find("#get-hardware-data").text()},getBundleDataApi=function(){return $(".app-urls").find("#get-bundle-data").text()},getProductDataApi=function(){return $(".app-urls").find("#get-product-data").text()},getItemDetailsApi=function(){return $(".app-urls").find("#get-item-details").text()},gettermsConditionsApi=function(){return $(".app-urls").find("#quote-get-tnc").text()},getstandardTncApi=function(){return $(".app-urls").find("#get-general-tnc").text()},sendTermsConditionsDocumentApi=function(){return $(".app-urls").find("#quote-save-tnc").text()},sendGeneralTermsConditionsApi=function(){return $(".app-urls").find("#save-general-tnc").text()},submitAdminActionApi=function(){return $(".app-urls").find("#action-admin").text()},getProductDetailsApi=function(){return $(".app-urls").find("#get-product-details").text()},postLNPFormDataApi=function(){return $(".app-urls").find("#lnp-form-data").text()},postRODAAFormDataApi=function(){return $(".app-urls").find("#rodaa-form-data").text()},getFeatureDetailsApi=function(){return $(".app-urls").find("#get-feature-details").text()},getHardwareDetailsApi=function(){return $(".app-urls").find("#get-hardware-details").text()},getabelsDataApi=function(){return $(".app-urls").find("#get-labels-data").text()},getPartnerLabelsDataApi=function(){return $(".app-urls").find("#get-partner-labels-data").text()},getUcProductLabelsDataApi=function(){return $(".app-urls").find("#get-uc-product-labels-data").text()},getCcProductLabelsDataApi=function(){return $(".app-urls").find("#get-cc-product-labels-data").text()},getAddOnsDataApi=function(){return $(".app-urls").find("#get-add-ons-data").text()},getCatalogDataApi=function(){return $(".app-urls").find("#get-catalog-data").text()},getConfiguratorLink=function(){return $(".app-urls").find("#configurator").text()},getBundleConfiguratorLink=function(){return $(".app-urls").find("#configurator2").text()},getAdditionalOptionsLink=function(){return $(".app-urls").find("#additional-options").text()},getSoldToListApi=function(){return $(".app-urls").find("#get-sold-to-list").text()},getPartnerInfoApi=function(){return $(".app-urls").find("#get-partner-info").text()},getCheckDirectApi=function(){return $(".app-urls").find("#check-direct").text()},getCustomerBySoldToApi=function(){return $(".app-urls").find("#check-soldto-address").text()},getCustomerByAddressApi=function(){return $(".app-urls").find("#check-soldto-nameaddress").text()},getCreateEndCustomerApi=function(){return $(".app-urls").find("#check-create-endcustomer").text()},getUpdateQuoteApi=function(){return $(".app-urls").find("#update-quote").text()},sendEmailApi=function(){return $(".app-urls").find("#send-email-quote").text()},getPartnerInfoT1Api=function(){return $(".app-urls").find("#get-partner-info-t1").text()},getPartnerSoldToAddressApi=function(){return $(".app-urls").find("#get-partner-soldTo-address").text()},getPartnerInfoT2Api=function(){return $(".app-urls").find("#get-partner-info-t2").text()},getBillToListApi=function(){return $(".app-urls").find("#get-bill-to-list").text()},getLacDataApi=function(){return $(".app-urls").find("#get-lac-data").text()},getlicenseDataApi=function(){return $(".app-urls").find("#get-license-data").text()},getdownloadsDataApi=function(){return $(".app-urls").find("#get-downloads-data").text()},getdownloadLinkApi=function(){return $(".app-urls").find("#get-download-link").text()},getCpaasDetailsApi=function(){return $(".app-urls").find("#get-cpaas-details").text()},getFileUploadApi=function(){return $(".app-urls").find("#file-upload").text()},phoneFileUploadApi=function(){return $(".app-urls").find("#upload-receipt").text()},getActivateLicenseApi=function(){return $(".app-urls").find("#activate-license").text()},getActivationStatusApi=function(){return $(".app-urls").find("#get-activation-status").text()},getZangCreditApi=function(){return $(".app-urls").find("#get-zang-credit").text()},getStoreLink=function(){return $(".app-urls").find("#store-link").text()},getStoreLandingLink=function(){return $(".app-urls").find("#store-landing").text()},getCartLink=function(){return $(".app-urls").find("#cart").text()},getHelpLink=function(){return $(".app-urls").find("#help-dashboard").text()},getManageLink=function(){return $(".app-urls").find("#manage-subscriptions").text()},getCheckoutLink=function(){return $(".app-urls").find("#checkout").text()},getagentURL=function(){return $(".app-urls").find("#agent-url").text()},getRemoveCartApi=function(){return $(".app-urls").find("#drop-cart").text()},getEmailIdsApi=function(){return $(".app-urls").find("#email-id").text()},getSubscriptionConfigureUrl=function(){return $(".app-urls").find("#subscription-configurator").text()},postSubscriptionItemsApi=function(){return $(".app-urls").find("#subscription-submit").text()},getThankYouLink=function(){return $(".app-urls").find("#thankyou").text()},getLabEnvironments=function(){return $(".app-urls").find("#get-lab-environments").text()},getLabStatus=function(){return $(".app-urls").find("#get-lab-status").text()},getActivateLab=function(){return $(".app-urls").find("#lab-activate").text()},startLab=function(){return $(".app-urls").find("#start-lab").text()},suspendLab=function(){return $(".app-urls").find("#suspend-lab").text()},destroyLab=function(){return $(".app-urls").find("#destroy-lab").text()},deleteLab=function(){return $(".app-urls").find("#delete-lab").text()},getLabProducts=function(){return $(".app-urls").find("#get-lab-products").text()},updateLabName=function(){return $(".app-urls").find("#update-lab-name").text()},findStatesList=function(){return $(".app-urls").find("#find-states-list").text()},findCitiesList=function(){return $(".app-urls").find("#find-cities-list").text()},findCitiesByCountryList=function(){return $(".app-urls").find("#find-cities-by-country-list").text()},getDirectoryListings=function(){return $(".app-urls").find("#get-directory-listings").text()},getDirectoryListingsByKeywords=function(){return $(".app-urls").find("#get-directory-listings-by-keywords").text()},getDirectoryListingsByState=function(){return $(".app-urls").find("#get-directory-listings-by-state").text()},getDirectoryListingsByCountry=function(){return $(".app-urls").find("#get-directory-listings-by-country").text()},getLocations=function(){return $(".app-urls").find("#get-locations").text()},getCountries=function(){return $(".app-urls").find("#get-countries").text()},getPartnerLevels=function(){return $(".app-urls").find("#get-partner-levels").text()},getPartnerDetails=function(){return $(".app-urls").find("#get-partner-details").text()},getEnterpriseBaseUrl=function(){return $(".app-urls").find("#enterprise-base-url").text()},saveProductCart=function(){return $(".app-urls").find("#save-product-cart").text()},getPurchaseOrderApi=function(){return $(".app-urls").find("#get-po-details").text()},getUserTypeApi=function(){return $(".app-urls").find("#get-user-type").text()},getCustomerTypeApi=function(){return $(".app-urls").find("#get-customer-type").text()},getSelectAgentApi=function(){return $(".app-urls").find("#super-set-view").text()},resetSelectAgentApi=function(){return $(".app-urls").find("#super-reset-view").text()},cancelSubscriptionApi=function(){return $(".app-urls").find("#cancel-subscription").text()},getMasterAgentApi=function(){return $(".app-urls").find("#get-master-agent").text()},getAgentApi=function(){return $(".app-urls").find("#get-agent").text()},getMidMarketDashboard=function(){return $(".app-urls").find("#midmarket-dashboard").text()},getTollFreeNumberApi=function(){return $(".app-urls").find("#toll-freenumber").text()},getLocalNumberApi=function(){return $(".app-urls").find("#local-number").text()},submitPhoneNumberApi=function(){return $(".app-urls").find("#submit-phone-number").text()},submitHelpApi=function(){return $(".app-urls").find("#submit-help-form").text()},postAgentsDataApi=function(){return $(".app-urls").find("#save-agents").text()},getLNPPdf=function(){return $(".app-urls").find("#loa-form-pdf").text()},getRODAAPdf=function(){return $(".app-urls").find("#rodaa-form-pdf").text()},createStandaloneQuote=function(){return $(".app-urls").find("#create-standalone-quote").text()},editPOApi=function(){return $(".app-urls").find("#edit-po").text()},deletePOApi=function(){return $(".app-urls").find("#delete-po").text()},getBillToApi=function(){return $(".app-urls").find("#get-billto-details").text()},getShipToApi=function(){return $(".app-urls").find("#get-shipto-details").text()},getUcItemId=function(){return $(".app-urls").find("#uc-item-id").text()},getCcItemId=function(){return $(".app-urls").find("#cc-item-id").text()},getEfaxItemId=function(){return $(".app-urls").find("#efax-item-id").text()},getEfax2ItemId=function(){return $(".app-urls").find("#efax-2-item-id").text()},getAcrItemId=function(){return $(".app-urls").find("#acr-item-id").text()},getAtaItemId=function(){return $(".app-urls").find("#ata-item-id").text()},setNewCustomerApi=function(){return $(".app-urls").find("#add-as-customer").text()},getCompanyDomainApi=function(){return $(".app-urls").find("#get-company-domain").text()},validateCompanyDomainApi=function(){return $(".app-urls").find("#validate-company-domain").text()},getInvoiceDetailsApi=function(){return $(".app-urls").find("#get-invoice-details").text()},invoicesDetailsLinkApi=function(){return $(".app-urls").find("#invoice-details-link").text()},postMyPaymentInfoApi=function(){return $(".app-urls").find("#update-payment-info").text()},saveSelectedAgentApi=function(){return $(".app-urls").find("#reassign-agent-user").text()},getAgentUsersApi=function(){return $(".app-urls").find("#get-agent-users").text()},getHomepageLink=function(){return $(".app-urls").find("#").text()},getTax=function(){return $(".app-urls").find("#get-tax-info").text()},updateUrlActionApi=function(){return $(".app-urls").find("#update-agent-shortname").text()},assignCartBackToAgentApi=function(){return $(".app-urls").find("#assign-cart-to-agent").text()},getCreditCardDetailsApi=function(){return $(".app-urls").find("#get-credit-card-details").text()},submitExportPdfApi=function(){return $(".app-urls").find("#export-pdf").text()},submitExportExcelApi=function(){return $(".app-urls").find("#export-excel").text()},submitforgotPasswordFormApi=function(){return $(".app-urls").find("#forgot-password").text()},cxoLanding=function(){return $(".app-urls").find("#cxo-landing").text()},enterpriseStoreLink=function(){return $(".app-urls").find("#enterprise-store-link").text()},submitOtpPasswordApi=function(){return $(".app-urls").find("#otp-password").text()},submitResetPasswordApi=function(){return $(".app-urls").find("#reset-password").text()},freetrialExceededCheck=function(){return $(".app-urls").find("#freetrial-exceeded-check").text()},getSpacesProductLabelsDataApi=function(){return $(".app-urls").find("#get-spaces-product-labels-data").text()},getSpacesItemId=function(){return $(".app-urls").find("#spaces-item-id").text()},getForgotPasswordPopup=function(){return $(".app-urls").find("#forgot-password-popup-status").text()},getExportPdfFormApi=function(){return $(".app-urls").find("#get-export-pdf").text()},getExportExcelFormApi=function(){return $(".app-urls").find("#get-export-excel").text()},getHelpLinkStatus=(getHelpLink=function(){return $(".app-urls").find("#get-help-link").text()},function(){return $(".app-urls").find("#help-link-status").text()}),getCountriesList=function(){return $(".app-urls").find("#get-countries-states-list").text()},postQuoteSettings=function(){return $(".app-urls").find("#post-quote-settings").text()},hideLoader=function(status,message){var serverMessage=$(".server-status-message");status=status||!0,$(".page-level-loader").removeClass("show-loader"),serverMessage.text(message),serverMessage.addClass("show"+(0==status?" error":"")),setTimeout(function(){serverMessage.text(""),serverMessage.removeClass("show")},5e3)},getQueryString=function(field,url){var href=url||window.location.href,string=new RegExp("[?&]"+field+"=([^&#]*)","i").exec(href);return string?string[1]:null};function getCookieValue(cname){var name=cname+"=",decodedCookie=decodeURIComponent(document.cookie);console.log(decodedCookie,document.cookie);for(var ca=decodedCookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}jQuery.fn.selectList=function(){var originalSelect=this,originalOptions=originalSelect.children("option"),originalId=originalSelect.attr("id")?originalSelect.attr("id"):"",originalClasses=originalSelect.attr("class")?originalSelect.attr("class"):"",originalValue=0<originalSelect.find(":selected").length?originalSelect.find(":selected")[0].innerHTML:$(originalOptions[0]).html(),existingSelectList=originalSelect.next(".selectList_container");existingSelectList&&0<existingSelectList.length&&existingSelectList.remove();originalSelect.outerWidth();originalSelect.css({position:"absolute",left:-9999}),originalSelect.bind("focus",function(){setBindings(!0)});var newContainer="<div class='selectList_container "+originalClasses+"'"+(originalId&&""!=originalId?"id='"+originalId+"_selectList'":"")+"><div class='selectList_value'><span class='selectValue_content'>"+originalValue+"</span><span class='select-carat'></span></div><div class='selectList_optionsWrapper'><ul class='selectList_options' style='display: none;'></ul></div></div>";$(newContainer).insertAfter(originalSelect);var newValue=(newContainer=this.next()).find(".selectList_value .selectValue_content"),newList=newContainer.find(".selectList_options"),newItems="";$(document).click(function(){newList.is(":visible")&&toggleList(),setBindings(!1)}),newContainer.bind("click",function(e){e.preventDefault(),e.stopPropagation()});var setValueFrom=function(item){if(item&&item.length&&!item.hasClass("disabled")){var thisText=item.html(),thisValue=item.attr("name");newValue.html(thisText).attr({name:thisValue}),originalSelect.val(thisValue).trigger("change"),toggleList()}},setBindings=function(set){set?$(document).unbind("keydown").bind("keydown",function(e){e.preventDefault(),e.stopPropagation();var key=e.keyCode,itemChanged=!1;if(newList.is(":visible")&&/[a-zA-Z]/.test(String.fromCharCode(e.which))){var letter=String.fromCharCode(key).toLowerCase(),option=$($("li.starts-with-"+letter,newList)[0]);option&&option.length&&($("li.active",newList).removeClass("active"),option.addClass("active"),itemChanged=!0)}if(40==key)if(newList.is(":visible"))if(itemChanged=!0,(selectedItem=$("li.active",newList))&&selectedItem.length){selectedItem.removeClass("active");var nextItem=selectedItem.next("li");nextItem&&nextItem.length?nextItem.addClass("active"):$($("li",newList)[0]).addClass("active")}else $($("li",newList)[0]).addClass("active");else newList.toggle();else if(38==key){var selectedItem;if(newList.is(":visible"))if(itemChanged=!0,(selectedItem=$("li.active",newList))&&selectedItem.length){selectedItem.removeClass("active");var prevItem=selectedItem.prev("li");prevItem&&prevItem.length?prevItem.addClass("active"):$($("li",newList)[$("li",newList).length-1]).addClass("active")}else $($("li",newList)[$("li",newList).length-1]).addClass("active")}else if(27==key)toggleList();else if(13==key||32==key)if(newList.is(":visible")){var activeItem=$("li.active",newList);activeItem&&activeItem.length&&setValueFrom(activeItem)}else toggleList();else if(e.shiftKey&&9==key){var thisSelect=originalSelect[0],prevInput=(inputs=$(":input")).get(inputs.index(thisSelect)-1);prevInput&&(setBindings(!1),newList.fadeOut(),prevInput.focus())}else if(9==key){thisSelect=originalSelect[0];var inputs,nextInput=(inputs=$(":input")).get(inputs.index(thisSelect)+1);nextInput&&(setBindings(!1),newList.fadeOut(),nextInput.focus())}if(itemChanged){var newItem=$("li.active",newList);if(newItem.position().top+newItem.outerHeight()>newList.outerHeight()||newItem.position().top<0||newItem.position().top+newItem.outerHeight()>newList.outerHeight()){newList.scrollTop(0);var itemOffset=newItem.position().top;newItem.position().top+newItem.outerHeight()>newList.outerHeight()?newList.scrollTop(itemOffset-newList.outerHeight()+newItem.outerHeight()):newList.scrollTop(itemOffset)}}}):$(document).unbind("keydown")},toggleList=function(){newList.is(":visible")?setBindings(!1):setBindings(!0),lists=$(".selectList_options");for(var i=0,j=lists.length;i<j;i++)lists[i]!==newList[0]&&$(lists[i]).fadeOut(125);newList.fadeToggle(125,function(){})};for(i=0,j=originalOptions.length;i<j;i++){var thisOption=$(originalOptions[i]),optionText=thisOption.html(),newItem="<li name='"+thisOption.val()+"' class='";0==i?newItem+="first":i==j-1&&(newItem+="last"),thisOption.attr("disabled")&&(newItem+=" disabled"),newItem+=" starts-with-"+optionText.toLowerCase().trim().split("")[0],newItems+=newItem+="'>"+optionText+"</li>"}$(newList).append(newItems);var newOptions=newContainer.find(".selectList_options li");for(newOptions.css({display:"block"}),newValue.parent().click(function(){toggleList()}),i=0,j=newOptions.length;i<j;i++)$(newOptions[i]).click(function(){setValueFrom($(this))});this.change(function(){newValue.html($(this).find("option:selected").text())})},function($){var $w=$(window);$.fn.visible=function(partial,hidden,direction){if(!(this.length<1)){var $t=1<this.length?this.eq(0):this,t=$t.get(0),vpWidth=$w.width(),vpHeight=$w.height(),clientSize=(direction=direction||"both",!0!==hidden||t.offsetWidth*t.offsetHeight);if("function"==typeof t.getBoundingClientRect){var rec=t.getBoundingClientRect(),tViz=0<=rec.top&&rec.top<vpHeight,bViz=0<rec.bottom&&rec.bottom<=vpHeight,lViz=0<=rec.left&&rec.left<vpWidth,rViz=0<rec.right&&rec.right<=vpWidth,vVisible=partial?tViz||bViz:tViz&&bViz,hVisible=partial?lViz||rViz:lViz&&rViz;if("both"===direction)return clientSize&&vVisible&&hVisible;if("vertical"===direction)return clientSize&&vVisible;if("horizontal"===direction)return clientSize&&hVisible}else{var viewTop=$w.scrollTop(),viewBottom=viewTop+vpHeight,viewLeft=$w.scrollLeft(),viewRight=viewLeft+vpWidth,offset=$t.offset(),_top=offset.top,_bottom=_top+$t.height(),_left=offset.left,_right=_left+$t.width(),compareTop=!0===partial?_bottom:_top,compareBottom=!0===partial?_top:_bottom,compareLeft=!0===partial?_right:_left,compareRight=!0===partial?_left:_right;if("both"===direction)return!!clientSize&&compareBottom<=viewBottom&&viewTop<=compareTop&&compareRight<=viewRight&&viewLeft<=compareLeft;if("vertical"===direction)return!!clientSize&&compareBottom<=viewBottom&&viewTop<=compareTop;if("horizontal"===direction)return!!clientSize&&compareRight<=viewRight&&viewLeft<=compareLeft}}}}(jQuery),avayaBlog.controller("avaya-blog",function($scope,$rootScope,presslyService,tvDataService){$scope.mainImageResizeValues="",$scope.secondaryImageResizeValues="";var ellipsifyFactor=1;window.onbeforeunload=function(){},$scope.$watch("hiddenLocale",function(oldValue,newValue){newValue&&("ko_KR"==$scope.hiddenLocale&&(ellipsifyFactor=.65),"zh_CN"!=$scope.hiddenLocale&&"ja_JP"!=$scope.hiddenLocale||(ellipsifyFactor=.5),tvDataService.getFeaturedList($scope.hiddenLocale).then(function(response){$scope.featuredVideoList=response.tvData.featuredVideos},function(error){$scope.hideFeaturedVideos=!0,console.log("Unable to retrieve featured video data.")}))});var windowWidth=$(window).width();function applyImageResizing(){windowWidth=$(window).width(),Number(windowWidth)<1025?($scope.mainImageResizeValues="",$scope.secondaryImageResizeValues=""):($scope.mainImageResizeValues="&size=600x440&op=cover",$scope.secondaryImageResizeValues="&size=300x220&op=cover")}presslyService.getPerspectivesFeed(App.urls.presslyPerspectivesFeedUrl,App.constants.requestType).then(function(result){$scope.articleList=result.data,$scope.showPerspectives=!0,applyImageResizing()},function(error){console.log("Unable to retrieve perspectives feed."),$scope.showPerspectives=!1}),$scope.toutImageResizeValues="&size=440x300&op=cover",$(window).resize(function(){applyImageResizing(),windowWidth=$(window).width()}),$rootScope.ellipsify=function(title,maxLength,applyFactor){return maxLength*=1==applyFactor?ellipsifyFactor:1,title.length>maxLength?title.substring(0,maxLength)+"...":title}}),avayaBlog.controller("avaya",function($scope,$window,commerceService,midmarketDashboardService,$rootScope){$scope.isLoggedIn=commerceService.isLoggedIn();var smSession=$(".app-urls").find("#smsession-cookie").text();smSession&&"No"!=smSession&&"LOGGEDOFF"!=smSession&&""!=smSession&&(commerceService.getProfileInfo().then(function(response){$scope.userProfileInfo=response;var storeCountry=getQueryString("country"),isInvalidStore=!1;response&&"Customer"==response.usertype&&response.salesAreas&&0<response.salesAreas.length&&response.salesAreas[0].country!=storeCountry&&storeCountry&&(isInvalidStore=!0),response.isInvalidStore=isInvalidStore,$rootScope.$broadcast("storeInfo",response)}),commerceService.getCartCount().then(function(response){$scope.cartCount=response})),$scope.module={selectedModule:"corporate"},$scope.invokeSearch=function(searchTerm,searchUrl){searchTerm&&0<searchTerm.length&&(-1<searchUrl.indexOf("SearchTerm")?window.location.href=searchUrl+searchTerm:window.location.href=searchUrl+"&q="+searchTerm)},-1<window.location.href.indexOf("solutions-finder-results")&&$(".solutions-footer-wrap").addClass("hide"),$scope.resetSelectedAgent=function(){midmarketDashboardService.resetSelectAgent().then(function(response){"success"==response.status&&$window.location.reload()},function(error){console.log("error selecting agent on search",error)})}}),$(function(){setTimeout(function(){$(".cart-notifications p").show()},2e3)}),avayaBlog.controller("partner-region-selector",function($scope,$http){$scope.regionData={};var countryListRequest;(countryListRequest={method:"GET",url:App.urls.countryListUrl},$http(countryListRequest)).then(function(result){$scope.regionData.countryList=result.data},function(error){console.log("Unable to retrieve perspectives feed.")}),$scope.redirectToSfdc=function(category){var countryQueryString="country="+category.code.toLowerCase();window.location.href=App.urls.regionRedirectUrl+"?"+countryQueryString}}),avayaBlog.directive("academyVideoModal",function($rootScope){return{scope:{video:"@",title:"@",language:"@"},controller:function($scope,$element){var videoModal=$(".kaltura-modal"),closeButton=videoModal.find(".close"),title=videoModal.find(".modal-header h4"),backdrop=$(".kaltura-modal-backdrop");function closeModal(){videoModal.addClass("hide"),videoModal.addClass("fade"),backdrop.removeClass("fade"),kWidget.destroy("kaltura-player")}closeButton.on("click",function(){closeModal()}),$(window).bind("keyup",function(e){27==e.keyCode&&closeModal()}),backdrop.bind("click",function(e){closeModal()}),$element.on("click",function(){var videoPlayerOptions;if(videoPlayerOptions={autoPlay:!0,externalInterfaceDisabled:!1,disableOnScreenClick:!1,playerBgColor:16777215,closedCaptions:{usecookie:!1,displayCaptions:!(!$scope.language||"en"==$scope.language),defaultLanguageKey:$scope.language}},null!=$scope.video&&null!=$scope.video){$.ajax({url:"//cdnapisec.kaltura.com/p/1535622/sp/153562200/embedIframeJs/uiconf_id/36948392/partner_id/1535622",dataType:"script",success:function(){kWidget.destroy("kaltura-player"),kWidget.embed({targetId:"kaltura-player",wid:"_1535622",uiconf_id:"36948392",flashvars:videoPlayerOptions,cache_st:1417536325,entry_id:$scope.video,params:{wmode:"transparent"}}),videoModal.removeClass("hide"),videoModal.removeClass("fade"),title.text($scope.title),backdrop.addClass("fade")}})}})}}}),avayaBlog.directive("accountSetup",function(commerceService){return{restrict:"A",link:function(scope,element){var isMobile=browserWidth()<=768,uiViewList=$(".card-titles .ui-view .card"),uiViewContainer=$(".ui-view.ui-container"),settingsForm=$("form[name='settings']"),setupForm=(settingsForm.find("input[name='country']"),settingsForm.find("input[name='state']"),$("form[name='form']")),signUpForm=$("form[name='sign-up']"),downloadsForm=$("form[name='downloads']"),generateLinkButton=downloadsForm.find(".generate-link"),cardsWrap=(downloadsForm.find(".download-link"),$(".cards-wrap")),errorMessage=$(".error-message"),errorTerms=setupForm.find(".error-terms"),toaster=$(".server-status-message"),signInForm=$("form[name='sign-in']"),tabList=($(".sign-in-button"),{}),validationListSetup=[],regexList_email=/^(?!.*\.{2})[A-Za-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,5}$/,regexList_name=/^[a-zA-Z][^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{1,50}$/,regexList_title=/^[a-zA-Z][^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=]{1,50}$/,regexList_address=/[^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{1,50}$/,regexList_phone=/^[^±!@£$%^&*_+§¡€¢§¶•ªº«\\/<>?:;|=.,]{4,20}$/,regexList_city=/^([a-zA-Z\u0080-\u024F]+(?:. |-| |'))*[a-zA-Z\u0080-\u024F]{1,30}$/,regexList_answer=/^[^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{3,30}$/,regexList_password=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d$@$!%*?&_]{8,15}$/,regexList_password2=/[^<>]{8,30}$/,getQueryString=function(field,url){var href=url||window.location.href,string=new RegExp("[?&]"+field+"=([^&#]*)","i").exec(href);return string?string[1]:null},usVer=getQueryString("_usver_"),hiddenPageName=signUpForm.find("input[name='pagename']"),hiddenUsver=signUpForm.find("input[name='_usver_']"),resendLink=$(".app-urls").find("#resend-link").text();uiViewList.each(function(){$(this).firstChild;tabList[$(this).parent().closest("li").attr("class")]||(tabList[$(this).parent().closest("li").attr("class")]=$(this).attr("id")),uiViewContainer.append($(this))});var requestedTab=getQueryString("view"),requestedView=tabList[requestedTab];function browserWidth(){return self.innerHeight?self.innerWidth:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientWidth:document.body?document.body.clientWidth:void 0}$(".avatar-login .account").remove(),scope.showLoader=function(){$(".page-level-loader").addClass("show-loader")},scope.hideLoader=function(status,message){status=status||!0,$(".page-level-loader").removeClass("show-loader"),toast(status,message)},scope.showView=function(){scope.showUiView=!0},scope.hideView=function(){cardsWrap.removeClass("breeze-height"),cardsWrap.removeClass("general-height"),scope.showUiView=!1},scope.tab=requestedTab||"settings",scope.subNav=requestedView||"general",isMobile&&scope.hideView(),scope.showTab=function(tabId,cardId,title){scope.tab=tabId,scope.showCard(cardId,title,!1),event.stopPropagation(),commerceService.clickTab(tabId)},scope.showCard=function(cardId,title,showView){"breeze"==cardId?cardsWrap.addClass("breeze-height"):cardsWrap.removeClass("breeze-height"),"general"==cardId?cardsWrap.addClass("general-height"):cardsWrap.removeClass("general-height"),scope.subNav=cardId,scope.cardTitle=title,isMobile&&0!=showView&&scope.showView(),event.stopPropagation()},scope.saveSettings=function(event){event.preventDefault(),event.stopPropagation(),validateSettingsForm(validationListSetup)&&(scope.showLoader(),$.ajax({url:settingsForm.attr("action"),type:settingsForm.attr("method"),data:settingsForm.serialize().replace(/\'/g,""),dataType:"JSON",success:function(result){1==result.status?setTimeout(function(){scope.hideLoader(!0,result.message),saveSettingsForm()},0):scope.hideLoader(!1,result.message)},error:function(result){scope.hideLoader(!1,getGenericErrorMessage())}}))},scope.resendEmail=function(event){scope.showLoader(),hiddenPageName.val(resendLink),hiddenUsver.val(usVer),$.ajax({url:signUpForm.attr("action"),type:signUpForm.attr("method"),data:signUpForm.serialize().replace(/\'/g,""),dataType:"JSON",success:function(result){scope.hideLoader(result.status,result.message)},error:function(result){scope.hideLoader(!1,getGenericErrorMessage())}})},scope.cancelSettings=function(event){event.preventDefault(),event.stopPropagation()};var toast=function(status,message){toaster.find("span").text(message),toaster.addClass("show"+(0==status?" error":"")),setTimeout(function(){toaster.removeClass("show error")},5e3)};generateLinkButton.on("click",function(event){event.stopPropagation()}),scope.finishAccountSetup=function(event){event.stopPropagation(),event.preventDefault(),validateForm(validationListSetup)&&(scope.showLoader(),$.ajax({url:setupForm.attr("action")+"?"+setupForm.serialize().replace(/\'/g,""),type:setupForm.attr("method"),dataType:"JSON",success:function(result){1==result.status?window.location.href=getSignInLink():setTimeout(function(){scope.hideLoader(!0,result.message)},0)},error:function(result){scope.hideLoader(!1,getGenericErrorMessage())}}))},$(window).bind("resize",function(){isMobile=browserWidth()<=768});var password=setupForm.find("[name='password']"),confirmPassword=setupForm.find("[name='confirmPassword']"),securityAnswer=setupForm.find("[name='securitya']"),securityQuestionDropdown=$(".dropdown-wrap.security-question"),securityQuestionHiddenField=setupForm.find("[name='securityQuestion']"),countryDropdown=$(".dropdown-wrap.country"),countryField=countryDropdown.find("input[ name='countryField' ]"),province=$("input[name='province']"),stateHiddenField=$("input[name='state']"),countryHiddenField=$("input[name='country']"),stateDropdown=$(".dropdown-wrap.state"),stateField=stateDropdown.find("input[ name='stateField' ]"),stateLabel=(stateHiddenField=$("input[name='state']"),settingsForm.find(".state-label")),provinceLabel=settingsForm.find(".province-label"),formStatusCallback=function(status){1==status?getFormStatus(validationListSetup)&&errorMessage.removeClass("show"):errorMessage.addClass("show")},getFormStatus=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){if(validationItem.field.hasClass("error"))return formStatus=!1}),formStatus};scope.signIn=function(event){event.preventDefault(),event.stopPropagation(),validateSignInForm(validationListSetup)&&signInForm.submit()};var formData,validateForm=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){validationItem.field.prop("disabled")||0!=commerceService.validateField(validationItem)||(errorMessage.addClass("show"),formStatus=!1)}),0==setupForm.find("input[name='terms']")[0].checked&&(errorTerms.addClass("show"),formStatus=!1),password.val()!=confirmPassword.val()&&(confirmPassword.addClass("error"),error.addClass("show"),formStatus=!1),formStatus},validateSettingsForm=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){validationItem.field.prop("disabled")||0!=commerceService.validateField(validationItem)||(errorMessage.addClass("show"),formStatus=!1)}),formStatus},validateSignInForm=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){commerceService.validateField(validationItem,formStatusCallback)||(errorMessage.addClass("show"),formStatus=!1)}),0==signInForm.find("input[name='terms']")[0].checked&&(signInForm.find(".error-terms").addClass("show"),formStatus=!1),formStatus},addValidation=function(field,regex,type,required,callback){if(0!=field.length&&!field.attr("readonly"))if("checkbox"==type)field.change(function(){0==$(this)[0].checked?errorTerms.addClass("show"):errorTerms.removeClass("show")});else{var validationItem={field:field,regEx:regex,type:type,required:required};validationListSetup.push(validationItem),field.on("keyup",function(){formStatusCallback(commerceService.validateField(validationItem,callback))})}};if(0<setupForm.length){var company=setupForm.find("[name='company']");addValidation(company,regexList_name),company.focus(),addValidation(setupForm.find("[name='title']"),regexList_title),addValidation(password,regexList_password),addValidation(securityAnswer,regexList_answer),addValidation(setupForm.find("input[name='terms']"),null,"checkbox"),addValidation(securityQuestionDropdown,null,"select"),addValidation(countryDropdown,null,"select"),password.on("keyup",function(){password.val()&&0<password.val().length&&(confirmPassword.removeAttr("disabled"),confirmPassword.addClass("error"),confirmPassword.on("keyup",function(){confirmPassword.prop("disabled")||(0==confirmPassword.val().length?confirmPassword.addClass("error"):confirmPassword.val()==password.val()?confirmPassword.removeClass("error"):confirmPassword.addClass("error"))}))}),$(securityQuestionDropdown).find("li").on("click",function(){securityQuestionDropdown.removeClass("error"),securityAnswer.removeAttr("disabled");var secuirtyAnswerEncoded=$(this).text().replace("'","&39;");securityQuestionHiddenField.val(secuirtyAnswerEncoded)}),$(stateDropdown).find("li").on("click",function(){stateDropdown.removeClass("error"),stateHiddenField.val($(this).find("a").attr("data-value")||$(this).text())}),$(countryDropdown).find("li").on("click",function(){countryDropdown.removeClass("error"),countryHiddenField.val($(this).find("a").attr("data-value")||$(this).text())})}if(0<settingsForm.length&&(addValidation(settingsForm.find("[name='fname']"),regexList_name,null,!1),addValidation(settingsForm.find("[name='lname']"),regexList_name,null,!1),addValidation(settingsForm.find("[name='company']"),regexList_name,null,!1),addValidation(settingsForm.find("[name='title']"),regexList_title,null,!1),addValidation(settingsForm.find("[name='phone']"),regexList_phone,null,!1),addValidation(settingsForm.find("[name='province']"),regexList_city,null,!1),addValidation(settingsForm.find("[name='address1']"),regexList_address,null,!1),addValidation(settingsForm.find("[name='address2']"),regexList_address,null,!1),addValidation(settingsForm.find("[name='city']"),regexList_city,null,!1),addValidation(settingsForm.find("[name='zipCode']"),regexList_phone,null,!1),$(stateDropdown).find("li").on("click",function(){stateDropdown.removeClass("error"),stateHiddenField.val($(this).find("a").attr("data-value")||$(this).text())}),countryHiddenField.val()&&"us"==countryHiddenField.val().toLowerCase()?(stateDropdown.removeClass("hidden"),province.addClass("hidden"),stateLabel.removeClass("hidden"),provinceLabel.addClass("hidden")):(stateDropdown.addClass("hidden"),province.removeClass("hidden"),stateLabel.addClass("hidden"),provinceLabel.removeClass("hidden")),$(countryDropdown).find("li").on("click",function(){countryDropdown.removeClass("error");var selectedValue=$(this).find("a").attr("data-value")||$(this).text();countryHiddenField.val(selectedValue),"us"==selectedValue.toLowerCase()?(stateDropdown.removeClass("hidden"),province.removeClass("error"),province.addClass("hidden"),stateLabel.removeClass("hidden"),provinceLabel.addClass("hidden")):(stateDropdown.addClass("hidden"),province.removeClass("hidden"),stateLabel.addClass("hidden"),provinceLabel.removeClass("hidden"))})),0<signInForm.length){var username=signInForm.find("[name='email']");errorTerms=signInForm.find(".error-terms"),username.focus();password=signInForm.find("[name='PASSWORD']");addValidation(username,regexList_email),addValidation(password,regexList_password2),addValidation(signInForm.find("input[name='terms']"),null,"checkbox")}function saveSettingsForm(){formData=settingsForm.serialize(),countryFieldValue=countryField.val(),stateFieldValue=stateField.val()}saveSettingsForm(),scope.cancelSettings=function($event){event.stopPropagation(),event.preventDefault();var settingsFormData=function(data){for(var temp,objs=[],temps=data.split("&"),i=0;i<temps.length;i++)temp=temps[i].split("="),objs.push(temp[0]),objs[temp[0]]=temp[1];return objs}(formData);countryHiddenField.val(settingsFormData[countryHiddenField.attr("name")]),stateHiddenField.val(settingsFormData[stateHiddenField.attr("name")]),countryField.val(countryFieldValue),stateField.val(stateFieldValue),_.each(validationListSetup,function(validationItem){validationItem.field.hasClass("read-only")||validationItem.field.val(settingsFormData[validationItem.field.attr("name")])})},$(".downloads-table a").on("click",function(){var filePath=$(this).attr("data-filepath");commerceService.downloadLink(filePath)})}}}),avayaBlog.directive("addOns",function(commerceProductService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/add-ons.html",link:function(scope,element,attrs){scope.showLoader(),commerceProductService.getAddOnsData(attrs.addOnId).then(function(response){scope.addOnsList=response.data,scope.hideLoader()},function(error){scope.hideLoader(),console.log("error fetching add on data")}),scope.goToDetailPage=function(url){window.location.href=url}}}}),avayaBlog.directive("addToCart",function(cartService,commerceProductService){return{restrict:"A",link:function(scope,element,attrs){element.prev().find("input").val();element.on("click",function(){var url,quantity=1,itemId=attrs.itemId,itemTypeId=attrs.itemTypeId,productId=(attrs.bundleAssetId,attrs.productId),redirectUrl=attrs.redirectUrl,productType=element.attr("data-type"),agentName=element.attr("data-agent"),country=element.attr("data-country");if("freetrial"!=productType)return productId&&"1000"!=itemId?(url=agentName?"&a="+agentName:"",void(window.location.href=redirectUrl+"?bundleId="+itemId+"&productId="+productId+"&country="+country+url)):("seats"==element.attr("data-type")&&(quantity=element.prev().find("input").val()),scope.showLoader(),void commerceProductService.getItemData(itemId,null,null,itemTypeId).then(function(response){var term=1,billingCycle="MO";response.data.avaPriceDetail[0]&&(term=response.data.avaPriceDetail[0].term,billingCycle=response.data.avaPriceDetail[0].billingCycle);var cartHasLab=cartService.hasLab();if("Y"==response.data.avaPriceDetail[0].isLab){if(1==cartHasLab)return alert("Your shopping cart already has a lab. Please complete your checkout or remove the lab before adding more products."),void scope.hideLoader()}else if(1==cartHasLab)return alert("Your shopping cart already has a lab. Please complete your checkout or remove the lab before adding more products."),void scope.hideLoader();cartService.addItem(cartService.createItem(itemId,quantity,billingCycle,term,subscriptionId)).then(function(response){"1000"==itemId&&scope.reviewCart(),scope.hideLoader()},function(error){scope.hideLoader(),console.log("error adding item to cart")})},function(error){console.log("error fetching item price"),scope.hideLoader()}));window.location.href=redirectUrl+"?bundleId="+itemId+"&productId="+productId+"&country="+country+"&isTrial=true"})}}}),avayaBlog.directive("additionalOptions",function(){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/additional-options.html",link:function(scope,element,attrs){scope.subscriptionStatus=!1,scope.decreaseQtyValidation=function(plan,itemId,target,qty,isAddon){if(scope.isSubscription&&!scope.isRenewal&&!scope.isFreeTrial&&"true"!=scope.userTypes.isSuperUser)return plan.editItemQty<plan.Qty?(plan.editItemQty=plan.Qty,scope.addProductToSelection(plan,itemId,target,plan.editItemQty,isAddon),scope.subscriptionStatus=!0,scope.showMsg="User Subscription cannot be decreased. Please adjust your subscription quantity",$(window).scrollTop(0),scope.continueBtnDisabled=plan.editItemQty==plan.Qty):plan.editItemQty>=plan.Qty?(scope.addProductToSelection(plan,itemId,target,plan.editItemQty,isAddon),scope.subscriptionStatus=!1,scope.showMsg="",scope.continueBtnDisabled=plan.editItemQty==plan.Qty):(plan.deltaQty=plan.editItemQty-plan.Qty,scope.subscriptionStatus=!1,scope.showMsg="",scope.continueBtnDisabled=!0),plan;scope.addProductToSelection(plan,itemId,target,plan.editItemQty,isAddon),scope.continueBtnDisabled=plan.editItemQty==plan.Qty}}}}),avayaBlog.directive("midmarketAgentAdministrator",function(midmarketAgentDashboardService,commerceService,midmarketDashboardService,dashboardService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/midmarket-agent-administrator.html",controller:function($scope,$element,$window){$scope.email=/^(?!.*\.{2})[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,5}$/,$scope.alphabetRegex=/^[a-zA-Z .]{1,50}$/,$scope.phoneRegex=/^((\+1)?[\s-]?)?\(?[1-9]\d\d\)?[\s-]?[0-9]\d\d[\s-]?\d\d\d\d/,$scope.addressLine1Regex=/^[ A-Za-z0-9()[\]+*#-/]{3,100}$/,$scope.stateRegex=/^[a-zA-Z .]{2,3}$/,$scope.zipCodeUSRegex=/^\d{5}(?:[-\s]\d{4})?/,$scope.zipCodeCARegex=/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,$scope.numberRegex=/^[0-9]*$/,$scope.alphaNumericRegex=/^[a-zA-Z0-9]*$/,$scope.closeAdmin=function(){$scope.closeModal(),$scope.clearAgentAdministrator()},$scope.clearAgentAdministrator=function(){$scope.administrator={}},$scope.administrator={},$scope.addActionDetails=function(data){var payload={action:"addcolleague",tabletype:"mycompany",userObject:{firstname:data.firstname,lastname:data.lastname,email:data.email,phone:data.phone,roletype:"Master Agent"!=$scope.userTypeInfo.usertype?data.role:"Admin",status:"Active"}};$scope.showLoader(),midmarketDashboardService.postAction(payload).then(function(response){"success"==response.status?($scope.getMyAdminsInfo(),$scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.hideLoader(),$scope.closeAdmin()):"failed"==response.status&&($scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.hideLoader(),$scope.closeAdmin())},function(error){$scope.showPopupStatusMsg(!0,"failed","There is a problem at this time. Please try again later."),$scope.hideLoader(),$scope.closeAdmin()})}}}}),avayaBlog.directive("midmarketAgentCompany",function(midmarketAgentDashboardService,midmarketDashboardService,commerceService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/midmarket-agent-company.html",controller:function($scope,$element,$window,$filter){$scope.email=/^(?!.*\.{2})[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,5}$/,$scope.alphabetRegex=/^[a-zA-Z .]{1,50}$/,$scope.phoneRegex=/^((\+1)?[\s-]?)?\(?[1-9]\d\d\)?[\s-]?[0-9]\d\d[\s-]?\d\d\d\d/,$scope.addressLine1Regex=/^[ A-Za-z0-9()[\]+*#-/]{3,100}$/,$scope.stateRegex=/^[a-zA-Z .]{2,3}$/,$scope.zipCodeUSRegex=/^\d{5}(?:[-\s]\d{4})?/,$scope.zipCodeCARegex=/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,$scope.numberRegex=/^[0-9]*$/,$scope.alphaNumericRegex=/^[a-zA-Z0-9]*$/,$scope.midmarketCompanyName=/^[a-zA-Z0-9 .+-,-]{1,50}$/,$scope.Prefix="",$scope.isSearch=!1,$scope.searchagents=[],$scope.editAgents=[],$scope.agentTab=1,$scope.isAdd=!1,$scope.searchAgent={},$scope.pUser={},$scope.tabClick=function(tab){1!=($scope.agentTab=tab)||$scope.isSearch?$scope.isAdd=!0:$scope.isAdd=!1},$scope.getCountriesList=function(){commerceService.getCountries().then(function(response){$scope.countriesList=[],1==$scope.userTypeInfo.salesAreas.length?(response.forEach(function(item){item.country.code2==$scope.userTypeInfo.salesAreas[0].country&&$scope.countriesList.push(item)}),$scope.setCountry($scope.countriesList[0])):($scope.countriesList=response,console.log("agent",$scope.countriesList))})},$scope.getCountriesList(),$scope.setCountry=function(country){$scope.selectedCountry=country},$scope.getZipPattern=function(){if($scope.selectedCountry)return"CA"==$scope.selectedCountry.country.code2?$scope.zipCodeCARegex:$scope.zipCodeUSRegex},$scope.closeCompany=function(){$scope.resetActionDropdowns(),$scope.closeModal(),$scope.clearCompany()},$scope.selectAgentForm=function(agent){return $scope.isAdd=!0,_.each($scope.searchagents,function(c){c.selected=!1}),agent.selected=!0,agent},$scope.clearCompany=function(){$scope.searchAgent={},$scope.pUser={},$scope.isSearch=!1,$scope.searchagents=[],$scope.editAgent=[],$scope.searchTerm="",1==$scope.agentTab?$scope.isAdd=!1:$scope.isAdd=!0},$scope.searchAgents=function(searchterm){searchterm&&2<searchterm.length&&midmarketDashboardService.getsearchAgents(searchterm).then(function(response){null!=response.data&&null!=response.data&&""!=response.data&&($scope.searchagents=response.data,$scope.isSearch=!0,$scope.isAdd=!0)},function(error){console.log("error fetchng data on search",error)})},$scope.getUserType=function(){midmarketDashboardService.getusertype().then(function(response){$scope.userTypeInfo=response})},$scope.getUserType(),$scope.isCheckedSalesTerritory=function(){return!$scope.userTypeInfo.salesAreas.some(function(options){return options.selected})},$scope.addAgents=function(searchAgent,user){var primaryUser={},company={};if(1==$scope.agentTab)0<$scope.searchagents.length&&(company=1==$scope.searchagents.length?$scope.searchagents[0]:$filter("filter")($scope.searchagents,{selected:!0},!0)[0]);else if(2==$scope.agentTab){primaryUser={firstname:user.firstname,lastname:user.lastname,email:user.email,phone:user.phone,status:"Active"},(company=searchAgent).country=$scope.selectedCountry.country.code2,company.state=$scope.searchAgent.state.code;var territories=[];angular.forEach($scope.userTypeInfo.salesAreas,function(item){item.selected&&territories.push(item)}),company.salesAreas=territories,1==$scope.userTypeInfo.salesAreas.length&&(company.salesAreas=$scope.userTypeInfo.salesAreas)}if(company!={}){company.status="Active";var payload={action:"add",tabletype:"myagents",userObject:primaryUser,companyObject:company};$scope.showLoader(),midmarketDashboardService.postAction(payload).then(function(response){"success"==response.status?($scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.getMyAgentsInfo(),$scope.hideLoader(),$scope.closeCompany()):"failed"==response.status&&($scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.hideLoader(),$scope.closeCompany())},function(error){$scope.hideLoader(),$scope.showPopupStatusMsg(!0,"failed","There is a problem at this time. Please try again later.")})}},$scope.editAgents=function(editAgent){var company={};if((company=editAgent)!={}){company.status="Active";var payload={action:"editCompany",tabletype:"myagents",companyObject:company};company.country=$scope.selectedCountry.country.code2,company.state=$scope.editAgent.state.code,$scope.showLoader(),midmarketDashboardService.postAction(payload).then(function(response){"success"==response.status?($scope.hideLoader(),$scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.getMyAgentsInfo(),$scope.closeCompany()):"failed"==response.status&&($scope.getMyAgentsInfo(),$scope.hideLoader(),$scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.closeCompany())},function(error){$scope.hideLoader(),$scope.showPopupStatusMsg(!0,"failed","There is a problem at this time. Please try again later."),$scope.closeCompany()})}}}}}),avayaBlog.directive("agentListModal",function($http,$q,midmarketDashboardService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/agent-list-modal.html",link:function(scope){scope.helpFindAgentt=!1,scope.selectedAgentLIST=null,scope.showAgentErrorStatus=!1,scope.callBackSelectedAgents(scope.helpFindAgentt,scope.selectedAgentLIST),scope.setAgentType={},scope.setAgentType.type="agent",scope.helpFindAgentFunc=function(){scope.helpFindAgentt=!0,scope.saveModalAgent()},scope.saveModalAgent=function(){scope.callBackSelectedAgents(scope.helpFindAgentt,scope.selectedAgentLIST),scope.closeAgenttChk()},scope.searchAgents=function(searchterm,linked,entityId){scope.searchagents=[],scope.showAgentErrorStatus=!1,searchterm&&2<searchterm.length&&midmarketDashboardService.getsearchAgentsCheckout(searchterm,linked,entityId).then(function(response){null!=response.data&&null!=response.data&&""!=response.data?scope.searchagents=response.data:scope.showAgentErrorStatus=!0},function(error){console.log("error fetchng data on search",error)})},scope.btnCloseAgent=function(){scope.closeAgenttChk(),scope.callBackSelectedAgents(scope.helpFindAgentt,scope.selectedAgentLIST)},scope.closeAgenttChk=function(){scope.closeModal(),scope.clearAgenttChk()},scope.selectAgentM=function(agent){_.each(scope.searchagents,function(c){c.selected=!1}),agent.selected=!0,scope.selectedAgentLIST=agent,scope.saveModalAgent()},scope.clearAgenttChk=function(){scope.searchAgent={},scope.setAgentType={},scope.setAgentType.type="agent",scope.showAgentErrorStatus=!1,scope.selectedAgentLIST=null,scope.searchagents=[],scope.searchTermAgent="",scope.helpFindAgentt=!1}}}}),avayaBlog.directive("midmarketAgentUser",function(midmarketAgentDashboardService,midmarketDashboardService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/midmarket-agent-user.html",controller:function($scope,$element,$window){$scope.email=/^(?!.*\.{2})[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,5}$/,$scope.alphabetRegex=/^[a-zA-Z .]{1,50}$/,$scope.phoneRegex=/^((\+1)?[\s-]?)?\(?[1-9]\d\d\)?[\s-]?[0-9]\d\d[\s-]?\d\d\d\d/,$scope.addressLine1Regex=/^[ A-Za-z0-9()[\]+*#-/]{3,100}$/,$scope.stateRegex=/^[a-zA-Z .]{2,3}$/,$scope.zipCodeUSRegex=/^\d{5}(?:[-\s]\d{4})?/,$scope.zipCodeCARegex=/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,$scope.numberRegex=/^[0-9]*$/,$scope.alphaNumericRegex=/^[a-zA-Z0-9]*$/,$scope.agentUser={},$scope.RoleTypes=[],$scope.closeUser=function(){$scope.closeModal(),$scope.clearagentUser()},$scope.clearagentUser=function(){$scope.agentUser={}},$scope.getRoleTypes=function(){midmarketDashboardService.getRolesType().then(function(response){$scope.RoleTypes=response},function(error){console.log("error fetching  doc",error)})},$scope.getRoleTypes(),$scope.addAgentUsers=function(agentUser){agentUser.status="Active";var userObject={firstname:agentUser.firstname,lastname:agentUser.lastname,phone:agentUser.phone,email:agentUser.email,roletype:agentUser.role,status:"Active"},companyObject=agentUser.agent;companyObject.status="Active";var payload={action:"add",tabletype:"myagentusers",userObject:userObject,companyObject:companyObject};$scope.showLoader(),midmarketDashboardService.postAction(payload).then(function(response){"success"==response.status?($scope.getMyAgentsUserInfo(),$scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.hideLoader(),$scope.closeUser()):"failed"==response.status&&($scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.hideLoader(),$scope.closeUser())},function(error){$scope.showPopupStatusMsg(!0,"failed","There is a problem at this time. Please try again later."),$scope.hideLoader(),$scope.closeUser()})}}}}),avayaBlog.directive("agentUsersListModal",function($http,$q,midmarketDashboardService,checkDirectService,$rootScope,$window,$timeout){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/agent-users-list-modal.html",link:function(scope){scope.selectedAgent={},scope.showSuccessMsg=!1,scope.agentWarningMsg=!1,scope.searchagents=[],scope.closeButton=function(){scope.closeModal(),scope.closeAgentChk(),scope.selectedAgent={}},scope.$on("searchagentsByCompanyId",function(event,data){scope.searchagents=data}),scope.selectAgentUser=function(agent){scope.selectedAgent=agent},scope.cancelbutton=function(){scope.closeModal(),scope.selectedAgent={}},scope.saveSelectedAgent=function(){var payload={companyid:scope.selectedAgent.companyid,name:scope.selectedAgent.name,emailid:scope.selectedAgent.email,solutionId:scope.solutionId};midmarketDashboardService.saveSelectedAgent(payload).then(function(response){"success"==response.status&&($rootScope.$broadcast("selectedAgentUser",scope.selectedAgent),scope.closeModal(),scope.showSuccessMsg=!0,$timeout(function(){$window.location.reload()},500))},function(error){console.log("error saving data",error)})}}}}),avayaBlog.directive("articlesFilter",function(){return{restrict:"A",link:function(scope,element){var articlesFilter=$(".article-types"),title=articlesFilter.find(".title"),articleTypeList=articlesFilter.find("ul"),articlesList=element.find(".article");articleTypeList.on("click",function(event){if(title.removeClass("open"),articleTypeList.hide(),"A"==event.target.tagName){var filterTypeId=$(event.target).parent().attr("value");title.text($(event.target).text()),_.each(articlesList,function(article){$(article).attr("article-type")==filterTypeId?$(article).show():$(article).hide()})}event.stopPropagation(),event.preventDefault()})}}}),avayaBlog.directive("autoComplete",function($compile,dataService){return{scope:{autoComplete:"@",searchUrl:"@",hideAutocomplete:"@",callback:"&"},require:"ngModel",link:function($scope,element,attrs,ctrl){$scope.suggestionIndex=-1,$scope.increment=1,$scope.callbackDefined=void 0!==attrs.callback,$scope.search=function(result){if(1==$scope.callbackDefined)return $scope.callback({keywords:result}),void element.val(result);result&&searchInput.val(result.name),-1<$scope.searchUrl.indexOf("SearchTerm")?window.location.href=$scope.searchUrl+result:window.location.href=$scope.searchUrl+"&q="+result};var searchInput=element;searchInput.after($compile('<ul class="autocomplete-results" interactive-dropdown>\t\t\t\t\t\t<li ng-class="(suggestionIndex == $index? \'suggestion-active\': \'suggestion-inactive\')" ng-repeat="result in searchAutocompleteResults track by $index">\t\t\t\t\t\t\t<a ng-click="search(result)">{{result}}</a>\t\t\t\t\t\t</li>\t\t\t\t\t</ul>')($scope));var searchResults=searchInput.next(),toggleList=function(visibility){"hidden"==visibility?searchResults.fadeOut(150,function(){}):"visible"==visibility&&searchResults.fadeIn(150,function(){})};searchInput.bind("input",function(e){"true"!=$scope.hideAutocomplete&&(3<=this.value.length?(console.log("autocomplete service called"),dataService.getDataFrom($scope.autoComplete,angular.element(this)[0].value,"GET").then(function(response){var results=response;results&&0<results.length&&(_.each(results,function(item,index){results[index]=decodeURIComponent(item)}),$scope.searchAutocompleteResults=results,"block"!==searchResults.css("display")&&toggleList("visible")),$scope.suggestionIndex=-1,$scope.increment=1},function(error){console.log(JSON.stringify(error))})):"block"==searchResults.css("display")&&toggleList("hidden"))}).bind("blur keyup",function(e){("keyup"==e.type&&27==e.keyCode||"blur"==e.type)&&"block"==searchResults.css("display")&&toggleList("hidden"),"keyup"==e.type&&13==e.keyCode&&$scope.$apply(function(){$scope.search(searchInput.val()),toggleList("hidden")}),"keydown"==e.type&&40==e.keyCode&&$(this).next().find("li").first().focus()}).bind("focus click",function(){"true"!=$scope.hideAutocomplete&&3<=this.value.length&&"block"!==searchResults.css("display")&&toggleList("visible")}),searchInput.bind("keydown",function(e){if(38===e.keyCode){if(0==$scope.suggestionIndex)return void $scope.$apply(function(){$scope.suggestionIndex=$scope.searchAutocompleteResults.length-1,$scope.increment=-1});$scope.suggestionIndex-=1,searchInput.val($scope.searchAutocompleteResults[$scope.suggestionIndex]),ctrl.$setViewValue($scope.searchAutocompleteResults[$scope.suggestionIndex])}if(40===e.keyCode){if($scope.suggestionIndex==$scope.searchAutocompleteResults.length-1)return void $scope.$apply(function(){$scope.suggestionIndex=0,$scope.increment=1});$scope.suggestionIndex+=1,searchInput.val($scope.searchAutocompleteResults[$scope.suggestionIndex]),ctrl.$setViewValue($scope.searchAutocompleteResults[$scope.suggestionIndex])}})}}}),avayaBlog.directive("avBubbleSlider",function(){return{restrict:"A",link:function(scope,element){var interval=element.attr("interval");interval=interval?1e3*interval:2e3;var slideList=element.find(".slide"),bubbleList=null,maxSlideIndex=element.find(".slide").length-1,slideIndex=-1,pauseSlider=!1,playStopped=!1,controlsWrap=element.find(".controls-wrap");controlsWrap.on("click",function(event){if(-1<$(event.target).attr("class").indexOf("slider-button")){var clickedBubbleIndex=$(event.target).attr("slide-index");clickedBubbleIndex!=slideIndex&&(bubbleList.eq(slideIndex).find(".slider-button").removeClass("current"),slideList.eq(slideIndex).removeClass("active"),slideList.eq(slideIndex).addClass("in-active"),slideIndex=Number(clickedBubbleIndex),slideList.eq(slideIndex).addClass("active"),slideList.eq(slideIndex).removeClass("in-active"),bubbleList.eq(slideIndex).find(".slider-button").addClass("current"))}event.stopPropagation()}),element.on("mouseenter",function(){pauseSlider=!0}),element.on("mouseleave",function(){pauseSlider=!1,1==playStopped&&play(),playStopped=!1});var play=function(){1!=pauseSlider?(-1!=slideIndex&&bubbleList.eq(slideIndex).find(".slider-button").removeClass("current"),slideList.eq(slideIndex).removeClass("active"),slideList.eq(slideIndex).addClass("in-active"),slideIndex+=slideIndex==maxSlideIndex?-maxSlideIndex:1,slideList.eq(slideIndex).addClass("active"),slideList.eq(slideIndex).removeClass("in-active"),bubbleList.eq(slideIndex).find(".slider-button").addClass("current"),setTimeout(function(){play()},interval)):playStopped=!0};if(maxSlideIndex&&0<maxSlideIndex){for(i=0;i<=maxSlideIndex;i++)controlsWrap.append('<div class="bubble"><span slide-index="'+i+'" class="slider-button'+(0==i?" current":"")+'"></span></div>');bubbleList=$(".controls-wrap .bubble"),play()}}}}),avayaBlog.directive("avDownloadCalendar",function(){return{restrict:"A",link:function(scope,element){element.on("click",function(event){var offset=(new Date).getTimezoneOffset(),calendarForm=$("#form-id");calendarForm.find("[name=starttime]").val(element.attr("starttime")),calendarForm.find("[name=endatetime]").val(element.attr("endatetime")),calendarForm.find("[name=displaytitle]").val(element.attr("displaytitle")),calendarForm.find("[name=timezoneoffset]").val(offset),calendarForm.find("[name=description]").val(element.attr("description")),calendarForm.submit()})}}}),avayaBlog.directive("avLearning",function(){return{restrict:"A",link:function(scope,element){var tabCollection={activeTab:-1,tabs:[]},tabs=element.find(".menu-tabs li"),slides=element.find(".tab-content");tabs.each(function(index){tabs.eq(index).attr("id",index),tabCollection.tabs.push({tab:tabs.eq(index),content:slides.eq(index)}),0==index?(tabCollection.tabs[0].tab.find("a").addClass("link-on"),tabCollection.tabs[0].content.css("display","block")):tabCollection.tabs[index].content.css("display","none")});var tabList=tabCollection.tabs,activateTab=function(tabIndex){-1<tabCollection.activateTab&&(tabList[tabCollection.activateTab].tab.find("a").removeClass("link-on"),tabList[tabCollection.activateTab].content.css("display","none")),tabCollection.activateTab=tabIndex,tabList[tabIndex].tab.find("a").addClass("link-on"),tabList[tabIndex].content.css("display","block")};tabs.on("click",function(event){activateTab($(this).attr("id")),event.preventDefault(),event.stopPropagation()}),activateTab(0)}}}),avayaBlog.directive("avPopup",function($compile){return{restrict:"A",controller:function($scope,$element){var modal=$(".av-modal.breeze-modal"),backdrop=(modal.find(".breeze-modal-content"),$(".commerce-modal-backdrop")),viewId=($(".cancel"),$element.attr("id"));if(0==modal.find("."+viewId).length)if("sold-to-picker"==viewId||"bill-to-picker"==viewId||"modal-alert"==viewId){if("sold-to-picker"==viewId&&setTimeout(function(){modal.prepend("<div style='display: none;' class='view "+viewId+"' "+viewId+"></div>"),$compile(modal.contents())($scope)},500),"bill-to-picker"==viewId&&setTimeout(function(){modal.prepend("<div style='display: none;' class='view "+viewId+"' "+viewId+"></div>"),$compile(modal.contents())($scope)},800),"modal-alert"==viewId){var attributes=$element.attr("message"),type=$element.attr("type");modal.prepend("<div style='display: none;' class='view "+viewId+"' "+viewId+" message='"+attributes+"' type='"+type+"'></div>"),$compile(modal.contents())($scope)}}else modal.prepend("<div style='display: none;' class='view "+viewId+"' "+viewId+"></div>"),$compile(modal.contents())($scope);$element.on("click",function(){$(window).scrollTop(0),modal.find("."+viewId).css("display","block"),backdrop.addClass("fade"),modal.css("display","block"),"modal-alert"==viewId&&$scope.showMessage()}),backdrop.on("click",function(event){closeModal(),event.preventDefault(),event.stopPropagation()});var closeModal=function(){modal.find("."+viewId).css("display","none"),modal.find(".view").css("display","none"),modal.css("display","none"),backdrop.removeClass("fade")};$scope.closeModal=function(){closeModal()},this.test=function(){alert("popup")}}}}),avayaBlog.directive("avReelSlider",function($timeout){return{restrict:"A",link:function($scope,$element,attrs,ctrl){var marginLeft=0,controls=$element.find(".control"),leftArrow=$element.find(".control.left i"),rightArrow=$element.find(".control.right i"),containerWidth=0,sliderWrap=$element.find(".slider-wrap"),slideStrip=$element.find(".slide-strip"),slideStripLength=250*slideStrip.children().length,sliderWrapWidth=0,slideStripWidth=slideStripLength,slideCount=$element.find(".slide").length;leftArrow.addClass("hide");var setDimensions=function(){containerWidth=$element.width(),250*slideCount-25<(sliderWrapWidth=containerWidth-89)?(rightArrow.removeClass("show"),rightArrow.addClass("hide")):(rightArrow.removeClass("hide"),rightArrow.addClass("show")),sliderWrap.css("width",sliderWrapWidth)};controls.on("click",function(event){if($(event.target).parents(".right").length){if(leftArrow.removeClass("hide"),marginLeft-=250,slideStrip.css("margin-left",marginLeft),slideStripWidth+marginLeft<sliderWrapWidth)return void rightArrow.addClass("hide");event.preventDefault(),event.stopPropagation()}if($(event.target).parents(".left").length){if(0==marginLeft)return void leftArrow.addClass("hide");rightArrow.removeClass("hide"),0==(marginLeft+=250)&&leftArrow.addClass("hide"),slideStrip.css("margin-left",marginLeft),event.preventDefault(),event.stopPropagation()}}),$(window).resize(function(){setDimensions()}),setDimensions()}}}),avayaBlog.directive("avSlider",function(){return{restrict:"A",link:function(scope,element){!function(){var slider3={speed:125,stopAfter:3,slideTiming:5e3,init:function(){slider3.sliders=[],sliderEls=element,sliderEls.hide();for(var i=0,j=sliderEls.length;i<j;i++)slider3.sliders[i]=new Slider(sliderEls[i])}},slider=this;slider.wrapper=$(element),slider.slideContainer=slider.wrapper.find(".slider-items"),slider.slides=slider.slideContainer.find(".slider-item"),slider.playing=!1,slider.slideInterval=null,slider.restartTimeout=null,slider.numPlays=0,slider.currentSlide=0,slider.play=function(){slider.slideInterval=setInterval(function(){slider.changeSlide(1)},slider3.slideTiming),slider.playing=!0},slider.pause=function(){clearInterval(slider.slideInterval),slider.playing=!1},slider.changeSlide=function(which){var currentSlide=$(slider.slides[slider.currentSlide]),newSlideIndex=0==which?slider.slides[slider.currentSlide-1]?slider.currentSlide-1:slider.slides.length-1:slider.slides[slider.currentSlide+1]?slider.currentSlide+1:0,newSlide=$(slider.slides[newSlideIndex]),slideWidth=currentSlide.outerWidth();newSlideStartOffset=0==which?(newSlideIndex+1)*slideWidth:(newSlideIndex-1)*slideWidth,newSlide.css({left:-newSlideStartOffset}),1==which?(currentSlide.animate({left:parseInt(currentSlide.css("left"))-slideWidth},slider3.speed),newSlide.animate({left:parseInt(newSlide.css("left"))-slideWidth},slider3.speed)):(currentSlide.animate({left:parseInt(currentSlide.css("left"))+slideWidth},slider3.speed),newSlide.animate({left:parseInt(newSlide.css("left"))+slideWidth},slider3.speed)),0==(slider.currentSlide=newSlideIndex)&&slider.numPlays++,slider.numPlays>=slider3.stopAfter&&slider.playing&&slider.pause()};var addControls=function(){slider.wrapper.append('<div data-features="slider-controls">\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="previous" style="cursor: pointer;">&#8249;</span>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="next" style="cursor: pointer;">&#8250;</span>\t\t\t\t\t\t\t\t\t\t\t\t</div>'),slider.nextBtn=slider.wrapper.find(".next"),slider.prevBtn=slider.wrapper.find(".previous"),slider.nextBtn.bind("click",function(){slider.changeSlide(1),slider.pause()}),slider.prevBtn.bind("click",function(){slider.changeSlide(0),slider.pause()})},styleSlider=function(){slider.slideContainer.css({"white-space":"nowrap","font-size":0,overflow:"hidden"});for(var i=0,j=slider.slides.length;i<j;i++)$(slider.slides[i]).css({display:"inline-block",position:"relative",left:0,"white-space":"normal"});slider.wrapper.show()};slider.slides.length&&(styleSlider(),1<slider.slides.length&&(addControls(),slider.play(),$(window).bind("resize",function(){slider.slides.css("left",0),slider.currentSlide=0})))}()}}}),avayaBlog.directive("avayaContentSlider",function(){return{restrict:"EAC",templateUrl:"/static/avaya/commerce-views/avaya-content-slider.html",scope:{contentList:"="},link:function(scope,element){scope.$watch("contentList",function(newValue,oldValue){newValue&&0<newValue.length&&setTimeout(function(){!function(){var slider3={speed:125,stopAfter:3,slideTiming:5e3};slider3.init=function(){slider3.sliders=[],sliderEls=element,sliderEls.hide();for(var i=0,j=sliderEls.length;i<j;i++)slider3.sliders[i]=new Slider(sliderEls[i])};var slider=this;slider.wrapper=$(element),slider.slideContainer=slider.wrapper.find(".slider-items"),slider.slides=slider.slideContainer.find(".slider-item"),slider.playing=!1,slider.slideInterval=null,slider.restartTimeout=null,slider.numPlays=0,slider.currentSlide=0;slider.play=function(){slider.slideInterval=setInterval(function(){slider.changeSlide(1)},slider3.slideTiming),slider.playing=!0},slider.pause=function(){clearInterval(slider.slideInterval),slider.playing=!1},slider.changeSlide=function(which){var currentSlide=$(slider.slides[slider.currentSlide]),newSlideIndex=0==which?slider.slides[slider.currentSlide-1]?slider.currentSlide-1:slider.slides.length-1:slider.slides[slider.currentSlide+1]?slider.currentSlide+1:0,newSlide=$(slider.slides[newSlideIndex]),slideWidth=currentSlide.outerWidth();newSlideStartOffset=0==which?(newSlideIndex+1)*slideWidth:(newSlideIndex-1)*slideWidth,newSlide.css({left:-newSlideStartOffset}),1==which?(currentSlide.animate({left:parseInt(currentSlide.css("left"))-slideWidth},slider3.speed),newSlide.animate({left:parseInt(newSlide.css("left"))-slideWidth},slider3.speed)):(currentSlide.animate({left:parseInt(currentSlide.css("left"))+slideWidth},slider3.speed),newSlide.animate({left:parseInt(newSlide.css("left"))+slideWidth},slider3.speed)),0==(slider.currentSlide=newSlideIndex)&&slider.numPlays++,slider.numPlays>=slider3.stopAfter&&slider.playing&&slider.pause()};var addControls=function(){slider.wrapper.append('<div data-features="slider-controls">\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="previous" style="cursor: pointer;">&#8249;</span>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="next" style="cursor: pointer;">&#8250;</span>\t\t\t\t\t\t\t\t\t\t\t\t</div>'),slider.nextBtn=slider.wrapper.find(".next"),slider.prevBtn=slider.wrapper.find(".previous"),slider.nextBtn.bind("click",function(){slider.changeSlide(1),slider.pause()}),slider.prevBtn.bind("click",function(){slider.changeSlide(0),slider.pause()})},styleSlider=function(){slider.slideContainer.css({"white-space":"nowrap","font-size":0,overflow:"hidden"});for(var i=0,j=slider.slides.length;i<j;i++){var slide=$(slider.slides[i]);slide.css({display:"inline-block",position:"relative",left:0,"white-space":"normal"})}slider.wrapper.show()};slider.slides.length&&(styleSlider(),1<slider.slides.length&&(addControls(),slider.play(),$(window).bind("resize",function(){slider.slides.css("left",0),slider.currentSlide=0})))}()},10)})}}}),avayaBlog.directive("dropdown",function($rootScope,$window){return{restrict:"E",templateUrl:"/static/avaya/commerce-views/avaya-dropdown.html",scope:{placeholder:"@",list:"=",mapping:"=",selected:"=",property:"@",prefix:"@",callback:"&",callbackUrl:"@"},link:function(scope){scope.listVisible=!1,scope.isPlaceholder=!0,scope.getTooltip=function(index){if(scope.mapping){var mapping=scope.mapping[index];if(mapping)return mapping.tooltip}},scope.select=function(item){if(scope.isPlaceholder=!1,scope.selected="object"==typeof item?item[scope.property]:item,scope.callbackUrl){var countryQueryString="?country="+item.code.toLowerCase();window.location.href=scope.callbackUrl+countryQueryString}else scope.callback({category:item})},scope.getDisplayText=function(item){return"object"==typeof item?item[scope.property]:item},scope.isSelected=function(item){return item===scope.selected},scope.show=function(){scope.listVisible=!scope.listVisible},$rootScope.$on("documentClicked",function(inner,target){console.log($(target[0]).is(".dropdown-display.clicked")||0<$(target[0]).parents(".dropdown-display.clicked").length),!$(target[0]).is(".dropdown-display.clicked")&&0<!$(target[0]).parents(".dropdown-display.clicked").length&&scope.$apply(function(){scope.listVisible=!1})}),scope.$watch("selected",function(value){scope.isPlaceholder=void 0===scope.selected,scope.display=scope.selected,scope.listVisible=!1})}}}),avayaBlog.directive("billToPicker",function(billToService,$timeout,serviceBase){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/bill-to-picker.html",replace:!0,link:function(scope,element){scope.billto={},scope.billto.type="select",scope.newSelectedBillTo={},scope.newSelectedBillTo.address={},scope.newSelectedBillTo.address.country="US",scope.alphabetRegex=/^[a-zA-Z .]{1,50}$/,scope.addressLine1Regex=/^[ A-Za-z0-9()[\]+*#-/]{3,100}$/,scope.stateRegex=/^[a-zA-Z .]{2,3}$/,scope.zipCodeUSRegex=/^\d{5}(?:[-\s]\d{4})?/,scope.zipCodeCARegex=/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,scope.alphaNumericRegex=/^[a-zA-Z0-9]*$/;var invalidAdrsMessage=$(".warning-message"),infoMsg=$(".info-msg");scope.closeBillToModal=function(){scope.clearBilltoData()},scope.clearBilltoData=function(){scope.newSelectedBillTo={},scope.newSelectedBillTo.address={},scope.billto={},scope.billto.type="select",infoMsg.removeClass("show"),insufficientAddress=!1,invalidAddress=!1,scope.closeModal()},scope.setCountryBillTo=function(country){scope.selectedCountryBillTo=country},scope.getZipPatternBillTo=function(){if(!angular.equals({},scope.selectedCountryBillTo))return scope.selectedCountryBillTo&&"CA"==scope.selectedCountryBillTo.country.code2?scope.zipCodeCARegex:scope.zipCodeUSRegex},scope.selectBillTo=function(billTo,newAddress){if(scope.billTo=billTo,newAddress&&"US"==scope.selectedCountryBillTo.country.code2){scope.billTo.address.addressLine1=scope.billTo.address.addressLine1.replace(/[^A-Z0-9.,]+/gi," "),scope.billTo.address.addressLine2=scope.billTo.address.addressLine2?scope.billTo.address.addressLine2.replace(/[^A-Z0-9.,]+/gi," "):"";var addressPayload="<AddressValidateRequest USERID='073AVAYA7582'><Address ID='0'><Address1>"+scope.billTo.address.addressLine1+"</Address1><Address2>"+scope.billTo.address.addressLine2+"</Address2><City>"+scope.billTo.address.city+"</City><State>"+scope.billTo.address.state.code+"</State><Zip5>"+scope.billTo.address.zip+"</Zip5><Zip4></Zip4></Address></AddressValidateRequest>";serviceBase.postData("https://secure.shippingapis.com/ShippingAPI.dll?API=verify&XML="+addressPayload).then(function(response){var addressSuggestionXML=$(response.data).find("ReturnText").text(),addressErrorXML=$(response.data).find("Description").text();return console.log("addressSuggestionXML",addressSuggestionXML),infoMsg.removeClass("show"),invalidAdrsMessage.removeClass("show"),addressSuggestionXML?($(window).scrollTop(0),infoMsg.addClass("show"),invalidAdrsMessage.removeClass("show"),void scope.hideLoader()):addressErrorXML?($(window).scrollTop(0),invalidAdrsMessage.addClass("show"),infoMsg.removeClass("show"),void scope.hideLoader()):(infoMsg.removeClass("show"),invalidAdrsMessage.removeClass("show"),scope.billTo.address.city=$(response.data).find("City").text(),scope.billTo.address.state=$(response.data).find("State").text(),scope.billTo.address.country=scope.billTo.address.country.country.code2,scope.selectedBillTo=scope.billTo,scope.setSelectedBillTo(scope.selectedBillTo,newAddress),void $timeout(function(){scope.closeBillToModal()},300))},function(error){})}else newAddress&&"CA"==scope.selectedCountryBillTo.country.code2&&(scope.billTo.address.state=scope.billTo.address.state.code,scope.billTo.address.country=scope.billTo.address.country.country.code2),scope.selectedBillTo=scope.billTo,scope.setSelectedBillTo(scope.selectedBillTo,newAddress),$timeout(function(){scope.closeBillToModal()},300)}}}}),avayaBlog.directive("breezeBundle",function(commerceProductService,estimatorService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/breeze-bundle.html",link:function(scope,element,attrs){scope.redirectUrl=element.attr("data-redirect-url");var field,url,href,string,bundleAssetId=element.attr("data-bundle-id"),productId=element.attr("data-product-id");element.attr("data-country");productId||(field="productId",href=url||window.location.href,productId=(string=new RegExp("[?&]"+field+"=([^&#]*)","i").exec(href))?string[1]:null),commerceProductService.getProductData(productId).then(function(response){scope.bundleData=response.data,scope.buttonLabel=scope.redirectUrl?scope.bundleData.buyNowLabel:scope.bundleData.continueLabel,scope.popularActive(),scope.redirectUrl&&scope.selectBundle(scope.bundleData.bundles[1])},function(error){console.log("Error fetching bundle data")}),scope.selectBundle=function(bundle){scope.selectedBundle=angular.copy(bundle),scope.redirectUrl||commerceProductService.getItemData(bundle.itemId).then(function(response){scope.contractData=_.filter(response.data.avaPriceDetail,function(item){return item.itemId==bundle.itemId&&item.billingCycle==scope.billingCycle}),scope.selectedContract=scope.contractData[0],scope.selectedBundle.price=scope.selectedContract?scope.selectedContract.price:0,scope.selectedBundle.term=scope.selectedContract?scope.selectedContract.term:1,estimatorService.addBundle(scope.selectedBundle)},function(error){console.log("error fetchng contract year list")})},scope.continue=function(){scope.redirectUrl?1==App.debug?window.location.href=scope.redirectUrl+"?bundleId="+scope.selectedBundle.itemId+"&bundleAssetId="+bundleAssetId:window.location.href=scope.redirectUrl+"%3FbundleId="+scope.selectedBundle.itemId+"&bundleAssetId="+bundleAssetId:scope.nextView(scope.selectedBundle)},$(".av-store-banner button").on("click",function(){window.location.href=getCartLink()}),scope.popularActive=function(){scope.popularActiveFlag=!1,angular.forEach(scope.bundleData.bundles,function(value,index){value.popular&&(scope.popularActiveFlag=!0)})}}}}),avayaBlog.directive("breezeConfigurator",function($q,estimatorService,cartService,purchaseOrderService,commerceProductService,$rootScope,serviceBase,checkDirectService,midmarketDashboardService,commerceService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/breeze-configurator.html",replace:!0,controller:function($scope,$element,$window){$scope.showLoader(),$.removeCookie("cmUsrSel",{path:"/"}),$scope.ucItemId=getUcItemId(),$scope.ccItemId=getCcItemId(),$scope.efaxItemId=getEfaxItemId(),$scope.efax2ItemId=getEfax2ItemId(),$scope.acrItemId=getAcrItemId(),$scope.ataItemId=getAtaItemId(),$scope.spacesItemId=getSpacesItemId(),$scope.continueBtnDisabled=!0,$scope.showInvalidStorePopup=!1,$scope.freeTrial="",$scope.quoteDescription="",$scope.userData=null;var preLoadPromises=[];$scope.validHardwareItems=[],$scope.$on("savedAgentRegion",function(event,data){$scope.showLoader(),$scope.getProductData(),$scope.userData=data,console.log("$scope.userData 1",$scope.userData)}),$scope.$on("storeInfo",function(event,data){data.isInvalidStore&&($scope.showInvalidStorePopup=!0),$scope.userData=data,console.log("$scope.userData 2",$scope.userData)});var editCartResponse,getQueryString=function(field,url){var href=url||window.location.href,string=new RegExp("[?&]"+field+"=([^&#]*)","i").exec(href);return string?string[1]:null};if($scope.freeTrial=getQueryString("isTrial"),$scope.omsIdfromEditCart=getQueryString("solutionId"),$scope.subscriptionId=getQueryString("subscriptionId"),$scope.entityId=getQueryString("entityId"),$scope.quoteId=getQueryString("solutionId"),$scope.shortName=getQueryString("a"),$scope.omsIdTocloneCart=getQueryString("cloneCart"),$scope.omsIdfromEditCart||$scope.subscriptionId||$scope.omsIdTocloneCart)var productInputValue=document.getElementById("bundleProdId").value;$scope.skuIdfromEditCart=getQueryString("skuId"),$scope.skuIdfromEditCart=getQueryString("skuId"),$scope.cpaasData=commerceProductService.getCpaasData(),$scope.billingCycle="MO",$scope.addToCartBtnTxt=$scope.omsIdfromEditCart||$scope.subscriptionId?"Update":"Add to Cart",$scope.estimatedCart=estimatorService.getEsimate(),$scope.configurator=cartService.getConfiguratorViews(),$scope.addedCredit=null,$scope.selectedBundle=null,$scope.selectedBundleId=getQueryString("bundleId"),$scope.SubFamily_C="",$scope.currencySymbol="",$scope.bundleAssetId=getQueryString("bundleAssetId"),$scope.productId=null!=productInputValue?productInputValue:getQueryString("productId"),$scope.shortName&&($scope.estimatedCart=estimatorService.getEsimate(),$scope.estimatedCart.cmUsrSel={},$scope.estimatedCart.cmUsrSel.shortName=$scope.shortName),$scope.callBackEstimate=function(){$scope.shortName&&($scope.estimatedCart=estimatorService.getEsimate(),$scope.estimatedCart.cmUsrSel.shortName=$scope.shortName)},$scope.isAddonPackageSelected=!1,$scope.defaultAddonPackage="Per Minute, Per Agent",$scope.bundle,$scope.accordion={current:null},$scope.isUCDiscountAvailable=!1,$scope.showPopupStatus=!1,$scope.termSelected=1,$scope.totalEndPointCredit=0,$scope.hardwareEndTotal=0,$scope.editCartFlag=0,$scope.currentTermFlag=0,$scope.DeltaQtyInitialCheckFlag=0,$scope.phoneCreditAppliedTotal=0,$scope.isSubscription=!(!$scope.subscriptionId||" "==$scope.subscriptionId),$scope.subscriptionsTotalDeltaQty=0,$scope.subscriptionType=getQueryString("subscriptionType"),$scope.trial=getQueryString("trial"),$scope.subscriptionType&&($scope.isRenewal="renewal"==$scope.subscriptionType.toLowerCase(),$scope.isFreeTrial="free-trial"==$scope.subscriptionType.toLowerCase()),$scope.hardwareItemPricingArray=[],$scope.showAccountSettingsModal=function(){if($scope.omsIdfromEditCart)return!1;var cookieString=$.cookie("cmUsrSel");if(!cookieString)return $scope.hideLoader(),!0;var cmUsrSel=JSON.parse(cookieString);return!$scope.validateUserSelection(cmUsrSel)},$scope.validateUserSelection=function(cmUsrSel){return!!cmUsrSel},$scope.callBackCartNaming=function(){$(window).scrollTop(0),$scope.cartNamingUpfront=!0},$scope.callBackCart=function(){"true"==$scope.freeTrial&&commerceProductService.getFreeTrial($scope.userData).then(function(response){return $scope.showLoader(),"success"==response.data.status?window.location.href=getCartLink():($scope.freeTrialErrorMsg=response.data.errorMsg,$scope.hideLoader(),$scope.freeTrialAlert=!0),!1},function(error){return console.log("error"),$scope.hideLoader(),!1})},$scope.goToShopping=function(){window.location.href=getStoreLandingLink()};var getUserTypePromise=checkDirectService.getUserType();preLoadPromises.push(getUserTypePromise),getUserTypePromise.then(function(response){$scope.userTypes=response,"Customer"===$scope.userTypes.usertype&&($scope.userData=response,$scope.userData.country=$scope.userData.salesAreas[0].country,$scope.userData.entityId=$scope.userData.salesAreas[0].legalEntity,$scope.userData.currency="US"===$scope.userData.country?"USD":"CAD")}),$q.all(preLoadPromises).then(function(results){$scope.getProductData=function(){$scope.freeTrial&&"Customer"===$scope.userTypes.usertype&&$scope.callBackCart(),commerceProductService.getProductData($scope.productId).then(function(response){if(console.log("$scope.showAccountSettingsModal() is true or false? If true, show settings modal",$scope.showAccountSettingsModal()),"Customer"!==$scope.userTypes.usertype&&$scope.showAccountSettingsModal()||$scope.freeTrial)return!1;for(var i=0;i<response.data.bundles.length;i++)(response.data.bundles[i].itemId==$scope.selectedBundleId||$scope.skuIdfromEditCart||$scope.isSubscription||$scope.omsIdTocloneCart)&&($scope.bundle=response.data.bundles[i]);if($scope.itemTypeId=$scope.bundle.itemTypeId,$scope.omsIdfromEditCart||$scope.omsIdTocloneCart?$scope.getEditCartItemDetails().then(function(response){editCartResponse=response,$scope.quoteName=$scope.omsIdfromEditCart?editCartResponse.quoteSummary[$scope.omsIdfromEditCart].quoteDescription:"",$scope.isUCOffer=$scope.omsIdfromEditCart?editCartResponse.quoteSummary[$scope.omsIdfromEditCart].featuredSku==$scope.ucItemId:"",$scope.isSpacesOffer=$scope.omsIdfromEditCart?editCartResponse.quoteSummary[$scope.omsIdfromEditCart].featuredSku==$scope.spacesItemId:"",$scope.getLabels(),$scope.getAddOns($scope.bundle.addOnUrl),$scope.omsIdfromEditCart&&"Customer"!==$scope.userTypes.usertype&&($scope.userData={},$scope.userData.entityId=editCartResponse.quoteSummary[$scope.omsIdfromEditCart].entityId,$scope.userData.currency=editCartResponse.quoteSummary[$scope.omsIdfromEditCart].currency,$scope.userData.country=editCartResponse.quoteSummary[$scope.omsIdfromEditCart].country,$scope.userData.userType=$scope.userTypes.usertype,$scope.userData.channelType=editCartResponse.quoteSummary[$scope.omsIdfromEditCart].channelType,$scope.userData.agentId=editCartResponse.quoteSummary[$scope.omsIdfromEditCart].agent.companyid,$scope.userData.agent=editCartResponse.quoteSummary[$scope.omsIdfromEditCart].agent.companyName,$scope.userData.agentUserEmail=editCartResponse.quoteSummary[$scope.omsIdfromEditCart].agent.emailid,$scope.userData.agentDisplayName=editCartResponse.quoteSummary[$scope.omsIdfromEditCart].agent.name,$.cookie("cmUsrSel",JSON.stringify($scope.userData),{path:"/"}),$scope.estimatedCart.cmUsrSel=$scope.userData)},function(error){console.log("Error in getEditCartItemDetails",error)}):(commerceProductService.getSubscriptionInfoData($scope.subscriptionId,$scope.entityId).then(function(subscription){$scope.subscriptionData=subscription.data[0],$scope.getLabels(),$scope.getSubscriptionsAddOns($scope.bundle.addOnUrl),$rootScope.$broadcast("availableTermsOnEdit",subscription)},function(error){console.log("Error in getSubscriptionItemDetails",error)}),$scope.getLabels(),$scope.getAddOns($scope.bundle.addOnUrl)),$scope.estimatedCart.featuredSkuId=$scope.bundle.itemId,"Customer"===$scope.userTypes.usertype){var userSelectionData={userType:$scope.userTypes.usertype,userid:$scope.userTypes.userObject.userid?$scope.userTypes.userObject.userid:"",currency:"US"==$scope.userTypes.salesAreas[0].country?"USD":"CAD",country:$scope.userTypes.salesAreas[0].country?$scope.userTypes.salesAreas[0].country:"",shortName:$scope.shortName?$scope.shortName:""};$scope.estimatedCart.cmUsrSel=userSelectionData,$scope.estimatedCart.entityId=$scope.entityId?$scope.entityId:$scope.userTypes.salesAreas[0].legalEntity}else $scope.estimatedCart.entityId=$scope.entityId?$scope.entityId:$scope.userData.entityId},function(error){console.log("error fetchng labels data")})},$scope.getProductData(),$scope.getEditCartItemDetails=function(){var deferred=$q.defer(),url=getCartApi(),solutionId=$scope.omsIdfromEditCart?$scope.omsIdfromEditCart:$scope.omsIdTocloneCart,parameters=solutionId?"?solutionId="+solutionId:"";return 1==App.debug?url=$scope.skuIdfromEditCart==$scope.spacesItemId?"/static/avaya/mocks/commerce/cart-item-mock-spaces.html":"/static/avaya/mocks/commerce/cart-item-mock-OMS0084244.html":url+=parameters||"",serviceBase.getData(url).then(function(response){var editCartResponse=response.data;$scope.editCartResponse=editCartResponse,deferred.resolve(editCartResponse)},function(error){deferred.reject(error)}),deferred.promise},$scope.getLabels=function(){commerceProductService.getLabelsData($scope.productId).then(function(response){var viewList=response.data;$scope.viewList={},$scope.viewList["select-bundle"]=viewList["select-bundle"],$scope.viewList["features-addons"]=viewList["features-addons"],$scope.viewList.hardware=viewList.hardware,$scope.selectedBundleId?$scope.$watch("bundleData",function(newValue,oldValue){if(newValue){$scope.viewList["select-bundle"].enabled=!0;var selectedBundle=_.find($scope.bundleData.bundles,function(bundle){if($scope.selectedBundleId==bundle.itemId||$scope.skuIdfromEditCart)return bundle});$scope.selectBundle(selectedBundle),$scope.view="select-bundle",$scope.viewList[$scope.view].enabled=!0,$scope.bundle=selectedBundle,$scope.nextView(selectedBundle)}}):($scope.view="select-bundle",$scope.viewList[$scope.view].enabled=!0,$scope.selectedBundle=$scope.bundle,$scope.selectBundle($scope.selectedBundle),$scope.nextView($scope.selectedBundle))},function(error){console.log("error fetchng labels data")})},$scope.getAddOns=function(addonurl){commerceProductService.getAddOnData(addonurl).then(function(response){var promises=[],addOnItemsArray=[];$scope.eFAXProductArray=[{planName:"None"}],$scope.addOns=response.addOns,$scope.features=response.features,$scope.hardware=response.hardware,$scope.accordion.current=0===$scope.hardware.length?"":$scope.hardware[0].sectionTitle,_.each($scope.addOns,function(section){_.each(section.sectionItems,function(addOnItem){if(0==addOnItem.available);else if("14"==addOnItem.itemType){var addOnsPromise1=commerceProductService.getItemData(addOnItem.itemId,$scope.userData,addOnItem.itemType);promises.push(addOnsPromise1),addOnsPromise1.then(function(priceResponse){var pricingObjWithRadios=priceResponse.data.ProductRatePlans.pricing;_.each(pricingObjWithRadios,function(pricingObjItem){pricingObjItem.selected=!1}),addOnItem.pricing=pricingObjWithRadios,$scope.addOnItem1=addOnItem},function(error){console.log("error fetching add-on price")})}else{var addOnsPromise2=commerceProductService.getItemData(addOnItem.itemId,$scope.userData,addOnItem.itemType);promises.push(addOnsPromise2),addOnsPromise2.then(function(priceResponse){addOnItem.itemId==$scope.efaxItemId||addOnItem.itemId==$scope.efax2ItemId?(priceResponse.data.ProductRatePlans.pricing[0].itemId=addOnItem.itemId,$scope.eFAXProductArray.push(priceResponse.data.ProductRatePlans.pricing[0]),$scope.addEfaxAddonToEstimator($scope.eFAXProductArray[0])):(addOnItemsArray.push(addOnItem),$scope.addOnItem2=addOnItemsArray),addOnItem.productName=priceResponse.data.productName,addOnItem.pricing=priceResponse.data.ProductRatePlans.pricing;for(var i=0;i<addOnItem.pricing.length;i++)addOnItem.pricing[i].cssInputGrey=!0},function(error){console.log("error fetching add on price")})}})}),_.each($scope.features,function(section){_.each(section.sectionItems,function(item){if(0==item.available);else if("9"==item.itemType){var featuresPromise1=commerceProductService.getFeatureData(item.itemId,$scope.userData,item.itemType);promises.push(featuresPromise1),featuresPromise1.then(function(priceResponse){item.price=priceResponse.data.ProductRatePlans.pricing[0].netprice,item.displayPrice=cartService.formatCurrency(parseFloat(item.price)),item.billingCycle="MO",item.term="1"},function(error){console.log("error fetching feature price")})}else if("11"==item.itemType||"12"==item.itemType||"13"==item.itemType||"14"==item.itemType){$scope.isUCOffer=item.itemId==$scope.ucItemId||"2074"==item.itemId,$scope.isSpacesOffer=item.itemId==$scope.spacesItemId;var featuresPromise2=commerceProductService.getFeatureData(item.itemId,$scope.userData,item.itemType);promises.push(featuresPromise2),featuresPromise2.then(function(priceResponse){if(null!=priceResponse||""!=priceResponse){$rootScope.$broadcast("availableTermsListener",priceResponse.data.term),item.pricing=priceResponse.data.ProductRatePlans.pricing,item.productName=priceResponse.data.productName,item.productDescription=priceResponse.data.ProductDescription,$scope.selectedBundle.productFamily=priceResponse.data.productFamily,item.productFamily=$scope.selectedBundle.productFamily,$scope.SubFamily_C=priceResponse.data.SubFamily__c,$scope.currencySymbol=priceResponse.data.currencySymbol;for(var k=0;k<item.pricing.length;k++)item.pricing[k].cssInputGrey=!0;$scope.featureItem=item}},function(error){console.log("error fetching feature price")})}})}),_.each($scope.hardware,function(section){_.each(section.sectionItems,function(item,sectionIndex){0==item.available||commerceProductService.getHardwareData(item.itemId,$scope.userData,item.itemType).then(function(priceResponse){if(priceResponse.data&&priceResponse.data.skuKey&&$scope.validHardwareItems.push(priceResponse.data.skuKey),item.cssInputGrey=!0,item.pricing=priceResponse.data.ProductRatePlans.pricing,item.billingCycle=priceResponse.data.billingCycle,item.productName=priceResponse.data.productName,item.productDescription=priceResponse.data.ProductDescription,"12"!=item.itemType&&"13"!=item.itemType||(item.price=priceResponse.data.ProductRatePlans.pricing[0].listpriceAPL),"10"==item.itemType&&(item.price=priceResponse.data.ProductRatePlans.pricing[0].netprice),item.itemId===$scope.ataItemId){item.ProductDescription=priceResponse.data.ProductDescription;for(var i=0;i<item.pricing.length;i++)item.pricing[i].cssInputGrey=!0}else $scope.hardwareItemPricingArray.push(item.pricing),item.displayPrice=cartService.formatCurrency(parseFloat(item.price)),item.pricingInfo=priceResponse.data.ProductRatePlans.pricing[0];if($scope.omsIdfromEditCart||$scope.omsIdTocloneCart){var editCartResponse=$scope.editCartResponse;if(!editCartResponse||!editCartResponse.shoppingCartItems)return;var refinedCartItems=[];if(editCartResponse.shoppingCartItems.forEach(function(shoppingCartItem){if(shoppingCartItem.skuKey===item.itemId)for(var k=0;k<item.pricing.length;k++)item.cssInputGrey=!0,item.pricing[k].productRatePlanId===shoppingCartItem.ratePlanId?(item.pricing[k].editItemQty=shoppingCartItem.qty,shoppingCartItem.skuKey==$scope.ataItemId?($scope.addHardwareAddOnToEstimator(item.pricing[k],item.itemId,null,shoppingCartItem.qty,!0),item.pricing[k].cssInputGrey=!1,refinedCartItems.push({editItemQty:item.pricing[k].editItemQty,productRatePlanId:item.pricing[k].productRatePlanId})):$scope.inputActions(sectionIndex,item,null,shoppingCartItem.qty),item.cssInputGrey=!1):(item.pricing[k].editItemQty=0,shoppingCartItem.skuKey==$scope.ataItemId&&(item.pricing[k].cssInputGrey=!0))}),item.itemId==$scope.ataItemId)for(var k=0;k<item.pricing.length;k++)for(var j in item.pricing[k],refinedCartItems)if(item.pricing[k].productRatePlanId===refinedCartItems[j].productRatePlanId){item.pricing[k].editItemQty=refinedCartItems[j].editItemQty,item.pricing[k].cssInputGrey=!1;break}}$scope.omsIdfromEditCart||$scope.subscriptionId||$scope.omsIdTocloneCart||"Customer"==$scope.userTypes.usertype||("hardware"!==$scope.view&&($scope.$watch("discountHardwarePhoneObj",function(newVal,oldVal){if(oldVal)for(var i=0;i<$scope.estimatedCart.nonRecurring.items.length;i++)oldVal.productRatePlanId===$scope.estimatedCart.nonRecurring.items[i].pricingInfo.productRatePlanId&&($scope.estimatedCart.nonRecurring.items[i].quantity=0);for(var k=0;k<item.pricing.length;k++)oldVal&&(item.pricing[k].editItemQty=0,$scope.inputActions(sectionIndex,item,null,0)),$scope.discountHardwarePhoneObj=newVal,item.cssInputGrey=!0,$scope.discountHardwarePhoneObj&&$scope.discountHardwarePhoneObj.productRatePlanId==item.pricing[k].productRatePlanId?(item.pricing[k].editItemQty=$scope.totalSubscriptionQty,$scope.inputActions(sectionIndex,item,null,item.pricing[k].editItemQty),item.cssInputGrey=!1):item.pricing[k].editItemQty=0}),$scope.compareHardwareAndSoftwareTotal(),$scope.isContinueBtnDisabled()),$scope.$watch("totalSubscriptionQty",function(newVal,oldVal){if(oldVal)for(var i=0;i<$scope.estimatedCart.nonRecurring.items.length;i++)oldVal.productRatePlanId===$scope.estimatedCart.nonRecurring.items[i].pricingInfo.productRatePlanId&&($scope.estimatedCart.nonRecurring.items[i].quantity=0);if(newVal!=oldVal){$scope.totalSubscriptionQty=newVal;for(var k=0;k<item.pricing.length;k++)item.cssInputGrey=!0,$scope.discountHardwarePhoneObj&&$scope.discountHardwarePhoneObj.productRatePlanId==item.pricing[k].productRatePlanId?(item.pricing[k].editItemQty=$scope.totalSubscriptionQty,$scope.inputActions(sectionIndex,item,null,item.pricing[k].editItemQty),item.cssInputGrey=!1):(item.pricing[k].editItemQty=0,$scope.inputActions(sectionIndex,item,null,item.pricing[k].editItemQty),item.cssInputGrey=!0)}$scope.compareHardwareAndSoftwareTotal(),$scope.isContinueBtnDisabled()}))},function(error){console.log("error fetching hardware price")})})}),$q.all(promises).then(function(results){if($scope.omsIdfromEditCart||$scope.omsIdTocloneCart){$scope.featureItem&&$scope.featureItemsOnEditCart(),$scope.addOnItem1&&$scope.addOnsItemType13OnEditCart(),$scope.addOnItem2&&($scope.addOnsItemType14OnEditCart(),$scope.eFAXaddOnsItemOnEditCart());var editCartResponse=$scope.editCartResponse;$scope.termFromEditCart=$scope.omsIdfromEditCart?editCartResponse.quoteSummary[$scope.omsIdfromEditCart].term:editCartResponse.quoteSummary[$scope.omsIdTocloneCart].term,$scope.omsIdfromEditCart?editCartResponse.quoteSummary[$scope.omsIdfromEditCart].featuredSku!=$scope.ccItemId&&2046!=editCartResponse.quoteSummary[$scope.omsIdfromEditCart].featuredSku||0!==$scope.termFromEditCart||($scope.termFromEditCart=1):$scope.omsIdTocloneCart&&(editCartResponse.quoteSummary[$scope.omsIdTocloneCart].featuredSku!=$scope.ccItemId&&2046!=editCartResponse.quoteSummary[$scope.omsIdTocloneCart].featuredSku||0!==$scope.termFromEditCart||($scope.termFromEditCart=1)),$scope.omsIdfromEditCart&&editCartResponse.quoteSummary[$scope.omsIdfromEditCart].selectedPhoneNumber&&$scope.callBackSelectedPhoneNumber(editCartResponse.quoteSummary[$scope.omsIdfromEditCart].selectedPhoneNumber,editCartResponse.quoteSummary[$scope.omsIdfromEditCart].numberType,!!editCartResponse.quoteSummary[$scope.omsIdfromEditCart].selectedPhoneNumber.phone_number),$scope.omsIdTocloneCart&&editCartResponse.quoteSummary[$scope.omsIdTocloneCart].selectedPhoneNumber&&$scope.callBackSelectedPhoneNumber(editCartResponse.quoteSummary[$scope.omsIdTocloneCart].selectedPhoneNumber,editCartResponse.quoteSummary[$scope.omsIdTocloneCart].numberType,!!editCartResponse.quoteSummary[$scope.omsIdTocloneCart].selectedPhoneNumber.phone_number),$scope.selectContract($scope.termFromEditCart)}"Customer"==$scope.userTypes.usertype&&$scope.freeTrial||$scope.hideLoader()}).catch(function(error){console.log("In getAddOns error:: ",error)})},function(error){console.log("error fetching addons list for bundle")})}}).catch(function(error){console.log("In getUserType error:: ",error)}),$scope.showHardwarePricingItem=function(item,section){return!!(item.itemId&&0<=$scope.validHardwareItems.indexOf(item.itemId))},$scope.resetSelectedAgent=function(){midmarketDashboardService.resetSelectAgent().then(function(response){"success"==response.status&&$window.location.reload()},function(error){console.log("error selecting agent on search",error)})},$scope.getSubscriptionsAddOns=function(addonurl){commerceProductService.getAddOnData(addonurl).then(function(response){var promises=[];$scope.addOns=response.addOns,$scope.features=response.features,$scope.hardware=response.hardware,$scope.accordion.current=0===$scope.hardware.length?"":$scope.hardware[0].sectionTitle,_.each($scope.addOns,function(section){_.each(section.sectionItems,function(addOnItem){if(0==addOnItem.available);else if("14"==addOnItem.itemType){var addOnsPromise1=commerceProductService.getItemData(addOnItem.itemId,$scope.userData,addOnItem.itemType);promises.push(addOnsPromise1),addOnsPromise1.then(function(priceResponse){var pricingObjWithRadios=priceResponse.data.ProductRatePlans.pricing;if(_.each(pricingObjWithRadios,function(pricingObjItem){pricingObjItem.selected=!1}),addOnItem.pricing=pricingObjWithRadios,$scope.subscriptionId){var subscriptionData=$scope.subscriptionData;if(!$scope.subscriptionData)return;for(var i=0;i<subscriptionData.ratePlans.length;i++)if(subscriptionData.ratePlans[i].skuKey==addOnItem.itemId)for(var k=0;k<addOnItem.pricing.length;k++)addOnItem.pricing[k].productRatePlanId===subscriptionData.ratePlans[i].productRatePlanId?(addOnItem.pricing[k].editItemQty=subscriptionData.ratePlans[i].quantity,addOnItem.pricing[k].Qty=subscriptionData.ratePlans[i].quantity,$scope.addProductToSelection(addOnItem.pricing[k],addOnItem.itemId,null,subscriptionData.ratePlans[i].quantity,!0)):$scope.addProductToSelection(addOnItem.pricing[k],addOnItem.itemId,null,0,!0)}},function(error){console.log("error fetching add-on price")})}else{var addOnsPromise2=commerceProductService.getItemData(addOnItem.itemId,$scope.userData,addOnItem.itemType);promises.push(addOnsPromise2),addOnsPromise2.then(function(priceResponse){addOnItem.pricing=priceResponse.data.ProductRatePlans.pricing;for(var i=0;i<addOnItem.pricing.length;i++)addOnItem.pricing[i].cssInputGrey=!0;if($scope.subscriptionId){var subscriptionData=$scope.subscriptionData;if(!subscriptionData)return;var refinedCartItems=[];for(i=0;i<subscriptionData.ratePlans.length;i++){if(subscriptionData.ratePlans[i].skuKey==addOnItem.itemId)for(var k=0;k<addOnItem.pricing.length;k++)addOnItem.pricing[k].cssInputGrey=!0,addOnItem.pricing[k].productRatePlanId===subscriptionData.ratePlans[i].productRatePlanId&&(addOnItem.pricing[k].editItemQty=subscriptionData.ratePlans[i].quantity,addOnItem.pricing[k].Qty=subscriptionData.ratePlans[i].quantity,$scope.addUcAddOnToEstimator(addOnItem.pricing[k],addOnItem.itemId,null,subscriptionData.ratePlans[i].quantity,!0),addOnItem.pricing[k].cssInputGrey=!1,refinedCartItems.push({Qty:addOnItem.pricing[k].Qty,editItemQty:addOnItem.pricing[k].editItemQty,productRatePlanId:addOnItem.pricing[k].productRatePlanId}));$scope.eFAXProductArray.forEach(function(eFAXItem){subscriptionData.ratePlans[i].skuKey===eFAXItem.itemId&&(eFAXItem.pricing[0].Qty=subscriptionData.ratePlans[i].quantity,$scope.addEfaxAddonToEstimator(eFAXItem,eFAXItem.itemId,null,1,!0))})}for(k=0;k<addOnItem.pricing.length;k++)for(var j in addOnItem.pricing[k],refinedCartItems)if(addOnItem.pricing[k].productRatePlanId===refinedCartItems[j].productRatePlanId){addOnItem.pricing[k].editItemQty=refinedCartItems[j].editItemQty,addOnItem.pricing[k].Qty=refinedCartItems[j].Qty,addOnItem.pricing[k].cssInputGrey=!1;break}}},function(error){console.log("error fetching add on price")})}})}),_.each($scope.features,function(section){_.each(section.sectionItems,function(item){if(0==item.available);else if("9"==item.itemType){var featuresPromise1=commerceProductService.getFeatureData(item.itemId,$scope.userData,item.itemType);promises.push(featuresPromise1),featuresPromise1.then(function(priceResponse){item.price=priceResponse.data.ProductRatePlans.pricing[0].netprice,item.displayPrice=cartService.formatCurrency(parseFloat(item.price)),item.billingCycle="MO",item.term="1"},function(error){console.log("error fetching feature price")})}else if("11"==item.itemType||"12"==item.itemType||"13"==item.itemType||"14"==item.itemType){var featuresPromise2=commerceProductService.getFeatureData(item.itemId,$scope.userData,item.itemType);promises.push(featuresPromise2),featuresPromise2.then(function(priceResponse){if(null!=priceResponse||""!=priceResponse){$rootScope.$broadcast("availableTermsListener",priceResponse.data.term),item.pricing=priceResponse.data.ProductRatePlans.pricing,item.productName=priceResponse.data.productName,item.productDescription=priceResponse.data.ProductDescription,$scope.selectedBundle.productFamily=priceResponse.data.productFamily,item.productFamily=$scope.selectedBundle.productFamily,$scope.SubFamily_C=priceResponse.data.SubFamily__c,$scope.currencySymbol=priceResponse.data.currencySymbol;for(var k=0;k<item.pricing.length;k++)item.pricing[k].cssInputGrey=!0;if($scope.subscriptionId){var subscriptionData=$scope.subscriptionData;if(!subscriptionData)return;for(var refinedCartItems=[],i=0;i<subscriptionData.ratePlans.length;i++)if(subscriptionData.ratePlans[i].skuKey==item.itemId)for(k=0;k<item.pricing.length;k++)item.pricing[k].cssInputGrey=!0,0<subscriptionData.ratePlans[i].quantity&&item.pricing[k].productRatePlanId===subscriptionData.ratePlans[i].productRatePlanId?(subscriptionData.ratePlans[i].ratePlanCharges.find(function(contractPriceObj){(contractPriceObj.name&&contractPriceObj.name.includes("List Price")||contractPriceObj.listPriceBase&&0!==contractPriceObj.listPriceBase.length)&&(item.pricing[k].listpriceAPL=contractPriceObj.price?contractPriceObj.price:item.pricing[k].listpriceAPL,console.log("item.pricing[k].listpriceAPL",item.pricing[k].listpriceAPL))}),item.pricing[k].editItemQty=subscriptionData.ratePlans[i].quantity,item.pricing[k].Qty=subscriptionData.ratePlans[i].quantity,$scope.addProductToSelection(item.pricing[k],item.itemId,null,subscriptionData.ratePlans[i].quantity,!1),item.pricing[k].cssInputGrey=!1,refinedCartItems.push({editItemQty:item.pricing[k].editItemQty,productRatePlanId:item.pricing[k].productRatePlanId,listpriceAPL:item.pricing[k].listpriceAPL})):item.pricing[k].editItemQty=0;for(k=0;k<item.pricing.length;k++)for(var j in item.pricing[k],refinedCartItems)if(item.pricing[k].productRatePlanId===refinedCartItems[j].productRatePlanId){item.pricing[k].editItemQty=refinedCartItems[j].editItemQty,item.pricing[k].listpriceAPL=refinedCartItems[j].listpriceAPL,item.pricing[k].cssInputGrey=!1;break}}}},function(error){console.log("error fetching feature price")})}})}),_.each($scope.hardware,function(section){_.each(section.sectionItems,function(item,sectionIndex){0==item.available||commerceProductService.getHardwareData(item.itemId,$scope.userData,item.itemType).then(function(priceResponse){if(priceResponse.data&&priceResponse.data.skuKey&&$scope.validHardwareItems.push(priceResponse.data.skuKey),item.pricing=priceResponse.data.ProductRatePlans.pricing,item.cssInputGrey=!0,"12"==item.itemType&&(item.price=priceResponse.data.ProductRatePlans.pricing[0].listpriceAPL),"10"==item.itemType&&(item.price=priceResponse.data.ProductRatePlans.pricing[0].netprice),item.displayPrice=cartService.formatCurrency(parseFloat(item.price)),item.billingCycle=priceResponse.data.billingCycle,item.pricingInfo=priceResponse.data.ProductRatePlans.pricing[0],item.productName=priceResponse.data.productName,item.productDescription=priceResponse.data.ProductDescription,item.currencySymbol=priceResponse.data.currencySymbol,$scope.subscriptionId){var subscriptionData=$scope.subscriptionData;if(!subscriptionData)return;for(var i=0;i<subscriptionData.ratePlans.length;i++)if(subscriptionData.ratePlans[i].skuKey==item.itemId)for(var k=0;k<item.pricing.length;k++)item.cssInputGrey=!0,item.pricing[k].productRatePlanId===subscriptionData.ratePlans[i].ratePlanId?(item.pricing[k].editItemQty=subscriptionData.ratePlans[i].quantity,item.pricing[k].Qty=subscriptionData.ratePlans[i].quantity,$scope.inputActions(sectionIndex,item,null,subscriptionData.ratePlans[i].quantity),item.cssInputGrey=!1):item.pricing[k].editItemQty=0}},function(error){console.log("error fetching hardware price")})})}),$q.all(promises).then(function(results){$scope.compareHardwareAndSoftwareTotal()}).catch(function(error){console.log("In getAddOns error:: ",error)})},function(error){console.log("error fetching addons list for bundle")})};var getSelectedAddOnItemPrice=function(productRatePlanCharges,quantity){var price=0,pricePlanObj=productRatePlanCharges.filter(function(planObj){if(planObj.model&&"PerUnit"===planObj.model)return!0});if((pricePlanObj=pricePlanObj.pop())&&pricePlanObj.pricing&&0<pricePlanObj.pricing.length)pricePlanObj.pricing.filter(function(priceItemObj){priceItemObj.currency&&"USD"===priceItemObj.currency&&(price=Number(priceItemObj.price))});return price};$scope.removeGreyClass=function(target){angular.element(target).removeClass("input-grey")},$scope.getIsSelectedRadio=function(item){return $scope.addonPackageSelected===item.planName},$scope.updateRadioValues=function(plan){_.each($scope.addOns,function(section){_.each(section.sectionItems,function(addOnItem){_.each(addOnItem.pricing,function(pricingItem){pricingItem.productCode===plan.productCode&&pricingItem.planName===plan.planName?pricingItem.selected=!0:pricingItem.selected=!1})})})},$scope.addAddonPackage=function(plan,itemId,target,isAddon){for(var bundle=estimatorService.getEsimate().bundle,i=0;i<$scope.addOns.length;i++)for(var section=$scope.addOns[i],j=0;j<section.sectionItems.length;j++)for(var addOnItem=section.sectionItems[j],k=0;k<addOnItem.pricing.length;k++){var pricingItem=addOnItem.pricing[k];plan||(plan||$scope.isAddonPackageSelected?_.each(bundle,function(bundleItem){bundleItem.itemMasterId===pricingItem.productRatePlanId&&(plan=pricingItem)}):pricingItem.planName===$scope.defaultAddonPackage&&(plan=pricingItem,itemId=addOnItem.itemId))}var seletedPrice;if(plan){seletedPrice=getSelectedAddOnItemPrice(plan.productRatePlanCharges),$scope.isAddonPackageSelected||(console.log("adding item from cart"),$scope.updateRadioValues(plan),$scope.isAddonPackageSelected=!0);var addOnTotal=1*seletedPrice;estimatorService.addSpokenItem({itemMasterId:itemId,qty:1,description:plan.planName,total:addOnTotal,billingCycle:"MO",term:1,productRatePlanId:plan.productRatePlanId,pricingInfo:plan,unitNet:seletedPrice,selectedPrice:seletedPrice,isAddOn:!0})}},$scope.addProductToSelection=function(plan,itemId,target,qty,isAddon){var quantity,seletedPrice,ucDiscountObject=plan&&plan.productRatePlanCharges&&plan.productRatePlanCharges.filter(function(productRatePlanCharge){return productRatePlanCharge.hasOwnProperty("discountRange")}).pop();if(ucDiscountObject&&($scope.isUCDiscountAvailable=0<ucDiscountObject.discountRange.length),isAddon){var radioValue=qty;quantity=1,$scope.updateRadioValues(plan),seletedPrice=getSelectedAddOnItemPrice(plan.productRatePlanCharges),$scope.addonPackageSelected=radioValue,$scope.isAddonPackageSelected=!0}else quantity=parseInt(qty),seletedPrice=$scope.isUCDiscountAvailable||$scope.isSpacesOffer?parseFloat(plan.listpriceAPL):function(tiers,quantity){var price=0,totalPrice=0,netPrice=0;return tiers.forEach(function(tier){quantity>=parseInt(tier.startingUnit)&&quantity<=parseInt(tier.endingUnit)&&(price=tier.price,netPrice=tier.netPrice,totalPrice=tier.price*quantity)}),{price:price,netPrice:netPrice,totalPrice:totalPrice}}(plan.tiers,quantity);if(0<quantity){if(0<qty&&target&&angular.element(target).removeClass("input-grey"),angular.element(".hardware-credit-selector").addClass("remove-margin"),!isAddon){var total=$scope.isUCDiscountAvailable||$scope.isSpacesOffer?seletedPrice*quantity:seletedPrice.totalPrice;estimatorService.addSpokenItem({itemMasterId:itemId,qty:quantity,description:plan.planName,total:total,billingCycle:"MO",term:1,productRatePlanId:plan.productRatePlanId,pricingInfo:plan,unitNet:$scope.isUCDiscountAvailable||$scope.isSpacesOffer?seletedPrice:seletedPrice.netPrice,selectedPrice:$scope.isUCDiscountAvailable||$scope.isSpacesOffer?seletedPrice:seletedPrice.price,isAddOn:!1,isUcAddOn:!1}),$scope.continueBtnDisabled=!1}1==App.debug?("2046"===itemId||"1052"===itemId)&&$scope.addAddonPackage(isAddon?plan:null,itemId,target,isAddon):(itemId===$scope.ccItemId||"avayaccminpack"===itemId)&&$scope.addAddonPackage(isAddon?plan:null,itemId,target,isAddon)}else angular.element(target).addClass("input-grey"),estimatorService.removeItem({itemMasterId:itemId,qty:quantity,description:plan.planName,total:total,billingCycle:"MO",term:1,productRatePlanId:plan.productRatePlanId,pricingInfo:plan,unitNet:$scope.isUCDiscountAvailable||$scope.isSpacesOffer?seletedPrice:seletedPrice.netPrice,selectedPrice:$scope.isUCDiscountAvailable||$scope.isSpacesOffer?seletedPrice:seletedPrice.price,isAddOn:!!isAddon,isUcAddOn:!1}),$scope.continueBtnDisabled=!0;$scope.isUCDiscountAvailable&&$scope.computeUcDiscountValues();for(var i=0;i<$scope.estimatedCart.bundle.length;i++)0<$scope.estimatedCart.bundle[i].qty&&($scope.continueBtnDisabled=!1);$scope.checkUcItemsTotalQty3000(itemId),$rootScope.$broadcast("addProductBroadcast")},$scope.computeUcDiscountValues=function(){for(var qtyTotal=0,estimatedCart=$scope.estimatedCart,i=0;i<estimatedCart.bundle.length;i++)qtyTotal+=estimatedCart.bundle[i].qty;for(i=0;i<estimatedCart.bundle.length;i++)if(!1===estimatedCart.bundle[i].isUcAddOn){var ucDiscountObject=estimatedCart.bundle[i].pricingInfo.productRatePlanCharges.filter(function(productRatePlanCharge){return productRatePlanCharge.hasOwnProperty("discountRange")}).pop(),currentItemQty=estimatedCart.bundle[i].qty,ucVolumeDiscountObject=ucDiscountObject&&ucDiscountObject.discountRange&&ucDiscountObject.discountRange.filter(function(volumeDiscountItem){return volumeDiscountItem.min<=qtyTotal&&volumeDiscountItem.max>=qtyTotal}).pop(),newSeletedPrice=0;ucVolumeDiscountObject&&(newSeletedPrice=estimatedCart.bundle[i].pricingInfo.listpriceAPL-ucVolumeDiscountObject.fixedDiscount,estimatedCart.bundle[i].total=newSeletedPrice*currentItemQty,estimatedCart.bundle[i].selectedPrice=newSeletedPrice,estimatedCart.bundle[i].ucPromotionalCharges=ucDiscountObject,estimatorService.getTotal(estimatedCart))}},$scope.addUcAddOnToEstimator=function(plan,itemId,target,qty,isUcAddOn){var quantity=parseInt(qty),seletedPrice=parseFloat(plan.listpriceAPL);if(0<quantity){0<qty&&target&&angular.element(target).removeClass("input-grey");var total=seletedPrice*quantity;estimatorService.addSpokenItem({itemMasterId:itemId,qty:quantity,description:plan.planName,total:total,billingCycle:"MO",term:1,productRatePlanId:plan.productRatePlanId,pricingInfo:plan,unitNet:seletedPrice,selectedPrice:seletedPrice,isAddOn:!1,isUcAddOn:isUcAddOn})}else angular.element(target).addClass("input-grey"),estimatorService.removeItem({itemMasterId:itemId,qty:quantity,description:plan.planName,total:total,billingCycle:"MO",term:1,productRatePlanId:plan.productRatePlanId,pricingInfo:plan,unitNet:seletedPrice,selectedPrice:seletedPrice,isAddOn:!1,isUcAddOn:isUcAddOn})},$scope.addEfaxAddonToEstimator=function(plan,itemId,target,quantity,isUcAddOn){$scope.estimatedCart=estimatorService.getEsimate();var bundle=$scope.estimatedCart.bundle;if($scope.updateEfaxRadioValues(plan),"None"==plan.planName){for(var i=0;i<bundle.length;i++)if(bundle[i].itemMasterId===$scope.efaxItemId||bundle[i].itemMasterId===$scope.efax2ItemId){bundle.splice(i,1);break}}else{var seletedPrice=parseFloat(plan.listpriceAPL);for(i=0;i<bundle.length;i++)if(bundle[i].itemMasterId===$scope.efaxItemId||bundle[i].itemMasterId===$scope.efax2ItemId){bundle.splice(i,1);break}estimatorService.addSpokenItem({itemMasterId:plan.itemId,qty:quantity,description:plan.planName,total:seletedPrice,billingCycle:"MO",term:1,productRatePlanId:plan.productRatePlanId,pricingInfo:plan,unitNet:seletedPrice,selectedPrice:seletedPrice,isAddOn:!1,isUcAddOn:isUcAddOn})}estimatorService.getTotal($scope.estimatedCart)},$scope.updateEfaxRadioValues=function(plan){_.each($scope.eFAXProductArray,function(pricingItem){pricingItem.productCode===plan.productCode&&pricingItem.planName===plan.planName?pricingItem.selected=!0:pricingItem.selected=!1})},$scope.isContinueBtnDisabled=function(){var totalSubscriptionQty=estimatorService.getSubscriptionsTotalQty();if(totalSubscriptionQty<estimatorService.getHardwareTotalQty()&&"hardware"==$scope.view||totalSubscriptionQty<1||$scope.showPopupStatus1||$scope.showPopupStatus2)return!0;if(!($scope.estimatedCart&&$scope.estimatedCart.bundle&&$scope.estimatedCart.bundle.length))return!0;for(var i=0;i<$scope.estimatedCart.bundle.length;i++)if(1===$scope.estimatedCart.bundle.length&&!0===$scope.estimatedCart.bundle[i].isUcAddOn)return!0},$scope.compareHardwareAndSoftwareTotal=function(itemId){if(($scope.isSubscription||$scope.isRenewal&&$scope.isFreeTrial)&&0===$scope.DeltaQtyInitialCheckFlag){var totalSubscriptionDeltaQty=estimatorService.getSubscriptionsTotalDeltaQty();$scope.continueBtnDisabled=0===totalSubscriptionDeltaQty,$scope.DeltaQtyInitialCheckFlag++}estimatorService.getSubscriptionsTotalQty()<estimatorService.getHardwareTotalQty()&&$scope.estimatedCart.bundle.length?($scope.showPopupStatus1=!0,$scope.showPopupMsg="Your selected phone quantity cannot exceed the total number of your user subscription. Please adjust your phone quantity.",$(window).scrollTop(0)):$scope.showPopupStatus1=!1},$scope.checkUcItemsTotalQty3000=function(itemId){var totalSubscriptionQty=estimatorService.getSubscriptionsTotalQty();(itemId===$scope.ucItemId||"2074"===itemId)&&3e3<totalSubscriptionQty&&$scope.estimatedCart.bundle.length?($(window).scrollTop(0),$scope.showPopupStatus2=!0,$scope.showPopupMsg="Your total user subscription cannot exceed 3000 users. Please adjust your subscription quantity.",$scope.continueBtnDisabled=!0):(itemId===$scope.spacesItemId||itemId===$scope.ccItemId||"2046"===itemId)&&1e4<totalSubscriptionQty&&$scope.estimatedCart.bundle.length?($(window).scrollTop(0),$scope.showPopupStatus2=!0,$scope.showPopupMsg="Your total user subscription cannot exceed 10000 users. Please adjust your subscription quantity.",$scope.continueBtnDisabled=!0):$scope.showPopupStatus2=!1},$scope.setSection=function(item){$scope.selectedSection=item,$scope.firstTier=$scope.selectedSection.pricing[0].tiers,$scope.countrySelected=$scope.userData.country},this.setViewId=function(viewId){"select-bundle"==viewId?window.location.href=getStoreLandingLink():($scope.view=viewId,$scope.viewList[$scope.view].enabled=!0)},$scope.nextView=function(bundle){if(bundle&&($scope.selectedBundle=bundle,estimatorService.addBundle(bundle)),"contract-term"==$scope.view&&$scope.getAddOns($scope.selectedBundle.addOnUrl),1==$scope.viewList[$scope.view].addToCart)return $scope.addToCartBtnTxt="Loading...",void($scope.isSubscription?($scope.estimatedCart.subscriptionId=$scope.subscriptionId,$scope.estimatedCart.entityId=$scope.entityId?$scope.entityId:$scope.userTypes.salesAreas[0].legalEntity,$scope.estimatedCart.quoteId=$scope.solutionId,$scope.estimatedCart.subscriptionType=$scope.subscriptionType,$scope.estimatedCart.subscriptionExpiryDate=$scope.subscriptionData.termEndDate,estimatorService.updateQuoteToCart().then(function(response){window.location.href=getCartLink()},function(error){$scope.addToCartBtnTxt="Update",console.log("error adding estimate to cart from subscriptions")}),console.log("$scope.estimatedCart.entityId",$scope.estimatedCart.entityId)):$scope.omsIdfromEditCart?($scope.estimatedCart.omsIdfromEditCart=$scope.omsIdfromEditCart,estimatorService.updateQuoteToCart().then(function(response){window.location.href=getCartLink()},function(error){$scope.addToCartBtnTxt="Update",console.log("error adding estimate to cart")})):estimatorService.addToCart().then(function(response){window.location.href=getCartLink()},function(error){$scope.addToCartBtnTxt="Add to Cart",console.log("error adding estimate to cart")}));$scope.view=$scope.viewList[$scope.view].next||$scope.view,$scope.viewList[$scope.view].enabled=!0},$scope.previousView=function(){"features-addons"==$scope.view?$scope.omsIdfromEditCart||$scope.isSubscription?($(window).scrollTop(0),window.location.href=getCartLink()):($(window).scrollTop(0),window.location.href=getStoreLandingLink()):$scope.view=$scope.viewList[$scope.view].prev||$scope.view},$scope.selectBundle=function(bundle){$scope.selectedBundle=bundle,estimatorService.addBundle($scope.selectedBundle)},$scope.selectItemQuantity=function(item,$event){var quantity=$event,recurring=!0;recurring="10"!=item.itemType&&"12"!=item.itemType&&"13"!=item.itemType&&("9"==item.itemType||(quantity=$($event.target).text()),!0),estimatorService.addItem(item.itemId,item.productName,item.price,item.pricingInfo,Number(quantity),item.itemType,item.billingCycle,item.term,recurring)},$scope.inputActions=function(sectionIndex,item,target,qty){0<(qty=qty)?angular.element(target).removeClass("input-grey"):angular.element(target).addClass("input-grey"),$scope.selectItemQuantity(item,qty),$scope.updateSelected(sectionIndex,item,qty),$rootScope.$broadcast("addProductBroadcast"),$scope.compareHardwareAndSoftwareTotal(item.itemId)},$scope.addHardwareAddOnToEstimator=function(plan,itemId,target,qty,isHardwareAddOn){var item=plan;item.itemId=itemId,qty=qty||0;var quantity=parseInt(qty);item.isHardwareAddOn=isHardwareAddOn,0<quantity?(item.quantity=quantity,angular.element(target).removeClass("input-grey"),estimatorService.addHardwareAddonItem(item)):(item.quantity=quantity,angular.element(target).addClass("input-grey"),estimatorService.removeHardwareAddonItem(item)),$rootScope.$broadcast("addProductBroadcast")},$scope.selected=[],$scope.selectedLength={},$scope.updateSelected=function(sectionIndex,item,qty){if($scope.selectedLength[sectionIndex]=0,""!=qty&&0<qty){0===_.filter($scope.selected,function(val){return val.item===item}).length&&$scope.selected.push({section:sectionIndex,item:item});var selectedSectionFilter=_.filter($scope.selected,function(val){return val.section===sectionIndex});$scope.selectedLength[sectionIndex]=selectedSectionFilter.length}else{$scope.selected.pop({section:sectionIndex,item:item});selectedSectionFilter=_.filter($scope.selected,function(val){return val.section===sectionIndex});$scope.selectedLength[sectionIndex]=selectedSectionFilter.length}},$scope.$on("availableTermsListener",function(event,data){var yearsInMonths=data.split(",");$scope.availableTerms=_.map(yearsInMonths,function(numStr){return Math.floor(parseInt(numStr)/12)})}),$scope.$on("addProductBroadcast",function(){$scope.selectContract(estimatorService.getTerm())}),$scope.selectContract=function(term){var estimatedCart=$scope.estimatedCart;if($scope.isSubscription&&!$scope.isFreeTrial&&0!=term)0===$scope.currentTermFlag&&(12===$scope.subscriptionData.currentTerm||36===$scope.subscriptionData.currentTerm||60===$scope.subscriptionData.currentTerm?term=$scope.subscriptionData.currentTerm/12:1==$scope.subscriptionData.currentTerm&&(term=0,$scope.termSelected=term),$scope.currentTermFlag++),$scope.hardwareEndTotal=Number(estimatedCart.oneTimeHardwareTotal+(estimatedCart.ataAccessoryTotal?estimatedCart.ataAccessoryTotal:0)),estimatedCart.oneTimeTotal=$scope.hardwareEndTotal,estimatedCart.hardwareCreditApplied=0,estimatedCart.totalHWCreditAvailable=0,estimatorService.setTerm(term),$scope.termSelected=term,estimatedCart.termSelected=$scope.termSelected;else{$scope.isFreeTrial&&0===$scope.currentTermFlag&&(12===$scope.subscriptionData.currentTerm||36===$scope.subscriptionData.currentTerm||60===$scope.subscriptionData.currentTerm?term=$scope.subscriptionData.currentTerm/12:1==$scope.subscriptionData.currentTerm&&(term=0,$scope.termSelected=term),$scope.currentTermFlag++),$scope.omsIdfromEditCart&&$scope.termFromEditCart&&0===$scope.editCartFlag&&(term=$scope.termFromEditCart,$scope.editCartFlag++),estimatorService.setTerm(term),$scope.termSelected=term;var creditDetails=estimatorService.getCreditDetails();$scope.totalEndPointCredit=creditDetails.totalCredit,$scope.appliedCredits=creditDetails.appliedCreditsList,$scope.avaialbleTermDiscount=creditDetails.termDiscountPercentage,estimatedCart.oneTimeHardwareTotal>=$scope.totalEndPointCredit?($scope.phoneCreditAppliedTotal=Number(estimatedCart.oneTimeHardwareTotal-$scope.totalEndPointCredit),estimatedCart.hardwareCreditApplied=$scope.totalEndPointCredit):($scope.phoneCreditAppliedTotal=0,estimatedCart.hardwareCreditApplied=estimatedCart.oneTimeHardwareTotal),$scope.hardwareEndTotal=Number($scope.phoneCreditAppliedTotal+(estimatedCart.ataAccessoryTotal?estimatedCart.ataAccessoryTotal:0)),estimatedCart.totalHWCreditAvailable=$scope.totalEndPointCredit,estimatedCart.oneTimeTotal=$scope.hardwareEndTotal,estimatedCart.termSelected=$scope.termSelected,estimatedCart.appliedCredits=$scope.appliedCredits,estimatedCart.avaialbleTermDiscount=$scope.avaialbleTermDiscount?$scope.avaialbleTermDiscount:0;for(var i=0;i<estimatedCart.bundle.length;i++){var discountListPriceApl,discountAppliedPrice,discountedTotal;$scope.isUCDiscountAvailable?estimatedCart.bundle[i].selectedPrice&&!estimatedCart.bundle[i].isUcAddOn&&(discountListPriceApl=estimatedCart.bundle[i].selectedPrice*(Number(estimatedCart.avaialbleTermDiscount)/100),discountAppliedPrice=Number(estimatedCart.bundle[i].selectedPrice-discountListPriceApl),discountedTotal=Number(discountAppliedPrice*estimatedCart.bundle[i].qty),estimatedCart.bundle[i].total=discountedTotal):(discountListPriceApl=estimatedCart.bundle[i].pricingInfo.listpriceAPL*(Number(estimatedCart.avaialbleTermDiscount)/100),discountAppliedPrice=Number(estimatedCart.bundle[i].pricingInfo.listpriceAPL-discountListPriceApl),discountedTotal=Number(discountAppliedPrice*estimatedCart.bundle[i].qty),estimatedCart.bundle[i].total=discountedTotal),estimatorService.getTotal(estimatedCart)}if($scope.totalSubscriptionQty=estimatorService.getSubscriptionsTotalQty(),"hardware"!==$scope.view){$scope.hardwareCreditDiscountAmount=estimatedCart.hardwareCreditDiscountAmount;for(i=0;i<$scope.hardwareItemPricingArray.length;i++)parseFloat($scope.hardwareItemPricingArray[i][0].listpriceAPL)==$scope.hardwareCreditDiscountAmount&&($scope.discountHardwarePhoneObj=$scope.hardwareItemPricingArray[i][0])}}},$scope.featureItemsOnEditCart=function(){var featureItem=$scope.featureItem,editCartResponse=$scope.editCartResponse;if(editCartResponse&&editCartResponse.shoppingCartItems){var refinedCartItems=[];editCartResponse.shoppingCartItems.forEach(function(shoppingCartItem){if(shoppingCartItem.skuKey===featureItem.itemId)for(var k=0;k<featureItem.pricing.length;k++)featureItem.pricing[k].cssInputGrey=!0,featureItem.pricing[k].productRatePlanId===shoppingCartItem.ratePlanId?(featureItem.pricing[k].editItemQty=shoppingCartItem.qty,$scope.addProductToSelection(featureItem.pricing[k],featureItem.itemId,null,shoppingCartItem.qty,!1),featureItem.pricing[k].cssInputGrey=!1,refinedCartItems.push({editItemQty:featureItem.pricing[k].editItemQty,productRatePlanId:featureItem.pricing[k].productRatePlanId})):featureItem.pricing[k].editItemQty=0});for(var k=0;k<featureItem.pricing.length;k++)for(var j in featureItem.pricing[k],refinedCartItems)if(featureItem.pricing[k].productRatePlanId===refinedCartItems[j].productRatePlanId){featureItem.pricing[k].editItemQty=refinedCartItems[j].editItemQty,featureItem.pricing[k].cssInputGrey=!1;break}}},$scope.addOnsItemType13OnEditCart=function(){var addOnItem1=$scope.addOnItem1,editCartResponse=$scope.editCartResponse;editCartResponse&&editCartResponse.shoppingCartItems&&editCartResponse.shoppingCartItems.forEach(function(shoppingCartItem){if(shoppingCartItem.skuKey===addOnItem1.itemId)for(var k=0;k<addOnItem1.pricing.length;k++){if(addOnItem1.pricing[k].productRatePlanId===shoppingCartItem.ratePlanId){addOnItem1.pricing[k].editItemQty=shoppingCartItem.qty,$scope.addProductToSelection(addOnItem1.pricing[k],addOnItem1.itemId,null,shoppingCartItem.qty,!0);break}$scope.addProductToSelection(addOnItem1.pricing[k],addOnItem1.itemId,null,0,!0)}})},$scope.addOnsItemType14OnEditCart=function(){var addOnItems=$scope.addOnItem2,editCartResponse=$scope.editCartResponse;if(editCartResponse&&editCartResponse.shoppingCartItems)for(var refinedCartItems=[],i=0;i<addOnItems.length;i++){addOnItem2=addOnItems[i],editCartResponse.shoppingCartItems.forEach(function(shoppingCartItem){if(shoppingCartItem.skuKey===addOnItem2.itemId)for(var k=0;k<addOnItem2.pricing.length;k++)addOnItem2.pricing[k].cssInputGrey=!0,addOnItem2.pricing[k].productRatePlanId===shoppingCartItem.ratePlanId?(addOnItem2.pricing[k].editItemQty=shoppingCartItem.qty,$scope.addUcAddOnToEstimator(addOnItem2.pricing[k],addOnItem2.itemId,null,shoppingCartItem.qty,!0),addOnItem2.pricing[k].cssInputGrey=!1,refinedCartItems.push({editItemQty:addOnItem2.pricing[k].editItemQty,productRatePlanId:addOnItem2.pricing[k].productRatePlanId})):addOnItem2.pricing[k].editItemQty=0});for(var k=0;k<addOnItem2.pricing.length;k++)for(var j in addOnItem2.pricing[k],refinedCartItems)if(addOnItem2.pricing[k].productRatePlanId===refinedCartItems[j].productRatePlanId){addOnItem2.pricing[k].editItemQty=refinedCartItems[j].editItemQty,addOnItem2.pricing[k].cssInputGrey=!1;break}}},$scope.eFAXaddOnsItemOnEditCart=function(){var eFAXProductArray=$scope.eFAXProductArray,editCartResponse=$scope.editCartResponse;if(editCartResponse&&editCartResponse.shoppingCartItems)for(var i=0;i<eFAXProductArray.length;i++)editCartResponse.shoppingCartItems.forEach(function(shoppingCartItem){shoppingCartItem.skuKey===eFAXProductArray[i].itemId&&$scope.addEfaxAddonToEstimator(eFAXProductArray[i],eFAXProductArray[i].itemId,null,1,!0)})},$scope.skipCartNaming=function(){$scope.cartNamingUpfront=!1,$scope.callBackCart()},$scope.closeStoreRedirect=function(){$scope.showInvalidStorePopup=!1},$scope.selectCartName=function(){$scope.estimatedCart.quoteDescription=$scope.quoteDescription,$scope.cartNamingUpfront=!1,$scope.callBackCart()},$scope.loginTypeCheckAlert=!1;var smSession=$(".app-urls").find("#smsession-cookie").text();smSession&&"No"!=smSession&&"LOGGEDOFF"!=smSession&&""!=smSession&&commerceService.getProfileInfo().then(function(response){$scope.userProfileInfo=response,$scope.userProfileInfo&&$scope.userProfileInfo.usertype?$scope.usertype=$scope.userProfileInfo.usertype:$scope.usertype=null;var loginTypeCheckAlertModal=$(".commerce-loginTypeCheckAlert-modal");"null"==$scope.usertype||"undefined"==$scope.usertype||""==$scope.usertype||null===$scope.usertype||void 0===$scope.usertype?(loginTypeCheckAlertModal.removeClass("hide"),$scope.loginTypeCheckAlert=!0):(loginTypeCheckAlertModal.addClass("hide"),$scope.loginTypeCheckAlert=!1)}),$scope.setUserTypeCancel=function(){$scope.showLoader(),window.location.href=getHomepageLink()},$scope.setUserTypeContinue=function(){$scope.showLoader(),commerceService.setNewCustomer().then(function(response){"success"==response.status?window.location.reload():window.location.href=getHomepageLink()})},$scope.callBackSelectedPhoneNumber=function(phoneNumber,numberType,showPhoneNumber,numPorting){$scope.selectedPhoneNumber=phoneNumber,$scope.showPhoneNumberStatus=showPhoneNumber,$scope.estimatedCart.selectedPhoneNumber=$scope.selectedPhoneNumber,$scope.estimatedCart.numberType=numberType,$scope.isUCOffer?($scope.tollfree="tollfree"==numberType,$scope.tollfree?$scope.tollFreeAmt="CA"==$scope.userData.country?17.5:10:$scope.tollFreeAmt=0):($scope.tollfree=!1,$scope.tollFreeAmt=0)}}}}),avayaBlog.directive("breezePaginator",function(estimatorService){return{restrict:"A",require:"^breezeConfigurator",templateUrl:"/static/avaya/commerce-views/breeze-paginator.html",link:function(scope,element,attrs,breezeConfiguratorCtrl){scope.setView=function(viewId){breezeConfiguratorCtrl.setViewId(viewId)}}}}),avayaBlog.directive("cancelMessage",function(){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/cancel-message.html",controller:function($scope,$element,$window,$filter){$scope.close=function(){$scope.closeModal()}}}}),avayaBlog.directive("cartDropdown",function(cartService,serviceBase){return{restrict:"A",link:function(scope,element){var notificationBubble=$(".cart-notifications p"),itemCount=0;cartService.register(function(){if(!getCookieValue("cmUsrSel"))return!1;var url=getCartApi();serviceBase.getData(url,"").then(function(response){if(!response.data.solutionIds)return!1;itemCount=response.data.solutionIds.length,notificationBubble.text(itemCount),0<itemCount?notificationBubble.addClass("show"):notificationBubble.removeClass("show")},function(error){deferred.reject(error)})})}}}),avayaBlog.directive("cart",function(cartService,modalService,commerceProductService,serviceBase,$q,checkDirectService,midmarketDashboardService,commerceService,$compile,$rootScope){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/cart.html",link:function(scope,element){scope.ucItemId=getUcItemId(),scope.ccItemId=getCcItemId(),scope.spacesItemId=getSpacesItemId(),scope.tollFreeId="SKU-00000050",scope.showCartStatus=!1,scope.showLoader(),scope.userAgentSelected=!1,scope.agentUserSelected="",scope.searchagentsByCompanyId=[],checkDirectService.getUserType().then(function(response){scope.userTypes=response}),scope.accordion={current:null},scope.resetSelectedAgent=function(){midmarketDashboardService.resetSelectAgent().then(function(response){"success"==response.status&&window.location.reload()},function(error){console.log("error selecting agent on search",error)})},scope.filterCart=function(filter){if(filter&&0<filter.length){var cartData=[];filter=filter.toLowerCase(),scope.cartItemsres.forEach(function(item){var cartItm=item.quoteSummary[item.solutionId];(-1<cartItm.createdBy.name.toLowerCase().indexOf(filter)||-1<cartItm.channelType.toLowerCase().indexOf(filter)||-1<cartItm.expiresOn.toLowerCase().indexOf(filter)||-1<item.solutionId.toLowerCase().indexOf(filter)||-1<cartItm.quoteDescription.toLowerCase().indexOf(filter))&&cartData.push(item)}),scope.cartItems=cartData}else scope.cartItems=scope.cartItemsres},scope.goToCheckout=function(solutionId){var qryParam=solutionId?"?solutionId="+solutionId:"";window.location.href=getCheckoutLink()+qryParam},scope.customerCheckOut=function(){checkDirectService.getCustomerType().then(function(response){scope.customerTypes=response})},scope.saveCartHeader=function(newDesc,solutionId){var payload={quoteDescription:newDesc,solutionId:solutionId};scope.showLoader(),cartService.updateCartDescription(payload).then(function(response){"success"==response.status?(scope.callbackReadCart(),scope.showCartStatusMsg(!0,response.status,response.statusMsg)):"failed"==response.status&&scope.showCartStatusMsg(!0,response.status,response.statusMsg)})},scope.editBundleFromCart=function(featuredSku,solutionId,subscriptionId,entityId,subscriptionType){var parameters;window.location.href=(parameters=subscriptionId&&entityId?(featuredSku?"?skuId="+featuredSku:"")+(solutionId?"&quoteId="+solutionId+"&":"")+(subscriptionId?"&subscriptionId="+subscriptionId+"&":"")+(entityId?"entityId="+entityId+"&":"")+(subscriptionType?"subscriptionType="+subscriptionType:""):(featuredSku?"?skuId="+featuredSku:"")+(solutionId?"&solutionId="+solutionId:""),getBundleConfiguratorLink()+parameters)},scope.cloneBundleFromCart=function(featuredSku,solutionId,subscriptionId,entityId,subscriptionType){var parameters=(featuredSku?"?skuId="+featuredSku:"")+(solutionId?"&cloneCart="+solutionId:"");window.location.href=getBundleConfiguratorLink()+parameters},scope.closeAlertModal=function(){scope.showRemoveAlert=!1},scope.removeCartPopup=function(cart){$(window).scrollTop(0),scope.showRemoveAlert=!0,scope.removedCartData=cart},scope.removeCart=function(cart){scope.showRemoveAlert=!1,scope.showLoader(),checkDirectService.getRemoveCart(cart.solutionId).then(function(response){"success"==(scope.removecart=response).status?(scope.callbackReadCart(),scope.showCartStatusMsg(!0,response.status,response.statusMsg)):"failed"==response.status&&(scope.showCartStatusMsg(!0,response.status,response.statusMsg),scope.hideLoader())})},scope.showCartStatusMsg=function(showPopup,status,statusMsg){$(window).scrollTop(0),scope.showCartStatus=showPopup,scope.showPopupStatus=status,scope.showPopupMsg=statusMsg,$(".cartStatusMsg").css("display","flex")},scope.updateItem=function(solutionId,item){console.log(">>>>>>>>>>>Incart<<<<<<<<<<<<<<",item),item.disable=!0,scope.actionType="Updating ",item.qty&&0<=item.qty&&cartService.updateItem(solutionId,item).then(function(){item.disable=!1},function(error){item.disable=!1})},scope.sendToCustomersolutionId=function(cart){scope.selectedSolutionId=cart.solutionId,scope.selectedQuoteCountry=cart.quoteSummary[cart.solutionId].country,scope.agentEmailId=cart.quoteSummary[cart.solutionId].agent&&cart.quoteSummary[cart.solutionId].agent.emailid?cart.quoteSummary[cart.solutionId].agent.emailid:"",scope.customerEmailId=cart.quoteSummary[cart.solutionId].customerEmailId?cart.quoteSummary[cart.solutionId].customerEmailId:"",$(window).scrollTop(0),$(".av-modal.breeze-modal").find(".send-to-customer").css("display","block"),$compile($(".av-modal.breeze-modal").contents())(scope),$(".commerce-modal-backdrop").addClass("fade"),$(".av-modal.breeze-modal").css("display","block")},scope.$on("selectedAgentUser",function(event,updateAgentUser){scope.userAgentSelected=!0,scope.agentUserSelected=updateAgentUser.name}),scope.removeItem=function(solutionId,item){item.disable=!0,scope.actionType="Removing ",cartService.deleteItem(solutionId,item).then(function(){item.disable=!1},function(error){item.disable=!1})};cartService.register(function(){scope.cartItems=cartService.readCart(),scope.cartItemsres=scope.cartItems,scope.hideLoader(),0==scope.cartItems.length?(scope.showContinueShoppingBtn=!0,scope.showCartStatusMsg(!0,"warning","There are no items in your shopping cart. Please click on main navigation to continue shopping.")):scope.showContinueShoppingBtn=!1}),scope.callbackReadCart=function(){cartService.get().then(function(response){scope.cartItems=response,scope.cartItemsres=response}),scope.hideLoader(),0==scope.cartItems.length?(scope.showContinueShoppingBtn=!0,scope.showCartStatusMsg(!0,"warning","There are no items in your shopping cart. Please click on the button below to continue shopping.")):scope.showContinueShoppingBtn=!1},scope.getExcelLink=function(solutionId){var url=getQuoteDownload();window.open(url+"xlsx/"+solutionId+"/","_blank")},scope.getPdfLink=function(solutionId){var url=getQuoteDownload();window.open(url+"pdf/"+solutionId+"/","_blank")},scope.loginTypeCheckAlert=!1;var smSession=$(".app-urls").find("#smsession-cookie").text();smSession&&"No"!=smSession&&"LOGGEDOFF"!=smSession&&""!=smSession&&commerceService.getProfileInfo().then(function(response){scope.userProfileInfo=response,scope.userProfileInfo&&scope.userProfileInfo.usertype?scope.usertype=scope.userProfileInfo.usertype:scope.usertype=null;var loginTypeCheckAlertModal=$(".commerce-loginTypeCheckAlert-modal");"null"==scope.usertype||"undefined"==scope.usertype||""==scope.usertype||null===scope.usertype||void 0===scope.usertype?(loginTypeCheckAlertModal.removeClass("hide"),scope.loginTypeCheckAlert=!0):(loginTypeCheckAlertModal.addClass("hide"),scope.loginTypeCheckAlert=!1)}),scope.setUserTypeCancel=function(){scope.showLoader(),window.location.href=getHomepageLink()},scope.setUserTypeContinue=function(){scope.showLoader(),commerceService.setNewCustomer().then(function(response){"success"==response.status?window.location.reload():window.location.href=getHomepageLink()})},scope.getAgentUserInfo=function(solutionId){checkDirectService.getAgentUsers(scope.cartItems[0].quoteSummary[solutionId].agent.companyid).then(function(response){scope.searchagents=response.data,scope.solutionId=solutionId,$rootScope.$broadcast("searchagentsByCompanyId",scope.searchagents)})},scope.setSolutionId=function(solutionId,type){scope.exportSolutionId=solutionId,scope.exportType=type,scope.details={}},scope.setCustomerPdfSolutionId=function(solutionId){var url=getExportPdfFormApi();window.open(url+solutionId+"/","_blank")},scope.setCustomerExcelSolutionId=function(solutionId){var url=getExportExcelFormApi();window.open(url+solutionId+"/","_blank")}}}}),avayaBlog.directive("caseStudyCarousel",function($timeout){return{link:function($scope,$element,attrs,ctrl){var slider=$element.find(".case-study-slider"),left=null,right=null,center=slider.find(".center");slider.find(".slide").on("click",function(event){$(event.target).parents(".left").length&&($scope.slideLeft(),event.preventDefault(),event.stopPropagation()),$(event.target).parents(".right").length&&($scope.slideRight(),event.preventDefault(),event.stopPropagation())}),$scope.slideLeft=function(){left=slider.find(".left"),right=slider.find(".right"),center=slider.find(".center"),left.appendTo(slider),$timeout(function(){center.removeClass("top"),left.addClass("top"),left.addClass("center").removeClass("left"),center.addClass("right").removeClass("center"),right.addClass("left").removeClass("right")},50)},$scope.slideRight=function(){left=slider.find(".left"),right=slider.find(".right"),center=slider.find(".center"),right.appendTo(slider),$timeout(function(){left.addClass("right").removeClass("left"),center.addClass("left").removeClass("center"),right.addClass("center").removeClass("right")},50)},$(window).resize(function(){$timeout(function(){resizeHeight()},2e3)});var resizeHeight=function(){var centerWidth=(center=slider.find(".center")).width();slider.css("height",.75*centerWidth)};resizeHeight()}}}),avayaBlog.directive("catalogFilter",function(commerceProductService){return{restrict:"EA",template:'<div class="av-store-filter">\t\t\t\t\t\t\t\t<div class="filter">\t\t\t\t\t\t\t\t\t<div class="search">\t\t\t\t\t\t\t\t\t\t<input placeholder="Search" ng-model="searchKeywords">\t\t\t\t\t\t\t\t\t\t<i class="fa fa-close" ng-click="clearSearch()" ng-show="searchKeywords.length > 0"></i>\t\t\t\t\t\t\t\t\t\t<i class="fa fa-search" ng-click="search()"></i>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t<div class="pillar">\t\t\t\t\t\t\t\t\t\t<div class="name">Filter<i class="fa"  ng-class="displayFilter == true? \'fa-chevron-up\':  \'fa-chevron-down\'" ng-click="displayFilter = !displayFilter"></i></div>\t\t\t\t\t\t\t\t\t\t<div class="filter-details" ng-class="{ \'show\': displayFilter == true }">\t\t\t\t\t\t\t\t\t\t\t<div class="section" ng-repeat="solution in catalog.solutions" ng-hide="solution.productCategories.length == 0">\t\t\t\t\t\t\t\t\t\t\t\t<div class="title" ng-show="solution.productCategories.length > 0">{{ solution.name }}</div>\t\t\t\t\t\t\t\t\t\t\t\t<div class="item" ng-repeat="category in solution.productCategories" ng-hide="category.products.length == 0">\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="control">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type="checkbox" class="category" g-checked="category.selected" id="{{ category.id }}" name="check" ng-click="selectProductType( category.id )">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for="{{ category.id }}"></label>\t\t\t\t\t\t\t\t\t\t\t\t\t    </div>\t\t\t\t\t\t\t\t\t\t\t\t\t    <div class="title" ng-bind="category.name">\t\t\t\t\t\t\t\t\t\t\t\t\t    </div>\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="section">\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item" ng-repeat="( key, value ) in category.subTypes">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="control">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type="checkbox" class="sub-type" g-checked="category.subTypes[ key ].selected" id="{{ category.id + \'-\' + key }}" name="check" ng-click="selectProductType( category.id, key )">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for="{{ category.id + \'-\' + key }}"></label>\t\t\t\t\t\t\t\t\t\t\t\t\t\t    </div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t    <div class="title">\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \t{{ value }}\t\t\t\t\t\t\t\t\t\t\t\t\t\t    </div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t<div class="section" ng-repeat="( key, value ) in subTypeList">\t\t\t\t\t\t\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="control">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type="checkbox" class="master-sub-type" id="{{ key }}" name="ipsum" ng-click="selectSubType( key )">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for="{{ key }}"></label>\t\t\t\t\t\t\t\t\t\t\t\t\t    </div>\t\t\t\t\t\t\t\t\t\t\t\t\t    <div class="title" ng-bind="value">\t\t\t\t\t\t\t\t\t\t\t\t\t    </div>\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class="results">\t\t\t\t\t\t\t\t\t<div class="av-add-on no-slide product-filter">\t\t\t\t\t\t\t\t\t\t<div class="wrapper">\t\t\t\t\t\t\t\t\t\t\t<a class="item" target="_self" ng-href="{{ product.redirectUrl }}" ng-repeat="product in productList | filter: { title:keywords }" ng-class="{ \'hide\': product.hide == true }">\t\t\t\t\t\t\t\t\t\t\t\t<div class="image" style="background-image: url(\'{{ product.imageUrl }}\')">\t\t\t\t\t\t\t\t\t\t\t\t\t<div ng-show="( product.new == true )" class="new">NEW</div>\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t<div class="content">\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="product-title" ng-bind="product.title"></div>\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="description ng-binding" ng-bind-html="product.description">\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="learn-more ng-binding" ng-href="product.redirectUrl">\t\t\t\t\t\t\t\t\t\t\t\t\tLearn More</div>\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>',replace:!0,controller:function($scope,$element){var catalogFilterCookie={categoryType:[],categorySubType:[],subType:[],keywords:""};var catalogFilter=function(name){var parts=("; "+document.cookie).split("; "+name+"=");if(2==parts.length)return parts.pop().split(";").shift()}("catalogFilter");catalogFilter&&(catalogFilterCookie=JSON.parse(catalogFilter)),$scope.keywords="",$scope.showLoader(0),commerceProductService.getCatalogData().then(function(response){$scope.catalog={solutions:response.data[0].solutions,subTypeMapping:response.data[1].subTypeMapping};var productList=[];$scope.subTypeList={},$scope.filterList={categoryType:[],categorySubType:[],subType:[]},_.each($scope.catalog.solutions,function(solution){_.each(solution.productCategories,function(category){category.subTypes={},_.each(category.products,function(product,index){product.categoryId=category.id,product.solutionId=solution.id,productList.push(product),category.subTypes[product.subType]||(category.subTypes[product.subType]=$scope.catalog.subTypeMapping[product.subType]),$scope.subTypeList[product.subType]||($scope.subTypeList[product.subType]=$scope.catalog.subTypeMapping[product.subType])})})}),productList.sort(function(leftValue,rightValue){var titleLeft=leftValue.title.toLowerCase(),titleRight=rightValue.title.toLowerCase();return titleLeft<titleRight?-1:titleRight<titleLeft?1:0}),$scope.productList=productList,setTimeout(function(){var categoryList=$($element).find("input.category");_.each(categoryList,function(category){0===_.difference([Number($(category).attr("id"))],catalogFilterCookie.categoryType).length&&$(category).prop("checked",!0)});var subTypeList=$($element).find("input.sub-type");_.each(subTypeList,function(subType){0===_.difference([$(subType).attr("id")],catalogFilterCookie.categorySubType).length&&$(subType).prop("checked",!0)});var masterSubTypeList=$($element).find("input.master-sub-type");_.each(masterSubTypeList,function(subType){0===_.difference([$(subType).attr("id")],catalogFilterCookie.subType).length&&$(subType).prop("checked",!0)}),$scope.searchKeywords=catalogFilterCookie.keywords,$scope.search(),$scope.filterList=catalogFilterCookie,applyFilters(),$scope.hideLoader()},100)},function(error){console.log("error fetching catalog data")}),$scope.selectProductType=function(categoryId,subTypeId){(console.log("categoryId: "+categoryId+" subtypeid: "+subTypeId),subTypeId)?0==_.remove($scope.filterList.categorySubType,function(item){return item===categoryId+"-"+subTypeId}).length&&$scope.filterList.categorySubType.push(categoryId+"-"+subTypeId):0==_.remove($scope.filterList.categoryType,function(item){return item===categoryId}).length&&$scope.filterList.categoryType.push(categoryId);applyFilters()},$scope.selectSubType=function(subTypeId){0==_.remove($scope.filterList.subType,function(item){return item===subTypeId}).length&&$scope.filterList.subType.push(subTypeId),console.log("subtypeid: "+subTypeId),applyFilters()};var applyFilters=function(){_.each($scope.productList,function(product){var show=!0;0<$scope.filterList.subType.length&&(show=0===_.difference([product.subType],$scope.filterList.subType).length),1==show&&0==$scope.filterList.subType.length&&(0<$scope.filterList.categoryType.length&&(show=0===_.difference([product.categoryId],$scope.filterList.categoryType).length),1==show&&0==$scope.filterList.categoryType.length&&0<$scope.filterList.categorySubType.length&&(show=0===_.difference([product.categoryId+"-"+product.subType],$scope.filterList.categorySubType).length)),product.hide=!show}),$scope.filterList.keywords=$scope.keywords,document.cookie="catalogFilter="+JSON.stringify($scope.filterList)};$($element).find(".search input").bind("blur keyup",function(e){"keyup"==e.type&&13==e.keyCode&&$scope.$apply(function(){$scope.search()})}),$scope.search=function(){$scope.keywords=$scope.searchKeywords,$scope.filterList.keywords=$scope.keywords,document.cookie="catalogFilter="+JSON.stringify($scope.filterList)},$scope.clearSearch=function(){$scope.searchKeywords="",$scope.keywords=$scope.searchKeywords}}}}),avayaBlog.directive("checkout",function($window,$timeout,cartService,purchaseOrderService,dateService,$compile,partnerInfoService,billToService,soldToService,checkDirectService,midmarketDashboardService,commerceProductService,commerceService,phoneNumberService){return{restrict:"A",require:"^breezeCommerce",templateUrl:"/static/avaya/commerce-views/checkout.html",link:function(scope,element,attrs,breezeCommerceCtrl){scope.ucItemId=getUcItemId(),scope.ccItemId=getCcItemId(),scope.spacesItemId=getSpacesItemId(),scope.tollFreeId="SKU-00000050",scope.isCCItem=!1,scope.title="Checkout";var checkoutForm=element.find(".checkout-form"),firstName=checkoutForm.find("input[name=firstName]"),lastName=checkoutForm.find("input[name=lastName]"),phone=checkoutForm.find("input[name=phone]"),email=checkoutForm.find("input[name=email]"),disableButton=($(".sign-contract").find("input"),$(".place-order"));scope.showPhoneNumberStatus=!1,scope.isCheckout=!0,scope.selectedPhoneNumber={},scope.purchaseOrderInfo={},scope.selectedMAgent={},scope.selectedAgent={},scope.userTypes={},scope.solutionId="",scope.newBillTo=!1,scope.newShipTo=!1,scope.agentSelection=!1,scope.showWarningPoMsg=!1,scope.POSelectionName="",scope.selectedPO1={},scope.achInfo=null,scope.showErrorInBillTo=!1,scope.agentSelectionChk=!1,scope.tollfree=!1,scope.tollFreeAmt=0,scope.showErrorMsgAfterTermsChk=!1,scope.companyDomainSelectionName="",scope.shipToUpdated=!1,scope.availableNumber=0,scope.numAvailabilityChk=!0,scope.selectedCard={},scope.paymentMethod="1",scope.newNumber=!1,scope.addNewCreditCard=!1,scope.selectedCard={},scope.hideCreditPayment=!1,scope.hidePayment=!1,scope.showFreeTrialErrorMsg=!1,scope.newDomain=!1,scope.selectedDomain={},scope.disableButton=!1,scope.showResponseErrorMsg=!1,scope.addressLine1Regex=/^[ A-Za-z0-9()[\]+*#-/]{3,100}$/,scope.alphabetRegex=/^[a-zA-Z .]{1,50}$/,scope.stateRegex=/^[a-zA-Z .]{2,3}$/,scope.zipCodeUSRegex=/^\d{5}(?:[-\s]\d{4})?/,scope.zipCodeCARegex=/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,scope.numberRegex=/^[0-9]*$/,scope.alphaNumericRegex=/^[a-zA-Z0-9]*$/,scope.phoneRegex=/^((\+1)?[\s-]?)?\(?[1-9]\d\d\)?[\s-]?[0-9]\d\d[\s-]?\d\d\d\d/,scope.routingRegex=/^[0-9]{8,10}$/,scope.acNumberRegex=/^[0-9]{9,17}$/,scope.companyDomainRegex=/^(?!.*\.{2})[A-Za-z0-9._%+-]+\.[a-z]{2,3}$/,scope.creditCardRegex=/^[0-9]{12,19}$/,scope.expiryDateRegex=/^(((0)[0-9])|((1)[0-2]))(\/)([2][0][1-3][0-9])$/,scope.CVVRegex=/^[0-9]{3,4}$/,scope.cardNameRegex=/^[a-zA-Z][^0-9±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{2,50}$/,scope.accordion={current:"customer"},scope.getZipPattern=function(){if(scope.selectedShipTo)return"CA"==scope.selectedShipTo.address.country?scope.zipCodeCARegex:scope.zipCodeUSRegex},scope.getZipBillToPattern=function(){if(scope.selectedBillTo)return"CA"==scope.selectedBillTo.address.country?scope.zipCodeCARegex:scope.zipCodeUSRegex},scope.alert=function(message,type){scope.alertMessage=message,scope.alertType=type,setTimeout(function(){$("#modal-alert").click()},1e3)};var field,url,href,string;scope.solutionId=(field="solutionId",href=url||window.location.href,(string=new RegExp("[?&]"+field+"=([^&#]*)","i").exec(href))?string[1]:null),cartService.get(scope.solutionId).then(function(response){scope.cartres=response,scope.selectPhoneNumberCheckout=!0,scope.showCompanyDomain=!0,0<scope.cartres.length?(scope.cartres[0].quoteSummary[scope.solutionId].tollfree?scope.tollFreeAmt="CA"==scope.cartres[0].quoteSummary[scope.solutionId].country?17.5:10:scope.tollFreeAmt=0,1==scope.cartres[0].quoteSummary[scope.solutionId].isTrial&&(scope.isFreeTrialQuote=!0,scope.selectPhoneNumberCheckout=!0,scope.showCompanyDomain=!0,scope.isFreeTrialExceeded(scope.cartres[0].quoteSummary[scope.solutionId].featuredSku)),scope.cartres[0].quoteSummary[scope.solutionId].featuredSku==scope.spacesItemId&&(scope.selectPhoneNumberCheckout=!1,scope.showCompanyDomain=!0),scope.cartres[0].quoteSummary[scope.solutionId].featuredSku!=scope.ccItemId&&""==scope.cartres[0].quoteSummary[scope.solutionId].subscriptionId||(scope.selectPhoneNumberCheckout=!1,scope.showCompanyDomain=!1),scope.cartres&&0<scope.cartres.length&&scope.solutionId&&0==scope.cartres[0].agentSelection?scope.agentSelection=!1:scope.agentSelection=!0,scope.cartres[0].quoteSummary[scope.solutionId].featuredSku==scope.ucItemId&&0==scope.cartres[0].quoteSummary[scope.solutionId].isTrial&&scope.getTaxInfo(scope.cartres,scope.selectedShipTo,scope.cartres[0].quoteSummary[scope.solutionId].numberType),""!=scope.cartres[0].quoteSummary[scope.solutionId].subscriptionId&&scope.getSubscriptionInfo(scope.cartres[0].quoteSummary[scope.solutionId].subscriptionId,scope.cartres[0].quoteSummary[scope.solutionId].entityId),scope.selectPhoneNumberCheckout&&(scope.isTollFree="tollfree"==scope.cartres[0].quoteSummary[scope.solutionId].numberType,scope.selectPhoneNumberCheck()),scope.showCompanyDomain&&scope.getDomain(),readCart()):(scope.showSolutionIdErrorMsg=!0,scope.alertMsg="You cannot checkout already checked out quote. Please choose a cart from Review Cart.")},function(error){console.log("error fetchng cart data in checkout")}),scope.selectPhoneNumberCheck=function(){"tollfree"==scope.cartres[0].quoteSummary[scope.solutionId].numberType?scope.tollFreeNumberCheck(scope.cartres[0].quoteSummary[scope.solutionId].selectedPhoneNumber.phone_number):"local"==scope.cartres[0].quoteSummary[scope.solutionId].numberType&&scope.localNumberCheck(scope.cartres[0].quoteSummary[scope.solutionId].selectedPhoneNumber.phone_number)},checkDirectService.getUserType().then(function(response){scope.userTypes=response,scope.userTypes||(scope.userTypes={})}),scope.resetSelectedAgent=function(){midmarketDashboardService.resetSelectAgent().then(function(response){"success"==response.status&&$window.location.reload()},function(error){console.log("error selecting agent on search",error)})},soldToService.get().then(function(response){scope.shipToList=response.shipToList;var copyShip=scope.shipToList;scope.shipToList&&1==scope.shipToList.length?(scope.selectedShipTo=copyShip[0],angular.forEach(scope.selectedShipTo.country,function(s){s.value==copyShip[0].country&&s.attr("selected",!0)})):scope.selectedShipTo=copyShip[0]},function(error){console.log("error fetching sold to list")}),soldToService.getSoldToAddress().then(function(response){scope.soldToList=response.soldToList,scope.soldToList&&1==scope.soldToList.length?scope.selectedsoldToList=scope.soldToList[0]:(scope.selectedsoldToList=scope.soldToList[0],scope.selectsoldToList=scope.selectedsoldToList)},function(error){console.log("error fetching sold to list")}),scope.selectedSoldTo=function(addr){scope.selectedsoldToList=addr},scope.billToAddress=function(){billToService.get().then(function(response){scope.billToList=response.shipToList,scope.billToList&&1<=scope.billToList.length&&(scope.selectedBillTo=scope.billToList[0],angular.forEach(scope.selectedBillTo.country,function(s){s.value==scope.billToList[0].country&&s.attr("selected",!0)}),scope.addNewCreditCard||scope.getCreditCardInfo())},function(error){console.log("error fetching bill to list")})},scope.billToAddress(),scope.changeAddress=function(){1==scope.sameAsShipTo?(scope.newBillTo=!1,scope.selectedShipTo?(scope.selectedBillTo=scope.selectedShipTo,angular.forEach(scope.selectedBillTo.country,function(s){s.value==scope.selectedShipTo.country&&s.attr("selected",!0)}),scope.showErrorInBillTo=!1):(scope.showErrorInBillTo=!0,scope.sameAsShipTo=!1)):(scope.selectedShipTo=scope.shipToList[0],angular.forEach(scope.selectedShipTo.country,function(s){s.value==scope.shipToList[0].country&&s.attr("selected",!0)}))},scope.setSelectedSold=function(soldTo,newAddressSelected,changedShipTo){scope.selectedShipTo=soldTo,angular.forEach(scope.selectedShipTo.country,function(s){s.value==soldTo.country&&s.attr("selected",!0)}),scope.newShipTo=newAddressSelected,scope.shipToUpdated=changedShipTo,scope.calculateTaxesShipTo()},scope.setSelectedBillTo=function(billTo,newAddressSelected){scope.selectedBillTo=billTo,scope.newBillTo=newAddressSelected,angular.forEach(scope.selectedBillTo.country,function(s){s.value==soldTo.country&&s.attr("selected",!0)})},scope.getTaxInfo=function(cart,shipTo,numberType){(cart=cart[0]).shippingAddress=shipTo,cart.tollFree="tollfree"==numberType,scope.showLoading=!0,commerceProductService.getTaxInfoData(cart).then(function(response){response.totaltax?(scope.taxInfo=response,scope.showLoading=!1,scope.notAvailableTax=!1):response.inv[0].err.length&&(scope.notAvailableTax=!0,scope.showLoading=!1)},function(error){console.log("error fetching bill to list")})},scope.calculateTaxesShipTo=function(){scope.cartres[0].quoteSummary[scope.solutionId].featuredSku==scope.ucItemId&&0==scope.cartres[0].quoteSummary[scope.solutionId].isTrial&&(scope.shipToUpdated&&scope.getTaxInfo(scope.cartres,scope.selectedShipTo,scope.cart[0].quoteSummary[scope.cart[0].solutionId].numberType),scope.shipToUpdated=!1)};var validateField=function(validationItem){return 0!=validationItem.required||validationItem.field.val()&&0!=validationItem.field.val().length?"select"==validationItem.type?0<validationItem.field.find(".not-selected").length&&0==validationItem.field.hasClass("hidden")?(validationItem.field.parent().addClass("show-error"),!1):(validationItem.field.parent().removeClass("show-error"),!0):validationItem.field.hasClass("hidden")?(validationItem.field.parent().removeClass("show-error"),!0):validationItem.field.val().match(validationItem.regEx)?(validationItem.field.parent().removeClass("show-error"),!0):(validationItem.field.parent().hasClass("show-error")||validationItem.field.parent().addClass("show-error"),!1):(validationItem.field.parent().removeClass("show-error"),!0)},addValidation=function(field,regex,type,required,callback,customCallback,validationList,formStatusCallback){if(0!=field.length&&!field.attr("readonly")){var validationItem={field:field,regEx:regex,type:type,required:required,customCallback:customCallback};validationList.push(validationItem),formStatusCallback&&field.on("keyup",function(){formStatusCallback(validateField(validationItem),validationList)})}},validationListSetup=[],regexList_name=/^[a-zA-Z][^0-9±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{2,50}$/,regexList_expiration=/^(?:0?[1-9]|1[0-2]) *\/ *[2][0][1-3][0-9]$/,regexList_cvv=/^[0-9]{3,4}$/,regexList_creditCard=/^[0-9]{1,19}$/,formStatusCallback=function(status,validationList){1==status?getFormStatus(validationList)&&errorMessage.removeClass("show"):errorMessage.addClass("show")},today=new Date,currentMonth=today.getUTCMonth()+1,currentYear=today.getUTCFullYear(),cardName=$("input[name='cardName']"),cardExpDate=$("input[name='cardExpDate']"),cardCvv=$("input[name='cardCvv']"),cardNumber=$("input[name='cardNumber']"),errorMessage=$(".error-message");addValidation(cardName,regexList_name,null,!0,0,null,validationListSetup,formStatusCallback),addValidation(cardExpDate,regexList_expiration,null,!0,0,function(cardExpDate){var card=cardExpDate.split("/"),month=card[0],year=card[1];return!(year<currentYear)&&(!(year==currentYear&&month<currentMonth)&&void 0)},validationListSetup,formStatusCallback),addValidation(cardCvv,regexList_cvv,null,!0,0,null,validationListSetup,formStatusCallback),addValidation(cardNumber,regexList_creditCard,null,!0,0,null,validationListSetup,formStatusCallback),scope.expiryDateRegexFunc=function(){var element=$("input[name='cardExpDate']").val();if(scope.expiryError=!1,/^(((0)[0-9])|((1)[0-2]))(\/)([2][0][1-3][0-9])$/.test(element)){var date_array=element.split("/"),month=date_array[0]-1,year=date_array[1];if(source_date=new Date,year>source_date.getFullYear())return!1;if(year==source_date.getFullYear()){if(month>=source_date.getMonth())return!1;scope.expiryError=!0}else scope.expiryError=!0}else scope.expiryError=!0};var validateForm=function(validationList){return scope.formStatus=!0,scope.paymetricError=!1,_.each(validationList,function(validationItem){validationItem.field.prop("disabled")||0!=validateField(validationItem)||(errorMessage.addClass("show"),scope.formStatus=!1)}),cardNumber.parent().hasClass("show-error")?(scope.formStatus=!1,scope.paymetricError=!0):(scope.formStatus=!0,scope.paymetricError=!1),scope.formStatus},getFormStatus=function(validationList){var formStatus=!0;return scope.paymetricError=!1,scope.paymetricExpError=!1,_.each(validationList,function(validationItem){if(validationItem.field.hasClass("error")||validationItem.field.val().length<1)return formStatus=!1,cardNumber.parent().hasClass("show-error")&&(scope.paymetricError=!0),formStatus}),formStatus};scope.tocDataValid=!1;$("input[name='tocName']"),$("input[name='tocTitle']"),$("input[name='tocEntity']"),$("input[name='tocEmail']"),$("button[name='tocAcceptButtom']");firstName.val(attrs.firstName),firstName.keyup(),lastName.val(attrs.lastName),lastName.keyup(),phone.val(attrs.phone),phone.keyup(),email.val(attrs.emailid),scope.userDetails={name:attrs.firstName+" "+attrs.lastName,jobtitle:"null"==attrs.title?"":attrs.title,legalEntity:attrs.legalEntity,email:attrs.emailid,date:new Date,tocId:"1.0"},scope.dateInWords=dateService.getDateInWords(),scope.checklist={soldTo:!1,creditCard:!1,terms:!1},scope.termsAccepted=!1,scope.termsAccept=function(accept,tnc){scope.termsAccepted=accept,scope.userDetails=tnc},email.keyup();var paymentFrame=$("#paymetricIframe").contents(),creditCardNumber=$("input[name=cardNumber]");scope.creditCardNumberError=$("input[name=cardNumber]").parent().hasClass("show-error"),scope.$applyAsync();var paymentInfo={expiryYear:"",paymetricToken:"",paymentType:"CC",expiryMonth:"",nameOnCard:"",poNumber:"123456",docId:null,cardType:"VISA",cvv:""};creditCardNumber.blur(function(cardNumber){if(scope.paymetricToken=null,function(cardNumber){return!(!cardNumber||0==cardNumber.length)}(cardNumber=$("input[name=cardNumber]").val())){var payNow=(paymentFrame=$("#paymetricIframe").contents()).find("#PayNowButton"),cardCvv="123",cardDetails=cardTypeDetails(cardNumber),cardTypeCode=(cardDetails.cardType,cardDetails.cardTypeCode);"3000"==cardTypeCode&&(cardCvv="5858");var pmCardType=paymentFrame.find("#Paymetric_CreditCardType"),pmCardNo=paymentFrame.find("#Paymetric_CreditCardNumber"),pmExpMonth=paymentFrame.find("#Paymetric_Exp_Month"),pmExpYear=paymentFrame.find("#Paymetric_Exp_Year"),pmCVV=paymentFrame.find("#Paymetric_CVV");pmCardType.val(cardTypeCode),pmCardNo.val(cardNumber),pmExpMonth.val("02"),pmExpYear.val("2019"),pmCVV.val(cardCvv),payNow.click(),$window.showToken=function(token){console.log("Paymetric token inside showToken method:"+token),scope.paymetricToken=token,scope.$applyAsync(),creditCardNumber.parent().removeClass("show-error"),scope.paymetricError=!1,setTimeout(function(){$("#paymetricIframe").attr("src",function(index,attr){return attr})},500)},setTimeout(function(){scope.paymetricError=!1;var paymetricErrorList=(paymentFrame=$("#paymetricIframe").contents()).find("#Paymetric_ErrorLogging");paymetricErrorList&&0<paymetricErrorList.length&&0<paymetricErrorList.text().length&&(creditCardNumber.parent().addClass("show-error"),scope.paymetricError=!0)},200),console.log("Paymetric token:"+scope.paymetricToken),scope.$applyAsync()}});var cardTypeDetails=function(cardNumber){var cardType,cardTypeCode,cardFirstDigit=cardNumber.substring(0,1);if("4"==cardFirstDigit)cardTypeCode="4000",cardType="VISA";else if("5"==cardFirstDigit)cardTypeCode="5000",cardType="MC";else if("6"==cardFirstDigit)cardTypeCode="6000",cardType="DISC";else if("3"==cardFirstDigit){cardTypeCode="3000";var cardSecondDigit=cardNumber.substring(1,2);"4"!=cardSecondDigit&&"7"!=cardSecondDigit||(cardType="AMEX"),"0"!=cardSecondDigit&&"6"!=cardSecondDigit&&"8"!=cardSecondDigit||(cardType="")}return{cardType:cardType,cardTypeCode:cardTypeCode}};breezeCommerceCtrl.onFileUpload(function(){}),scope.callBackSelectedAgents=function(helpFindAgent,agent){scope.helpFindAgent=helpFindAgent,scope.selectedAgent=agent,scope.helpFindAgent||scope.selectedAgent?scope.agentSelectionChk=!0:scope.agentSelectionChk=!1},element.find(".place-order ").on("click",function(){if(disableButton.addClass("disable"),!(0<scope.cart.total)||validateForm(validationListSetup)){if("1"==scope.paymentMethod){if(scope.addNewCreditCard){var expDate=element.find("input[ name='cardExpDate' ]"),cardNumber=$("input[name=cardNumber]").val();paymentInfo.cardType=cardTypeDetails(cardNumber).cardType,paymentInfo.paymetricToken=scope.paymetricToken,paymentInfo.expiryYear=expDate.val().split("/")[1],paymentInfo.expiryMonth=expDate.val().split("/")[0],paymentInfo.nameOnCard=element.find("input[ name='cardName' ]").val(),paymentInfo.cvv=element.find("input[ name='cardCvv' ]").val(),scope.paymentInfo={},scope.paymentInfo=paymentInfo,scope.paymentInfoDefault=paymentInfo,console.log("addNewCreditCard",scope.paymentInfo)}scope.addNewCreditCard||(paymentInfo={expiryYear:"",paymetricToken:"",paymentType:"CC",expiryMonth:"",nameOnCard:"",poNumber:"123456",docId:null,cardType:"VISA",cvv:""}),scope.purchaseOrderInfo={}}else"2"==scope.paymentMethod&&(scope.purchaseOrderInfo=scope.selectedPO1,scope.selectedCard.paymentInfo={},scope.paymentInfo={});scope.showLoader(30);var tnc={docId:scope.docId};scope.selectedBillTo.newAddress=scope.newBillTo?scope.newBillTo:"",scope.selectedShipTo.newAddress=scope.newShipTo?scope.newShipTo:"";var phoneNumberSelected=scope.newNumber?scope.cartres[0].quoteSummary[scope.solutionId].selectedPhoneNumber:"";cartService.submit("true"==scope.defaultCard?scope.paymentInfoDefault:scope.paymentInfo,scope.solutionId,scope.purchaseOrderInfo,tnc,scope.cart[0].quoteSummary[scope.cart[0].solutionId].selectedPhoneNumber,scope.selectedShipTo,scope.selectedBillTo,scope.helpFindAgent,scope.selectedAgent,scope.selectedsoldToList,scope.taxExempt,scope.cart[0].quoteSummary[scope.cart[0].solutionId].companyDomainSelectionName,phoneNumberSelected).then(function(response){"success"==response.status?($(window).scrollTop(0),scope.errorMsgPlaceOrder="",scope.confirmation=!0,scope.confirmationData=response,scope.title="Thank you for your order",scope.hideLoader()):"failed"==response.status?(scope.hideLoader(),scope.disableButton=!1,scope.errorMsgPlaceOrder=response.errorMessage):(scope.showResponseErrorMsg=!0,scope.hideLoader())},function(error){scope.hideLoader(),scope.errorMsgPlaceOrder="There was a problem submitting your order at this time. Please try again later."})}});var readCart=function(){null!=scope.solutionId||null!=scope.solutionId?scope.cart=scope.cartres:scope.cart=cartService.readCart()};scope.tollFreeNumberCheck=function(number){phoneNumberService.get(number).then(function(response){scope.availableNumber=response.total,1==scope.availableNumber?scope.numAvailabilityChk=!0:scope.numAvailabilityChk=!1},function(error){scope.hideLoader(),console.log("error fetchng data on search",error)})},scope.localNumberCheck=function(number){phoneNumberService.getNumber(number).then(function(response){scope.availableNumber=response.total,1==scope.availableNumber?scope.numAvailabilityChk=!0:scope.numAvailabilityChk=!1,scope.hideLoader()},function(error){scope.hideLoader(),console.log("error fetchng data on search",error)})},scope.savePODetails=function(formData,selectedPO){scope.showLoader(),scope.selectedPO1=selectedPO,purchaseOrderService.savePO(formData).then(function(response){var res=JSON.parse(response.data);"success"==res.status&&(scope.closeModal(),scope.selectedPO1.PODocID=res.docId,scope.setSelectedPo(scope.selectedPO1)),scope.hideLoader()},function(error){scope.closeModal(),scope.hideLoader()})},scope.checkoutWarningPO=function(){"50000"<scope.cart[0].quoteSummary[scope.cart[0].solutionId].subscription.total+scope.cart[0].quoteSummary[scope.cart[0].solutionId].oneTime.total&&(scope.showWarningPoMsg=!0)},scope.disablePlaceOrderBtn=function(){return!!(scope.checkoutForm.$invalid||!scope.termsAccepted||scope.agentSelection&&!scope.agentSelectionChk||scope.showCompanyDomain&&!scope.cart[0].quoteSummary[scope.cart[0].solutionId].companyDomainSelectionName.domain||scope.selectPhoneNumberCheckout&&!scope.cart[0].quoteSummary[scope.cart[0].solutionId].selectedPhoneNumber.phone_number||!scope.selectedShipTo||("2"==scope.paymentMethod||scope.hideCreditPayment)&&!scope.POSelectionName||scope.creditCardNumberError||scope.paymetricExpError||scope.paymetricError||"1"==scope.paymentMethod&&scope.addNewCreditCard&&(!scope.hidePayment&&null==scope.paymetricToken)||"1"==scope.paymentMethod&&!scope.addNewCreditCard&&!scope.selectedCard.paymentInfo||scope.selectPhoneNumberCheckout&&!scope.numAvailabilityChk)},scope.setSelectedPo=function(po){po?(scope.selectedPO1=po,scope.POSelectionName=scope.selectedPO1.PONumber,scope.checkoutWarningPO()):(scope.selectedPO1={},scope.POSelectionName="")},scope.showCheckoutStatusMsg=function(showPopup,status,statusMsg){$(window).scrollTop(0),scope.showCheckoutStatus=showPopup,scope.showPopupStatus=status,scope.showPopupMsg=statusMsg,$(".checkoutStatusMsg").css("display","flex")},null==scope.solutionId&&($(window).scrollTop(0),scope.showSolutionIdErrorMsg=!0,scope.alertMsg="You cannot checkout without a Solution Id. Please choose a cart from Review Cart."),scope.closeAlertModal=function(){scope.showSolutionIdErrorMsg=!1},scope.reviewCartLink=function(){window.location.href=getCartLink()},scope.refreshCheckout=function(){window.location.href=getCheckoutLink()},scope.clearForm=function(){scope.showPhoneNumberStatus=!1,scope.errorMsgPlaceOrder="",scope.termsAccepted=!1,scope.POSelectionName="",scope.selectedShipTo=scope.shipToList[0],scope.phoneTab="1",scope.paymentMethod="1";var billaddr=scope.billToList[0];scope.selectedBillTo=billaddr,scope.selectedDomain={},scope.selectPhoneNumberCheckout?(scope.companyDomainSelectionName=null,scope.unavailableNumber&&(scope.cart[0].quoteSummary[scope.solutionId].selectedPhoneNumber=scope.unavailableNumber,scope.cart[0].quoteSummary[scope.solutionId].numberType=scope.unavailableNumberType,scope.selectPhoneNumberCheck())):1==scope.cartres[0].quoteSummary[scope.solutionId].isTrial?(scope.cart[0].quoteSummary[scope.solutionId].companyDomainSelectionName={},scope.cart[0].quoteSummary[scope.solutionId].selectedPhoneNumber={}):scope.companyDomainSelectionName="na.na",scope.showCompanyDomain&&scope.getDomain(),scope.agentSelectionChk=!1,scope.selectedAgent={},scope.cardName="",scope.cardNumber="",scope.cardExpiry="",scope.cardCVV="",scope.selectedPO1.PONumber=""},cartService.register(readCart),scope.loginTypeCheckAlert=!1;var smSession=$(".app-urls").find("#smsession-cookie").text();smSession&&"No"!=smSession&&"LOGGEDOFF"!=smSession&&""!=smSession&&commerceService.getProfileInfo().then(function(response){scope.userProfileInfo=response,scope.userProfileInfo&&scope.userProfileInfo.usertype?scope.usertype=scope.userProfileInfo.usertype:scope.usertype=null;var loginTypeCheckAlertModal=$(".commerce-loginTypeCheckAlert-modal");"null"==scope.usertype||"undefined"==scope.usertype||""==scope.usertype||null===scope.usertype||void 0===scope.usertype?(loginTypeCheckAlertModal.removeClass("hide"),scope.loginTypeCheckAlert=!0):(loginTypeCheckAlertModal.addClass("hide"),scope.loginTypeCheckAlert=!1)}),scope.setUserTypeCancel=function(){scope.showLoader(),window.location.href=getHomepageLink()},scope.setUserTypeContinue=function(){scope.showLoader(),commerceService.setNewCustomer().then(function(response){"success"==response.status?window.location.reload():window.location.href=getHomepageLink()})},scope.editBundleFromCart=function(featuredSku,solutionId){var parameters;parameters=(featuredSku?"?skuId="+featuredSku:"")+(solutionId?"&solutionId="+solutionId:""),window.location.href=getBundleConfiguratorLink()+parameters},scope.callBackSelectedPhoneNumber=function(phoneNumber,numberType,showPhoneNumber,numPorting){var num=scope.cartres[0].quoteSummary[scope.solutionId].selectedPhoneNumber,type=scope.cartres[0].quoteSummary[scope.solutionId].numberType;scope.unavailableNumber=num,scope.unavailableNumberType=type,scope.cartres[0].quoteSummary[scope.solutionId].selectedPhoneNumber=phoneNumber,scope.showPhoneNumberStatus=showPhoneNumber,scope.newNumber=!0,scope.numAvailabilityChk=!0,scope.cartres[0].quoteSummary[scope.solutionId].numberType=numberType,scope.cartres[0].quoteSummary[scope.solutionId].featuredSku==scope.ucItemId?(scope.tollfree="tollfree"==scope.cartres[0].quoteSummary[scope.solutionId].numberType,scope.tollfree?scope.tollFreeAmt="CA"==scope.cartres[0].quoteSummary[scope.solutionId].country?17.5:10:scope.tollFreeAmt=0):(scope.tollfree=!1,scope.tollFreeAmt=0)},scope.setSelectedDomain=function(val){scope.cartres[0].quoteSummary[scope.solutionId].companyDomainSelectionName={},scope.cartres[0].quoteSummary[scope.solutionId].companyDomainSelectionName=val,console.log("v",scope.cartres[0].quoteSummary[scope.solutionId].companyDomainSelectionName)},scope.isFreeTrialExceeded=function(featuredSku){soldToService.getFreeTrialInfo(featuredSku).then(function(response){if("failed"!=response.status)return!1;$(window).scrollTop(0),scope.showFreeTrialErrorMsg=!0,scope.alertMsg=response.statusMsg},function(error){console.log("error fetching isFreetrial response")})},scope.getCreditCardInfo=function(){scope.showLoader(),scope.addNewCreditCard=!1,billToService.getCreditCardDetails().then(function(response){scope.creditCardList=response;var length=scope.creditCardList.length-1;scope.paymentInfo=scope.creditCardList[length],scope.creditCardList&&0!=scope.creditCardList.length?(angular.forEach(scope.creditCardList,function(card){card.creditcardDetails.expiryYear=card.creditcardDetails.expDate.split("-")[0],card.creditcardDetails.expiryMonth=card.creditcardDetails.expDate.split("-")[1]}),scope.addNewCreditCard||(scope.selectedCard.paymentInfo=scope.creditCardList[0],scope.selectedBillTo.address=scope.selectedCard.paymentInfo.creditcardPayerAddress,scope.selectedBillTo.address.state=scope.selectedCard.paymentInfo.creditcardPayerAddress.stateOrProvinceCode,scope.selectedBillTo.address.zip=scope.selectedCard.paymentInfo.creditcardPayerAddress.postalCode,scope.selectedBillTo.address.country=scope.selectedCard.paymentInfo.creditcardPayerAddress.countryCode)):scope.addNewCreditCard=!0,scope.hideLoader()},function(error){scope.hideLoader(),console.log("error fetchng credit caard data")})},scope.showNewCreditCard=function(){scope.addNewCreditCard=!0,scope.billToAddress()},scope.showCreditList=function(){scope.addNewCreditCard=!1,""!=scope.cartres[0].quoteSummary[scope.solutionId].subscriptionId?scope.getSubscriptionInfo(scope.cartres[0].quoteSummary[scope.solutionId].subscriptionId,scope.cartres[0].quoteSummary[scope.solutionId].entityId):scope.getCreditCardInfo()},scope.updateAddress=function(addr){scope.selectedBillTo.address=addr.creditcardPayerAddress,scope.selectedBillTo.address.state=addr.creditcardPayerAddress.stateOrProvinceCode,scope.selectedBillTo.address.zip=addr.creditcardPayerAddress.postalCode,scope.selectedBillTo.address.country=addr.creditcardPayerAddress.countryCode},scope.updatePaymentInfo=function(card){"Credit Card on file"==(scope.paymentInfo=card).creditcardDetails.cardType?scope.defaultCard="true":scope.defaultCard="false"},scope.chkCreditRequired=function(){return!scope.hidePayment&&(1==scope.paymentMethod&&scope.addNewCreditCard)},scope.getSubscriptionInfo=function(subscriptionId,entityId){var subscription={};subscription.subscriptionId=subscriptionId,subscription.entityId=entityId,scope.defaultCard="true",scope.paymentInfoDefault={paymentType:"CC",expiryMonth:"",nameOnCard:"",poNumber:"123456"},midmarketDashboardService.getSubscriptionInfoData(subscription).then(function(response){scope.subscriptionInfo=response.data[0];var subscriptionObj={creditcardDetails:{},creditcardPayerAddress:{}};subscriptionObj.creditcardDetails.cardType="Credit Card on file ",subscriptionObj.creditcardDetails.cardTokenNo=scope.subscriptionInfo.CCToken__c,subscriptionObj.creditcardDetails.expiryMonth="",subscriptionObj.creditcardDetails.expiryYear="",subscriptionObj.creditcardPayerAddress.stateOrProvinceCode="",subscriptionObj.creditcardPayerAddress.postalCode="",subscriptionObj.creditcardPayerAddress.countryCode="checked",""!=scope.cartres[0].quoteSummary[scope.solutionId].subscriptionId&&(scope.selectedCard.paymentInfo=subscriptionObj),scope.creditCardList.push(subscriptionObj);for(var item=0;item<scope.creditCardList.length;item++)subscriptionObj.creditcardDetails.cardTokenNo==scope.creditCardList[item].creditcardDetails.cardTokenNo&&""!=scope.creditCardList[item].creditcardPayerAddress.postalCode&&scope.creditCardList.splice(item,1);for(var i=0;i<scope.creditCardList.length;i++)for(var j=i+1;j<scope.creditCardList.length;j++)scope.creditCardList[i].creditcardDetails.cardTokenNo==scope.creditCardList[j].creditcardDetails.cardTokenNo&&scope.creditCardList.splice(i,1);scope.subscriptionInfo.CCToken__c?scope.hidePayment=!0:(scope.hideCreditPayment=!0,scope.paymentMethod="2",scope.selectedCard.paymentInfo={},scope.paymentInfoDefault={})})},scope.getDomain=function(){soldToService.getCompanyDomain().then(function(response){scope.companyDomainList=response,scope.companyDomainList&&0==scope.companyDomainList.length?(scope.cartres[0].quoteSummary[scope.solutionId].companyDomainSelectionName={},scope.domain={},scope.domain.type="addnew"):(scope.companyDomainList&&scope.companyDomainList.length,scope.cartres[0].quoteSummary[scope.solutionId].companyDomainSelectionName=scope.companyDomainList[0],scope.selectedDomain=scope.companyDomainList[0])},function(error){console.log("error fetching company domain")})},scope.setQuoteEntityId=function(id){scope.quoteEntityId=id,$(window).scrollTop(0),$(".av-modal.breeze-modal").find(".terms-conditions").css("display","block"),$compile($(".av-modal.breeze-modal").contents())(scope),$(".commerce-modal-backdrop").addClass("fade"),$(".av-modal.breeze-modal").css("display","block")},scope.getCountriesList=function(){commerceService.getCountries().then(function(response){scope.countriesList=response,scope.countriesUserTypeList=[],scope.userTypes.salesAreas&&1==scope.userTypes.salesAreas.length?response.forEach(function(item){item.country.code2==scope.userTypes.salesAreas[0].country&&scope.countriesUserTypeList.push(item)}):scope.countriesUserTypeList=[]})},scope.getCountriesList()}}}),avayaBlog.directive("commerceAccountSettingsModal",function($http,$q,$location,checkDirectService,estimatorService,partnerInfoService,partnerInfoServiceT1,partnerInfoServiceT2,commerceProductService,serviceBase,$rootScope){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/account-settings-modal.html",link:function(scope){scope.userTypes=null,scope.customerTypes=null,scope.masterAgents=null,scope.agents=null,scope.direct=!1,scope.inDirect=!1,scope.magentSelection=null,scope.agentSelection=null,scope.showAgent=!1,scope.showMasterAgent=!1,scope.estimatedCart=estimatorService.getEsimate(),scope.salesAreas=[];checkDirectService.getUserType().then(function(response){null!=(scope.userTypes=response).channeltype&&(scope.userTypeSelection=null!=scope.userTypes.channeltype?scope.userTypes.channeltype[0]:"",scope.userName=scope.userTypes.firstname+" "+scope.userTypes.lastname,scope.salesAreas=scope.userTypes.salesAreas,scope.salesAreas.country="Customer"===scope.userTypes.usertype?scope.salesAreas[0].country:"Please Select",1==scope.userTypes.channeltype.length?scope.channelTypeSelected(scope.userTypeSelection):1<scope.userTypes.channeltype.length&&(scope.userTypeSelection="Please Select")),scope.userTypes&&"Agent"===scope.userTypes.usertype&&scope.userTypes.salesAreas&&1===scope.userTypes.salesAreas.length&&(scope.salesAreas.country=scope.salesAreas[0].country,scope.salesAreas.entityId=scope.salesAreas[0].legalEntity),-1<$location.absUrl().toLowerCase().indexOf("solutionid")||!scope.userTypes||"Master Agent"!=scope.userTypes.usertype&&"Agent"!=scope.userTypes.usertype&&"Avaya-Sales"!=scope.userTypes.usertype?checkDirectService.getCustomerType().then(function(response){scope.customerTypes=response}):$(".commerce-modal-popup").addClass("show")}),scope.goToContinueShopping=function(){window.location.href=getStoreLandingLink()},scope.channelTypeSelected=function(channel){scope.masterAgents=null,scope.agents=null,"Direct"==(scope.userTypeSelection=channel)?(scope.direct=!0,scope.inDirect=!1,scope.salesAreas=scope.userTypes.salesAreas,scope.salesAreas.country="Please Select"):"Master Agent"==channel&&(scope.inDirect=!0,scope.direct=!1,scope.salesAreas.country="Please Select","Master Agent"==scope.userTypes.usertype?(scope.showMasterAgent=!1,scope.getAgentsInfo()):scope.getMasterAgentsInfo())},scope.masterAgentSelected=function($event){if(scope.magentSelection=$($event.target).text(),scope.magentId=scope.getMasterAgentId(scope.magentSelection),angular.element(magentError).removeClass("show"),"Agent"!==scope.userTypes.usertype){var mAgent=scope.masterAgents.filter(function(agent){return agent.companyname===scope.magentSelection})[0];scope.getAgentsInfo(mAgent.companyid)}},scope.agentSelected=function($event){scope.agentSelection=$($event.target).text(),scope.agentId=scope.getAgentId(scope.agentSelection),angular.element(agentError).removeClass("show"),scope.getAgentUsersInfo(scope.agentId)},scope.agentUsersSelected=function(agent){scope.agentUserSelection=agent},scope.getAgentId=function(agentSelected){var agent=scope.agents.filter(function(agent){return agent.companyname===agentSelected})[0];return scope.salesAreas=agent.salesAreas,1<scope.salesAreas.length&&(scope.salesAreas.country="Please Select"),1===scope.salesAreas.length&&(scope.salesAreas.country=scope.salesAreas[0].country,scope.salesAreas.entityId=scope.salesAreas[0].legalEntity),agent.companyid},scope.getMasterAgentId=function(magentSelected){return scope.masterAgents.filter(function(agent){return agent.companyname===magentSelected})[0].companyid},scope.closeModal=function(){window.location.href=getSignOutLink()},scope.getAgentsInfo=function(companyId){checkDirectService.getAgents(companyId).then(function(response){scope.agents=response.data,1==scope.agents.length?(scope.agentSelection=scope.agents.companyname,scope.showAgent=!0,scope.getAgentUsersInfo(scope.agents[0].companyid),scope.salesAreas=scope.agents[0].salesAreas,1<scope.salesAreas.length&&(scope.salesAreas.country="Please Select")):(scope.agentSelection="Please Select",scope.showAgent=!0)})},scope.getAgentUsersInfo=function(agentId){checkDirectService.getAgentUsers(agentId).then(function(response){scope.agentUsers=response.data,1==scope.agentUsers.length?scope.showAgentUser=!0:(scope.showAgentUser=!0,scope.agentUserSelection={},scope.agentUserSelection.name=scope.agentUsers[0].name)})},scope.getMasterAgentsInfo=function(){checkDirectService.getMasterAgents().then(function(response){scope.masterAgents=response,1==scope.masterAgents.length?scope.showMasterAgent=!0:(scope.showMasterAgent=!0,scope.magentSelection="Please Select"),"Agent"!==scope.userTypes.usertype&&1==scope.masterAgents.length&&scope.getAgentsInfo(scope.masterAgents[0].companyid)})},scope.userEntityCountrySelection=function(selectedUserentity){var selectedCountry=scope.salesAreas.filter(function(salesArea){return salesArea.country===selectedUserentity.country})[0];scope.salesAreas.country=selectedCountry.country,scope.salesAreas.entityId=selectedCountry.legalEntity},scope.saveModal=function(){var field,url,href,string;if(scope.showLoader(),$.removeCookie("cmUsrSel",{path:"/"}),scope.masterAgents&&1==scope.masterAgents.length&&(scope.magentSelection=scope.masterAgents[0].companyname,scope.magentId=scope.getMasterAgentId(scope.magentSelection)),scope.agents&&1==scope.agents.length&&(scope.agentSelection=scope.agents[0].companyname,scope.agentId=scope.agents[0].companyid),scope.agentUsers&&1==scope.agentUsers.length&&(scope.agentUserSelection=scope.agentUsers[0]),scope.validateSelection()){var userSelection={userType:scope.userTypes.usertype,channelType:scope.userTypeSelection,masterAgentId:scope.magentId?scope.magentId:"",masterAgent:scope.magentSelection?scope.magentSelection:"",agentId:scope.agentId?scope.agentId:"",agent:scope.agentSelection?scope.agentSelection:"",agentUserEmail:scope.agentUserSelection?scope.agentUserSelection.email:"",agentDisplayName:scope.agentUserSelection?scope.agentUserSelection.name:"",currency:1===scope.salesAreas.length&&"US"==scope.salesAreas[0].country||"US"==scope.salesAreas.country?"USD":"CAD",country:1===scope.salesAreas.length?scope.salesAreas[0].country:scope.salesAreas.country,entityId:1===scope.salesAreas.length?scope.salesAreas[0].legalEntity:scope.salesAreas.entityId};$rootScope.$broadcast("savedAgentRegion",userSelection),console.log("userSelection on save modal",userSelection),$(window).scrollTop(0),$.cookie("cmUsrSel",JSON.stringify(userSelection),{path:"/"}),scope.freeTrial=(field="isTrial",href=url||window.location.href,(string=new RegExp("[?&]"+field+"=([^&#]*)","i").exec(href))?string[1]:null),scope.freeTrial?scope.callBackCart():scope.callBackCartNaming(),scope.estimatedCart.cmUsrSel=userSelection,scope.callBackEstimate(),$(".commerce-modal-popup").removeClass("show")}},scope.validateSelection=function(){var success=!0;return null!=scope.agents&&"Please Select"==scope.agentSelection&&(angular.element(agentError).addClass("show"),success=!1),null!=scope.masterAgents&&"Please Select"==scope.magentSelection&&(angular.element(magentError).addClass("show"),success=!1),success},scope.isRegionVisible=function(){return!(0<!scope.salesAreas.length)&&("Please Select"!==scope.userTypeSelection&&("Direct"===scope.userTypeSelection||"Please Select"!==scope.magentSelection&&"Please Select"!==scope.agentSelection))}}}}),avayaBlog.directive("commerce",function(commerceService){return{restrict:"A",link:function(scope,element){var isMobile=browserWidth()<=768,uiViewList=$(".card-titles .ui-view .card"),uiViewContainer=$(".ui-view.ui-container"),settingsForm=$("form[name='settings']"),setupForm=(settingsForm.find("input[name='country']"),settingsForm.find("input[name='state']"),$("form[name='form']")),signUpForm=$("form[name='sign-up']"),downloadsForm=$("form[name='downloads']"),generateLinkButton=downloadsForm.find(".generate-link"),cardsWrap=(downloadsForm.find(".download-link"),$(".cards-wrap")),errorMessage=$(".error-message"),errorTerms=setupForm.find(".error-terms"),toaster=$(".server-status-message"),signInForm=$("form[name='sign-in']"),tabList=($(".sign-in-button"),{}),createPasswordCaps=$("#create-password"),capsonCreatePassword=$("#capson-create-password"),forgotPwdPopupStatus=getForgotPasswordPopup(),validationListSetup=[],regexList_email=/^(?!.*\.{2})[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,5}$/,regexList_name=/^[a-zA-Z][^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{1,50}$/,regexList_title=/^[a-zA-Z][^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=]{1,50}$/,regexList_address=/[^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{1,50}$/,regexList_phone=/^[^±!@£$%^&*_+§¡€¢§¶•ªº«\\/<>?:;|=.,]{4,20}$/,regexList_city=/^([a-zA-Z\u0080-\u024F]+(?:. |-| |'))*[a-zA-Z\u0080-\u024F]{1,30}$/,regexList_answer=/^[^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{3,30}$/,regexList_password=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d$@$!%*?&_]{8,15}$/,regexList_password2=/[^<>]{8,30}$/,getQueryString=function(field,url){var href=url||window.location.href,string=new RegExp("[?&]"+field+"=([^&#]*)","i").exec(href);return string?string[1]:null},usVer=getQueryString("_usver_"),hiddenPageName=signUpForm.find("input[name='pagename']"),hiddenUsver=signUpForm.find("input[name='_usver_']"),resendLink=$(".app-urls").find("#resend-link").text();uiViewList.each(function(){$(this).firstChild;tabList[$(this).parent().closest("li").attr("class")]||(tabList[$(this).parent().closest("li").attr("class")]=$(this).attr("id")),uiViewContainer.append($(this))}),createPasswordCaps.keyup(function(event){event.originalEvent.getModifierState("CapsLock")?capsonCreatePassword.css("display","inline-block"):capsonCreatePassword.css("display","none")});var requestedTab=getQueryString("view"),requestedView=tabList[requestedTab];function browserWidth(){return self.innerHeight?self.innerWidth:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientWidth:document.body?document.body.clientWidth:void 0}$(".avatar-login .account").remove(),scope.showLoader=function(){$(".page-level-loader").addClass("show-loader"),setTimeout(function(){scope.hideLoader()},1e4)},scope.hideLoader=function(status,message){status=status||!0,$(".page-level-loader").removeClass("show-loader"),toast(status,message)},scope.showView=function(){scope.showUiView=!0},scope.hideView=function(){cardsWrap.removeClass("breeze-height"),cardsWrap.removeClass("general-height"),scope.showUiView=!1},scope.tab=requestedTab||"settings",scope.subNav=requestedView||"general",isMobile&&scope.hideView(),console.log("Forgot Pasword Status",forgotPwdPopupStatus),1==forgotPwdPopupStatus&&($(window).scrollTop(0),$(".av-modal.breeze-modal").find(".forgot-password").css("display","block"),$(".commerce-modal-backdrop").addClass("fade"),$(".av-modal.breeze-modal").css("display","block")),scope.showTab=function(tabId,cardId,title){scope.tab=tabId,scope.showCard(cardId,title,!1),event.stopPropagation(),commerceService.clickTab(tabId)},scope.showCard=function(cardId,title,showView){"breeze"==cardId?cardsWrap.addClass("breeze-height"):cardsWrap.removeClass("breeze-height"),"general"==cardId?cardsWrap.addClass("general-height"):cardsWrap.removeClass("general-height"),scope.subNav=cardId,scope.cardTitle=title,isMobile&&0!=showView&&scope.showView(),event.stopPropagation()},scope.saveSettings=function(event){event.preventDefault(),event.stopPropagation(),validateSettingsForm(validationListSetup)&&(scope.showLoader(),$.ajax({url:settingsForm.attr("action"),type:settingsForm.attr("method"),data:settingsForm.serialize().replace(/\'/g,""),dataType:"JSON",success:function(result){1==result.status?setTimeout(function(){scope.hideLoader(!0,result.message),saveSettingsForm()},0):scope.hideLoader(!1,result.message)},error:function(result){scope.hideLoader(!1,getGenericErrorMessage())}}))},scope.resendEmail=function(event){scope.showLoader(),hiddenPageName.val(resendLink),hiddenUsver.val(usVer),$.ajax({url:signUpForm.attr("action"),type:signUpForm.attr("method"),data:signUpForm.serialize().replace(/\'/g,""),dataType:"JSON",success:function(result){scope.hideLoader(result.status,result.message)},error:function(result){scope.hideLoader(!1,getGenericErrorMessage())}})},scope.cancelSettings=function(event){event.preventDefault(),event.stopPropagation()};var toast=function(status,message){toaster.find("span").text(message),toaster.addClass("show"+(0==status?" error":"")),setTimeout(function(){toaster.removeClass("show error")},5e3)};generateLinkButton.on("click",function(event){event.stopPropagation()}),scope.finishAccountSetup=function(event){event.stopPropagation(),event.preventDefault(),validateForm(validationListSetup)&&(scope.showLoader(),$.ajax({url:setupForm.attr("action")+"?"+setupForm.serialize().replace(/\'/g,""),type:setupForm.attr("method"),dataType:"JSON",success:function(result){1==result.status?window.location.href=getSignInLink():setTimeout(function(){scope.hideLoader(!0,result.message)},0)},error:function(result){scope.hideLoader(!1,getGenericErrorMessage())}}))},$(window).bind("resize",function(){isMobile=browserWidth()<=768});var password=setupForm.find("[name='password']"),confirmPassword=setupForm.find("[name='confirmPassword']"),securityAnswer=setupForm.find("[name='securitya']"),securityQuestionDropdown=$(".dropdown-wrap.security-question"),securityQuestionHiddenField=setupForm.find("[name='securityQuestion']"),countryDropdown=$(".dropdown-wrap.country"),countryField=countryDropdown.find("input[ name='countryField' ]"),province=$("input[name='province']"),countryHiddenField=$("input[name='country']"),stateDropdown=$(".dropdown-wrap.state"),stateField=stateDropdown.find("input[ name='stateField' ]"),stateHiddenField=$("input[name='state']"),stateLabel=settingsForm.find(".state-label"),provinceLabel=settingsForm.find(".province-label"),formStatusCallback=function(status){1==status?getFormStatus(validationListSetup)&&errorMessage.removeClass("show"):errorMessage.addClass("show")},getFormStatus=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){if(validationItem.field.hasClass("error"))return formStatus=!1}),formStatus};scope.signIn=function(event){event.preventDefault(),event.stopPropagation(),validateSignInForm(validationListSetup)&&signInForm.submit()};var formData,validateForm=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){validationItem.field.prop("disabled")||0!=commerceService.validateField(validationItem)||(errorMessage.addClass("show"),formStatus=!1)}),0==setupForm.find("input[name='terms']")[0].checked&&(errorTerms.addClass("show"),formStatus=!1),password.val()!=confirmPassword.val()&&(confirmPassword.addClass("error"),error.addClass("show"),formStatus=!1),formStatus},validateSettingsForm=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){validationItem.field.prop("disabled")||0!=commerceService.validateField(validationItem)||(errorMessage.addClass("show"),formStatus=!1)}),formStatus},validateSignInForm=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){commerceService.validateField(validationItem,formStatusCallback)||(errorMessage.addClass("show"),formStatus=!1)}),0==signInForm.find("input[name='terms']")[0].checked&&(signInForm.find(".error-terms").addClass("show"),formStatus=!1),formStatus},addValidation=function(field,regex,type,required,callback){if(0!=field.length&&!field.attr("readonly"))if("checkbox"==type)field.change(function(){0==$(this)[0].checked?errorTerms.addClass("show"):errorTerms.removeClass("show")});else{var validationItem={field:field,regEx:regex,type:type,required:required};validationListSetup.push(validationItem),field.on("keyup",function(){formStatusCallback(commerceService.validateField(validationItem,callback))})}};if(0<setupForm.length){var company=setupForm.find("[name='company']");addValidation(company,regexList_name),company.focus(),addValidation(setupForm.find("[name='title']"),regexList_title),addValidation(password,regexList_password),addValidation(securityAnswer,regexList_answer),addValidation(setupForm.find("input[name='terms']"),null,"checkbox"),addValidation(securityQuestionDropdown,null,"select"),addValidation(countryDropdown,null,"select"),password.on("keyup",function(){password.val()&&0<password.val().length&&(confirmPassword.removeAttr("disabled"),confirmPassword.addClass("error"),confirmPassword.on("keyup",function(){confirmPassword.prop("disabled")||(0==confirmPassword.val().length?confirmPassword.addClass("error"):confirmPassword.val()==password.val()?confirmPassword.removeClass("error"):confirmPassword.addClass("error"))}))}),$(securityQuestionDropdown).find("li").on("click",function(){securityQuestionDropdown.removeClass("error"),securityAnswer.removeAttr("disabled");var secuirtyAnswerEncoded=$(this).text().replace("'","&39;");securityQuestionHiddenField.val(secuirtyAnswerEncoded)}),$(countryDropdown).find("li").on("click",function(){countryDropdown.removeClass("error"),countryHiddenField.val($(this).find("a").attr("data-value")||$(this).text())})}if(0<settingsForm.length&&(addValidation(settingsForm.find("[name='fname']"),regexList_name,null,!1),addValidation(settingsForm.find("[name='lname']"),regexList_name,null,!1),addValidation(settingsForm.find("[name='company']"),regexList_name,null,!1),addValidation(settingsForm.find("[name='title']"),regexList_title,null,!1),addValidation(settingsForm.find("[name='phone']"),regexList_phone,null,!1),addValidation(settingsForm.find("[name='province']"),regexList_city,null,!1),addValidation(settingsForm.find("[name='address1']"),regexList_address,null,!1),addValidation(settingsForm.find("[name='address2']"),regexList_address,null,!1),addValidation(settingsForm.find("[name='city']"),regexList_city,null,!1),addValidation(settingsForm.find("[name='zipCode']"),regexList_phone,null,!1),$(stateDropdown).find("li").on("click",function(){stateDropdown.removeClass("error"),stateHiddenField.val($(this).find("a").attr("data-value")||$(this).text())}),countryHiddenField.val()&&"us"==countryHiddenField.val().toLowerCase()?(stateDropdown.removeClass("hidden"),province.addClass("hidden"),stateLabel.removeClass("hidden"),provinceLabel.addClass("hidden")):(stateDropdown.addClass("hidden"),province.removeClass("hidden"),stateLabel.addClass("hidden"),provinceLabel.removeClass("hidden")),$(countryDropdown).find("li").on("click",function(){countryDropdown.removeClass("error");var selectedValue=$(this).find("a").attr("data-value")||$(this).text();countryHiddenField.val(selectedValue),"us"==selectedValue.toLowerCase()?(stateDropdown.removeClass("hidden"),province.removeClass("error"),province.addClass("hidden"),stateLabel.removeClass("hidden"),provinceLabel.addClass("hidden")):(stateDropdown.addClass("hidden"),province.removeClass("hidden"),stateLabel.addClass("hidden"),provinceLabel.removeClass("hidden"))})),0<signInForm.length){var username=signInForm.find("[name='email']");errorTerms=signInForm.find(".error-terms"),username.focus();password=signInForm.find("[name='PASSWORD']");addValidation(username,regexList_email),addValidation(password,regexList_password2),addValidation(signInForm.find("input[name='terms']"),null,"checkbox")}function saveSettingsForm(){formData=settingsForm.serialize(),countryFieldValue=countryField.val(),stateFieldValue=stateField.val()}saveSettingsForm(),scope.cancelSettings=function($event){event.stopPropagation(),event.preventDefault();var settingsFormData=function(data){for(var temp,objs=[],temps=data.split("&"),i=0;i<temps.length;i++)temp=temps[i].split("="),objs.push(temp[0]),objs[temp[0]]=temp[1];return objs}(formData);countryHiddenField.val(settingsFormData[countryHiddenField.attr("name")]),stateHiddenField.val(settingsFormData[stateHiddenField.attr("name")]),countryField.val(countryFieldValue),stateField.val(stateFieldValue),_.each(validationListSetup,function(validationItem){validationItem.field.hasClass("read-only")||validationItem.field.val(settingsFormData[validationItem.field.attr("name")])})},$(".downloads-table a").on("click",function(){var filePath=$(this).attr("data-filepath");commerceService.downloadLink(filePath)})}}}),avayaBlog.directive("commerceDropdown",function(){return{restrict:"A",link:function(scope,element){var control=element.find(".dropdown-display"),displayValue=control.find(".value"),list=element.find(".dropdown-list"),listItems=list.find("li");control.on("click",function(){list.hasClass("expanded")?list.removeClass("expanded"):list.addClass("expanded")}),list.find("li").on("click",function(){displayValue.val($(this).text()),displayValue.removeClass("not-selected"),list.removeClass("expanded")}),scope.selectItem=function(item){displayValue.val(item),displayValue.removeClass("not-selected"),list.removeClass("expanded")},list.find("li").on("mouseover",function(event){$(this).addClass("hover")}),list.find("li").on("mouseout",function(){$(this).removeClass("hover")});var keyword="",startTime=0;displayValue.on("keydown",function(event){if(63<event.which&&event.which<91){if(0==Number(startTime))startTime=(new Date).getTime(),keyword+=String.fromCharCode(event.which).toLowerCase();else{var newKeyTime=(new Date).getTime()-Number(startTime);console.log(newKeyTime),Number(newKeyTime)<1e3?(startTime=(new Date).getTime(),keyword+=String.fromCharCode(event.which).toLowerCase()):(startTime=0,keyword=String.fromCharCode(event.which).toLowerCase())}_.each(listItems,function(listItem){$(listItem).text().toLowerCase().startsWith(keyword)&&(listItems.removeClass("hover"),$(listItem).addClass("hover"),list.find("ul")[0].scrollTop=$(listItem)[0].offsetTop-10)})}if(13==event.which){if(!list.hasClass("expanded"))return;var selectedItem=list.find("li.hover");0<selectedItem.length&&(displayValue.val(selectedItem.text()),selectedItem.removeClass("hover"),displayValue.removeClass("not-selected"),list.removeClass("expanded"),selectedItem.click())}event.stopPropagation(),event.preventDefault()});$(document).on("click",function(event){var className=event.target.className.split(" ")[0];"dropdown-display"!=className&&"dropdown-list"!=className&&"value"!=className&&"fa"!=className?list.removeClass("expanded"):$(element).has($(event.target)).length||list.removeClass("expanded")})}}}),avayaBlog.directive("commerceModal",function(commerceService){return{restrict:"A",link:function(scope,element){var commerceModal=$(".commerce-modal"),closeButton=commerceModal.find(".close"),backdrop=(commerceModal.find(".modal-header h4"),$(".commerce-modal-backdrop")),signUp=commerceModal.find(".sign-up"),signUpButton=commerceModal.find(".sign-up .button"),confirmEmail=commerceModal.find(".confirm-email"),cancelEmailButton=(commerceModal.find(".confirm-email .confirm"),commerceModal.find(".confirm-email .cancel")),emailSent=commerceModal.find(".email-sent"),signUpForm=(commerceModal.find(".resend-email"),commerceModal.find("form[name='sign-up']")),errorMessage=signUpForm.find(".error-message"),errorTerms=signUpForm.find(".error-terms"),serverStatus=signUpForm.find(".error-server"),email=signUpForm.find("[name='emailid']"),appUrls=$(".app-urls"),resendLink=appUrls.find("#resend-link").text(),signupLink=appUrls.find("#signup-link").text(),hiddenPageName=signUpForm.find("input[name='pagename']"),validationList=(signUpForm.find("input[name='_usver_']"),[]),regexList_email=/^(?!.*\.{2})[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,5}$/,regexList_name=/^([a-z0-9A-Z_ %!,:&\-\'\.*+\[\]\{\}\(\)@#]+){2,30}$/;closeButton.on("click",function(){closeModal()}),$(window).bind("keyup",function(e){27==e.keyCode&&closeModal()});function closeModal(){commerceModal.addClass("hide"),commerceModal.addClass("fade"),backdrop.removeClass("fade"),signUp.addClass("show"),confirmEmail.removeClass("show"),emailSent.removeClass("show")}backdrop.bind("click",function(e){closeModal()}),element.on("click",function(){commerceModal.removeClass("hide"),commerceModal.removeClass("fade"),backdrop.addClass("fade")}),signUpButton.on("click",function(event){event.preventDefault(),event.stopPropagation(),validateForm()&&(hiddenPageName.val(signupLink),errorMessage.removeClass("show"),errorTerms.removeClass("show"),scope.showLoader(),commerceService.signUp(),$.ajax({url:signUpForm.attr("action")+"?"+signUpForm.serialize().replace(/\'/g,""),type:signUpForm.attr("method"),dataType:"JSON",success:function(result){var userEmail=signUpForm.find("input[name='emailid']").val();1==result.status?(emailSent.addClass("show"),setTimeout(function(){commerceModal.find(".sent-email").text(userEmail),signUp.removeClass("show"),emailSent.addClass("show"),$(".user-email").text(userEmail+"."),scope.hideLoader()},0),commerceService.signUpComplete()):(scope.hideLoader(),"resend"==result.action?(emailSent.addClass("show"),commerceModal.find(".sent-email").text(userEmail),signUp.removeClass("show"),emailSent.addClass("show"),$(".user-email").text(userEmail+".")):showServerStatus(result.message))},error:function(result){scope.hideLoader(),showServerStatus(getGenericErrorMessage())}}))});var showServerStatus=function(message){serverStatus.find("span").text(message),serverStatus.addClass("show"),setTimeout(function(){serverStatus.removeClass("show")},7e3)};scope.resendEmail=function(){scope.showLoader(),hiddenPageName.val(resendLink),$.ajax({url:signUpForm.attr("action")+"?"+signUpForm.serialize().replace(/\'/g,""),type:signUpForm.attr("method"),dataType:"JSON",success:function(result){scope.hideLoader(),showServerStatus(result.message)},error:function(result){scope.hideLoader(),showServerStatus(getGenericErrorMessage())}})};cancelEmailButton.on("click",function(){confirmEmail.removeClass("show"),signUp.addClass("show")}),scope.showLoader=function(){$(".page-level-loader").addClass("show-loader")},scope.hideLoader=function(){$(".page-level-loader").removeClass("show-loader")};var formStatusCallback=function(status){1==status?getFormStatus(validationList)&&errorMessage.removeClass("show"):errorMessage.addClass("show")},validateField=function(validationItem,callback){return validationItem.field.val().match(validationItem.regEx)?(validationItem.field.removeClass("error"),!0):(validationItem.field.hasClass("error")||validationItem.field.addClass("error"),!1)},getFormStatus=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){if(validationItem.field.hasClass("error"))return formStatus=!1}),formStatus},validateForm=function(){var formStatus=!0;return _.each(validationList,function(validationItem){validateField(validationItem)||(errorMessage.addClass("show"),formStatus=!1)}),0==signUpForm.find("input[name='terms']")[0].checked&&(errorTerms.addClass("show"),formStatus=!1),"avaya.com"==email.val().substring(email.val().indexOf("@")+1).toLowerCase()?(errorMessage.addClass("show"),formStatus=!1,email.addClass("error")):email.removeClass("error"),formStatus},addValidation=function(field,regex,type,callback){if("checkbox"==type)field.change(function(){0==$(this)[0].checked?errorTerms.addClass("show"):errorTerms.removeClass("show")});else{var validationItem={field:field,regEx:regex,type:type};validationList.push(validationItem),field.on("keyup",function(){formStatusCallback(validateField(validationItem))})}};if(0<signUpForm.length){var firstName=signUpForm.find("[name='fname']"),lastName=signUpForm.find("[name='lname']"),terms=signUpForm.find("[name='terms']");addValidation(email,regexList_email),addValidation(firstName,regexList_name),addValidation(lastName,regexList_name),addValidation(terms,null,"checkbox")}}}}),avayaBlog.directive("breezeCommerce",function(cartService){return{restrict:"A",controller:function($scope,$element,$attrs){var errorModal=$(".error-modal"),errorModalMessage=errorModal.find(".message");$scope.showLoader=function(timeout){$(".page-level-loader").addClass("show-loader")},$scope.hideLoader=function(status,message,showModal){if(1==showModal)return errorModalMessage.text(message),void errorModal.addClass("show-modal");status=status||!0,$(".page-level-loader").removeClass("show-loader")},errorModal.find("button").on("click",function(){$(".page-level-loader").removeClass("show-loader"),errorModal.removeClass("show-modal")}),this.eventHandlers={fileUploadedHandlers:[]},this.onFileUpload=function(callback){this.eventHandlers.fileUploadedHandlers.push(callback)},this.fileUploadedCallbacks=function(){this.eventHandlers.fileUploadedHandlers.forEach(function(handler){handler()})},$scope.reviewCart=function(){window.location.href=getCartLink()},$scope.continueShopping=function(){window.location.href=getStoreLandingLink()},$scope.checkout=function(){window.location.href=getCheckoutLink()},$scope.formatCurrency=function(value){return cartService.formatCurrency(value)}}}}),avayaBlog.directive("companyDomain",function(soldToService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/company-domain.html",link:function(scope,element){scope.domain={},scope.domain.type="addnew",scope.enableDomainBtn=!1,scope.companyDomainRegex=/^(?!.*\.{2})[A-Za-z0-9._%+-]+\.[a-z]{2,3}$/,scope.closeCompanyDomainModal=function(){scope.closeModal(),scope.clearDomainData()},scope.clearDomainData=function(){scope.domain={},scope.domain.type="select",scope.newSelectedDomain={},scope.showPopupStatusMsg(!1,"","")},scope.selectedDomainNameFunc=function(){var value;value="select"==scope.domain.type?scope.selectedDomain:scope.newSelectedDomain,scope.setSelectedDomain(value),scope.closeCompanyDomainModal()},scope.validateDomainName=function(){scope.showErrorMessage=!1,angular.forEach(scope.companyDomainList,function(item){if(item.domain==scope.newSelectedDomain.domain)return scope.showErrorMessage=!0,scope.showPopupStatusMsg(!0,"failed","The domain name already exists in your list."),!1}),scope.showErrorMessage||(scope.showLoader(),scope.enableDomainBtn=!1,soldToService.validateCompanyDomain(scope.newSelectedDomain.domain).then(function(response){response.success?(scope.showPopupStatusMsg(!0,"success",response.success),scope.enableDomainBtn=!0,scope.hideLoader()):response.error&&(scope.showPopupStatusMsg(!0,"failed",response.error.message),scope.enableDomainBtn=!1,scope.hideLoader())}))},scope.showPopupStatusMsg=function(showPopup,status,statusMsg){scope.showDomainPopupMsg=showPopup,scope.showDomainStatus=status,scope.showDomainMsg=statusMsg,$(".popupStatus").css("display","flex")},scope.keyPressHandler=function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation())}}}}),avayaBlog.directive("comparePassword",function(){return{require:"ngModel",scope:{confirmPassword:"=comparePassword"},link:function(scope,element,attributes,modelVal){modelVal.$validators.comparePassword=function(val){return val==scope.confirmPassword},scope.$watch("confirmPassword",function(){modelVal.$validate()})}}}),avayaBlog.directive("contractSelector",function(cartService){return{restrict:"A",replace:!0,templateUrl:"/static/avaya/commerce-views/contract-selector.html",link:function(scope,element,attrs){scope.termSelected=scope.cart.term,scope.selectContract=function(term){scope.termSelected=term,scope.cart.term=scope.termSelected,scope.showLoader(),cartService.updateContract(scope.cart.solutionId,term)}}}}),avayaBlog.directive("contractTerms",function(estimatorService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/contract-terms.html",link:function(scope,element,attrs){scope.selectContract=function(contract){scope.selectedContract=contract,scope.selectedBundle.price=contract.price,scope.selectedBundle.term=contract.term,scope.selectedBundle.billingCycle=contract.billingCycle,estimatorService.addBundle(scope.selectedBundle)},scope.discountLookup={1:"0",2:"17",3:"33",4:"37",5:"40"}}}}),avayaBlog.filter("convertToMonth",function(){return function(number){return 12*number}}),avayaBlog.directive("countdownClock",function($interval,$sce){return{scope:{startDate:"@",startMessage:"@",endMessage:"@",startUrl:"@",endUrl:"@",endDate:"@",hideDate:"@",hideAnnouncement:"@"},templateUrl:"/static/avaya/commerce-views/countdown-clock.html",link:function($scope,element,attrs,ctrl){setTimeout(function(){$scope.showClock=!0},1e3),$scope.timezoneOffsetHours=0;var offset,clientDate,utc,endDate=new Date($scope.endDate),startDate=new Date($scope.startDate),hideDate=new Date($scope.hideDate),hideAnnouncement=new Date($scope.hideAnnouncement),estTime=(offset=$scope.timezoneOffsetHours,clientDate=new Date,utc=clientDate.getTime()+6e4*clientDate.getTimezoneOffset(),new Date(utc+36e5*offset)),currentDate=new Date;$scope.startMessageSanitized=$sce.trustAsHtml($scope.startMessage),$scope.endMessageSanitized=$sce.trustAsHtml($scope.endMessage);var difference=(estTime.getTime()-currentDate.getTime())/1e3;$scope.hideClock=!0;var stopClock=$interval(function(){var currentDate,currentEst=((currentDate=new Date).setSeconds(currentDate.getSeconds()+difference),currentDate);endDate<=currentEst&&($scope.days="0",$scope.hours="00",$scope.minutes="00",$scope.seconds="00",$scope.hideDays=!0,$scope.countdownEnded=!0),startDate<currentEst&&($scope.hideClock=!1,diff=(endDate.getTime()-currentEst.getTime())/1e3,hideDate<=currentEst&&($scope.hideTimer=!0),hideAnnouncement<=currentEst&&($scope.hideClock=!0,$interval.cancel(stopClock)),endDate<=currentEst?($scope.seconds="00",$scope.countdownEnded=!0):function(difference){$scope.hideDays=172800<=difference?($scope.hideSeconds=!0,!1):($scope.hideSeconds=!1,!0);$scope.days=Math.floor(difference/86400);var offset=0;0==$scope.hideDays?difference-=86400*$scope.days:offset=24*$scope.days;$scope.hours=Math.floor(difference/3600)%24+Number(offset),difference-=3600*$scope.hours,$scope.minutes=addLeadingZero(Math.floor(difference/60)%60),difference-=60*$scope.minutes,$scope.seconds=addLeadingZero(Math.ceil(difference%60))}(diff))},1e3);function addLeadingZero(number){return number<10?"0"+number:number}}}}),avayaBlog.directive("cpaasCalculator",function(cpaasService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/cpaas-calculator.html",link:function(scope,element,attr){var calculator=element.find(".config-calculator-form"),calculatorItems=calculator.find(".horizontal-form"),cpaasCatalog=cpaasService.getCatalog(),estimate=calculator.find(".estimated-total input"),suggestedRefillLabel=calculator.find(".suggested-cpaas label"),estimatedTotal=0,suggestedRefill=0;"dashboard"==attr.view&&(element.find(".example-scenarios").hide(),element.find(".fa-close").hide()),suggestedRefillLabel.text("$"+suggestedRefill),estimate.val(estimatedTotal.toFixed(2));var priceList;scope.addCustomCredit=function(){0<scope.suggestedRefill&&(cpaasService.addCredit(scope.suggestedRefill),scope.closeModal())},priceList=cpaasCatalog.priceList.map(function(item,i){return'<div class="form-row"><div class="field-group">\t<div class="input-div">\t\t<input placeholder="0" type="text" data-price="'+item.price+'">\t</div>\t<label>'+item.description+"($"+item.price+")</label></div></div>"}),calculatorItems.prepend(priceList),calculatorItems.find("input").each(function(){$(this).on("keyup",function(event){var previousValue=$(this).attr("data-previous-val")||0,price=Number($(this).attr("data-price"));estimatedTotal-=(Number(previousValue)*price).toFixed(2),$(this).attr("data-previous-val",$(this).val()||0),estimatedTotal=(estimatedTotal+=Number($(this).val()||0)*price)<=0?0:estimatedTotal,estimate.val(estimatedTotal.toFixed(2)),suggestedRefill=((0<estimatedTotal%50?estimatedTotal+50:estimatedTotal)-estimatedTotal%50).toFixed(2),scope.suggestedRefill=suggestedRefill,suggestedRefillLabel.text("$"+suggestedRefill),event.stopPropagation()})})}}}),avayaBlog.directive("cpaasCredit",function(estimatorService,cpaasService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/data-minutes.html",link:function(scope,element,attrs){scope.dashboardView="dashboard"==attrs.view,scope.addCredit=function(item){scope.addedCredit=item,estimatorService.addItem(scope.cpaasSkuDetails.itemId,item.itemName,item.price,1,null,scope.cpaasSkuDetails.billingCycle,scope.cpaasSkuDetails.term,!1,"cpaas")};cpaasService.getSkuDetails().then(function(response){scope.cpaasSkuDetails=response.data.avaPriceDetail[0]},function(error){console.log("error fetching cpaas sku details")}),cpaasService.register(function(){var refillAdded=cpaasService.getCredit();scope.cpaasData.customCredit.price=refillAdded,scope.addedCredit=null,estimatorService.addItem(scope.cpaasData.customCredit.itemId,scope.cpaasData.customCredit.itemName,scope.cpaasData.customCredit.price,1,!1)}),scope.min=25,scope.max=1e4,scope.customCreditInput;var numberRegex=/^[0-9]*$/;scope.valid=!1,scope.validateInput=function(){scope.customCreditInput>=scope.min&&scope.customCreditInput<=scope.max?scope.valid=!0:scope.valid=!1},scope.validateChar=function(event){numberRegex.test(String.fromCharCode(event.which))||event.preventDefault()}}}}),avayaBlog.directive("cpaasSetup",function(labService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/cpaas-setup.html",link:function(scope,element,attrs){scope.wizardId=0,scope.popupSrc="",scope.regions=labService.getAwsRegionCodes();var accountNumber=$(element).find("#awsAccountNumber"),region=$(element).find("#regionField"),sshKey=$(element).find("#sshKey"),regionContainer=$(element).find(".dropdown-wrap"),errorMessage=$(element).find(".error-message");scope.nextView=function(){if(1!=scope.wizardId||0!=validateAccountInfo())if(errorMessage.removeClass("show"),5!=scope.wizardId){if(6==scope.wizardId)return scope.cpaasSetupCompleted(),void(scope.wizardId=1);scope.wizardId+=1,scope.gotoElement("wizard-top")}else{scope.showLoader(0);var setupData={aws_account:scope.awsAccountNumber,aws_region:scope.awsRegion,ssh_key:scope.sshKey,quoteId:scope.quoteId};labService.activateLab(setupData).then(function(response){if(response.data.error&&0<response.data.error.length)return alert("Error: Unable to activate lab."),void scope.hideLoader();if(scope.wizardId+=1,scope.hideLoader(),scope.awsAccountNumber="",scope.awsRegion="",scope.sshKey="",scope.roleCreated=!1,response.data.lab_status){var indexOfColon=response.data.lab_status.indexOf(":");scope.labActivationStatus=-1<indexOfColon?response.data.lab_status.substring(0,response.data.lab_status.indexOf(":"))+".":response.data.lab_status}scope.hideLoader(),labService.notifyLabActivate()},function(error){alert("Error: Unable to activate lab."),scope.hideLoader()})}else errorMessage.addClass("show")};var validateAccountInfo=function(){var status=!0;scope.awsAccountNumber?scope.awsAccountNumber.match(/^[0-9]{12}$/)?accountNumber.removeClass("error"):(accountNumber.addClass("error"),status=!1):(accountNumber.addClass("error"),status=!1);if(region.hasClass("not-selected")?(regionContainer.addClass("error"),status=!1):regionContainer.removeClass("error"),sshKey.val()&&0<sshKey.length){sshKey.val(sshKey.val().trim());var sshKeySections=sshKey.val().split(" ");2!=sshKeySections.length||"ssh-rsa"!=sshKeySections[0]&&"ecdsa-sha2-nistp256"!=sshKeySections[0]&&"ssh-ed25519"!=sshKeySections[0]?(sshKey.addClass("error"),status=!1):sshKey.removeClass("error")}else sshKey.removeClass("error");return status};scope.previousView=function(){scope.wizardId-=1,scope.gotoElement("wizard-top")},scope.showPopup=function($event){scope.popupSrc="";var elem=$event.currentTarget||$event.srcElement;scope.popupSrc=elem.src,$(".wizard-popup").addClass("show")},scope.closePopup=function($event){$(".wizard-popup").removeClass("show"),scope.popupSrc=""},$(element).find(".dropdown-list").on("click",function(event){if($(event.target).is("a")){var regionname=$(event.target).text(),region=_.find(scope.regions,function(region){return regionname==region.description});scope.awsRegion=region.id}}),scope.goToView=function(wizardId){scope.wizardId=wizardId},scope.startWizard=function(){scope.wizardId+=1};scope.returnToDashboard=function(){labService.notifyLabNameChange(),scope.back()},scope.deleteLab=function(){scope.showLoader(0),labService.deleteLab(scope.quoteId).then(function(response){if(!response.data.errorMsg)return alert("Lab deleted successfully."),void scope.returnToDashboard();alert("Error: There was a problem processing your request."),scope.hideLoader()},function(error){alert("Error: There was a problem processing your request."),scope.hideLoader()})}}}}),avayaBlog.directive("dashboardAccount",function(midmarketDashboardService,serviceBase){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/dashboard-account.html",replace:!0,link:function(scope,element){scope.phoneStatus=!0,scope.pwordStatus=!0,scope.cpwordStatus=!0,scope.showMessage=!1,scope.infoMessage="",scope.pwordRegex=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d$@$!%*?&_]{8,14}$/,scope.securityAnswer=/^[^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{3,30}$/,scope.enableAnswer=!1;var oldPasswordCaps=$("#old-password"),newPasswordCaps=$("#new-password"),confirmPasswordCaps=$("#confirm-password"),capsonOldPassword=$("#capson-old-password"),capsonNewPassword=$("#capson-new-password"),capsonConfirmPassword=$("#capson-confirm-password");oldPasswordCaps.keyup(function(event){event.originalEvent.getModifierState("CapsLock")?capsonOldPassword.css("display","inline-block"):capsonOldPassword.css("display","none")}),newPasswordCaps.keyup(function(event){event.originalEvent.getModifierState("CapsLock")?capsonNewPassword.css("display","inline-block"):capsonNewPassword.css("display","none")}),confirmPasswordCaps.keyup(function(event){event.originalEvent.getModifierState("CapsLock")?capsonConfirmPassword.css("display","inline-block"):capsonConfirmPassword.css("display","none")}),scope.getMyProfileInfo=function(){midmarketDashboardService.getAccountDetails().then(function(response){scope.accountDetails=response.data},function(error){console.log("error fetchng account details")})},scope.getMyProfileInfo(),scope.updateSettings=function(){var payload={Work_Phone:scope.accountDetails.Work_Phone,Security_Question:scope.ssosecurityques,Security_Answer:scope.ssosecuritya};scope.showLoader();var url=updateUser();serviceBase.postData(url,payload).then(function(response){"success"==response.data.Status?($(window).scrollTop(0),scope.getMyProfileInfo(),scope.ssosecuritya="",scope.ssosecurityques=null,scope.reset(scope.dashboardSecurityForm),scope.enableAnswer=!1,scope.showPopupStatusMsg(!0,response.data.Status,response.data.StatusMsg),scope.hideLoader()):"failed"==response.data.Status&&($(window).scrollTop(0),scope.getMyProfileInfo(),scope.showPopupStatusMsg(!0,response.data.Status,response.data.StatusMsg),$(window).scrollTop(0),scope.hideLoader())},function(error){scope.showPopupStatusMsg(!0,response.data.Status,response.data.StatusMsg),scope.hideLoader()})},scope.enableSecurityAnswer=function(){scope.enableAnswer=!0},scope.updatePassword=function(){var payload={OldPassword:scope.passwordDetails.oldpassword,NewPassword:scope.passwordDetails.password};scope.showLoader();var url=updatePassword();serviceBase.postData(url,payload).then(function(response){"success"==response.data.Status?(scope.showPopupStatusMsg(!0,response.data.Status,response.data.StatusMsg),scope.hideLoader()):"failed"==response.data.Status&&(scope.showPopupStatusMsg(!0,response.data.Status,response.data.StatusMsg),scope.hideLoader())},function(error){scope.showPopupStatusMsg(!0,response.data.Status,response.data.StatusMsg),scope.hideLoader()})},scope.reset=function(form){form.$setPristine(),form.$setUntouched()}}}}),avayaBlog.directive("dashboardSubscription",function(midmarketDashboardService,commerceProductService,$q,serviceBase){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/dashboard-subscriptions.html",replace:!0,controller:function($scope){$scope.ucItemId=getUcItemId(),$scope.ccItemId=getCcItemId(),$scope.spacesItemId=getSpacesItemId(),$scope.subscriptionsDetails=[],$scope.cancelledsubscription={},$scope.OpenCloseText="",$scope.isCcItem=!1,$scope.subscription={},$scope.statusMsg="",$scope.subscriptions={currentPage:1,offset:0,pageLimit:"5",filter:""},$scope.getSubscriptionsDetails=function(){$scope.showLoader(),midmarketDashboardService.getSubscriptions().then(function(response){$scope.subscriptionsDetails=response.data,$scope.hideLoader()},function(error){$scope.hideLoader(),console.log("error fetching subscription details")})},$scope.getUserType=function(){midmarketDashboardService.getusertype().then(function(response){$scope.userTypeInfo=response},function(error){console.log("error fetching  doc",error)})},$scope.getUserType(),$scope.openClosePanels=function(data,subscrip){angular.forEach(subscrip,function(item){1==item.expanded&&item!=data&&(item.expanded=!1)}),data.expanded?data.expanded=!0:data.expanded=!1},$scope.manage=function(url){window.open(url,"_blank")},$scope.configure=function(ratePlans,subscriptionId,entityId,subscriptionType,trial){var skuKey="";ratePlans.forEach(function(rplan){rplan.skuKey!=$scope.ucItemId&&rplan.skuKey!=$scope.ccItemId&&"2074"!=rplan.skuKey&&rplan.skuKey!=$scope.spacesItemId||(skuKey=rplan.skuKey)});var qryParam="?"+(skuKey?"skuId="+skuKey+"&":"")+(subscriptionId?"subscriptionId="+subscriptionId+"&":"")+(entityId?"entityId="+entityId+"&":"")+(subscriptionType?"subscriptionType="+subscriptionType+"&":"")+(trial?"trial="+trial:"");window.location.href=getBundleConfiguratorLink()+qryParam},$scope.cancelledSubscription=function(subscription){"true"==$scope.userTypeInfo.isSuperUser||"Customer"==$scope.userTypeInfo.usertype&&"1"==subscription.trial?($(window).scrollTop(0),$scope.showSubscriptionCancelErrorMsg=!0,$scope.alertMsg="Cancelling a subscription can take up to 24 hours to process. Please confirm that you would like to cancel this subscription."):($scope.showPopupCustomerMsg=!0,$scope.alertMsg="Please contact Customer Success @ cloudsuccess@avaya.com and provide them with your subscription number and reason for cancellation")},$scope.freeTrial=function(subscription){$scope.validateFreeTrial(subscription),"1"==subscription.trial&&($(window).scrollTop(0),$scope.showFreeTrialCancelErrorMsg=!0,$scope.alertMsg="Avaya will commence billing on submission of this order. Would you like to continue?")},$scope.cancelSubscription=function(subscriptionId,entityId){$scope.showLoader(),midmarketDashboardService.cancelSubscription(subscriptionId,entityId).then(function(response){"success"==response.status&&($scope.showSubscriptionCancelErrorMsg=!1),"failure"==response.status&&($scope.statusMsg=response.statusMsg,$scope.showPopupCancelMsg=!0,$scope.alertMsg="We couldn't process the request at this time.Please contact Helpform through Account Dashboard"),$scope.hideLoader()},function(error){$scope.hideLoader(),console.log("error cancelling subscription")})},$scope.closeCustomerModal=function(){$scope.showPopupCustomerMsg=!1},$scope.closeCancelledModal=function(){$scope.showSubscriptionCancelErrorMsg=!1,$scope.showPopupCancelMsg=!1,$scope.showFreeTrialCancelErrorMsg=!1,$scope.closeModal()},$scope.getSubscriptionInfo=function(subscription){$scope.showTDLoader=!0,$scope.subscription=subscription,$scope.subscriptionInfo=[],midmarketDashboardService.getSubscriptionInfoData(subscription).then(function(response){var subInfo=response.data;angular.forEach(subInfo[0].ratePlans,function(s,index){s.productSku=s.productSku.replace("S-","SKU-")},log),$scope.subscriptionInfo=subInfo[0],$scope.isCcItem=!1,$scope.subscriptionInfo.ratePlans.forEach(function(rplan){rplan.skuKey!=$scope.ccItemId&&"2046"!=rplan.skuKey||($scope.isCcItem=!0)}),$scope.showTDLoader=!1})},$scope.closeCancelModal=function(){$scope.showSubscriptionCancelErrorMsg=!1,$scope.showFreeTrialCancelErrorMsg=!1},$scope.validateFreeTrial=function(subscription){if(subscription.expirationDate){var today=new Date,endDate=new Date(subscription.expirationDate),timeDiff=Math.abs(endDate.getTime()-today.getTime());$scope.diffDays=Math.ceil(timeDiff/864e5)}},$scope.validateRenewal=function(subscription){if(subscription.termEndDate){var today=new Date;today.setHours(0,0,0,0);var endDate=new Date(subscription.termEndDate);if(endDate.setDate(endDate.getDate()-90),endDate.setHours(0,0,0,0),endDate<today)return!0}return!1}}}}),avayaBlog.directive("dashboardTabs",function($q,dashboardService,cartService,labService,midmarketDashboardService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/dashboard-tabs.html",controller:function($scope,$element,$attrs){var viewHash=window.location.hash;viewHash="account",midmarketDashboardService.getusertype().then(function(response){$scope.userInfoTab=response,$scope.userInfoTab&&"Avaya-Sales"==$scope.userInfoTab.usertype&&(viewHash="billing",$scope.routeController={tabId:viewHash,parentViewId:viewHash,childViewId:viewHash})},function(error){console.log("error fetching  doc",error)}),$scope.routeController={tabId:viewHash,parentViewId:viewHash,childViewId:viewHash},$scope.selectTab=function(tabId){if("subscriptions"==tabId&&$scope.getSubscriptionsDetails(),"help"==tabId&&0==$scope.ishelp){var url=getHelpLink();window.open(url,"_blank")}$scope.routeController.tabId=tabId,$scope.routeController.childViewId=tabId},$scope.selectChildView=function(childViewId){$scope.routeController.parentViewId=$scope.routeController.childViewId,"myAgentUsers"==($scope.routeController.childViewId=childViewId)&&midmarketDashboardService.getagentusersdata().then(function(response){$scope.myAgentUserInfo=response},function(error){}),"myprofile"==childViewId&&midmarketDashboardService.getAccountDetails().then(function(response){$scope.accountDetails=response.data},function(error){}),"myagents"==childViewId&&midmarketDashboardService.getagentdata().then(function(response){$scope.myAgentInfo=response},function(error){console.log("error fetching  doc",error)}),"myCustomers"==childViewId&&midmarketDashboardService.getmycustomerdata().then(function(response){$scope.myCustomerInfo=response},function(error){console.log("error fetching  doc",error)})},$scope.back=function(){$scope.routeController.childViewId=$scope.routeController.parentViewId,$scope.showToggleConfirmation=!1,$scope.showDestroyConfirmation=!1},$scope.routeController.tabId=viewHash,$scope.routeController.childViewId=viewHash}}}),avayaBlog.directive("dashboard",function(dashboardService,commerceProductService,cartService,cpaasService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/dashboard.html",controller:function($scope,$element){var errorMessage=$(".warning"),activationError=$(".activation-error"),validateField=function(validationItem){return 0!=validationItem.required||validationItem.field.val()&&0!=validationItem.field.val().length?"select"==validationItem.type?0<validationItem.field.find(".not-selected").length&&0==validationItem.field.hasClass("hidden")?(validationItem.field.parent().addClass("show-error"),!1):(validationItem.field.parent().removeClass("show-error"),!0):validationItem.field.hasClass("hidden")?(validationItem.field.parent().removeClass("show-error"),!0):validationItem.field.val().match(validationItem.regEx)?(validationItem.field.parent().removeClass("show-error"),!0):(validationItem.field.parent().hasClass("show-error")||validationItem.field.parent().addClass("show-error"),!1):(validationItem.field.parent().removeClass("show-error"),!0)},addValidation=function(field,regex,type,required,callback,customCallback){if(0!=field.length&&!field.attr("readonly")){var validationItem={field:field,regEx:regex,type:type,required:required,customCallback:customCallback};validationListSetup.push(validationItem),field.on("keyup",function(){formStatusCallback(validateField(validationItem))})}},validationListSetup=[],regexList_email=/^(?!.*\.{2})[A-Za-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,5}$/,regexList_hostId=/^.[^<>]{3,150}$/,regexList_hostName=/^.[^<>]{3,150}$/,hostId=$("input[name='hostId']"),hostName=$("input[name='hostName']"),email=$("input[name='email']");addValidation(hostId,regexList_hostId,null,!0),addValidation(hostName,regexList_hostName,null,!0),addValidation(email,regexList_email,null,!1);var formStatusCallback=function(status){1==status?getFormStatus(validationListSetup)&&errorMessage.removeClass("show"):errorMessage.addClass("show")},getFormStatus=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){if(validationItem.field.hasClass("error"))return formStatus=!1}),formStatus};$(".activate-license").on("click",function(event){if(validationList=validationListSetup,formStatus=!0,_.each(validationList,function(validationItem){validationItem.field.prop("disabled")||0!=validateField(validationItem)||(errorMessage.addClass("show"),formStatus=!1)}),formStatus){var validationList,formStatus,lacData={lacnumber:$scope.lacNumber,machineName:hostName.val(),lockingDetails:[{lockingID:hostId.val()}]};$scope.showLoader(),dashboardService.activateLicense(lacData).then(function(response){response.data.key&&0<response.data.key.length?(activationError.removeClass("show"),$scope.modal.close(),$scope.getLicenseData(),console.log("error activating license")):activationError.addClass("show"),$scope.hideLoader()},function(error){$scope.hideLoader(),console.log("error activating license")})}}),$scope.cpaasData=commerceProductService.getCpaasData(),$scope.addCredit=function(item){$scope.addedCredit=item},$scope.addCreditToCart=function(){$scope.showLoader(),cartService.addCpaas($scope.addedCredit).then(function(){$scope.checkout()},function(){$scope.hideLoader(),console.log("error adding cpaas to cart")}),$scope.addedCredit=null},$scope.cancelCredit=function(){$scope.addedCredit=null},$scope.cpaasData=commerceProductService.getCpaasData();cpaasService.register(function(){var refillAdded=cpaasService.getCredit(),item={id:"1",itemId:"1011",itemName:"CPaasS Account",price:Number(refillAdded)};$scope.showLoader(),cartService.addCpaas(item).then(function(){$scope.checkout()},function(){$scope.hideLoader(),console.log("error adding cpaas to cart")})})}}}),avayaBlog.directive("dynamicStoreMenu",function(){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/dynamic-store-menu.html",replace:!0,link:function(scope,element,attrs){var desktopLinks=$(".subnav-desktop li").clone(),mobileHoverBox=element.find("ul");mobileHoverBox.prepend(desktopLinks),mobileHoverBox.find("li .more-products").parent().remove()}}}),avayaBlog.directive("editName",function(labService){return{restrict:"A",controller:function($scope,$element){$scope.showEditView=!1;$($element).find("h2").text(),$($element).find("input");var titleView=$($element).find(".title-view"),editView=$($element).find(".edit-view");$scope.editLabName=function(){$scope.editedLabName=$scope.labDetails.labName,$scope.showEditView=!0,titleView.removeClass("show"),editView.addClass("show")},$scope.cancelEditLabName=function(){$scope.showEditView=!1,titleView.addClass("show"),editView.removeClass("show"),$scope.editedLabName=$scope.labDetails.labName},$scope.updateLabName=function(){var labData={labname:$scope.editedLabName,quoteid:$scope.labDetails.quoteId,labid:$scope.labDetails.lab_id};$scope.showLoader(0),labService.setLabName(labData).then(function(response){"1"==response.data.status?($scope.labDetails.labName=$scope.editedLabName,$scope.cancelEditLabName(),$scope.hideLoader(),labService.notifyLabNameChange()):(console.log("error updating lab name"),$scope.hideLoader())},function(error){$scope.hideLoader(),console.log("error updating lab name")})}}}}),avayaBlog.directive("enterprise",function(){return{restrict:"A",link:function(scope,element,attrs){var applicationDomain=window.location.hostname,multiTrack=function(viewPath,viewId){window.Webtrends?Webtrends.multiTrack({argsa:["dcssip",applicationDomain,"dcsuri",viewPath,"WT.dl","0","viewId",viewId]}):console.log(JSON.stringify({argsa:["dcssip","dlowsap2.us1.avaya.com","dcsuri",viewPath,"WT.dl","0","viewId",viewId]}))},baseUrl=getEnterpriseBaseUrl(),lastVideoTarget="";multiTrack(baseUrl,""),$(document).ready(function(){var showView=function(viewId){if(currentView&&(currentView.elem.removeClass("show"),removeVideo(viewId)),!viewId)return currentView=null,multiTrack(baseUrl,""),App.debug,void history.replaceState(viewId,null,baseUrl);(currentView=views[viewId]).elem||(currentView.elem=$(".enterprise-detailpage."+viewId)),currentView.elem.addClass("show"),multiTrack(baseUrl+"/"+viewId,currentView.viewId),1==App.debug?(embedVideo(viewId,currentView.videoId),window.location.href.indexOf("lob-spa")):(embedVideo(viewId,currentView.videoId),window.location.href.indexOf("viewId")),history.replaceState(viewId,null,baseUrl+"/"+viewId+"?viewId="+currentView.viewId)},detailCard=$(".enterprise-wrapper").find(".enterprise-detailpage"),currentView=(detailCard.find(".enterprise-img"),detailCard.find(".enterprise-detailpane"),null),views={sales:{viewId:1,previous:"remote-working",next:"marketing",videoId:"1_wnjna1cn"},marketing:{viewId:2,previous:"sales",next:"human-resources",videoId:"1_oa6bhbe4"},"human-resources":{viewId:3,previous:"marketing",next:"finance",videoId:"1_j309iksd"},finance:{viewId:4,previous:"human-resources",next:"research-and-development",videoId:"1_j309iksd"},"research-and-development":{viewId:5,previous:"finance",next:"customer-support",videoId:"1_mv3urnzh"},"customer-support":{viewId:6,previous:"research-and-development",next:"operations",videoId:"1_oa6bhbe4"},operations:{viewId:7,previous:"customer-support",next:"manufacturing",videoId:"1_zdil7f8s"},manufacturing:{viewId:8,previous:"operations",next:"remote-working",videoId:"1_zdil7f8s"},"remote-working":{viewId:9,previous:"manufacturing",next:"sales",videoId:"1_oa6bhbe4"},"contact-form":{}};$(".hosp-hotspot")&&$(".hosp-hotspot").on("click",function(e){e.stopPropagation(),e.preventDefault();var ele=$(this).attr("href");$(this).find(".hotspot-hover").addClass("grow"),setTimeout(function(){showView(ele)},100)}),$(".enterprise-anchor")&&$(".enterprise-anchor").on("click",function(e){e.stopImmediatePropagation(),e.preventDefault();var nextViewId="";nextViewId=$(this).hasClass("previous")?currentView.previous:currentView.next,showView(nextViewId)}),$(".explore").on("click",function(e){showView()}),$(".enterprise-anchor")&&$(".enterprise-anchor").on("click",function(e){e.stopImmediatePropagation(),e.preventDefault(),slideout(this)}),$(".enterprise-btn.registration").on("click",function(e){e.stopImmediatePropagation(),e.preventDefault(),showView("contact-form")}),$("#getstarted")&&$("#getstarted").on("click",function(e){e.stopImmediatePropagation(),e.preventDefault(),$(".enterprise-content").removeClass("overlay"),window.location.href=$(this).attr("href")}),$(".share")&&$(".share").click(function(event){event.preventDefault(),event.stopPropagation(),$(".share-popup").hasClass("show")?$(".share-popup").removeClass("show"):$(".share-popup").addClass("show")}),$(".hotspot")&&$(".hotspot").mouseover(function(e){e.stopPropagation(),$(this).find(".hotspot-hover").addClass("show").removeClass("hide")}),$(".hotspot")&&$(".hotspot").mouseout(function(e){e.stopPropagation(),$(this).find(".hotspot-hover").addClass("hide").removeClass("show"),$(this).find(".hotspot-hover").hasClass("grow")&&$(this).find(".hotspot-hover").removeClass("grow")}),$(document).click(function(){$(".hotspot").find(".hotspot-hover").removeClass("show").addClass("hide"),$(".hotspot").find(".hotspot-hover").removeClass("grow"),$(".share-popup").removeClass("show")}),$(".hotspot-hover")&&$(".hotspot-hover").each(function(){$(this).removeClass("grow").addClass("hide")});var viewIdParameter=function(name){var url=window.location.href;name=name.replace(/[\[\]]/g,"\\$&");var results=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)").exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null}("viewId");if(viewIdParameter)for(var key in views)views.hasOwnProperty(key)&&views[key].viewId==viewIdParameter&&showView(key)});var embedVideo=function(target,videoId){lastVideoTarget=target,kWidget&&kWidget.embed({targetId:target,wid:"_1535622",uiconf_id:"28256001",entry_id:videoId,flashvars:{autoPlay:!1},params:{wmode:"transparent"}})},removeVideo=function(target){if(lastVideoTarget){if(!kWidget)return;kWidget.destroy(lastVideoTarget),lastVideoTarget=""}}}}}),avayaBlog.directive("estimator",function(){return{restrict:"A",require:"^breezeConfigurator",templateUrl:"/static/avaya/commerce-views/estimator.html",link:function(scope,element,attrs,breezeConfiguratorCtrl){}}}),avayaBlog.directive("expandable",function(){return{restrict:"A",scope:{},link:function(scope,element,attrs){var queryResult=element[0].querySelector(".content"),wrappedQueryResult=angular.element(queryResult).children(),firstParagraph=wrappedQueryResult.get(3),hideContent=wrappedQueryResult.eq(3).nextUntil("A, BUTTON"),lastParagraph=hideContent.last();lastParagraph.is(":empty")&&(lastParagraph=lastParagraph.prev());var readMoreLink=$("<i class='fa fa-plus-square read-more'></i>"),readLessLink=$("<p class='read-less-wrap'><i class='fa fa-minus-square read-less'></i></p>");lastParagraph.is(":empty")&&(readLessLink=$("<i class='fa fa-minus-square read-less'></i>")),readMoreLink.on("click",function(event){element.removeClass("expandable"),hideContent.removeClass("hide"),event.stopPropagation()}),readLessLink.on("click",function(event){element.addClass("expandable"),hideContent.addClass("hide"),event.stopPropagation()}),firstParagraph.nodeName&&"ul"===firstParagraph.nodeName.toLowerCase()&&(firstParagraph=firstParagraph.lastElementChild),lastParagraph[0].nodeName&&"ul"==lastParagraph[0].nodeName.toLowerCase()&&(lastParagraph=lastParagraph[0].lastElementChild),hideContent.addClass("hide"),readMoreLink.appendTo(firstParagraph),readLessLink.appendTo(lastParagraph)}}}),avayaBlog.directive("exportQuote",function(midmarketDashboardService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/export-quote.html",replace:!0,controller:function($scope){$scope.zipCodeUSRegex=/^\d{5}(?:[-\s]\d{4})?/,$scope.exportPdf=function(){$scope.exportUrl,"pdf"==$scope.exportType?$scope.exportUrl=submitExportPdfApi():$scope.exportUrl=submitExportExcelApi(),$scope.exportUrl=$scope.exportUrl+$scope.exportSolutionId+"/",$scope.closeExportPdf()},$scope.closeExportPdf=function(){$scope.closeModal()}}}}),avayaBlog.directive("fileUpload",["$parse",function($parse){return{scope:{uploadFile:"&",formats:"@"},restrict:"A",template:'\t\t<div class="file-upload-container">\t\t\t<label class="file-upload"> \t\t\t\t<input id="uploadBtn" type="file" class="upload" style="width: 180px"> \t\t\t\t<i class="fa fa-upload"></i> \t\t\t</label> \t\t\t<input type="text" ng-model="uploadName" ng-value="fileName" id="uploadFile"> \t\t\t<label class="btn btn-danger" ng-show="displayUploadButton" ng-click="sendFile()"> \t\t\t\tUpload File \t\t\t</label>\t\t</div>',link:function(scope,element,attrs){scope.fileObject={};scope.fileName="No file chosen",scope.formats&&scope.formats.split(","),element.find(".upload").bind("change",function(){scope.$apply(function(){if(element.find(".upload")[0].files){scope.fileData=element.find(".upload")[0].files[0],scope.fileObject.fileData=element.find(".upload")[0].files[0];var fileExtension=scope.fileObject.fileData.name.split(".").pop();scope.fileName="pdf"==fileExtension?scope.fileObject.fileData.name:"Invalid file extension"}})})}}}]),avayaBlog.directive("fiveVideoQuilt",function($compile){return{restrict:"EAC",templateUrl:"/static/avaya/commerce-views/five-video-quilt.html",scope:{videoList:"="},replace:!0,link:function(scope,$element){scope.$watch("videoList",function(oldValue,newValue){$compile($element.contents())(scope)})},compile:function(scope,$element){}}}),avayaBlog.directive("forgotPassword",function(serviceBase,midmarketDashboardService,$q){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/forgot-password.html",replace:!0,controller:function($scope,$element,$filter){$scope.emailRegex=/^(?!.*\.{2})[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,3}$/,$scope.passwordRegex=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d$@$!%*?&_]{8,15}$/,$scope.showOtp=!1,$scope.showPassword=!1,$scope.isSubmitClicked=!0,$scope.showValidateOtp=!1,$scope.showSubmit=!0,$scope.showVerbiage=!0,$scope.showEmailMsg=!1,$scope.showOTPMsg=!1,$scope.showPasswordMsg=!1,$scope.showEmailMsgFailure=!1,$scope.forgotpwdpopupstatus=getForgotPasswordPopup(),$scope.showForgotPwdMsg=!1,$scope.forgotPasswordModalClose=function(){$scope.closeModal(),$scope.user={},$scope.showOtp=!1,$scope.showPassword=!1,$scope.isSubmitClicked=!0,$scope.showValidateOtp=!1,$scope.showSubmit=!0,$scope.showVerbiage=!0,$scope.showEmailMsg=!1,$scope.showOTPMsg=!1,$scope.showEmailMsg=!1,$scope.showPasswordMsg=!1,$scope.showEmailMsgFailure=!1},$scope.showOtpMethod=function(){$scope.showOtp=!0,$scope.isSubmitClicked=!1,$scope.showValidateOtp=!0,$scope.showSubmit=!1,$scope.showVerbiage=!1,$scope.showEmailMsg=!1},$scope.submitforgotPassword=function(user){$scope.showLoader();var payload={email:$scope.user.emailaddress};midmarketDashboardService.submitforgotPasswordForm(payload).then(function(response){"success"==response.Status?($scope.isSubmitClicked=!1,$scope.showOtp=!0,$scope.showValidateOtp=!0,$scope.showSubmit=!1,$scope.showVerbiage=!1,$scope.showEmailMsg=!0,$scope.hideLoader()):"failed"==response.Status&&($scope.hideLoader(),$scope.showEmailMsgFailure=!0)},function(error){$scope.hideLoader()})},1==$scope.forgotpwdpopupstatus?$scope.showForgotPwdMsg=!0:$scope.showForgotPwdMsg=!1,$scope.validateOtp=function(user){$scope.showLoader();var payload={OTP:$scope.user.otp,email:$scope.user.emailaddress};midmarketDashboardService.submitOtpPassword(payload).then(function(response){"success"==response.Status?($scope.showPassword=!0,$scope.showValidateOtp=!1,$scope.showOtp=!1,$scope.showVerbiage=!1,$scope.showOTPMsg=!0,$scope.showEmailMsg=!1,$scope.hideLoader()):"failed"==response.Status&&($scope.hideLoader(),$scope.showEmailMsgFailure=!0)},function(error){$scope.hideLoader()})},$scope.resetPassword=function(user){$scope.showLoader();var payload={email:$scope.user.emailaddress,passwd:$scope.user.newpassword};midmarketDashboardService.submitResetPassword(payload).then(function(response){"success"==response.Status?($scope.showPasswordMsg=!0,$scope.showVerbiage=!1,$scope.showOTPMsg=!1,$scope.showEmailMsg=!1,$scope.hideLoader()):"failed"==response.Status&&($scope.hideLoader(),$scope.showEmailMsgFailure=!0)},function(error){$scope.hideLoader()})}}}}),avayaBlog.directive("freeTrialConfigurator",function(commerceProductService){return{restrict:"A",replace:!0,controller:function($scope,$element){commerceProductService.getFreeTrial().then(function(response){"success"==response.data.status&&(window.location.href=getCartLink())},function(error){console.log("error")})}}}),avayaBlog.directive("hardware",function(){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/hardware.html",link:function(scope,element,attrs){}}}),avayaBlog.directive("inputPhoneNumberFormatting",function($filter,$browser){return{require:"ngModel",link:function($scope,$element,$attrs,ngModelCtrl){var listener=function(){var value=$element.val().replace(/[^0-9]/g,"");$element.val($filter("telFormatting")(value,!1))};ngModelCtrl.$parsers.push(function(viewValue){return viewValue.replace(/[^0-9]/g,"").slice(0,10)}),ngModelCtrl.$render=function(){$element.val($filter("telFormatting")(ngModelCtrl.$viewValue,!1))},$element.bind("change",listener),$element.bind("keydown",function(event){var key=event.keyCode;91==key||15<key&&key<19||37<=key&&key<=40||$browser.defer(listener)}),$element.bind("paste cut",function(){$browser.defer(listener)})}}}),avayaBlog.directive("kalturaModal",function($rootScope,webtrendsService){return{scope:{video:"@",title:"@",language:"@"},controller:function($scope,$element){var videoModal=$(".kaltura-modal"),closeButton=videoModal.find(".close"),title=videoModal.find(".modal-header h4"),backdrop=$(".kaltura-modal-backdrop");function closeModal(){videoModal.addClass("hide"),videoModal.addClass("fade"),backdrop.removeClass("fade"),kWidget.destroy("kaltura-player")}closeButton.on("click",function(){closeModal()}),$(window).bind("keyup",function(e){27==e.keyCode&&closeModal()}),backdrop.bind("click",function(e){closeModal()}),$element.on("click",function(){var videoPlayerOptions;if(videoPlayerOptions={autoPlay:!0,externalInterfaceDisabled:!1,disableOnScreenClick:!1,playerBgColor:16777215,closedCaptions:{usecookie:!1,displayCaptions:!(!$scope.language||"en"==$scope.language),defaultLanguageKey:$scope.language}},null!=$scope.video&&null!=$scope.video){$.ajax({url:"//cdnapisec.kaltura.com/p/1535622/sp/153562200/embedIframeJs/uiconf_id/28256001/partner_id/1535622",dataType:"script",success:function(){kWidget.destroy("kaltura-player"),kWidget.embed({targetId:"kaltura-player",wid:"_1535622",uiconf_id:"28256001",flashvars:videoPlayerOptions,cache_st:1417536325,entry_id:$scope.video,params:{wmode:"transparent"}}),videoModal.removeClass("hide"),videoModal.removeClass("fade"),title.text($scope.title),backdrop.addClass("fade"),webtrendsService.playVideo($scope.video,$scope.title)}})}})}}}),avayaBlog.directive("kalturaPlayer",["$rootScope","webtrendsService",function($rootScope,webtrendsService){return{restrict:"A",scope:{video:"=",language:"="},templateUrl:"commerce-views/kaltura-player.html",controller:function($scope,$element){var videoPlayerOptions;videoPlayerOptions={autoPlay:!1,externalInterfaceDisabled:!1,disableOnScreenClick:!1,playerBgColor:16777215,closedCaptions:{usecookie:!1,displayCaptions:!(!$scope.language||"en"==$scope.language),defaultLanguageKey:$scope.language}},$scope.duration={minutes:0,seconds:"00",total:0},$scope.played={minutes:0,seconds:"00"},$scope.currentTime=0,$scope.percentagePlayed=0,$scope.player={playing:!1,paused:!1,videoLoaded:!1,object:null},$scope.$watch("video",function(){if(null!=$scope.video&&null!=$scope.video){$.ajax({url:"//cdnapisec.kaltura.com/p/1535622/sp/153562200/embedIframeJs/uiconf_id/28256001/partner_id/1535622",dataType:"script",success:function(){kWidget.destroy("kaltura-player"),kWidget.embed({targetId:"kaltura-player",wid:"_1535622",uiconf_id:"28256001",flashvars:videoPlayerOptions,cache_st:1417536325,entry_id:$scope.video,params:{wmode:"transparent"}}),webtrendsService.playVideo($scope.video,"")}})}})}}}]),avayaBlog.directive("labDetails",function(labService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/lab-details.html",replace:!0,controller:function($scope,$element){$scope.showToggleConfirmation=!1;var switchWrap=$($element).find(".switch"),powerButton=switchWrap.find("input");$scope.togglePower=function(event){event.preventDefault(),event.stopPropagation(),$scope.powerChangeStatus=switchWrap.hasClass("on")?"OFF":"ON",$scope.showToggleConfirmation=!0},$scope.dismissConfirmation=function(){$scope.showToggleConfirmation=!1},$scope.switchPower=function(){$scope.showToggleConfirmation=!1,switchWrap.hasClass("on")?($scope.showLoader(0),labService.stopLab($scope.labDetails.lab_id).then(function(response){if(response.data.error)return alert("Error: There was a problem processing your request."),void $scope.hideLoader();$scope.labDetails.nodes.smgr_status="",$scope.pollLabStatus()},function(error){alert("Error: There was a problem processing your request."),$scope.hideLoader()}),powerButton.removeAttr("checked")):($scope.showLoader(0),labService.startLab($scope.labDetails.lab_id).then(function(response){if(response.data.error)return alert("Error: There was a problem processing your request."),void $scope.hideLoader();$scope.pollLabStatus()},function(error){alert("Error: There was a problem processing your request."),$scope.hideLoader()}),powerButton.attr("checked",""))},$scope.refreshProducts=function(){},$scope.destroyLab=function(){$scope.showLoader(0),labService.destroyLab($scope.labDetails.lab_id).then(function(response){if(!response.data.errorMsg)return alert("Lab destroyed successfully."),void $scope.returnToDashboard();alert("Error: There was a problem processing your request."),$scope.hideLoader()},function(error){alert("Error: There was a problem processing your request."),$scope.hideLoader()})},$scope.returnToDashboard=function(){labService.notifyLabNameChange(),$scope.back()}}}}),avayaBlog.directive("loadMore",function(){return{restrict:"EAC",link:function(scope,element,attr){var footer=$(".footer-wrap");$.prototype.isInViewport=function(){var win=$(window),viewport={top:win.scrollTop(),left:win.scrollLeft()};viewport.right=viewport.left+win.width(),viewport.bottom=viewport.top+win.height();var bounds=this.offset();return bounds.right=bounds.left+this.outerWidth(),bounds.bottom=bounds.top+this.outerHeight(),!(viewport.right<bounds.left||viewport.left>bounds.right||viewport.bottom<bounds.top||viewport.top>bounds.bottom)},$(window).scroll(function(){!0===footer.isInViewport()&&scope.$apply(attr.loadMore)})}}}),avayaBlog.directive("midmarketagentdashboard",function(midmarketAgentDashboardService,dashboardService,commerceProductService,cartService,cpaasService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/midmarket-agent-dashboard.html",controller:function($scope,$element,$window){$scope.companyInfo={},$scope.agentInfo=[],$scope.myAgentInfo=[],$scope.myAgentUserInfo=[],$scope.myCustomerInfo=[],$scope.userTypeInfo={},$scope.showMasterAgent=!0,$scope.showcustomer=!0,$scope.admincust={currentPage:1,offset:0,pageLimit:"5"},$scope.company={currentPage:1,offset:0,pageLimit:"5"},$scope.agentuser={currentPage:1,offset:0,pageLimit:"5"},$scope.customer={currentPage:1,offset:0,pageLimit:"5"},$scope.getUserType=function(){midmarketAgentDashboardService.getusertype().then(function(response){$scope.userTypeInfo=response,"Agent"==$scope.userTypeInfo.usertype||""==$scope.userTypeInfo.usertype?($scope.showMasterAgent=!1,$scope.showcustomer=!1):($scope.showMasterAgent=!0,$scope.showcustomer=!0)},function(error){console.log("error fetching  doc",error)})},$scope.getCompanyInfo=function(){midmarketAgentDashboardService.getdata().then(function(response){$scope.companyInfo=response},function(error){console.log("error fetching  doc",error)})},$scope.getMyAdminsInfo=function(){midmarketAgentDashboardService.get().then(function(response){$scope.agentInfo=response},function(error){console.log("error fetching  doc",error)})},$scope.getMyAgentsInfo=function(){midmarketAgentDashboardService.getagentdata().then(function(response){$scope.myAgentInfo=response},function(error){console.log("error fetching  doc",error)})},$scope.getMyAgentsUserInfo=function(){midmarketAgentDashboardService.getagentusersdata().then(function(response){$scope.myAgentUserInfo=response},function(error){console.log("error fetching  doc",error)})},$scope.getMyCustomersInfo=function(){midmarketAgentDashboardService.getmycustomerdata().then(function(response){$scope.myCustomerInfo=response},function(error){console.log("error fetching  doc",error)})},$scope.postActionDetails=function(data,itemsName){"Remove"==data.action&&$scope[itemsName].splice($scope[itemsName].indexOf(data),1);var payload={action:"De-Link"==data.action?"DeLink":data.action,tabletype:$scope.routeController.childViewId,userObject:data,companyObject:$scope.companyInfo};$scope.showLoader(),midmarketAgentDashboardService.postAction(payload).then(function(response){$scope.hideLoader(),$scope.getCompanyInfo(),$scope.getMyAdminsInfo(),$scope.getMyAgentsInfo(),$scope.getMyAgentsUserInfo(),$scope.getMyCustomersInfo()},function(error){$scope.hideLoader()})},$scope.getCompanyInfo(),$scope.getMyAdminsInfo(),$scope.getMyAgentsInfo(),$scope.getMyAgentsUserInfo(),$scope.getMyCustomersInfo(),$scope.getUserType(),$scope.viewdetails=function(){},$scope.alert=function(message,type){$scope.alertMessage=message,$scope.alertType=type,setTimeout(function(){$("#modal-alert").click()},1e3)}}}}),avayaBlog.directive("midmarketAgentUrl",function(midmarketDashboardService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/midmarket-agent-url.html",controller:function($scope){$scope.alphaNumericRegex=/^[a-zA-Z0-9]*$/,$scope.showStatusMsg=!1,$scope.closeCompanyUrl=function(){$scope.resetActionDropdowns(),$scope.closeModal()},$scope.clearCompanyUrl=function(){$scope.editAgentUrl.shortName="",$scope.showStatusMsg=!1},$scope.editAgentsUrl=function(editAgentUrl){editAgentUrl&&editAgentUrl.shortName&&($scope.showLoader(),midmarketDashboardService.updateAgentUrl(editAgentUrl.shortName).then(function(response){$scope.hideLoader(),"success"==response.status&&($scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.showStatusMsg=!1,$scope.closeCompanyUrl()),"failed"==response.status&&($scope.showStatusMsg=!0),$scope.getCompanyInfo()},function(error){$scope.hideLoader(),$scope.showPopupStatusMsg(!0,"failed","There is a problem at this time. Please try again later."),$scope.closeCompanyUrl()}))},$scope.showPopupStatusMsg=function(showPopup,status,statusMsg){$scope.showAgentPopupStatus=showPopup,$scope.showAgentStatus=status,$scope.showAgentPopupMsg=statusMsg,$(".popupStatus").css("display","flex")}}}}),avayaBlog.directive("midmarketdashboard",function(midmarketDashboardService,dashboardService,commerceProductService,cartService,cpaasService,purchaseOrderService,commerceService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/midmarket-dashboard.html",controller:function($scope,$element,$window,$compile){$scope.ishelp=getHelpLinkStatus(),$scope.orders={currentPage:1,offset:0,pageLimit:"5"},$scope.po={currentPage:1,offset:0,pageLimit:"5",filter:""},$scope.invoices={currentPage:1,offset:0,pageLimit:"5"},$scope.admincust={currentPage:1,offset:0,pageLimit:"5"},$scope.company={currentPage:1,offset:0,pageLimit:"5"},$scope.agentuser={currentPage:1,offset:0,pageLimit:"5"},$scope.customer={currentPage:1,offset:0,pageLimit:"5"},$scope.companyInfo={},$scope.purchaseOrder=[],$scope.agentInfo=[],$scope.myAgentInfo=[],$scope.myAgentUserInfo=[],$scope.myCustomerInfo=[],$scope.userTypeInfo={},$scope.showMasterAgent=!0,$scope.showcustomer=!0,$scope.showcheckout=!0,$scope.updatePaymentBtnTxt="Update",$scope.creditCardNumber=$("input[name=cardNumber]"),$scope.editSalesTerritory=[],$scope.billingData={},$scope.OpenClose="",$scope.getPOData=function(){purchaseOrderService.get().then(function(response){$scope.purchaseOrder=response},function(error){console.log("error fetchng PO data in checkout")})},$scope.getPOData(),$scope.getOrderData=function(){midmarketDashboardService.get($scope.userTypeInfo.usertype).then(function(response){$scope.billingData=response,$scope.showcheckout=!0},function(error){console.log("error fetching tnc doc",error)})},$scope.orderid="",$scope.closeAll=function(){angular.forEach($scope.billingData.Orders,function(item){item.expanded=!1}),$scope.OpenClose=""},$scope.openClose=function(){var isOpen=!1;angular.forEach($scope.billingData.Orders,function(item){1!=item.expanded||(isOpen=!0)}),$scope.OpenClose=isOpen?"Close All":""},$scope.viewDetails=function(order){var url=getExportPdfFormApi();window.open(url+order+"/","_blank")},$scope.checkout=function(order){var orderid=order.orderid;window.location.href=getCheckoutLink()+"?solutionId="+orderid},$scope.savePODetails=function(formData,selectedPO){$scope.showLoader(),$scope.selectedPO=selectedPO,purchaseOrderService.savePO(formData).then(function(response){var res=JSON.parse(response.data);"success"==res.status&&($scope.closeModal(),$scope.selectedPO.PODocID=res.docId,$scope.getPOData()),$scope.hideLoader()},function(error){$scope.hideLoader()})},$scope.poActions=function(po,selectedAction){if($scope.selectedPO=po,"Edit"==selectedAction)$scope.editPo=!0,$(window).scrollTop(0),$(".av-modal.breeze-modal").find(".purchase-order").css("display","block"),$(".commerce-modal-backdrop").addClass("fade"),$(".av-modal.breeze-modal").css("display","block");else{if("Delete"!=selectedAction)return $scope.clearData(),!1;$scope.deletePO()}},$scope.editPODetails=function(formData){$scope.showLoader(),purchaseOrderService.editPO(formData).then(function(response){"success"==JSON.parse(response.data).status&&($scope.clearData(),$scope.closeModal(),$scope.getPOData()),$scope.hideLoader()},function(error){$scope.hideLoader()})},$scope.deletePO=function(){var poFormData=new FormData;poFormData.append("poNumber",$scope.selectedPO.PONumber),poFormData.append("poAmount",$scope.selectedPO.POAmount),poFormData.append("poExpiration",$scope.selectedPO.POExpiration),poFormData.append("poDate",$scope.selectedPO.PODate),poFormData.append("poName",$scope.selectedPO.POName),poFormData.append("poURL",$scope.selectedPO.POURL),poFormData.append("poDocId",$scope.selectedPO.PODocID),poFormData.append("PayerNo",$scope.selectedPO.POURL),poFormData.append("POID",$scope.selectedPO.PODocID),purchaseOrderService.deletePO(poFormData).then(function(response){"success"==JSON.parse(response.data).status&&$scope.getPOData(),$scope.hideLoader()},function(error){$scope.hideLoader()})},$scope.getUserType=function(){midmarketDashboardService.getusertype().then(function(response){$scope.userTypeInfo=response,$scope.getOrderData(),"Agent"==$scope.userTypeInfo.usertype||""==$scope.userTypeInfo.usertype?($scope.showMasterAgent=!1,$scope.showcustomer=!1):($scope.showMasterAgent=!0,$scope.showcustomer=!0)},function(error){console.log("error fetching  doc",error)})},$scope.getCompanyInfo=function(){midmarketDashboardService.getdata().then(function(response){var agentcode=($scope.companyInfo=response).shortName;$scope.companyInfo.agentUrl=getagentURL()+agentcode,$scope.companyInfo.shortName=agentcode},function(error){console.log("error fetching  doc",error)})},$scope.getMyAdminsInfo=function(){midmarketDashboardService.getAdmindata().then(function(response){$scope.agentInfo=response},function(error){console.log("error fetching  doc",error)})},$scope.getMyAgentsInfo=function(){midmarketDashboardService.getagentdata().then(function(response){$scope.myAgentInfo=response},function(error){console.log("error fetching  doc",error)})},$scope.getMyAgentsUserInfo=function(){midmarketDashboardService.getagentusersdata().then(function(response){$scope.myAgentUserInfo=response},function(error){console.log("error fetching  doc",error)})},$scope.getMyCustomersInfo=function(){midmarketDashboardService.getmycustomerdata().then(function(response){$scope.myCustomerInfo=response},function(error){console.log("error fetching  doc",error)})},$scope.getInvoices=function(){midmarketDashboardService.getInvoiceData().then(function(response){$scope.invoicesData=response,$scope.invoicesData=$scope.invoicesData.filter(function(el){return null!=el})},function(error){console.log("error fetching  doc",error)})},$scope.getInvoices(),$scope.invoiceViewDetails=function(invoiceId,invoiceNo,entityId){var url=getInvoiceDownload();window.open(url+invoiceId+"/"+invoiceNo+"/"+entityId+"/","_blank")},$scope.cancelRemoveAlertModal=function(){$scope.showRemoveAlert=!1},$scope.continueRemoveAlertModal=function(data){$scope.showRemoveAlert=!1,$scope.postDataPayloadActions(data)},$scope.showEditCompany=function(companyData){if("Edit"==companyData.companyAction){var companyEditData=companyData;$scope.editAgent=companyEditData,$scope.editCompany=!0,$(window).scrollTop(0),$(".av-modal.breeze-modal").find(".midmarket-agent-company").css("display","block"),$(".commerce-modal-backdrop").addClass("fade"),$(".av-modal.breeze-modal").css("display","block")}},$scope.showEditCompanyUrl=function(companyUrlData){if("Edit"==companyUrlData.urlAction){var companyEditUrlData=companyUrlData;$scope.editAgentUrl=companyEditUrlData,$(window).scrollTop(0),$(".av-modal.breeze-modal").find(".midmarket-agent-url").css("display","block"),$(".commerce-modal-backdrop").addClass("fade"),$(".av-modal.breeze-modal").css("display","block")}},$scope.showEditSalesTerritory=function(companyData){var companyEditSalesTerritoryData=companyData;$scope.item=companyEditSalesTerritoryData,$scope.showMsgEditSalesTerritory=!0},$scope.resetActionDropdowns=function(){$scope.companyInfo.companyAction="",$scope.companyInfo.urlAction=""},$scope.editSalesTerritory=function(companyEditSalesTerritoryData){var company={};if((company=companyEditSalesTerritoryData)!={}){company.status="Active";var payload={action:"EditSalesTerritory",tabletype:"myagents",companyObject:company},territories=[];angular.forEach($scope.userTypeInfo.salesAreas,function(item){item.selected&&territories.push(item)}),company.salesAreas=territories,$scope.showLoader(),midmarketDashboardService.postAction(payload).then(function(response){"success"==response.status?($scope.getMyAgentsInfo(),$scope.hideLoader(),$scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.closeAlertModal()):"failed"==response.status&&($scope.getMyAgentsInfo(),$scope.hideLoader(),$scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.closeAlertModal())},function(error){$scope.hideLoader(),$scope.showPopupStatusMsg(!0,"failed","There is a problem at this time. Please try again later."),$scope.closeAlertModal()})}},$scope.postActionDetails=function(data,itemsName,companyData){return"Remove"==data.action?($(window).scrollTop(0),$scope.showRemoveAlert=!0,$scope.removeItemData=data,!($scope.showDelinkRemoveAlertText="Do you want to remove?")):"Edit"==data.action?($scope.showEditCompany(companyData),companyData.action=companyData.actions[0].value,!1):"EditSalesTerritory"==data.action?($scope.showEditSalesTerritory(companyData),!1):"De-Link"==data.action?($(window).scrollTop(0),$scope.showRemoveAlert=!0,$scope.removeItemData=data,!($scope.showDelinkRemoveAlertText="Do you want to De-Link?")):"DeActivate"==data.action?($(window).scrollTop(0),$scope.showRemoveAlert=!0,$scope.removeItemData=data,!($scope.showDelinkRemoveAlertText="Do you want to DeActivate?")):($scope.showRemoveAlert=!1,$scope.showDelinkRemoveAlertText="",void $scope.postDataPayloadActions(data))},$scope.postDataPayloadActions=function(data){var payload={action:"De-Link"==data.action?"DeLink":data.action,tabletype:$scope.routeController.childViewId,userObject:data,companyObject:$scope.companyInfo};$scope.showLoader(),midmarketDashboardService.postAction(payload).then(function(response){response.status,$scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.getCompanyInfo(),$scope.getMyAdminsInfo(),$scope.getMyAgentsInfo(),$scope.getMyAgentsUserInfo(),$scope.getMyCustomersInfo(),$scope.hideLoader()},function(error){$scope.hideLoader(),$scope.showPopupStatusMsg(!0,"failed",response.statusMsg)})},$scope.getCompanyInfo(),$scope.getMyAdminsInfo(),$scope.getMyAgentsInfo(),$scope.getMyAgentsUserInfo(),$scope.getMyCustomersInfo(),$scope.getUserType(),$scope.viewdetails=function(){},$scope.alert=function(message,type){$scope.alertMessage=message,$scope.alertType=type,setTimeout(function(){$("#modal-alert").click()},1e3)},$scope.getDateFormat=function(timestamp){return new Date(timestamp)},$scope.closeAlertModal=function(){$scope.showOrderRemoveAlert=!1,$scope.showMsgEditSalesTerritory=!1},$scope.cancelOrderPopup=function(lac){$(window).scrollTop(0),$scope.showOrderRemoveAlert=!0,$scope.cancelledOrderData=lac},$scope.cancelOrder=function(lac){$scope.showOrderRemoveAlert=!1,$scope.showLoader(),midmarketDashboardService.getCancelOrder(lac.orderid).then(function(response){"success"==response.status?($scope.getOrderData(),$scope.hideLoader(),$scope.showPopupStatusMsg(!0,response.status,response.statusMsg)):"failed"==response.status&&($scope.hideLoader(),$scope.showPopupStatusMsg(!0,response.status,response.statusMsg))})},$scope.showPopupStatusMsg=function(showPopup,status,statusMsg){$(window).scrollTop(0),$scope.showPopupMsg=showPopup,$scope.showPopupStatus=status,$scope.showPopupMsg=statusMsg,$(".popupStatus").css("display","flex")},$scope.shouldShow=function(admin){return"Active"==admin.status&&"Activate"==admin.action},$scope.resendOrderEmail=function(order,email){$scope.resendSolutionId=order,$scope.customerEmail=email||"",$(window).scrollTop(0),$(".av-modal.breeze-modal").find(".send-to-customer").css("display","block"),$compile($(".av-modal.breeze-modal").contents())($scope),$(".commerce-modal-backdrop").addClass("fade"),$(".av-modal.breeze-modal").css("display","block")},$scope.showMsg=!1,$scope.help=function(custdetails){midmarketDashboardService.submitHelpForm(custdetails).then(function(response){$scope.showMsg=!0,$scope.clearHelpForm()},function(error){$scope.showMsg=!1})},$scope.clearHelpForm=function(){$scope.custdetails={}},$scope.updateAction=function(){midmarketDashboardService.getupdateAction().then(function(response){"success"==response.status&&($scope.hideLoader(),$scope.closeCompany())},function(error){$scope.hideLoader(),$scope.showPopupStatusMsg(!0,"failed","There is a problem at this time. Please try again later."),$scope.closeCompany()})},$scope.closeCompany=function(){$scope.closeModal()},$scope.clearHelpMessages=function(){$scope.showMsg=!1},$scope.submitBtnLoadingTxt="Submit",$scope.addressLine1Regex=/^[ A-Za-z0-9()[\]+*#-/]{3,100}$/,$scope.alphabetRegex=/^[a-zA-Z .]{1,50}$/,$scope.stateRegex=/^[a-zA-Z .]{2,3}$/,$scope.zipCodeUSRegex=/^\d{5}(?:[-\s]\d{4})?/,$scope.zipCodeCARegex=/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,$scope.numberRegex=/^[0-9]*$/,$scope.alphaNumericRegex=/^[a-zA-Z0-9]*$/,$scope.phoneRegex=/^((\+1)?[\s-]?)?\(?[1-9]\d\d\)?[\s-]?[0-9]\d\d[\s-]?\d\d\d\d/,$scope.routingRegex=/^[0-9]{8,10}$/,$scope.acNumberRegex=/^[0-9]{9,17}$/,$scope.companyDomainRegex=/^(?!.*\.{2})[A-Za-z0-9._%+-]+\.[a-z]{2,3}$/,$scope.creditCardRegex=/^[0-9]{12,19}$/,$scope.expiryDateRegex=/^(((0)[0-9])|((1)[0-2]))(\/)([2][0][1-3][0-9])$/,$scope.CVVRegex=/^[0-9]{3,4}$/,$scope.cardNameRegex=/^[a-zA-Z][^0-9±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{2,50}$/,$scope.getZipPattern=function(){if($scope.selectedShipTo)return"CA"==$scope.selectedShipTo.address.country?$scope.zipCodeCARegex:$scope.zipCodeUSRegex},$scope.getZipBillToPattern=function(){if($scope.billingInfo)return"CA"==$scope.billingInfo.address.country?$scope.zipCodeCARegex:$scope.zipCodeUSRegex};var validateField=function(validationItem){return 0!=validationItem.required||validationItem.field.val()&&0!=validationItem.field.val().length?"select"==validationItem.type?0<validationItem.field.find(".not-selected").length&&0==validationItem.field.hasClass("hidden")?(validationItem.field.parent().addClass("show-error"),!1):(validationItem.field.parent().removeClass("show-error"),!0):validationItem.field.hasClass("hidden")?(validationItem.field.parent().removeClass("show-error"),!0):validationItem.field.val().match(validationItem.regEx)?(validationItem.field.parent().removeClass("show-error"),!0):(validationItem.field.parent().hasClass("show-error")||validationItem.field.parent().addClass("show-error"),!1):(validationItem.field.parent().removeClass("show-error"),!0)},addValidation=function(field,regex,type,required,callback,customCallback,validationList,formStatusCallback){if(0!=field.length&&!field.attr("readonly")){var validationItem={field:field,regEx:regex,type:type,required:required,customCallback:customCallback};validationList.push(validationItem),formStatusCallback&&field.on("keyup",function(){formStatusCallback(validateField(validationItem),validationList)})}},validationListSetup=[],regexList_name=/^[a-zA-Z][^0-9±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{2,50}$/,regexList_expiration=/^(?:0?[1-9]|1[0-2]) *\/ *[2][0][1-3][0-9]$/,regexList_cvv=/^[0-9]{3,4}$/,regexList_creditCard=/^[0-9]{1,19}$/,formStatusCallback=function(status,validationList){1==status?getFormStatus(validationList)&&errorMessage.removeClass("show"):errorMessage.addClass("show")},cardName=$("input[name='cardName']"),cardExpDate=$("input[name='cardExpDate']"),cardCvv=$("input[name='cardCvv']"),cardNumber=$("input[name='cardNumber']"),errorMessage=$(".error-message");addValidation(cardName,regexList_name,null,!0,0,null,validationListSetup,formStatusCallback),addValidation(cardExpDate,regexList_expiration,null,!0,0,function(cardExpDate){var card=cardExpDate.split("/"),month=card[0],year=card[1];return!(year<currentYear)&&(!(year==currentYear&&month<currentMonth)&&void 0)},validationListSetup,formStatusCallback),addValidation(cardCvv,regexList_cvv,null,!0,0,null,validationListSetup,formStatusCallback),addValidation(cardNumber,regexList_creditCard,null,!0,0,null,validationListSetup,formStatusCallback);var getFormStatus=function(validationList){var formStatus=!0;return $scope.paymetricError=!1,_.each(validationList,function(validationItem){if(validationItem.field.hasClass("error")||validationItem.field.val().length<1)return formStatus=!1,cardNumber.parent().hasClass("show-error")&&($scope.paymetricError=!0),formStatus}),formStatus},paymentInfo={nameOnCard:"",expiryMonth:"",expiryYear:"",paymentType:"CC",cardType:"VISA",paymetricToken:""};$scope.creditCardNumberError=$("input[name=cardNumber]").parent().hasClass("show-error"),$scope.$applyAsync(),$scope.creditCardNumber.blur(function(cardNumber){if($scope.updatePaymentBtnTxt="Loading...",$scope.paymetricToken=null,function(cardNumber){return!(!cardNumber||0==cardNumber.length)}(cardNumber=$("input[name=cardNumber]").val())){$scope.paymentFrame=$("#paymetricIframe").contents();var payNow=$scope.paymentFrame.find("#PayNowButton"),cardCvv="123",cardDetails=cardTypeDetails(cardNumber),cardTypeCode=(cardDetails.cardType,cardDetails.cardTypeCode);"3000"==cardTypeCode&&(cardCvv="5858");var pmCardType=$scope.paymentFrame.find("#Paymetric_CreditCardType"),pmCardNo=$scope.paymentFrame.find("#Paymetric_CreditCardNumber"),pmExpMonth=$scope.paymentFrame.find("#Paymetric_Exp_Month"),pmExpYear=$scope.paymentFrame.find("#Paymetric_Exp_Year"),pmCVV=$scope.paymentFrame.find("#Paymetric_CVV");pmCardType.val(cardTypeCode),pmCardNo.val(cardNumber),pmExpMonth.val("02"),pmExpYear.val("2019"),pmCVV.val(cardCvv),payNow.click(),$window.showToken=function(token){console.log("Paymetric token inside showToken method:"+token),$scope.paymetricToken=token,$scope.$applyAsync(),$scope.creditCardNumber.parent().removeClass("show-error"),$scope.paymetricError=!1,$scope.updatePaymentBtnTxt="Update",setTimeout(function(){$("#paymetricIframe").attr("src",function(index,attr){return attr})},500)},setTimeout(function(){$scope.paymetricError=!1,$scope.paymentFrame=$("#paymetricIframe").contents();var paymetricErrorList=$scope.paymentFrame.find("#Paymetric_ErrorLogging");paymetricErrorList&&0<paymetricErrorList.length&&0<paymetricErrorList.text().length&&($scope.creditCardNumber.parent().addClass("show-error"),$scope.paymetricError=!0)},200),console.log("Paymetric token:"+$scope.paymetricToken),$scope.updatePaymentBtnTxt="Update",$scope.$applyAsync()}});var cardTypeDetails=function(cardNumber){var cardType,cardTypeCode,cardFirstDigit=cardNumber.substring(0,1);if("4"==cardFirstDigit)cardTypeCode="4000",cardType="VISA";else if("5"==cardFirstDigit)cardTypeCode="5000",cardType="MC";else if("6"==cardFirstDigit)cardTypeCode="6000",cardType="DISC";else if("3"==cardFirstDigit){cardTypeCode="3000";var cardSecondDigit=cardNumber.substring(1,2);"4"!=cardSecondDigit&&"7"!=cardSecondDigit||(cardType="AMEX"),"0"!=cardSecondDigit&&"6"!=cardSecondDigit&&"8"!=cardSecondDigit||(cardType="")}return{cardType:cardType,cardTypeCode:cardTypeCode}};$scope.resetSelectedAgent=function(){midmarketDashboardService.resetSelectAgent().then(function(response){"success"==response.status&&$window.location.reload()},function(error){console.log("error selecting agent on search",error)})},$scope.expiryDateRegexFunc=function(){var element=$scope.cardExpiry;if($scope.expiryError=!1,/^(((0)[0-9])|((1)[0-2]))(\/)([2][0][1-3][0-9])$/.test(element)){var date_array=element.split("/"),month=date_array[0]-1,year=date_array[1];if(source_date=new Date,year>source_date.getFullYear())return!1;if(year==source_date.getFullYear()){if(month>=source_date.getMonth())return!1;$scope.expiryError=!0}else $scope.expiryError=!0}else $scope.expiryError=!0},$scope.submitMyPaymentDetails=function(){$scope.updatePaymentBtnTxt="Loading...",$scope.showLoader();var expDate=$scope.cardExpiry,cardNumber=$scope.cardNumber;paymentInfo.nameOnCard=$scope.cardName,paymentInfo.cardType=cardTypeDetails(cardNumber).cardType,paymentInfo.expiryYear=expDate.split("/")[1],paymentInfo.expiryMonth=expDate.split("/")[0],paymentInfo.paymetricToken=$scope.paymetricToken,midmarketDashboardService.submitPaymentDetails(paymentInfo,$scope.billingInfo).then(function(response){response.status,$scope.hideLoader(),$scope.showPopupStatusMsg(!0,response.status,response.statusMsg),$scope.clearMyPaymentDetails()},function(error){$scope.showPopupStatusMsg(!0,"failed","Something went wrong. Request to retry."),$scope.hideLoader(),$scope.clearMyPaymentDetails(),$scope.updatePaymentBtnTxt="Update"})},$scope.clearMyPaymentDetails=function(){$scope.cardName="",$scope.cardNumber="",$scope.cardExpiry="",$scope.cardCVV="",$scope.billingInfo.address.addressLine1="",$scope.billingInfo.address.addressLine2="",$scope.billingInfo.address.city="",$scope.billingInfo.address.state="",$scope.billingInfo.address.zip=""},$scope.loginTypeCheckAlert=!1;var smSession=$(".app-urls").find("#smsession-cookie").text();smSession&&"No"!=smSession&&"LOGGEDOFF"!=smSession&&""!=smSession&&commerceService.getProfileInfo().then(function(response){$scope.userProfileInfo=response,$scope.userProfileInfo&&$scope.userProfileInfo.usertype?$scope.usertype=$scope.userProfileInfo.usertype:$scope.usertype=null;var loginTypeCheckAlertModal=$(".commerce-loginTypeCheckAlert-modal");"null"==$scope.usertype||"undefined"==$scope.usertype||""==$scope.usertype||null===$scope.usertype||void 0===$scope.usertype?(loginTypeCheckAlertModal.removeClass("hide"),$scope.loginTypeCheckAlert=!0):(loginTypeCheckAlertModal.addClass("hide"),$scope.loginTypeCheckAlert=!1)}),$scope.setUserTypeCancel=function(){$scope.showLoader(),window.location.href=getHomepageLink()},$scope.setUserTypeContinue=function(){$scope.showLoader(),commerceService.setNewCustomer().then(function(response){"success"==response.status?window.location.reload():window.location.href=getHomepageLink()})},$scope.openEnterpriseLink=function(){window.open(enterpriseStoreLink(),"_blank")}}}}),avayaBlog.directive("mobileMenu",function($compile,dataService){return{restrict:"A",link:function($scope,element,attrs,ctrl){var menu={},moblieHamburgerClickEventDefined=!1;function browserWidth(){return self.innerHeight?self.innerWidth:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientWidth:document.body?document.body.clientWidth:void 0}menu.button=$(".menu-button"),menu.wrapper=$("[mobile-menu]"),menu.search_form=menu.wrapper.children(".search"),menu.country_select_btn=menu.wrapper.find(".country-selector .title"),menu.isMobile=browserWidth()<=1024,menu.levelOne=element.find(".level-one"),menu.innerMenu=$(".items").not(".mobile-row").find(".level-one").not(".hidden-desktop").find(".inner-menu"),menu.levelOneLabel=menu.levelOne.find(".mobile-label"),menu.levelTwo=menu.levelOne.find(".level-two .content"),menu.leveTwoLabel=menu.levelTwo.find(".mobile-label-two"),menu.levelThree=menu.levelTwo.find(".level-three"),menu.buyWrapper=$(".buy-wrapper"),menu.buyDropdown=$(".dropdown-container"),menu.countrySelector=$("#country-selector"),menu.countryDropdown=menu.countrySelector.find(".country"),menu.firstLevelHeights=[],function(){var innerMenu=$(".inner-menu");innerMenu.css("opacity","0"),innerMenu.css("display","block");var innerMenuHeight=0;$(".level-one").each(function(index){menu.firstLevelHeights.push($(this).find(".inner-menu").height())}),menu.levelThree.each(function(index){$(this).css("display","block"),innerMenuHeight=$(this).closest(".inner-menu").height();var leftColumnHeight=$(this).find(".column-wrapper .left").innerHeight(),spotlightColumnHeight=$(this).find(".column-wrapper .column").not(".left").innerHeight();if(!spotlightColumnHeight||0==spotlightColumnHeight){var columnWrapperWidth=$(this).find(".column-wrapper .column.left").width();$(this).find(".column-wrapper").css("width",Number(columnWrapperWidth))}var maxHeight=Math.max(innerMenuHeight,leftColumnHeight,spotlightColumnHeight);$(this).find(".column-wrapper .column").css("height",maxHeight),$(this).find(".column-wrapper").not(".left").css("height",maxHeight),$(this).css("display","")}),setTimeout(function(){innerMenu.css("display",""),innerMenu.css("opacity","1")},100)}(),menu.wireMobileMenuEvents=function(){moblieHamburgerClickEventDefined=!0,menu.button.bind("click",function(e){e.preventDefault(),e.stopPropagation(),menu.wrapper.hasClass("open")?menu.close():menu.open()}),menu.levelOne.on("click",function(event){menu.isMobile&&event.preventDefault(),console.log("level one click"),0!=$(this).hasClass("level-one")&&($(this).find(".inner-menu").addClass("show"),event.stopPropagation())}),menu.levelOneLabel.on("click",function(event){0!=$(this).hasClass("mobile-label")&&(event.stopPropagation(),$(this).closest(".inner-menu").removeClass("show"))}),menu.levelTwo.on("click",function(event){event.stopPropagation(),menu.isMobile&&0<$(this).find(".level-three").length&&event.preventDefault(),0!=$(this).hasClass("level-two-content")&&($(this).find(".level-three").hasClass("show")?$(this).find(".level-three").removeClass("show"):$(this).find(".level-three").addClass("show"))}),menu.leveTwoLabel.on("click",function(event){0!=$(this).hasClass("mobile-label-two")&&(event.preventDefault(),event.stopPropagation(),$(this).closest(".level-three").removeClass("show"))}),menu.levelThree.find(".sub-title").on("click",function(event){event.stopPropagation()}),menu.levelThree.find(".item").on("click",function(event){event.stopPropagation()})},menu.countrySelector.mouseover(function(event){event.stopPropagation(),menu.isMobile||menu.countryDropdown.css("display","block")}),menu.countrySelector.mouseout(function(event){event.stopPropagation(),menu.isMobile||menu.countryDropdown.css("display","none")}),menu.countrySelector.on("click",function(event){event.stopPropagation(),menu.isMobile&&("block"==menu.countryDropdown.css("display")?menu.countryDropdown.css("display","none"):menu.countryDropdown.css("display","block"))}),menu.isMobile&&(menu.wireMobileMenuEvents(),menu.innerMenu.removeClass("right")),menu.open=function(){menu.wrapper.animate({right:0},menu.speed).addClass("open"),menu.button.addClass("expanded")},menu.close=function(){menu.wrapper.animate({right:"-375px"},menu.speed).removeClass("open"),menu.button.removeClass("expanded")},$(window).bind("resize",function(){menu.isMobile=browserWidth()<=1024,menu.isMobile?(0==moblieHamburgerClickEventDefined&&(moblieHamburgerClickEventDefined=!0,menu.wireMobileMenuEvents()),$("#main-navigation").css("right","-375px").removeClass("open"),menu.button.removeClass("expanded"),menu.innerMenu.removeClass("right")):(menu.wrapper.find(".items").slideDown(0,function(){$(this).attr("style","")}),menu.button.removeClass("expanded"),menu.levelOne.css("display",""),element.css("right","0"),menu.innerMenu.last().addClass("right"))}),menu.buyWrapper.on("mouseover",function(){menu.buyDropdown.css("display","block")}),menu.buyWrapper.on("mouseout",function(){menu.buyDropdown.css("display","none")}),$(".level-three .column").mouseover(function(){menu.isMobile||($(this).closest(".level-three").prev().addClass("show-triangle"),$(this).closest(".level-three").prev().parent().addClass("add-hover"))}),$(".level-three .column").mouseout(function(){menu.isMobile||($(this).closest(".level-three").prev().removeClass("show-triangle"),$(this).closest(".level-three").prev().parent().removeClass("add-hover"))}),$(".level-two-title").mouseover(function(){menu.isMobile||0<$(this).next().find(".column-wrapper .column").length&&($(this).addClass("show-triangle"),$(this).parent().addClass("add-hover"),$(this).closest(".inner-menu").css("height",$(this).next().find(".column-wrapper .column").innerHeight()+2))}),$(".level-one").mouseover(function(event){if(!menu.isMobile){console.log("event class: "+event.target.className);var eventClass=event.target.className;"level-one wide"!=eventClass&&"level-one"!=eventClass&&"menu-title"!=eventClass||$(this).find(".inner-menu").css("height",menu.firstLevelHeights[$(this).index()])}}),$(".level-two-title").mouseout(function(){menu.isMobile||($(this).removeClass("show-triangle"),$(this).parent().removeClass("add-hover"))})}}}),avayaBlog.directive("modalAlert",function(){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/modal-alert.html",controller:function($scope,$element,$window,$filter){var typeAttr=$element.attr("type"),messageAttr=$element.attr("message"),msgBody=$("#message",".modal-alert");$scope.showMessage=function(){var type=$scope[typeAttr],message=$scope[messageAttr];"success"==type?msgBody.css("color","green"):"error"==type?msgBody.css("color","red"):msgBody.css("color","black"),msgBody.html(message)},$scope.alertClose=function(){$scope.closeModal()}}}}),avayaBlog.directive("multiSelectDropdown",function($rootScope,$window){return{restrict:"EAC",templateUrl:"/static/avaya/commerce-views/multi-select-dropdown.html",scope:{placeholder:"@",list:"=",mapping:"=",selected:"=",id:"@",property:"@",prefix:"@",callback:"&",callbackUrl:"@"},link:function(scope){scope.listVisible=!1,scope.isPlaceholder=!0,scope.getTooltip=function(index){if(scope.mapping){var mapping=scope.mapping[index];if(mapping)return mapping.tooltip}},scope.select=function(item){scope.isPlaceholder=!1,scope.selected="object"==typeof item?item[scope.property]:item},scope.applyFilters=function(){var categoryList="";_.each(scope.list,function(item){1==item.selected&&(categoryList=categoryList+item[scope.id||scope.property]+"|")}),scope.callback({category:categoryList}),scope.show()},scope.clearFilters=function(){_.each(scope.list,function(item){item.selected=!1})},scope.getDisplayText=function(item){return"object"==typeof item?item[scope.property]:item},scope.isSelected=function(item){return item===scope.selected},scope.show=function(){scope.listVisible=!scope.listVisible},scope.$watch("selected",function(value){scope.isPlaceholder=void 0===scope.selected,scope.display=scope.selected,scope.listVisible=!1})}}}),avayaBlog.filter("objectToArray",function(){return function(input){var output=[];for(i in input)output.push(input[i]);return output}}),avayaBlog.directive("oceanaSectionText",function($rootScope){return{restrict:"A",scope:{text:"=",video:"=",title:"="},template:'<span ng-bind-html="text"></span><a ng-if="video" kaltura-modal video="{{video}}" title="{{title}}" language="en" target="_self"><i class="fa fa-info-circle"></i></a>',link:function(scope,element){}}}),avayaBlog.directive("pagination",function(){return{restrict:"E",templateUrl:"/static/avaya/commerce-views/pagination.html",replace:!0,scope:{currentPage:"=",offset:"=",pageLimit:"=",total:"="},link:function(scope,element,attrs){scope.totalPages=function(){if(0<scope.total)return Math.ceil(scope.total/parseInt(scope.pageLimit))},scope.prevNext=function(type){"prev"==type&&1!=scope.currentPage?scope.currentPage-=1:"next"==type&&scope.currentPage!=scope.totalPages()&&(scope.currentPage+=1),scope.offset=(scope.currentPage-1)*scope.pageLimit},scope.$watch("currentPage + pageLimit + total",function(){0<scope.total&&scope.currentPage>scope.totalPages()&&(scope.currentPage=scope.totalPages())})}}}),avayaBlog.filter("phoneNumberFormatting",function(){return function(tel){if(!tel)return"";var country,city,number,value=tel.toString().trim().replace(/^\+/,"");if(value.match(/[^0-9]/))return tel;switch(value.length){case 10:country=1,city=value.slice(0,3),number=value.slice(3);break;case 11:country=value[0],city=value.slice(1,4),number=value.slice(4);break;case 12:country=value.slice(0,3),city=value.slice(3,5),number=value.slice(5);break;default:return tel}return 1==country&&(country=""),(country+" ("+city+") "+(number=number.slice(0,3)+"-"+number.slice(3))).trim()}}),avayaBlog.directive("preBoarding",function($resource,preBoardingService){return{link:function($scope,element,attrs,ctrl){$scope.contentList=[],$scope.breakoutId=0,$scope.applyFilters=function(categoryList,showAll){var sectionList=[];showAll=!categoryList,_.each($scope.newHireData.sections,function(section){(1==showAll||-1<categoryList.indexOf(section.id))&&sectionList.push(section)}),$scope.sectionList=sectionList},$scope.rooms="pre-boarding"==attrs.type?preBoardingService.getRoomsData().result.rooms:preBoardingService.getAcademyData().result.rooms,$scope.newHireData=$scope.rooms[0],$scope.applyFilters(null,!0),$scope.showBreakoutsContent=function(breakout){var contentList=[];_.each(breakout.contentMenu.categories,function(category){_.each(category.contents,function(contentIdList){var item=_.find($scope.content,function(content){return contentIdList.contentId==content.id});item&&contentList.push(item)})}),$scope.breakoutId=breakout.id,$scope.contentList=contentList}}}}),avayaBlog.directive("productSlider",function(){return{restrict:"A",link:function($scope,$element){var carouselList=$element.find(".carousel-list"),windowWidth=0,controls=$element.find(".carousel-controls");$element.find(".slide .box");windowWidth=$(window).width()<1170?$(window).width()-120:1050,controls.css("width",windowWidth);var slideWidth=.33*windowWidth,leftOffset=slideWidth,blurOffset=5;$scope.slideRight=function(){indent=-1*(slideWidth+leftOffset),carouselList.find("li:nth-of-type("+blurOffset+")").removeClass("blur"),carouselList.animate({left:indent},100,"linear",function(){carouselList.find("li:last").after(carouselList.find("li:first")),carouselList.find("li").each(function(){$(this).removeClass("blur")}),carouselList.find("li:nth-of-type("+blurOffset+")").addClass("blur"),carouselList.find("li:first").addClass("blur"),carouselList.css("left","-"+String(leftOffset)+"px")})},$scope.slideLeft=function(){indent=slideWidth-leftOffset,carouselList.find("li:first").removeClass("blur"),carouselList.animate({left:indent},100,"linear",function(){carouselList.find("li:first").before(carouselList.find("li:last")),carouselList.find("li").each(function(){$(this).removeClass("blur")}),carouselList.find("li:first").addClass("blur"),carouselList.find("li:nth-of-type("+blurOffset+")").addClass("blur"),carouselList.css("left","-"+String(leftOffset)+"px")})},setTimeout(function(){$(window).width()<1170?(windowWidth=$(window).width()-120,controls.css("width",$(window).width())):(windowWidth=1050,controls.css("width",1170)),blurOffset=Number(windowWidth)<620?(leftOffset=20+(slideWidth=1*windowWidth),3):Number(windowWidth)<960?(leftOffset=20+(slideWidth=.5*windowWidth),4):(leftOffset=20+(slideWidth=.33*windowWidth),5),carouselList.find("li").css("max-width",slideWidth+"px"),carouselList.find("li .content-container").css("width",slideWidth+"px"),carouselList.find("li:first").before(carouselList.find("li:last")),carouselList.find("li:first").addClass("blur"),carouselList.find("li:nth-of-type("+blurOffset+")").addClass("blur"),carouselList.css("left","-"+String(leftOffset)+"px")},500),$(window).resize(function(){$(window).width()<1170?(windowWidth=$(window).width()-120,controls.css("width",$(window).width())):(windowWidth=1050,controls.css("width",1170)),blurOffset=Number(windowWidth)<620?(leftOffset=20+(slideWidth=1*windowWidth),carouselList.css("left","-"+String(leftOffset)+"px"),carouselList.find("li").css("max-width",slideWidth+"px"),carouselList.find("li .content-container").css("width",slideWidth+"px"),carouselList.find("li:nth-of-type("+blurOffset+")").removeClass("blur"),3):Number(windowWidth)<960?(leftOffset=20+(slideWidth=.5*windowWidth),carouselList.css("left","-"+String(leftOffset)+"px"),carouselList.find("li").css("max-width",slideWidth+"px"),carouselList.find("li .content-container").css("width",slideWidth+"px"),carouselList.find("li:nth-of-type("+blurOffset+")").removeClass("blur"),4):(leftOffset=20+(slideWidth=.33*windowWidth),carouselList.css("left","-"+String(leftOffset)+"px"),carouselList.find("li").css("max-width",slideWidth+"px"),carouselList.find("li .content-container").css("width",slideWidth+"px"),carouselList.find("li:nth-of-type("+blurOffset+")").removeClass("blur"),5),carouselList.find("li:nth-of-type("+blurOffset+")").addClass("blur")})}}}),avayaBlog.directive("purchaseOrder",function(purchaseOrderService,$filter){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/purchase-order.html",link:function(scope,element){scope.selectedPO={},scope.poFileValid=!1,scope.formValid=!1,scope.editFormValid=!1,scope.POSelected={},scope.showPODropdown=!1,scope.poNumberRegex=/^[a-zA-Z0-9-/]{1,15}$/,scope.poNameRegex=/^[ A-Za-z0-9()[\]+*#-/]{1,100}$/,scope.poAmtRegex=/^[0-9.]*$/,scope.poDateRegex=/^(([1-9]|1[012])[-/.]([1-9]|[12][0-9]|3[01])[-/.](19|20)\d\d)|((1[012]|0[1-9])(3[01]|2\d|1\d|0[1-9])(19|20)\d\d)|((1[012]|0[1-9])[-/.](3[01]|2\d|1\d|0[1-9])[-/.](19|20)\d\d)$/,scope.showAlertMsg=!1,scope.getPO=function(){scope.POSelected={},purchaseOrderService.get().then(function(response){scope.purchaseOrder=response},function(error){console.log("error fetchng PO data in checkout")})},scope.routeController&&scope.routeController.parentViewId?scope.showPODropdown=!1:(scope.showPODropdown=!0,scope.getPO()),scope.closePOModal=function(){scope.closeModal(),scope.clearData()},scope.updatePOFields=function(){scope.setSelectedPo(scope.POSelected),scope.closePOModal()},scope.savePO=function(){var poFormData=new FormData;poFormData.append("pofile",null!=scope.selectedPO.poFormData?scope.selectedPO.poFormData:""),poFormData.append("poNumber",null!=scope.selectedPO.PONumber?scope.selectedPO.PONumber:""),poFormData.append("poAmount",null!=scope.selectedPO.POAmount?scope.selectedPO.POAmount:""),poFormData.append("poExpiration",null!=scope.selectedPO.POExpiration?scope.selectedPO.POExpiration:""),poFormData.append("poDate",null!=scope.selectedPO.PODate?scope.selectedPO.PODate:""),poFormData.append("poName",null!=scope.selectedPO.POName?scope.selectedPO.POName:""),poFormData.append("poURL",null!=scope.selectedPO.POURL?scope.selectedPO.POURL:""),poFormData.append("poDocId",null!=scope.selectedPO.PODocID?scope.selectedPO.PODocID:""),poFormData.append("PayerNo",null!=scope.selectedPO.PayerNo?scope.selectedPO.PayerNo:""),scope.savePODetails(poFormData,scope.selectedPO)},scope.editPO=function(){var poFormData=new FormData;poFormData.append("poNumber",scope.selectedPO.PONumber),poFormData.append("poAmount",scope.selectedPO.POAmount),poFormData.append("poExpiration",scope.selectedPO.POExpiration),poFormData.append("poDate",scope.selectedPO.PODate),poFormData.append("poName",scope.selectedPO.POName),poFormData.append("poURL",scope.selectedPO.POURL),poFormData.append("poDocId",scope.selectedPO.PODocID),poFormData.append("PayerNo",scope.selectedPO.PayerNo),scope.editPODetails(poFormData)},scope.deletePO=function(){var poFormData=new FormData;poFormData.append("poNumber",scope.selectedPO.PONumber),poFormData.append("poAmount",scope.selectedPO.POAmount),poFormData.append("poExpiration",scope.selectedPO.POExpiration),poFormData.append("poDate",scope.selectedPO.PODate),poFormData.append("poName",scope.selectedPO.POName),poFormData.append("poURL",scope.selectedPO.POURL),poFormData.append("poDocId",scope.selectedPO.PODocID),poFormData.append("PayerNo",scope.selectedPO.PayerNo),purchaseOrderService.deletePO(poFormData).then(function(response){"success"==JSON.parse(response.data).status&&$scope.getPOData(),$scope.hideLoader()},function(error){$scope.hideLoader()})},scope.validatePOFields=function(){scope.selectedPO&&scope.selectedPO.POName&&scope.selectedPO.PONumber&&scope.poFileValid&&0==scope.showAlertMsg?scope.formValid=!0:scope.formValid=!1},scope.chkAmount=function(){var cartAmt=scope.cart[0].quoteSummary[scope.cart[0].solutionId].subscription.total+scope.cart[0].quoteSummary[scope.cart[0].solutionId].oneTime.total+scope.tollFreeAmt;scope.selectedPO.POAmount<cartAmt?scope.showAlertMsg=!0:scope.showAlertMsg=!1},scope.validateEditPOFields=function(){scope.selectedPO.POName?scope.editFormValid=!0:scope.editFormValid=!1},scope.cancelPO=function(){scope.closePOModal()},scope.clearData=function(){scope.editPo=!1,scope.selectedPO={},scope.POSelected={},scope.fileName="No file chosen",scope.poFileValid=!1,scope.uploadName=null,scope.formValid=!1,scope.getPO()},scope.fileName="No file chosen",scope.formats&&(formatList=scope.formats.split(",")),element.find(".upload").bind("change",function(){var files=this.files[0];scope.selectedPO.poFormData=files,scope.$apply(function(){if(element.find(".upload")[0].files){var fileExtension=files.name.split(".").pop();scope.fileName="pdf"==fileExtension?(scope.poFileValid=!0,files.name):(scope.poFileValid=!1,scope.POSelected&&(scope.poFileValid=!0),"Invalid file extension"),scope.validatePOFields()}}),scope.validatePOFields()})}}}),avayaBlog.directive("rateplanModal",function(){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/rateplan-modal.html",replace:!0,link:function(scope,element){scope.showRatePlanTable=function(item){scope.productInfo=item.pricing}}}}),avayaBlog.directive("reelSlider",function(){return{restrict:"EAC",templateUrl:"/static/avaya/commerce-views/reel-slider.html",scope:{articleList:"="},link:function(scope,$element){var articleListWatch=scope.$watch("articleList",function(){scope.articleList&&(setTimeout(function(){if(windowWidth=$element.width(),Number(windowWidth)<481){leftOffset=.72*(slideWidth=.6*windowWidth),blurOffset=3,carouselList.find("li").css("width",slideWidth+"px"),carouselList.find("li .content-container").css("width",slideWidth+"px");var currentSlide=carouselList.find("li:first");currentSlide.before(carouselList.find("li:last")),carouselList.find("li:first").addClass("blur"),carouselList.find("li:nth-of-type("+blurOffset+")").addClass("blur"),carouselList.css("left","-"+String(leftOffset)+"px")}else if(Number(windowWidth)<700){leftOffset=.85*(slideWidth=.4*windowWidth),blurOffset=4,carouselList.find("li").css("width",slideWidth+"px"),carouselList.find("li .content-container").css("width",slideWidth+"px");var currentSlide=carouselList.find("li:first");currentSlide.before(carouselList.find("li:last")),carouselList.find("li:first").addClass("blur"),carouselList.find("li:nth-of-type("+blurOffset+")").addClass("blur"),carouselList.css("left","-"+String(leftOffset)+"px")}else{leftOffset=.78*(slideWidth=.28*windowWidth),blurOffset=5,carouselList.find("li").css("width",slideWidth+"px"),carouselList.find("li .content-container").css("width",slideWidth+"px");var currentSlide=carouselList.find("li:first");currentSlide.before(carouselList.find("li:last")),carouselList.find("li:first").addClass("blur"),carouselList.find("li:nth-of-type("+blurOffset+")").addClass("blur"),carouselList.css("left","-"+String(leftOffset)+"px")}},500),$(window).resize(function(){windowWidth=$element.width(),blurOffset=Number(windowWidth)<481?(leftOffset=.72*(slideWidth=.6*windowWidth),carouselList.css("left","-"+String(.8*slideWidth)+"px"),carouselList.find("li").css("width",slideWidth+"px"),carouselList.find("li .content-container").css("width",slideWidth+"px"),carouselList.find("li:nth-of-type("+blurOffset+")").removeClass("blur"),3):Number(windowWidth)<700?(leftOffset=.85*(slideWidth=.4*windowWidth),carouselList.css("left","-"+String(.8*slideWidth)+"px"),carouselList.find("li").css("width",slideWidth+"px"),carouselList.find("li .content-container").css("width",slideWidth+"px"),carouselList.find("li:nth-of-type("+blurOffset+")").removeClass("blur"),4):(leftOffset=.82*(slideWidth=.28*windowWidth),carouselList.css("left","-"+String(.8*slideWidth)+"px"),carouselList.find("li").css("width",slideWidth+"px"),carouselList.find("li .content-container").css("width",slideWidth+"px"),carouselList.find("li:nth-of-type("+blurOffset+")").removeClass("blur"),5),carouselList.find("li:nth-of-type("+blurOffset+")").addClass("blur")}),articleListWatch())}),carouselList=$element.find(".carousel-list"),windowWidth=$element.width(),slideWidth=.28*windowWidth,leftOffset=.65*slideWidth,blurOffset=5;scope.slideRight=function(){indent=-1*(slideWidth+leftOffset),carouselList.find("li:nth-of-type("+blurOffset+")").removeClass("blur"),carouselList.animate({left:indent},333,"linear",function(){carouselList.find("li:last").after(carouselList.find("li:first")),carouselList.find("li").each(function(){$(this).removeClass("blur")}),carouselList.find("li:nth-of-type("+blurOffset+")").addClass("blur"),carouselList.find("li:first").addClass("blur"),carouselList.css("left","-"+String(leftOffset)+"px")})},scope.slideLeft=function(){indent=slideWidth-leftOffset,carouselList.find("li:first").removeClass("blur"),carouselList.animate({left:indent},333,"linear",function(){carouselList.find("li:first").before(carouselList.find("li:last")),carouselList.find("li").each(function(){$(this).removeClass("blur")}),carouselList.find("li:first").addClass("blur"),carouselList.find("li:nth-of-type("+blurOffset+")").addClass("blur"),carouselList.css("left","-"+String(leftOffset)+"px")})}}}}),avayaBlog.directive("removeBundle",function(cpaasService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/remove-bundle-modal.html",link:function(scope,element){scope.closeBundleRemoveDialog=function(){scope.closeModal()},scope.removeBundle=function(){alert("remove bundle")}}}}),avayaBlog.directive("scrollToTop",function($window,$location){return{link:function($scope,element,attrs){angular.element($window).bind("scroll",function(){900<=this.pageYOffset?$scope.cssClass=!0:$scope.cssClass=!1,$scope.$apply()}),$scope.gotoElement=function(eID){return null!=eID&&($location.hash(eID),function scrollTo(eID){if(1==App.isIe10||1==App.isIe11)return void window.scrollTo(0,0);var startY=currentYPosition();var stopY=elmYPosition(eID);var distance=startY<stopY?stopY-startY:startY-stopY;if(distance<100)return void scrollTo(0,stopY);var speed=Math.round(distance/100);20<=speed&&(speed=20);var step=Math.round(distance/25);var leapY=startY<stopY?startY+step:startY-step;var timer=0;if(startY<stopY){for(var i=startY;i<stopY;i+=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),stopY<(leapY+=step)&&(leapY=stopY),timer++;return}for(var i=startY;stopY<i;i-=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),(leapY-=step)<stopY&&(leapY=stopY),timer++;function currentYPosition(){return self.pageYOffset?self.pageYOffset:document.body.scrollTop?document.body.scrollTop:0}function elmYPosition(eID){if(null==eID)return!1;for(var elm=document.getElementById(eID),y=null!=elm?elm.offsetTop:"",node=elm;node.offsetParent&&node.offsetParent!=document.body;)node=node.offsetParent,y+=node.offsetTop;return y}}(eID),!0)}}}}),avayaBlog.directive("selectPhoneNumber",function(phoneNumberService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/select-phone-number.html",replace:!0,controller:function($scope,$element,$attrs){$scope.validFileUpload=!1,$scope.phoneTab="1",$scope.numberType="transfer",$scope.phoneRegex=/^((\+1)?[\s-]?)?\(?[1-9]\d\d\)?[\s-]?[0-9]\d\d[\s-]?\d\d\d\d/,$scope.isFreeTrialQuote&&($scope.phoneTab="3"),$scope.isCheckout&&$scope.isTollFree&&($scope.phoneTab="2"),$scope.clearSelectPhoneData=function(){$scope.phoneNumbers=[],$scope.localPhoneNumbers=[],$scope.selectedNumber={},$scope.enableSelect=!1,$scope.Prefix="",$scope.transferPhoneNumber={},$scope.validFileUpload=!1,$scope.fileName="No file chosen",$scope.uploadName=null},$scope.clearSelectPhoneData(),$scope.changePhoneTab=function(tab){$scope.phoneTab=tab,$scope.clearSelectPhoneData()},$scope.searchPhoneNumbers=function(prefix){prefix?($scope.selectedNumber="",$scope.enableSelect=!1,$scope.showLoader(),phoneNumberService.get(prefix).then(function(response){$scope.phoneNumbers=response.available_phone_numbers,$scope.hideLoader()},function(error){$scope.hideLoader(),console.log("error fetchng data on search",error)})):($scope.phoneNumbers=[],$scope.enableSelect=!1)},$scope.searchLocalPhoneNumbers=function(prefix){$scope.selectedNumber="",$scope.enableSelect=!1,$scope.phoneNumberMessage="",prefix&&3==prefix.length?($scope.showLoader(),phoneNumberService.getNumber(prefix).then(function(response){$scope.localPhoneNumbers=response.available_phone_numbers,"failed"==response.status?($scope.phoneNumberMessage="Local phone numbers not available for your search criteria. Request to search with a different criteria.",$scope.hideLoader()):$scope.phoneNumberMessage="",$scope.hideLoader()},function(error){$scope.hideLoader(),console.log("error fetchng data on search",error)})):($scope.phoneNumbers=[],$scope.enableSelect=!1)},$scope.selectNumber=function(selectedPhoneNumber){$scope.selectedNumber=selectedPhoneNumber,$scope.enableSelect=!0},$scope.selectPhoneNumber=function(){$scope.selectedPhoneNumber="1"!=$scope.phoneTab?$scope.selectedNumber:$scope.transferPhoneNumber,$scope.showPhoneNumber=!0,"1"==$scope.phoneTab?$scope.numberType="transfer":"2"==$scope.phoneTab?$scope.numberType="tollfree":"3"==$scope.phoneTab&&($scope.numberType="local"),$scope.callBackSelectedPhoneNumber($scope.selectedPhoneNumber,$scope.numberType,$scope.showPhoneNumber),$scope.closeModal()},$scope.allowOnlyNumbers=function(e,allowPlus){if(8!=e.which&&0!=e.which&&(e.which<48||57<e.which)&&(43!=e.which||!allowPlus))return e.preventDefault(),!1},$scope.fileName="No file chosen",$scope.formats&&(formatList=scope.formats.split(",")),$element.find(".upload").bind("change",function(){var files=this.files[0];$scope.transferPhoneNumber.phoneFileData=files,$scope.$apply(function(){if($element.find(".upload")[0].files){var fileExtension=files.name.split(".").pop();$scope.fileName="pdf"==fileExtension?($scope.validFileUpload=!0,files.name):($scope.validFileUpload=!1,"Invalid file extension")}})}),$scope.savePhoneData=function(){$scope.showPhoneNumber=!0,$scope.transferPhoneNumber.phone_number="+1"+$scope.transferPhoneNumber.phone_number,$scope.selectedPhoneNumber=$scope.transferPhoneNumber,"1"==$scope.phoneTab?$scope.numberType="transfer":"2"==$scope.phoneTab?$scope.numberType="tollfree":"3"==$scope.phoneTab&&($scope.numberType="local"),$scope.callBackSelectedPhoneNumber($scope.selectedPhoneNumber,$scope.numberType,$scope.showPhoneNumber),$scope.closeModal()},$scope.enableBtn=function(){return!!($scope.transferPhoneNumber.phone_number&&10<=$scope.transferPhoneNumber.phone_number.length)},$scope.redirectLNP=function(){window.open(getLNPPdf(),"_blank")},$scope.redirectRODAA=function(){window.open(getRODAAPdf(),"_blank")}}}}),avayaBlog.directive("sendToCustomer",function(customerSearchService,serviceBase,cartService,checkDirectService,$q,commerceService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/send-to-customer.html",replace:!0,controller:function($scope,$element,$filter){$scope.selectedSoldTo="",$scope.customers=[],$scope.customersBackUp=[],$scope.selectedCustomer={},$scope.sendToCustomer={},$scope.current=1,$scope.soldToId="",$scope.customerIsValid=!0,$scope.showEmailForm=!1,$scope.showEmailSentMsg=!1,$scope.showcustomerSearchModal=!1,$scope.customerEmailDetails={},$scope.showCreateCustomer=!0,$scope.showCreateCustomerForm=!1;var scModalBackdrop=$(".commerce-modal-backdrop");$scope.createUser={},$scope.addressLine1Regex=/^[ A-Za-z0-9()[\]+*#-/]{3,100}$/,$scope.alphabetRegex=/^[a-zA-Z .]{1,50}$/,$scope.nameRegex=/^([a-z0-9A-Z_ %!,:&\-\'\.*+\[\]\{\}\(\)@#]+){2,30}$/,$scope.stateRegex=/^[a-zA-Z .]{2,3}$/,$scope.zipCodeUSRegex=/^\d{5}(?:[-\s]\d{4})?/,$scope.zipCodeCARegex=/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,$scope.numberRegex=/^[0-9]*$/,$scope.companyName=/^[a-zA-Z0-9 ._+-,-]{1,50}$/,$scope.phoneRegex=/^((\+1)?[\s-]?)?\(?[1-9]\d\d\)?[\s-]?[0-9]\d\d[\s-]?\d\d\d\d/,$scope.emailRegex=/^(?!.*\.{2})[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,5}$/,$scope.passwordRegex=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d$@$!%*?&_]{8,15}$/,$scope.password2=/[^<>]{8,30}$/,$scope.securityAnswer=/^[^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{3,30}$/,$scope.disableInput=!1,$scope.selectedCountry={};var invalidAdrsMessage=$(".warning-message"),infoMsg=$(".info-msg");$scope.getCustomerZipPattern=function(){if($scope.sendToCustomer)return"CA"==$scope.sendToCustomer.country?$scope.zipCodeCARegex:$scope.zipCodeUSRegex},$scope.showLoader=function(){$(".page-level-loader").addClass("show-loader")},$scope.hideLoader=function(){$(".page-level-loader").removeClass("show-loader")},$scope.showModalsOnRole=function(){$scope.routeController&&$scope.routeController.parentViewId?($scope.showEmailForm=!0,$scope.showcustomerSearchModal=!1,$scope.customerEmailDetails.emailAddress=$scope.customerEmail):($scope.showEmailForm=!0,$scope.showcustomerSearchModal=!1,!$scope.customerEmailId||"Master Agent"!=$scope.userTypes.usertype&&"Agent"!=$scope.userTypes.usertype||($scope.customerEmailDetails.emailAddress=$scope.customerEmailId,$scope.showCreateCustomer=!1,$scope.disableInput=!0),$scope.agentEmailId&&"Customer"==$scope.userTypes.usertype&&($scope.customerEmailDetails.emailAddress=$scope.agentEmailId,$scope.showCreateCustomer=!1,$scope.disableInput=!0))},$scope.showModalsOnRole(),$scope.createCustomer=function(sendToCustomer){var payload={zip:sendToCustomer.zip,state:sendToCustomer.state,addressLine2:sendToCustomer.addressLine2,addressLine1:sendToCustomer.addressLine1,country:sendToCustomer.country,city:sendToCustomer.city,name:sendToCustomer.name};return createEndCustomer(getCreateEndCustomerApi(),payload).then(function(response){$scope.hideLoader(),$scope.current=null!=response?($scope.customers=[{soldTo:response.data.soldTo,zip:payload.zip,state:payload.state,addressLine2:payload.addressLine2,addressLine1:payload.addressLine1,country:payload.country,city:payload.city,name:payload.name}],2):1},function(error){console.log("Error creating New Address",error),$scope.hideLoader()})};var createEndCustomer=function(url,payload){var deferred=$q.defer();return $scope.showLoader(),serviceBase.postData(url,payload).then(function(response){deferred.resolve(response)},function(error){deferred.reject(error)}),deferred.promise};$scope.scModalClose=function(){$scope.selectedSoldTo="",$scope.customers=[],$scope.customersBackUp=[],$scope.selectedCustomer={},$scope.sendToCustomer={},$scope.customerEmailDetails={},$scope.showCreateCustomerForm=!1,$scope.showCreateCustomer=!0,$scope.current=1,$scope.statusMsg="",$scope.createUser={},$scope.closeModal(),$scope.clearcustomers()},$scope.clearcustomers=function(){$scope.sendToCustomer={},$scope.customers=[],$scope.closeModal()},$scope.scEmailModalClose=function(){$scope.routeController&&$scope.routeController.parentViewId||$scope.callbackReadCart(),$scope.selectedSoldTo="",$scope.customers=[],$scope.customersBackUp=[],$scope.selectedCustomer={},$scope.sendToCustomer={},$scope.current=1,$scope.closeModal()},scModalBackdrop.on("click",function(event){$scope.scEmailModalClose(),$scope.scModalClose(),event.preventDefault(),event.stopPropagation()}),$scope.searchCustomers=function(isValid){$scope.showLoader(),$scope.customerSearchError=!1;var soldToId=null!=$scope.sendToCustomer.SoldTo&&$scope.sendToCustomer.SoldTo.trim();if(soldToId)customerSearchService.getCustomerBySoldToId(soldToId).then(function(response){$element.find(".active-header").addClass("teal-header"),$scope.customers=response,0<$scope.customers.length?($scope.customerSearchError=!1,$scope.current=2):$scope.customerSearchError=!0,$scope.hideLoader()},function(error){console.log("Error in API fetching data",error),$scope.hideLoader()});else if(isValid){var address=$scope.sendToCustomer;address.country="US",customerSearchService.getCustomerByAddress(address).then(function(response){null!=response.addressList&&null!=response.addressList&&""!=response.addressList?($scope.customers=response.addressList,$scope.current=2,$scope.customerIsValid=!0):$scope.customerIsValid=!1,$scope.hideLoader()},function(error){console.log("Error in API fetching data",error),$scope.hideLoader()})}},$scope.openEmail=function(){$scope.showcustomerSearchModal=!1,$scope.showEmailForm=!0},$scope.searchContinue=function(){$element.find(".active-header").addClass("teal-header"),$scope.current=3,1==$scope.customers.length?$scope.selectedCustomer=$scope.customers[0]:$scope.selectedCustomer=$filter("filter")($scope.customers,{selected:!0},!0)[0]},$scope.conditionalRequired=function(){return!!($scope.sendToCustomer.name||$scope.sendToCustomer.addressLine1||$scope.sendToCustomer.addressLine2||$scope.sendToCustomer.city||$scope.sendToCustomer.state||$scope.sendToCustomer.zip)},$scope.back=function(){$scope.customers=[],$scope.sendToCustomer={},$scope.current=1},$scope.cancel=function(){$scope.current=2},$scope.selectCustomer=function(selectedCustomer){return _.each($scope.customers,function(c){c.selected=!1}),selectedCustomer.selected=!0,selectedCustomer},$scope.updateQuote=function(){$scope.showLoader();var solutionId=$scope.selectedSolutionId,filteredCartObjects=$scope.cartItems.filter(function(cartObj){return cartObj.solutionId===solutionId});if(filteredCartObjects&&0<filteredCartObjects.length){var cartItems=filteredCartObjects.pop().shoppingCartItems,newCartItems=[];cartItems.forEach(function(item){newCartItems.push({qty:Number(item.quantity),billingCycle:item.billingCycle,term:item.term})});var payload={solutionid:solutionId,soldToInfo:{soldTo:$scope.selectedCustomer.soldTo,soldToName:$scope.selectedCustomer.name,address:{addressLine1:$scope.selectedCustomer.addressLine1,addressLine2:$scope.selectedCustomer.addressLine2,state:$scope.selectedCustomer.state,city:$scope.selectedCustomer.city,zip:$scope.selectedCustomer.zip,country:$scope.selectedCustomer.country,name:$scope.selectedCustomer.name,region:$scope.selectedCustomer.country}}};return sendUpdateQuote(getUpdateQuoteApi(),payload)}};var sendUpdateQuote=function(url,payload){var deferred=$q.defer();return serviceBase.postData(url,payload).then(function(response){$scope.showcustomerSearchModal=!1,$scope.showEmailForm=!0,$scope.hideLoader()},function(error){deferred.reject(error),$scope.showEmailForm=!1,$scope.hideLoader()}),deferred.promise};$scope.clearEmailData=function(){$scope.customerEmailDetails={},$scope.createUser={},!$scope.customerEmailId||"Master Agent"!=$scope.userTypes.usertype&&"Agent"!=$scope.userTypes.usertype||($scope.customerEmailDetails.emailAddress=$scope.customerEmailId),$scope.agentEmailId&&"Customer"==$scope.userTypes.usertype&&($scope.customerEmailDetails.emailAddress=$scope.agentEmailId)},$scope.sendEmailToCustomer=function(customerEmailDetails){var solutionId="",emailPayload={solutionid:solutionId=$scope.routeController&&$scope.routeController.parentViewId?$scope.resendSolutionId:$scope.selectedSolutionId,emailBody:customerEmailDetails.emailContent,emailId:customerEmailDetails.emailAddress};if($scope.showLoader(),$scope.agentEmailId&&"Customer"==$scope.userTypes.usertype)return $scope.assignCartToAgent(emailPayload);if($scope.routeController&&$scope.routeController.parentViewId||$scope.showCreateCustomer||$scope.customerEmailId)return sendEmailDetails(sendEmailApi(),emailPayload);$scope.createUser.stcaddress1=$scope.createUser.stcaddress1.replace(/[^A-Z0-9.,]+/gi," "),$scope.createUser.stcaddress2=$scope.createUser.stcaddress2?$scope.createUser.stcaddress2.replace(/[^A-Z0-9.,]+/gi," "):"";var addressPayload="<AddressValidateRequest USERID='073AVAYA7582'><Address ID='0'><Address1>"+$scope.createUser.stcaddress1+"</Address1><Address2>"+$scope.createUser.stcaddress2+"</Address2><City>"+$scope.createUser.stccity+"</City><State>"+$scope.createUser.stcstate+"</State><Zip5>"+$scope.createUser.stczip+"</Zip5><Zip4></Zip4></Address></AddressValidateRequest>";if("US"==$scope.selectedCountry.country.code2)serviceBase.postData("https://secure.shippingapis.com/ShippingAPI.dll?API=verify&XML="+addressPayload).then(function(response){var addressSuggestionXML=$(response.data).find("ReturnText").text(),addressErrorXML=$(response.data).find("Description").text();if(console.log("addressSuggestionXML",addressSuggestionXML),infoMsg.removeClass("show"),invalidAdrsMessage.removeClass("show"),addressSuggestionXML)return $(window).scrollTop(0),infoMsg.addClass("show"),invalidAdrsMessage.removeClass("show"),void $scope.hideLoader();if(addressErrorXML)return $(window).scrollTop(0),invalidAdrsMessage.addClass("show"),infoMsg.removeClass("show"),void $scope.hideLoader();infoMsg.removeClass("show"),invalidAdrsMessage.removeClass("show"),$scope.createUser.stccity=$(response.data).find("City").text(),$scope.createUser.stcstate=$(response.data).find("State").text();var createUserPayload={iamUserReqObj:{Firstname:$scope.createUser.stcfname,Lastname:$scope.createUser.stclname,Emailid:customerEmailDetails.emailAddress,Company:$scope.createUser.stccompany,Title:$scope.createUser.stctitle,State:$scope.createUser.stcstate,City:$scope.createUser.stccity,Addressline1:$scope.createUser.stcaddress1?$scope.createUser.stcaddress1:"",Addressline2:$scope.createUser.stcaddress2?$scope.createUser.stcaddress2:"",Zip_Code:$scope.createUser.stczip,Work_Phone:$scope.createUser.stcphone?$scope.createUser.stcphone:"",CODE_ABBR_2:$scope.selectedCountry.country.code2,User_Type:"Customer",GovtAccount:$scope.createUser.stcgovtaccount,FederalTaxId:$scope.createUser.stcfederal?$scope.createUser.stcfederal:"",StateTaxId:$scope.createUser.stcstateid?$scope.createUser.stcstateid:""},solutionid:solutionId,emailBody:customerEmailDetails.emailContent},url=createUserAgent();serviceBase.postData(url,createUserPayload).then(function(response){1==response.data.Status?($(window).scrollTop(0),$scope.statusMsg="",$scope.showcustomerSearchModal=!1,$scope.showEmailForm=!1,$scope.showEmailSentMsg=!0,$scope.hideLoader()):0==response.data.Status&&($(window).scrollTop(0),$scope.statusMsg=response.data.StatusMsg,$scope.hideLoader())},function(error){$scope.hideLoader(!0,error.message)})},function(error){});else{var createUserPayload={iamUserReqObj:{Firstname:$scope.createUser.stcfname,Lastname:$scope.createUser.stclname,Emailid:customerEmailDetails.emailAddress,Company:$scope.createUser.stccompany,State:$scope.createUser.stcstate.code,City:$scope.createUser.stccity,Title:$scope.createUser.stctitle,Addressline1:$scope.createUser.stcaddress1?$scope.createUser.stcaddress1:"",Addressline2:$scope.createUser.stcaddress2?$scope.createUser.stcaddress2:"",Zip_Code:$scope.createUser.stczip,Work_Phone:$scope.createUser.stcphone?$scope.createUser.stcphone:"",CODE_ABBR_2:$scope.selectedCountry.country.code2,User_Type:"Customer",GovtAccount:$scope.createUser.stcgovtaccount,FederalTaxId:$scope.createUser.stcfederal?$scope.createUser.stcfederal:"",StateTaxId:$scope.createUser.stcstateid?$scope.createUser.stcstateid:""},solutionid:solutionId,emailBody:customerEmailDetails.emailContent},url=createUserAgent();serviceBase.postData(url,createUserPayload).then(function(response){1==response.data.Status?($(window).scrollTop(0),$scope.statusMsg="",$scope.showcustomerSearchModal=!1,$scope.showEmailForm=!1,$scope.showEmailSentMsg=!0,$scope.hideLoader()):0==response.data.Status&&($(window).scrollTop(0),$scope.statusMsg=response.data.StatusMsg,$scope.hideLoader())},function(error){$scope.hideLoader(!0,error.message)})}};var sendEmailDetails=function(url,payload){var deferred=$q.defer();return serviceBase.postData(url,payload).then(function(response){$scope.hideLoader(),$(window).scrollTop(0),$scope.showcustomerSearchModal=!1,$scope.showEmailForm=!1,$scope.showEmailSentMsg=!0},function(error){deferred.reject(error),$(window).scrollTop(0),$scope.showEmailSentMsg=!1,$scope.hideLoader()}),deferred.promise};$scope.assignCartToAgent=function(payload){$scope.showLoader(),checkDirectService.assignCartBackToAgent(payload).then(function(response){"success"==response.status?($scope.showcustomerSearchModal=!1,$scope.showEmailForm=!1,$scope.showEmailSentMsg=!0,$scope.hideLoader()):"failed"==response.status&&($scope.hideLoader(),$scope.statusMsg=response.statusMsg)})},$scope.getCountriesList=function(){commerceService.getCountries().then(function(response){$scope.countriesList=[],1==$scope.userTypes.salesAreas.length?(response.forEach(function(item){item.country.code2==$scope.userTypes.salesAreas[0].country&&$scope.countriesList.push(item)}),$scope.setCountry($scope.countriesList[0])):$scope.countriesList=response})},$scope.setCountry=function(country){$scope.selectedCountry=country},$scope.getZipPattern=function(){if(!angular.equals({},$scope.selectedCountry))return"CA"==$scope.selectedCountry.country.code2?$scope.zipCodeCARegex:$scope.zipCodeUSRegex}}}}),avayaBlog.directive("avSignIn",function(){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/sign-in.html",controller:function($scope,$element){}}}),avayaBlog.directive("sixVideoQuilt",function(){return{restrict:"EAC",templateUrl:"/static/avaya/commerce-views/six-video-quilt.html",scope:{videoList:"="},replace:!0,link:function(scope,$element){}}}),avayaBlog.directive("soldToPicker",function(soldToService,$timeout,serviceBase){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/sold-to-picker.html",replace:!0,link:function(scope,element){scope.shipto={},scope.shipto.type="select",scope.newSelectedShipTo={},scope.newSelectedShipTo.address={},scope.newSelectedShipTo.address.country="US",scope.changedShipTo=!1,scope.alphabetRegex=/^[a-zA-Z .]{1,50}$/,scope.addressLine1Regex=/^[ A-Za-z0-9()[\]+*#-/]{3,100}$/,scope.stateRegex=/^[a-zA-Z .]{2,3}$/,scope.zipCodeUSRegex=/^\d{5}(?:[-\s]\d{4})?/,scope.zipCodeCARegex=/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,scope.alphaNumericRegex=/^[a-zA-Z0-9]*$/;var invalidAdrsMessage=$(".warning-message"),infoMsg=$(".info-msg");scope.closeShipToModal=function(){scope.clearShiptoData()},scope.clearShiptoData=function(){scope.newSelectedShipTo={},scope.newSelectedShipTo.address={},scope.shipto={},scope.shipto.type="select",infoMsg.removeClass("show"),!1,scope.closeModal()},scope.setCountrySoldTo=function(country){scope.selectedCountrySoldTo=country},scope.getZipPattern=function(){if(!angular.equals({},scope.selectedCountrySoldTo))return scope.selectedCountrySoldTo&&"CA"==scope.selectedCountrySoldTo.country.code2?scope.zipCodeCARegex:scope.zipCodeUSRegex},scope.selectSoldTo=function(soldTo,newAddressSelected){if(scope.selectedShipTo1=soldTo,scope.changedShipTo=!0,newAddressSelected&&"US"==scope.selectedCountrySoldTo.country.code2){scope.newSelectedShipTo.address.addressLine1=scope.newSelectedShipTo.address.addressLine1.replace(/[^A-Z0-9.,]+/gi," "),scope.newSelectedShipTo.address.addressLine2=scope.newSelectedShipTo.address.addressLine2?scope.newSelectedShipTo.address.addressLine2.replace(/[^A-Z0-9.,]+/gi," "):"";var addressPayload="<AddressValidateRequest USERID='073AVAYA7582'><Address ID='0'><Address1>"+scope.newSelectedShipTo.address.addressLine1+"</Address1><Address2>"+scope.newSelectedShipTo.address.addressLine2+"</Address2><City>"+scope.newSelectedShipTo.address.city+"</City><State>"+scope.newSelectedShipTo.address.state.code+"</State><Zip5>"+scope.newSelectedShipTo.address.zip+"</Zip5><Zip4></Zip4></Address></AddressValidateRequest>";serviceBase.postData("https://secure.shippingapis.com/ShippingAPI.dll?API=verify&XML="+addressPayload).then(function(response){var addressSuggestionXML=$(response.data).find("ReturnText").text(),addressErrorXML=$(response.data).find("Description").text();console.log("addressSuggestionXML",addressSuggestionXML),infoMsg.removeClass("show"),invalidAdrsMessage.removeClass("show"),addressSuggestionXML?(!0,$(window).scrollTop(0),infoMsg.addClass("show"),invalidAdrsMessage.removeClass("show"),console.log(addressSuggestionXML)):addressErrorXML?(!0,$(window).scrollTop(0),invalidAdrsMessage.addClass("show"),infoMsg.removeClass("show"),console.log(addressErrorXML)):(!1,infoMsg.removeClass("show"),invalidAdrsMessage.removeClass("show"),soldTo.address.city=$(response.data).find("City").text(),soldTo.address.state=$(response.data).find("State").text(),scope.setSelectedSold(soldTo,newAddressSelected,scope.changedShipTo),soldTo.address.country=scope.countriesUserTypeList[0].country.code2,scope.closeShipToModal(),console.log("Address Succesfully validated"))},function(error){})}else newAddressSelected&&"CA"==scope.selectedCountrySoldTo.country.code2&&(soldTo.address.country=scope.countriesUserTypeList[0].country.code2,soldTo.address.state=soldTo.address.state.code),scope.setSelectedSold(soldTo,newAddressSelected,scope.changedShipTo),scope.closeShipToModal()}}}}),avayaBlog.directive("spinner",function(){return{link:function(scope,element,attrs,ctrl){new Spinner({lines:13,length:28,width:14,radius:42,scale:1,corners:.7,color:"$color-black",opacity:.15,rotate:0,direction:1,speed:.9,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"51%",shadow:!1,hwaccel:!1,position:"absolute"}).spin(element[0])}}}),avayaBlog.directive("ssoAccountSetup",function(commerceService,serviceBase){return{restrict:"A",replace:!0,link:function(scope,element){var isMobile=browserWidth()<=768,uiViewList=$(".card-titles .ui-view .card"),uiViewContainer=$(".ui-view.ui-container"),settingsForm=$("form[name='settings']"),setupForm=(settingsForm.find("input[name='country']"),settingsForm.find("input[name='state']"),$("form[name='form']")),signUpForm=$("form[name='sign-up']"),downloadsForm=$("form[name='downloads']"),generateLinkButton=downloadsForm.find(".generate-link"),cardsWrap=(downloadsForm.find(".download-link"),$(".cards-wrap")),errorMessage=$(".error-message"),errorTerms=setupForm.find(".error-terms"),invalidAdrsMessage=($(".server-status-message"),$(".warning-message")),infoMsg=$(".info-msg"),createPasswordCaps=$("#create-password"),confirmPasswordCaps=$("#confirm-password"),capsonCreatePassword=$("#capson-create-password"),capsonConfirmPassword=$("#capson-confirm-password");createPasswordCaps.keyup(function(event){event.originalEvent.getModifierState("CapsLock")?capsonCreatePassword.css("display","inline-block"):capsonCreatePassword.css("display","none")}),confirmPasswordCaps.keyup(function(event){event.originalEvent.getModifierState("CapsLock")?capsonConfirmPassword.css("display","inline-block"):capsonConfirmPassword.css("display","none")});var signInForm=$("form[name='sign-in']"),tabList=($(".sign-in-button"),{});scope.ssocountry=$(".dropdown-wrap.country li:first").text(),scope.ssogovtaccount=!1,scope.ssosisp=!1,scope.ssostate="Select the state...",scope.ssosecurityques="Select the security question...";var validationListSetup=[],regexList_name=/^[a-zA-Z0-9][^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{1,50}$/,regexList_address1=/[^?!<>]{2,30}$/,regexList_phone=/^[0-9 eExXtT.()+-]{2,50}$/,regexList_answer=/^[^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{3,30}$/,regexList_password=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d$@$!%*?&_]{8,14}$/;scope.email=/^(?!.*\.{2})[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,5}$/,scope.alphabetRegex=/^[a-zA-Z .]{1,50}$/,scope.phoneRegex=/^((\+1)?[\s-]?)?\(?[1-9]\d\d\)?[\s-]?[0-9]\d\d[\s-]?\d\d\d\d/,scope.addressLine1Regex=/^[ A-Za-z0-9()[\]+*#-/]{3,100}$/,scope.stateRegex=/^[a-zA-Z .]{2,3}$/,scope.zipCodeUSRegex=/^\d{5}(?:[-\s]\d{4})?/,scope.zipCodeCARegex=/^[ABCEGHJ-NPRSTVXY]\d[ABCEGHJ-NPRSTV-Z][ -]?\d[ABCEGHJ-NPRSTV-Z]\d$/i,scope.numberRegex=/^[0-9]*$/,scope.alphaNumericRegex=/^[a-zA-Z0-9]*$/,scope.companyName=/^[a-zA-Z0-9 .+-,-]{1,50}$/,scope.Prefix="",scope.passwordRegex=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d$@$!%*?&_]{8,15}$/,scope.password2=/[^<>]{8,30}$/,scope.phone=/^[^±!@£$%^&*_+§¡€¢§¶•ªº«\\/<>?:;|=.,]{4,20}$/,scope.cityRegex=/^([a-zA-Z\u0080-\u024F]+(?:. |-| |'))*[a-zA-Z\u0080-\u024F]{1,30}$/,scope.securityAnswer=/^[^±!@£$%^&*_+§¡€#¢§¶•ªº«\\/<>?:;|=.,]{3,30}$/;var getQueryString=function(field,url){var href=url||window.location.href,string=new RegExp("[?&]"+field+"=([^&#]*)","i").exec(href);return string?string[1]:null},usVer=getQueryString("_usver_"),hiddenPageName=signUpForm.find("input[name='pagename']"),hiddenUsver=signUpForm.find("input[name='_usver_']"),resendLink=$(".app-urls").find("#resend-link").text();uiViewList.each(function(){$(this).firstChild;tabList[$(this).parent().closest("li").attr("class")]||(tabList[$(this).parent().closest("li").attr("class")]=$(this).attr("id")),uiViewContainer.append($(this))});var requestedTab=getQueryString("view"),requestedView=tabList[requestedTab];function browserWidth(){return self.innerHeight?self.innerWidth:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientWidth:document.body?document.body.clientWidth:void 0}$(".avatar-login .account").remove(),scope.showLoader=function(){$(".page-level-loader").addClass("show-loader"),setTimeout(function(){scope.hideLoader()},1e4)},scope.hideLoader=function(status,message){$(".page-level-loader").removeClass("show-loader")},scope.showView=function(){scope.showUiView=!0},scope.clearSignupForm=function(){scope.email={},scope.ssophone="",scope.ssocompany="",scope.ssotitle="",scope.ssostate="Select State...",scope.ssocity="",scope.ssozip="",scope.ssoaddress1="",scope.ssoaddress2="",scope.ssogovtaccount="",scope.ssosisp="",scope.ssopassword="",scope.ssoconfirmpassword="",scope.ssosecurityques="Select security question",scope.ssosecuritya="",scope.ssoterms=""},scope.hideView=function(){cardsWrap.removeClass("breeze-height"),cardsWrap.removeClass("general-height"),scope.showUiView=!1},scope.tab=requestedTab||"settings",scope.subNav=requestedView||"general",isMobile&&scope.hideView(),scope.showTab=function(tabId,cardId,title){scope.tab=tabId,scope.showCard(cardId,title,!1),event.stopPropagation(),commerceService.clickTab(tabId)},scope.showCard=function(cardId,title,showView){"breeze"==cardId?cardsWrap.addClass("breeze-height"):cardsWrap.removeClass("breeze-height"),"general"==cardId?cardsWrap.addClass("general-height"):cardsWrap.removeClass("general-height"),scope.subNav=cardId,scope.cardTitle=title,isMobile&&0!=showView&&scope.showView(),event.stopPropagation()},scope.saveSettings=function(event){event.preventDefault(),event.stopPropagation(),validateSettingsForm(validationListSetup)&&(scope.showLoader(),$.ajax({url:settingsForm.attr("action"),type:settingsForm.attr("method"),data:settingsForm.serialize().replace(/\'/g,""),dataType:"JSON",success:function(result){1==result.status?setTimeout(function(){scope.hideLoader(!0,result.message),saveSettingsForm()},0):scope.hideLoader(!1,result.message)},error:function(result){scope.hideLoader(!1,getGenericErrorMessage())}}))},scope.resendEmail=function(event){scope.showLoader(),hiddenPageName.val(resendLink),hiddenUsver.val(usVer),$.ajax({url:signUpForm.attr("action"),type:signUpForm.attr("method"),data:signUpForm.serialize().replace(/\'/g,""),dataType:"JSON",success:function(result){scope.hideLoader(result.status,result.message)},error:function(result){scope.hideLoader(!1,getGenericErrorMessage())}})},scope.cancelSettings=function(event){event.preventDefault(),event.stopPropagation()};generateLinkButton.on("click",function(event){event.stopPropagation()}),scope.finishAccountSetup=function(event){event.stopPropagation(),event.preventDefault(),console.log("ss",scope.ssotaxexempt),scope.redirectUrlHidden=setupForm.find("input[name='refUrl']").val(),scope.showLoader();var url=createUser();scope.ssoaddress1=scope.ssoaddress1.replace(/[^A-Z0-9.,]+/gi," "),scope.ssoaddress2=scope.ssoaddress2?scope.ssoaddress2.replace(/[^A-Z0-9.,]+/gi," "):"";var addressPayload="<AddressValidateRequest USERID='073AVAYA7582'><Address ID='0'><Address1>"+scope.ssoaddress1+"</Address1><Address2>"+scope.ssoaddress2+"</Address2><City>"+scope.ssocity+"</City><State>"+scope.ssostate+"</State><Zip5>"+scope.ssozip+"</Zip5><Zip4></Zip4></Address></AddressValidateRequest>";if("US"==scope.selectedCountry.country.code2)serviceBase.postData("https://secure.shippingapis.com/ShippingAPI.dll?API=verify&XML="+addressPayload).then(function(response){var addressSuggestionXML=$(response.data).find("ReturnText").text(),addressErrorXML=$(response.data).find("Description").text();if(infoMsg.removeClass("show"),invalidAdrsMessage.removeClass("show"),addressSuggestionXML)$(window).scrollTop(0),infoMsg.addClass("show"),invalidAdrsMessage.removeClass("show");else if(addressErrorXML)$(window).scrollTop(0),invalidAdrsMessage.addClass("show"),infoMsg.removeClass("show");else{if(infoMsg.removeClass("show"),invalidAdrsMessage.removeClass("show"),scope.ssocity=$(response.data).find("City").text(),scope.ssostate=$(response.data).find("State").text(),!validateForm(validationListSetup))return;var payload={Firstname:document.form.elements.fname.value,Lastname:document.form.elements.lname.value,Emailid:document.form.elements.emailid.value,Company:scope.ssocompany,Password:scope.ssopassword,Title:scope.ssotitle,State:scope.ssostate,City:scope.ssocity,security_question:scope.ssosecurityques,security_answer:scope.ssosecuritya,Addressline1:scope.ssoaddress1?scope.ssoaddress1:"",Addressline2:scope.ssoaddress2?scope.ssoaddress2:"",Zip_Code:scope.ssozip,Work_Phone:scope.ssophone?scope.ssophone:"",CODE_ABBR_2:scope.selectedCountry.country.code2,User_Type:"Customer",GovtAccount:scope.ssogovtaccount,SystemIntegratorServiceProvider:scope.ssosisp,FederalTaxId:scope.ssofederal?scope.ssofederal:"",StateTaxId:scope.ssostatetaxid?scope.ssostatetaxid:""};serviceBase.postData(url,payload).then(function(response){1==response.data.Status?($(window).scrollTop(0),scope.statusSuccessMsg=response.data.StatusMsg,scope.redirectUrlHidden&&""==scope.redirectUrlHidden?window.location.href=getMidMarketDashboard():window.location.href=scope.redirectUrlHidden):0==response.data.Status&&($(window).scrollTop(0),scope.statusMsg=response.data.StatusMsg,scope.hideLoader())},function(error){scope.hideLoader(!0,error.message)})}},function(error){});else{var payload={Firstname:document.form.elements.fname.value,Lastname:document.form.elements.lname.value,Emailid:document.form.elements.emailid.value,Company:scope.ssocompany,Password:scope.ssopassword,State:scope.ssostate.code,City:scope.ssocity,security_question:scope.ssosecurityques,security_answer:scope.ssosecuritya,Title:scope.ssotitle,Addressline1:scope.ssoaddress1?scope.ssoaddress1:"",Addressline2:scope.ssoaddress2?scope.ssoaddress2:"",Zip_Code:scope.ssozip,Work_Phone:scope.ssophone?scope.ssophone:"",CODE_ABBR_2:scope.selectedCountry.country.code2,User_Type:"Customer",GovtAccount:scope.ssogovtaccount,SystemIntegratorServiceProvider:scope.ssosisp,FederalTaxId:scope.ssofederal?scope.ssofederal:"",StateTaxId:scope.ssostatetaxid?scope.ssostatetaxid:""};serviceBase.postData(url,payload).then(function(response){1==response.data.Status?($(window).scrollTop(0),scope.statusSuccessMsg=response.data.StatusMsg,scope.redirectUrlHidden&&""==scope.redirectUrlHidden?window.location.href=getMidMarketDashboard():window.location.href=scope.redirectUrlHidden):0==response.data.Status&&($(window).scrollTop(0),scope.statusMsg=response.data.StatusMsg,scope.hideLoader())},function(error){scope.hideLoader(!0,error.message)})}},$(window).bind("resize",function(){isMobile=browserWidth()<=768});var password=setupForm.find("[name='password']"),confirmPassword=setupForm.find("[name='confirmPassword']"),securityAnswer=setupForm.find("[name='securitya']"),securityQuestionDropdown=$(".dropdown-wrap.security-question"),securityQuestionHiddenField=setupForm.find("[name='securityQuestion']"),countryDropdown=$(".dropdown-wrap.country"),countryField=countryDropdown.find("input[ name='countryField' ]"),province=($("input[name='city']"),$("input[name='province']")),postalCode=$("input[name='postalCode']"),zipCode=$("input[name='zipCode']"),countryHiddenField=$("input[name='country']"),stateDropdown=$(".dropdown-wrap.state"),stateField=stateDropdown.find("input[ name='stateField' ]"),stateHiddenField=$("input[name='state']"),stateLabel=settingsForm.find(".state-label"),provinceLabel=settingsForm.find(".province-label"),getFormStatus=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){if(validationItem.field.hasClass("error"))return formStatus=!1}),formStatus};scope.signIn=function(event){event.preventDefault(),event.stopPropagation(),validateSignInForm(validationListSetup)&&signInForm.submit()};var validateForm=function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){validationItem.field.prop("disabled")||0!=commerceService.validateField(validationItem)||($(window).scrollTop(0),errorMessage.addClass("show"),formStatus=!1)}),0==setupForm.find("input[name='terms']")[0].checked&&($(window).scrollTop(0),errorTerms.addClass("show"),formStatus=!1),password.val()!=confirmPassword.val()&&(confirmPassword.addClass("error"),error.addClass("show"),formStatus=!1),formStatus},addValidation=function(field,regex,type,required,callback){if(0!=field.length&&!field.attr("readonly"))if("checkbox"==type)field.change(function(){0==$(this)[0].checked?($(window).scrollTop(0),errorTerms.addClass("show")):errorTerms.removeClass("show")});else{var validationItem={field:field,regEx:regex,type:type,required:required};validationListSetup.push(validationItem),field.on("keyup",function(){1==commerceService.validateField(validationItem,callback)?getFormStatus(validationListSetup)&&errorMessage.removeClass("show"):errorMessage.addClass("show")})}};if(0<setupForm.length){var company=setupForm.find("[name='company']");addValidation(company,regexList_name),company.focus(),addValidation(setupForm.find("[name='address1']"),regexList_address1),addValidation(setupForm.find("[name='phone']"),regexList_phone),addValidation(password,regexList_password),addValidation(securityAnswer,regexList_answer),addValidation(stateDropdown,null,"select"),addValidation(zipCode,null,"select"),addValidation(setupForm.find("input[name='terms']"),null,"checkbox"),addValidation(securityQuestionDropdown,null,"select"),addValidation(countryDropdown,null,"select"),password.on("keyup",function(){password.val()&&0<password.val().length&&(confirmPassword.removeAttr("disabled"),confirmPassword.addClass("error"),confirmPassword.on("keyup",function(){confirmPassword.prop("disabled")||(0==confirmPassword.val().length?confirmPassword.addClass("error"):confirmPassword.val()==password.val()?confirmPassword.removeClass("error"):confirmPassword.addClass("error"))}))}),$(stateDropdown).find("li").on("click",function(){stateDropdown.removeClass("error"),stateHiddenField.val($(this).find("a").attr("data-value")||$(this).text())}),$(securityQuestionDropdown).find("li").on("click",function(){securityQuestionDropdown.removeClass("error"),securityAnswer.removeAttr("disabled"),securityQuestionDropdown.parent(".form-row").removeClass("show-error");var secuirtyAnswerEncoded=$(this).text().replace("'","&39;");securityQuestionHiddenField.val(secuirtyAnswerEncoded)}),$(stateDropdown).find("li").on("click",function(){stateDropdown.removeClass("error"),stateHiddenField.val($(this).find("a").attr("data-value")||$(this).text()),stateDropdown.parent(".form-row").removeClass("show-error")}),countryHiddenField.val()&&"us"==countryHiddenField.val().toLowerCase()?(countryField.removeClass("not-selected"),stateDropdown.removeClass("hidden"),stateDropdown.closest(".form-row").removeClass("hidden"),zipCode.removeClass("hidden"),zipCode.closest(".form-row").removeClass("hidden"),province.addClass("hidden"),province.closest(".form-row").addClass("hidden"),postalCode.addClass("hidden"),postalCode.closest(".form-row").addClass("hidden"),stateLabel.removeClass("hidden"),stateLabel.closest(".form-row").removeClass("hidden"),provinceLabel.addClass("hidden"),provinceLabel.closest(".form-row").addClass("hidden")):(stateDropdown.addClass("hidden"),stateDropdown.closest().addClass("hidden"),zipCode.addClass("hidden"),zipCode.closest(".form-row").addClass("hidden"),province.removeClass("hidden"),province.closest(".form-row").removeClass("hidden"),postalCode.removeClass("hidden"),postalCode.closest(".form-row").removeClass("hidden"),stateLabel.addClass("hidden"),stateLabel.closest(".form-row").addClass("hidden"),provinceLabel.removeClass("hidden"),provinceLabel.closest(".form-row").removeClass("hidden")),$(countryDropdown).find("li").on("click",function(){countryDropdown.removeClass("error");var selectedValue=$(this).find("a").attr("data-value")||$(this).text();countryHiddenField.val(selectedValue),"us"==selectedValue.toLowerCase()?(stateDropdown.removeClass("hidden"),stateDropdown.closest(".form-row").removeClass("hidden"),zipCode.removeClass("hidden"),zipCode.closest(".form-row").removeClass("hidden"),province.addClass("hidden"),province.closest(".form-row").addClass("hidden"),postalCode.addClass("hidden"),postalCode.closest(".form-row").addClass("hidden"),stateLabel.removeClass("hidden"),stateLabel.closest(".form-row").removeClass("hidden"),provinceLabel.addClass("hidden"),provinceLabel.closest(".form-row").addClass("hidden")):(stateDropdown.addClass("hidden"),stateDropdown.closest(".form-row").addClass("hidden"),zipCode.addClass("hidden"),zipCode.closest(".form-row").addClass("hidden"),province.removeClass("hidden"),province.closest(".form-row").removeClass("hidden"),postalCode.removeClass("hidden"),postalCode.closest(".form-row").removeClass("hidden"),stateLabel.addClass("hidden"),stateLabel.closest(".form-row").addClass("hidden"),provinceLabel.removeClass("hidden"),provinceLabel.closest(".form-row").removeClass("hidden"))})}scope.cancelSettings=function($event){event.stopPropagation(),event.preventDefault();var settingsFormData=function(data){for(var temp,objs=[],temps=data.split("&"),i=0;i<temps.length;i++)temp=temps[i].split("="),objs.push(temp[0]),objs[temp[0]]=temp[1];return objs}(formData);countryHiddenField.val(settingsFormData[countryHiddenField.attr("name")]),stateHiddenField.val(settingsFormData[stateHiddenField.attr("name")]),countryField.val(countryFieldValue),stateField.val(stateFieldValue),_.each(validationListSetup,function(validationItem){validationItem.field.hasClass("read-only")||validationItem.field.val(settingsFormData[validationItem.field.attr("name")])})},$(".dropdown-wrap.country li").on("click",function(){scope.ssocountry=$(this).text()}),$(".dropdown-wrap.state li").on("click",function(){scope.ssostate=$(this).text(),scope.ssostate=$(this).find("a").attr("data-value")}),$(".dropdown-wrap.security-question li").on("click",function(){scope.ssosecurityques=$(this).text()}),scope.getCountriesList=function(){commerceService.getCountries().then(function(response){scope.countriesList=response,scope.countriesList&&1==scope.countriesList.length&&scope.setCountry(scope.countriesList[0])})},scope.getCountriesList(),scope.setCountry=function(country){scope.selectedCountry=country},scope.getZipPattern=function(){if(scope.selectedCountry)return"CA"==scope.selectedCountry.country.code2?scope.zipCodeCARegex:scope.zipCodeUSRegex}}}}),avayaBlog.directive("superSearchModal",function($http,$q,$window,midmarketDashboardService,$timeout){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/super-search-modal.html",link:function(scope){scope.selectedAgentt=null,scope.selectAgentAction={},scope.selectAgentAction.type="agent",scope.searchagentsData=[],scope.showSuccessMsg=!1,scope.enableSave=!1,scope.SearchAgentError=!1,scope.superSearchAgents=function(searchterm){scope.enableSave=!1,scope.SearchAgentError=!1,searchterm&&2<searchterm.length?midmarketDashboardService.getsearchAgents(searchterm).then(function(response){null!=response.data&&null!=response.data&&""!=response.data?(scope.searchagentsData=response.data,0<scope.searchagentsData.length&&(scope.SearchAgentError=!1),1==scope.searchagentsData.length&&(scope.enableSave=!0)):scope.SearchAgentError=!0},function(error){console.log("error fetchng data on search",error)}):scope.searchagentsData=[]},scope.btnClose=function(){scope.closeAgentChk(),scope.callBackSelectedAgents(scope.helpFindAgentt,scope.selectedAgentt)},scope.closeAgentChk=function(){scope.closeModal(),scope.clearAgentChk()},scope.selectAgentAction=function(agent){_.each(scope.searchagentsData,function(c){c.selected=!1}),agent.selected=!0,scope.enableSave=!0},scope.saveAgent=function(){var selectedAgent={};1==scope.searchagentsData.length?selectedAgent=scope.searchagentsData[0]:_.each(scope.searchagentsData,function(c){1!=c.selected||(selectedAgent=c)}),selectedAgent&&midmarketDashboardService.getSelectAgent(selectedAgent.companyid).then(function(response){"success"==response.status&&(scope.showSuccessMsg=!0,$timeout(function(){$window.location.reload()},3e3))},function(error){console.log("error selecting agent on search",error)})},scope.clearAgentChk=function(){scope.enableSave=!1,scope.searchAgent={},scope.selectAgentAction.type="agent",scope.selectAgentAction="",scope.selectedAgentt=null,scope.searchagentsData=[],scope.searchTerm="",scope.helpFindAgentt=!1}}}}),avayaBlog.directive("taxBreakdownModal",function($filter){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/tax-breakdown-modal.html",link:function(scope,element){}}}),avayaBlog.filter("telFormatting",function(){return function(tel){if(!tel)return"";var city,number,value=tel.toString().trim().replace(/^\+/,"");if(value.match(/[^0-9]/))return tel;switch(value.length){case 1:case 2:case 3:city=value;break;default:city=value.slice(0,3),number=value.slice(3)}return number?("("+city+") "+(number=3<number.length?number.slice(0,3)+"-"+number.slice(3,7):number)).trim():"("+city}}),avayaBlog.directive("termsConditions",function($window,cartService,soldToService,billToService,purchaseOrderService,dateService,partnerInfoService,termsConditionsService){return{restrict:"A",templateUrl:"/static/avaya/commerce-views/terms-conditions.html",link:function(scope,element,attrs){var termsCheckbox=$(".sign-contract").find("#sign-contract");scope.type="",scope.tnc={},scope.getTermsConditions=function(){scope.tnc.name=scope.userDetails.name,scope.tnc.email=scope.userDetails.email,scope.tnc.jobtitle=scope.userDetails.jobtitle,scope.tnc.tncdate=scope.dateInWords,scope.tnc.legalEntity=scope.userDetails.legalEntity,scope.showTDLoader=!0,scope.printtermsLink=gettermsConditionsApi()+scope.quoteEntityId+"/print/",termsConditionsService.get(scope.quoteEntityId?scope.quoteEntityId:"").then(function(response){var string=JSON.stringify(response.tnc);scope.type=response.type;var e=document.createElement("div");e.innerHTML=string,scope.tnc.tncdocument="",angular.forEach(e.childNodes,function(value,key){scope.tnc.tncdocument+=e.childNodes[key].nodeValue}),scope.tnc.tncdocument=scope.tnc.tncdocument.substr(1),scope.tnc.tncdocument=scope.tnc.tncdocument.substr(0,scope.tnc.tncdocument.length-1),scope.showTDLoader=!1},function(error){console.log("error fetching tnc doc",error)})},scope.getTermsConditions(),scope.checklist={soldTo:!1,creditCard:!1,terms:!1},scope.termsAccepted=!1,scope.$watch("termsAccepted",function(newValue,oldValue){newValue&&1==newValue?termsCheckbox.prop("checked",!0):termsCheckbox.prop("checked",!1)}),scope.acceptTerms=function(){scope.showLoader(),scope.tnc.accepted=!0,scope.termsAcceptHtml=angular.element(document.querySelector(".tnc-accept-html"));var payload={tnc:scope.tnc,solutionId:scope.solutionId?scope.solutionId:" ",tncDocument:scope.tnc.tncdocument,tncAcceptedTerms:scope.termsAcceptHtml[0].innerHTML,docId:scope.docId?scope.docId:""};termsConditionsService.sendTncDocument(payload).then(function(response){console.log("tncresponse",response),scope.termsAccepted=!0,scope.termsAccept(!0,scope.tnc),scope.closeModal(),scope.docId=response.docid,scope.hideLoader()},function(error){scope.hideLoader(),console.log("error fetching tnc doc",error)})},scope.rejectTerms=function(){scope.termsAccepted=!1,scope.termsAccept(!1,scope.tnc),termsCheckbox.prop("checked",!1),scope.closeModal()},scope.printTerms=function(){console.log("aaa"),window.open(scope.printtermsLink,"_blank")}}}}),avayaBlog.directive("userInfo",function(userSession){return{restrict:"A",scope:{},link:function(scope,element){var userInfo=$(".user-info");if(userSession.valid()){userInfo.addClass("show");var userDetails=userSession.getDetails();userInfo.find(".welcome").text("Welcome, "+userDetails.firstName+"!")}}}}),avayaBlog.directive("validateQuantity",function(){return{require:"ngModel",link:function(scope,element,attr,ngModelCtrl){ngModelCtrl.$parsers.push(function(value){var convertedInput=value.replace(/[^0-9]/g,"");return 1<convertedInput.length&&(convertedInput=convertedInput.replace(/\b0+/g,"")),ngModelCtrl.$setViewValue(convertedInput),ngModelCtrl.$render(),convertedInput})}}}),avayaBlog.directive("verticalSlider",function($compile){return{scope:{slideDuration:"@",maxCycles:"@"},link:function($scope,$element,attrs,ctrl){var totalCycles=0;function move(){$scope.carouselContainer.stop().animate($scope.nextProp,{duration:config.duration,complete:function(){var increment;config.vertical?$scope.carouselContainer.scrollTop(0):$scope.carouselContainer.scrollLeft(0),increment=config.itemsPerMove,$scope.currentSlide+=increment,$scope.currentSlide+1>config.totalSlides&&($scope.currentSlide=$scope.currentSlide-config.totalSlides,totalCycles+=1),setActiveSlide($scope.currentSlide);for(var i=0;i<config.itemsPerMove;i++)$scope.slideList.children(":last").after($scope.slideList.children(":first"));config.itemsPerMove=1}})}function setActiveSlide(activeSlideIndex){$scope.carouselControls.find(".carousel-button").each(function(index){$(this).attr("slide-index")==activeSlideIndex?$(this).addClass("active"):$(this).removeClass("active")})}$scope.playCarousel=function(){totalCycles!=config.maxCycles&&(0==$scope.pauseCarousel&&move(),setTimeout($scope.playCarousel,config.slideDuration))},$scope.stopCarousel=function(){$scope.pauseCarousel=!0},$scope.resumeCarousel=function(){$scope.pauseCarousel=!1},$scope.showSlide=function(requestedSlideIndex){if(requestedSlideIndex!=$scope.currentSlide){var incrementBy=0,difference=Number($scope.currentSlide-requestedSlideIndex);incrementBy=0<difference?config.totalSlides-$scope.currentSlide-1+Number(requestedSlideIndex)+1:Math.abs(difference),config.itemsPerMove=incrementBy,move()}};var config={itemsPerMove:1,maxCycles:3,duration:200,vertical:!0,totalSlides:0,slideDuration:$scope.slideDuration||4e3,maxCycles:$scope.maxCycles||3};!function(){$scope.carouselContainer=$element.find(".carousel-container"),$scope.slideList=$scope.carouselContainer.find(".list"),$scope.currentSlide=0,$scope.numRep=3,$scope.currentRep=0,$scope.carouselControls=$(".vertical-carousel-controls"),$scope.pauseCarousel=!1;var backgroundColorList=["#598f94","#666366","#4b80b6","#4f8c0d"];$scope.slideList.children().each(function(index){$(this).css("background",backgroundColorList[index]),$scope.carouselControls.append($compile("<div><span ng-click='showSlide("+index+")' slide-index='"+index+"' class='carousel-button'></span></div>")($scope)),config.totalSlides+=1});var first=$scope.slideList.children(":first"),last=$scope.slideList.children(":last");setActiveSlide(0),config.vertical?($scope.distance=Math.max(first.outerHeight(!0),last.outerHeight(!0))*config.itemsPerMove,$scope.prevProp={scrollTop:"-="+$scope.distance},$scope.nextProp={scrollTop:$scope.distance}):($scope.distance=Math.max(first.outerWidth(!0),last.outerWidth(!0))*config.itemsPerMove,$scope.prevProp={scrollLeft:"-="+$scope.distance},$scope.nextProp={scrollLeft:"+="+$scope.distance}),$element.on("mouseenter",function(){$scope.stopCarousel()}),$element.on("mouseleave",function(){$scope.resumeCarousel()}),1<config.totalSlides?setTimeout(function(){$scope.playCarousel()},config.slideDuration):$scope.carouselControls.hide()}()}}}),avayaBlog.factory("billToService",function($http,$q,serviceBase){return{get:function(){return deferred=$q.defer(),serviceBase.getData(getBillToApi(),"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getCreditCardDetails:function(){return deferred=$q.defer(),serviceBase.getData(getCreditCardDetailsApi(),"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred}}}),avayaBlog.factory("cartService",function($q,serviceBase,commerceProductService){var field,url,href,string,cartItemIndex=0,bundleCartIndex=0,quoteId=(field="quoteId",href=url||window.location.href,(string=new RegExp("[?&]"+field+"=([^&#]*)","i").exec(href))?string[1]:null),payload={cartItems:[]},responseCart=[],cartItem=function(itemMasterId,quantity,billingCycle,term){return{cartItemIndex:cartItemIndex+=1,itemMasterId:itemMasterId,qty:Number(quantity),billingCycle:billingCycle,term:term}},eventHandlers={cartChangedHandlers:[]},notify=function(){eventHandlers.cartChangedHandlers.forEach(function(handler){handler()})},addItem=function(item){return 0!=item.term&&(item.term=responseCart.term||1),payload.cartItems.push({cartItemIndex:cartItemIndex+=1,itemMasterId:item.sku||item.itemMasterId,qty:Number(item.quantity||item.qty),billingCycle:item.billingCycle,term:item.term}),serviceBase.postData(saveProductCart(),payload).then(function(response){},function(error){console.log("Unable to save quote for reasons",error)}),sendCart(getAddToCartApi())},addItemsToCart=function(itemsList,bundle){_.each(itemsList,function(item){1==item.mandatory?payload.cartItems.push({cartItemIndex:bundleCartIndex,itemMasterId:item.sku,qty:Number(item.quantity),billingCycle:item.billingCycle,term:item.term}):"cpaas"==item.type?(item.quantity=item.price,payload.cartItems.push({cartItemIndex:cartItemIndex+=1,itemMasterId:item.sku,qty:Number(item.quantity),billingCycle:item.billingCycle,term:item.term})):payload.cartItems.push({cartItemIndex:cartItemIndex+=1,itemMasterId:item.sku,qty:Number(item.quantity),pricingInfo:item.pricingInfo,billingCycle:item.billingCycle,term:responseCart.term})})},sendCart=function(url){var deferred=$q.defer();return serviceBase.postData(url,payload).then(function(response){responseCart=response.data,clearCart(),deferred.resolve(responseCart),notify()},function(error){deferred.reject(error)}),deferred.promise},removeFromCart=function(url){var deferred=$q.defer();return serviceBase.postData(url,payload.cartItems[0]).then(function(response){setTimeout(function(){responseCart=processCart(response.data),clearCart(),deferred.resolve(responseCart),notify()},1e3)},function(error){deferred.reject(error)}),deferred.promise},updateCart=function(url){var deferred=$q.defer();return serviceBase.getData(url,payload.cartItems[0]).then(function(response){setTimeout(function(){"success"==response.data.status&&window.location.reload()},1e3)},function(error){deferred.reject(error)}),deferred.promise},processCart=function(data){var aSolution={solutionId:"",shoppingCartItems:[]},solutionBundles=Array();return data.solutionIds&&(data.solutionIds.forEach(function(solutionId){null!=solutionId&&(aSolution={solutionId:solutionId,currency:data.currency,currencySign:data.currencySign,agentSelection:data.agentSelection,quoteSummary:data.quoteSummary,shoppingCartItems:data.shoppingCartItems.filter(function(solution){return solutionId===solution.solutionId})},solutionBundles.push(aSolution))}),solutionBundles.forEach(function(cartData){if(cartData.total=0,cartData.totalItems=0,cartData.recurringItems=0,cartData.nonRecurringItems=0,cartData.recurringItemsTotal=0,cartData.nonRecurringItemsTotal=0,cartData.term=1,cartData.subTotal=0,cartData.shoppingCartItems||(cartData.shoppingCartItems=[]),cartData.shoppingCartItems.forEach(function(cartItem){if("Y"==cartItem.isTrial&&(cartData.freeTrial=!0,cartItem.editable=!1,cartData.hasBundle=!0),null!=cartItem.ratePlanId&&null!=data.pricingInfo){var rtp=data.pricingInfo.find(function(priceitem){if(null!=priceitem)return priceitem.productRatePlanId===cartItem.ratePlanId});cartItem.itemName+=rtp?" "+rtp.planName:""}null!=cartData.header&&""!=cartItem.header||(cartData.header=cartData.itemName?cartData.itemName:"Cart Description"),cartData.totalItems+=1,cartItem.price=(cartItem.billingCycle,cartItem.pricingInfo.listpriceAPL*cartItem.qty),cartData.total+=cartItem.price,cartData.recurringItemsTotal+="MO"==cartItem.billingCycle?cartItem.price:0,cartData.nonRecurringItemsTotal+="MO"!=cartItem.billingCycle?cartItem.price:0,cartData.recurringItems+="MO"==cartItem.billingCycle?1:0,"MO"==cartItem.billingCycle&&(cartData.term=cartItem.term),cartItem.price=formatCurrency(cartItem.price)}),cartData.nonRecurringItems=cartData.totalItems-cartData.recurringItems,cartData.subTotal=Number(cartData.total),cartData.taxes=Number(0),cartData.monthlyPayment=Number(cartData.recurringItemsTotal),cartData.subTotal=Number(cartData.subTotal),cartData.displayTotal=Number(cartData.total),0<cartData.shoppingCartItems.length){var cartIndexArray=cartData.shoppingCartItems.map(function(item){return item.itemIndex});cartItemIndex+=Math.max.apply(null,cartIndexArray)}})),solutionBundles},clearCart=function(){payload.cartItems=[],cartItemIndex=0},formatCurrency=function(value){return(value=value||0).toString().indexOf(",")<0&&value.toString().indexOf(".")<0&&(value=value.toFixed(2)),(value=value.toString().split("."))[0]=value[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),value.join(".")};return{get:function(solId){var deferred=$q.defer(),delay=0,solutionId=solId;-1<window.location.pathname.indexOf("checkout")&&(delay=2e3);var url=getCartApi(),parameters=solutionId?"?solutionId="+solutionId:"";return 1==App.debug?url=null!=solutionId||null!=solutionId?"OMS0084246"==solutionId?"/static/avaya/mocks/commerce/cart-spaces.html":"/static/avaya/mocks/commerce/cart-2013.html":"/static/avaya/mocks/commerce/cart.html":url+=parameters||"",setTimeout(function(){serviceBase.getData(url,"").then(function(response){responseCart=processCart(response.data),deferred.resolve(responseCart),notify()},function(error){deferred.reject(error)})},delay),deferred.promise},hasLab:function(){return!!_.find(responseCart.shoppingCartItems,function(cartItem){return"Y"==cartItem.isLab})},readCart:function(){return responseCart},set:function(val){cart=val},getConfiguratorViews:function(){return configurator},submit:function(paymentInfo,solutionId,purchaseOrderInfo,tnc,phoneNumber,shipToInfo,billToInfo,findAgent,selectedAgent,soldToList,taxExempt,domainName,newPhoneNumber){return function(paymentInfo,solutionId,purchaseOrderInfo,tnc,phoneNumber,shipToInfo,billToInfo,findAgent,selectedAgent,soldToList,taxExempt,domainName,newPhoneNumber){return payload={paymentInfo:paymentInfo,purchaseOrderInfo:purchaseOrderInfo,solutionId:solutionId,tnc:tnc,phoneNumber:phoneNumber,shipToInfo:shipToInfo,billToInfo:billToInfo,findAgent:findAgent,selectedAgent:selectedAgent,soldToList:soldToList,taxExempt:taxExempt,selectedDomain:domainName,selectedPhoneNumber:newPhoneNumber},sendCart(submitCartApi())}(paymentInfo,solutionId,purchaseOrderInfo,tnc,phoneNumber,shipToInfo,billToInfo,findAgent,selectedAgent,soldToList,taxExempt,domainName,newPhoneNumber)},register:function(callback){!function(callback){eventHandlers.cartChangedHandlers.push(callback)}(callback)},addItem:function(item){return addItem(item)},updateItem:function(solutionId,item){return function(solutionId,item){return console.log(">>>>>>>>>>>In cart service<<<<<<<<<<<<<<",item),payload.cartItems.push({solutionId:solutionId,cartItemIndex:item.itemIndex,itemMasterId:item.itemId,billingCycle:item.billingCycle,term:item.term,qty:Number(item.qty)}),updateCart(getUpdateCartApi())}(solutionId,item)},deleteItem:function(item){return function(item){return item.itemType,payload.cartItems.push({cindex:item.itemIndex}),removeFromCart(removeCartItemApi())}(item)},delete:function(){},updateContract:function(bundle,term){return function(solutionId,term){return payload={solutionId:solutionId,term:term,billingCycle:billingCycle},sendCart(updateCartContractApi())}(bundle,term)},addEstimateItem:function(item){return addItem(item)},deleteEstimateItem:function(index){},deleteEstimate:function(){},getestValue:function(){return"6"},createItem:function(itemMasterId,quantity,billingCycle,term){return new cartItem(itemMasterId,quantity,billingCycle,term)},finishEstimate:function(estimate){return function(estimate){var subscriptionTerm=estimate.termSelected;return cartItemIndex=0,payload={cartItems:[],oneTimeTotal:estimate.oneTimeTotal,subscriptionTotal:estimate.subTotal,hardwareCreditApplied:estimate.hardwareCreditApplied,oneTimePromo:"Hardware Credit Applied "+estimate.hardwareCreditApplied,subscriptionPromo:"Term Discount applied "+estimate.avaialbleTermDiscount+"%",hardwareCreditAvailableTotal:estimate.totalHWCreditAvailable,oneTimeBeforePromo:estimate.oneTimeHardwareTotal+estimate.ataAccessoryTotal,featuredSku:estimate.featuredSkuId,term:subscriptionTerm,subscriptionId:estimate.subscriptionId,settings:estimate.cmUsrSel,subscriptionType:estimate.subscriptionType,entityId:estimate.entityId,subscriptionExpiryDate:estimate.subscriptionExpiryDate,quoteDescription:estimate.quoteDescription,selectedPhoneNumber:estimate.selectedPhoneNumber,numberType:estimate.numberType},"Spoken"==estimate.productBundle?estimate.bundle.forEach(function(item){payload.cartItems.push({cartItemIndex:cartItemIndex+=1,itemMasterId:item.itemMasterId,qty:item.qty,deltaQty:item.pricingInfo.deltaQty?item.pricingInfo.deltaQty:0,billingCycle:item.billingCycle,term:subscriptionTerm,pricingInfo:item.pricingInfo,promotionalCharges:[item.ccPromotionalCharges?item.ccPromotionalCharges:item.ucPromotionalCharges]}),bundleCartIndex=cartItemIndex}):(payload.cartItems.push({cartItemIndex:cartItemIndex+=1,itemMasterId:estimate.bundle.itemId,qty:1,billingCycle:estimate.bundle.billingCycle,term:estimate.bundle.term}),bundleCartIndex=cartItemIndex,addItemsToCart(estimate.recurring.items,estimate.bundle)),addItemsToCart(estimate.nonRecurring.items,estimate.bundle),estimate.omsIdfromEditCart?sendCart(getUpdateQuoteCartApi()+estimate.omsIdfromEditCart+"/"):sendCart(quoteId?getUpdateQuoteCartApi()+quoteId+"/":getAddToCartApi())}(estimate)},addCpaas:function(item){return function(item){return item.quantity=item.price,payload.cartItems.push({cartItemIndex:cartItemIndex+=1,itemMasterId:item.itemId,qty:Number(item.quantity),billingCycle:null,term:"0"}),sendCart(getAddToCartApi())}(item)},formatCurrency:function(value){return formatCurrency(value)},updateCartDescription:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(postCartDescriptionApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(payload)}}}),avayaBlog.factory("checkDirectService",function($http,$q,serviceBase){var checkDirectInfo=null;return{get:function(){return deferred=$q.defer(),serviceBase.getData(getCheckDirectApi(),"").then(function(response){checkDirectInfo=response.data;var headers=response.headers();deferred.resolve(checkDirectInfo,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getUserType:function(){return deferred=$q.defer(),serviceBase.getData(getUserTypeApi(),"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getCustomerType:function(){return deferred=$q.defer(),serviceBase.getData(getCustomerTypeApi(),"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getMasterAgents:function(){return deferred=$q.defer(),serviceBase.getData(getMasterAgentApi(),"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getAgentUsers:function(agentId){return function(agentId){var url=getAgentUsersApi();if(null!=agentId)var parameters=agentId+"/";else parameters="";return 1==App.debug?url="/static/avaya/mocks/commerce/get-agent-users.html":url+=parameters,serviceBase.getData(url)}(agentId)},getAgents:function(masterAgent){return function(companyId){var url=getAgentApi();if(null!=companyId)var parameters="?companyId="+companyId;else parameters="";return 1==App.debug?url="/static/avaya/mocks/commerce/get-agent.html":url+=parameters,serviceBase.getData(url)}(masterAgent)},getRemoveCart:function(solutionId){return function(solutionId){var deferred=$q.defer(),endpointUrl=getRemoveCartApi()+("localhost"===window.location.hostname?"":"?solutionId="+solutionId);return serviceBase.getData(endpointUrl,"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(solutionId)},assignCartBackToAgent:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(assignCartBackToAgentApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(payload)}}}),avayaBlog.factory("commerceProductService",function($http,$q,serviceBase,$httpParamSerializer,checkDirectService){var getQueryString=function(field,url){var href=url||window.location.href,string=new RegExp("[?&]"+field+"=([^&#]*)","i").exec(href);return string?string[1]:null},ucItemId=getUcItemId(),ccItemId=getCcItemId(),spacesItemId=getSpacesItemId(),skuIdfromEditCart=(getEfaxItemId(),getAcrItemId(),getAtaItemId(),getQueryString("skuId")),bundleIdFromUrl=getQueryString("bundleId"),entityId=(getQueryString("country"),null),currency=null,cpaasData={items:[{id:"1",itemId:"1011",itemName:"CPaasS Account",price:200},{id:"2",itemId:"1011",itemName:"CPaasS Account",price:400,popular:!0},{id:"3",itemId:"1011",itemName:"CPaasS Account",price:600}],customCredit:{itemId:"1011",itemName:"CPaasS Account",price:0}};return{getLabelsData:function(){return"2046"==bundleIdFromUrl||bundleIdFromUrl==ccItemId||skuIdfromEditCart==ccItemId?serviceBase.getData(getCcProductLabelsDataApi()):"2074"==bundleIdFromUrl||bundleIdFromUrl==ucItemId||skuIdfromEditCart==ucItemId?serviceBase.getData(getUcProductLabelsDataApi()):bundleIdFromUrl==spacesItemId||skuIdfromEditCart==spacesItemId?serviceBase.getData(getSpacesProductLabelsDataApi()):serviceBase.getData(getPartnerLabelsDataApi())},getBundleData:function(bundleAssetId){return serviceBase.getData(getBundleDataApi()+"&bundleId="+bundleAssetId)},getProductData:function(productId){if(1!=App.debug)return serviceBase.getData(getProductDataApi()+"&productid="+productId);if(bundleIdFromUrl!=spacesItemId&&skuIdfromEditCart!=spacesItemId)return serviceBase.getData(getProductDataApi()+"&productid="+productId);return serviceBase.getData("/static/avaya/mocks/commerce/new-spaces-bundle-data.html?&productid="+productId)},getAddOnData:function(addOnUrl){return function(addOnUrl){var deferred=$q.defer();return serviceBase.getData(addOnUrl).then(function(response){var addOnsData=response.data;deferred.resolve(addOnsData)},function(error){deferred.reject(error)}),deferred.promise}(addOnUrl)},getItemData:function(itemId,billingCycle,term,itemType){return function(itemId,userData,itemType){var url=getItemDetailsApi();return entityId=userData&&"Customer"===userData.usertype||userData&&"Customer"===userData.userType?userData.salesAreas[0].legalEntity:userData&&userData.entityId,currency=userData&&"Customer"===userData.usertype||userData&&"Customer"===userData.userType?"US"===userData.salesAreas[0].country?"USD":"CAD":userData&&userData.currency,1==App.debug?url="1000"==itemId||"1001"==itemId||"1002"==itemId?"/static/avaya/mocks/commerce/mock-bundle-sku-details.html":"1095"==itemId?"/static/avaya/mocks/commerce/mock-item-price-"+itemId+".html":"1003"==itemId||"1005"==itemId||"1052"==itemId||"1051"==itemId||"1075"==itemId||"1157"==itemId||"2158"==itemId||"2159"==itemId?"/static/avaya/mocks/commerce/mock-item-price-"+itemId+".html":"1012"==itemId?"/static/avaya/mocks/commerce/mock-item-price-1012.html":"1013"==itemId||"1016"==itemId?"/static/avaya/mocks/commerce/mock-item-price-1013.html":"1026"==itemId?"/static/avaya/mocks/commerce/mock-item-price-1026.html":"1027"==itemId?"/static/avaya/mocks/commerce/mock-item-price-1027.html":"1052"==itemId?"/static/avaya/mocks/commerce/mock-item-price-1052.html":"/static/avaya/mocks/commerce/mock-item-price-1003.html":url+="/"+(itemType||"1")+"/"+itemId+(entityId?"/entityId/"+entityId:"")+(currency?"/?currency="+currency:""),serviceBase.getData(url)}(itemId,billingCycle,term)},getFeatureData:function(itemId,billingCycle,term,itemType){return function(itemId,userData,itemTypeId){var url=getFeatureDetailsApi();return entityId=userData&&"Customer"===userData.usertype||userData&&"Customer"===userData.userType?userData.salesAreas[0].legalEntity:userData&&userData.entityId,currency=userData&&"Customer"===userData.usertype||userData&&"Customer"===userData.userType?"US"===userData.salesAreas[0].country?"USD":"CAD":userData&&userData.currency,1==App.debug?url="1000"==itemId||"1001"==itemId||"1002"==itemId?"/static/avaya/mocks/commerce/mock-bundle-sku-details.html":"2053"==itemId||"2046"==itemId||"2074"==itemId?"/static/avaya/mocks/commerce/mock-item-price-"+itemId+".html":"avayaspaces"==itemId?"/static/avaya/mocks/commerce/mock-item-price-spaces.html":"2054"==itemId||"2055"==itemId?"/static/avaya/mocks/commerce/mock-item-price-1012.html":"1003"==itemId||"1005"==itemId?"/static/avaya/mocks/commerce/mock-item-price-"+itemId+".html":"1012"==itemId?"/static/avaya/mocks/commerce/mock-item-price-1012.html":"1013"==itemId||"1016"==itemId?"/static/avaya/mocks/commerce/mock-item-price-1013.html":"1026"==itemId?"/static/avaya/mocks/commerce/mock-item-price-1026.html":"1027"==itemId?"/static/avaya/mocks/commerce/mock-item-price-1027.html":"/static/avaya/mocks/commerce/mock-item-price-1003.html":url+="/"+itemTypeId+"/"+itemId+(entityId?"/entityId/"+entityId:"")+(currency?"/?currency="+currency:""),serviceBase.getData(url)}(itemId,billingCycle,term)},getHardwareData:function(itemId,billingCycle,term,itemType){return function(itemId,userData,itemTypeId){var url=getHardwareDetailsApi();return entityId=userData&&"Customer"===userData.usertype||userData&&"Customer"===userData.userType?userData.salesAreas[0].legalEntity:userData&&userData.entityId,currency=userData&&"Customer"===userData.usertype||userData&&"Customer"===userData.userType?"US"===userData.salesAreas[0].country?"USD":"CAD":userData&&userData.currency,1==App.debug?url="1026"==itemId||"1100"==itemId||"1200"==itemId||"1158"==itemId?"/static/avaya/mocks/commerce/mock-item-price-"+itemId+".html":"/static/avaya/mocks/commerce/mock-item-price-1027.html":url+="/"+itemTypeId+"/"+itemId+(entityId?"/entityId/"+entityId:"")+(currency?"/?currency="+currency:""),serviceBase.getData(url)}(itemId,billingCycle,term)},getCpaasData:function(){return cpaasData},getAddOnsData:function(addOnId){return serviceBase.getData(getAddOnsDataApi()+"&addOnId="+addOnId)},getCatalogData:function(addOnId){return serviceBase.getData(getCatalogDataApi())},getFreeTrial:function(userData){return function(userData){var entityId=userData.entityId,currency=userData.currency,url=createStandaloneQuote();return url+="?itemId="+ucItemId+"&isTrial=true&entityId="+entityId+"&currency="+currency,console.log(url),serviceBase.getData(url)}(userData)},getSubscriptions:function(subscriptionId){return function(subscriptionId){var deferred=$q.defer(),url=getSubscriptionsApi(),parameters=subscriptionId?"?subscriptionId="+subscriptionId:"";return 1==App.debug?url="/static/avaya/mocks/commerce/subscriptions-data.html":url+=parameters||"",serviceBase.getData(url).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(subscriptionId)},getSubscriptionschangeOrder:function(subscriptionId){return function(subscriptionId){var deferred=$q.defer(),url=getSubscriptionsInfoApi(),parameters=subscriptionId?"?subscriptionId="+subscriptionId:"";return 1==App.debug?url="/static/avaya/mocks/commerce/subscriptions-info.html":url+=parameters||"",serviceBase.getData(url).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(subscriptionId)},getSubscriptionInfoData:function(subscriptionId,entityId){return function(subscriptionId,entityId){var deferred=$q.defer();return url=getSubscriptionsInfoApi(),1==App.debug?parameters="":(parameters=subscriptionId+"/"+entityId,url+=parameters),serviceBase.getData(url,"").then(function(response){deferred.resolve(response)},function(error){deferred.reject(error)}),deferred.promise}(subscriptionId,entityId)},getTaxInfoData:function(cart){return function(cart){var deferred=$q.defer(),url=getTax();return 1==App.debug&&(url="/static/avaya/mocks/commerce/get-tax.html"),serviceBase.postData(url,cart).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(cart)}}}),avayaBlog.factory("commerceService",function($q,serviceBase){var validateField=function(validationItem){var parentWrap=validationItem.field.parent(".form-row");return 0!=validationItem.required||validationItem.field.val()&&0!=validationItem.field.val().length?"select"==validationItem.type?0<validationItem.field.find(".not-selected").length&&0==validationItem.field.hasClass("hidden")?(validationItem.field.addClass("error"),parentWrap.addClass("show-error"),!1):(validationItem.field.removeClass("error"),parentWrap.removeClass("show-error"),!0):validationItem.field.hasClass("hidden")?(validationItem.field.removeClass("error"),parentWrap.removeClass("show-error"),!0):validationItem.field.val().match(validationItem.regEx)?(validationItem.field.removeClass("error"),parentWrap.removeClass("show-error"),!0):(validationItem.field.hasClass("error")||(validationItem.field.addClass("error"),parentWrap.addClass("show-error")),!1):(validationItem.field.removeClass("error"),parentWrap.removeClass("show-error"),!0)},getLocation=function(href){var l=document.createElement("a");return l.href=href,l};function getCookieValue(cname){for(var name=cname+"=",ca=decodeURIComponent(document.cookie).split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}function setUserTypeToSession(data){sessionStorage.usertype=JSON.stringify(data.usertype)}return{validateField:function(validationItem){return validateField(validationItem)},validateForm:function(validationList){return function(validationList){var formStatus=!0;return _.each(validationList,function(validationItem){validationItem.field.prop("disabled")||0!=validateField(validationItem)||(errorMessage.addClass("show"),formStatus=!1)}),0==setupForm.find("input[name='terms']")[0].checked&&(errorTerms.addClass("show"),formStatus=!1),password.val()!=confirmPassword.val()&&(confirmPassword.addClass("error"),error.addClass("show"),formStatus=!1),formStatus}(validationList)},clickTab:function(tab){var location;location=tab,window.Webtrends?window.Webtrends.multiTrack({argsa:["WT.z_engage","Tab Click: "+location,"WT.nv","Avaya Dashboard","WT.dl","36"]}):console.log(JSON.stringify({argsa:["WT.z_engage","Tab Click: "+location,"WT.nv","Avaya Dashboard","WT.dl","36"]}))},downloadLink:function(url){!function(url){var location=getLocation(url),domain=location.hostname,path=location.pathname,fileName=path.split("/").pop();window.Webtrends?window.Webtrends.multiTrack({argsa:["DCS.dcssip",domain,"DCS.dcsuri",path,"WT.ti",fileName,"WT.nv","Avaya Dashboard","WT.dl","20"]}):console.log(JSON.stringify({argsa:["DCS.dcssip",domain,"DCS.dcsuri",path,"WT.ti",fileName,"WT.nv","Avaya Dashboard","WT.dl","20"]}))}(url)},signUp:function(){window.Webtrends?window.Webtrends.multiTrack({argsa:["WT.si_n","my avaya","WT.si_p","account setup","WT.z_engage","Breeze Signup","WT.dl","36"]}):console.log(JSON.stringify({argsa:["WT.si_n","my avaya","WT.si_p","account setup","WT.z_engage","Breeze Signup","WT.dl","36"]}))},signUpComplete:function(){window.Webtrends?window.Webtrends.multiTrack({argsa:["WT.si_n","my avaya","WT.si_p","thank you","WT.z_engage","Breeze Signup","WT.dl","36"]}):console.log(JSON.stringify({argsa:["WT.si_n","my avaya","WT.si_p","thank you","WT.z_engage","Breeze Signup","WT.dl","36"]}))},isLoggedIn:function(){return!(!(smSession=$(".app-urls").find("#smsession-cookie").text())||"No"==smSession||"LOGGEDOFF"==smSession||""==smSession);var smSession},getUserCookieInfo:function(){return(userCookieInfo={}).firstname=getCookieValue("firstname"),userCookieInfo.lastname=getCookieValue("lastname"),userCookieInfo;var userCookieInfo},getProfileInfo:function(){return function(){var smSession=$(".app-urls").find("#smsession-cookie").text();if(smSession&&"No"!=smSession&&"LOGGEDOFF"!=smSession&&""!=smSession){var deferred=$q.defer();return serviceBase.getData(getUserTypeApi(),"").then(function(response){deferred.resolve(response.data),setUserTypeToSession(response.data)},function(error){deferred.reject(error)}),deferred.promise}return!1}()},setUserTypeToSession:function(){return setUserTypeToSession()},setNewCustomer:function(){return deferred=$q.defer(),serviceBase.getData(setNewCustomerApi(),"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getCountries:function(){return deferred=$q.defer(),url=getCountriesList(),serviceBase.getData(url,"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred,url},getCartCount:function(){return deferred=$q.defer(),url=getCartCountApi(),serviceBase.getData(url,"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred,url}}}),avayaBlog.factory("cpaasService",function($http,serviceBase){var credit=0,cpaasCatalog={priceList:[{description:"Send a Message (per SMS)",price:.005},{description:"Receive a Message (per SMS)",price:0},{description:"Make a Call Local (per min)",price:.015},{description:"Make a Call Toll-Free (per min)",price:.015},{description:"Receive a Call Local (per Min)",price:.01},{description:"Receive a Call Toll Free (per Min)",price:.03},{description:"Carrier Lookups (per request)",price:.01},{description:"BNA (Billing Name Address) Lookups (per request)",price:.05},{description:"CNAM (Caller Name) Lookup (per request)",price:.01},{description:"Buy a Phone Number Local (per month)",price:1},{description:"Buy a Phone Number Toll-Free (per month)",price:2}]},eventHandlers={creditAddedHandlers:[]},addCredit=function(creditAmount){credit=creditAmount,eventHandlers.creditAddedHandlers.forEach(function(handler){handler()})};return{getCatalog:function(){return cpaasCatalog},addCredit:function(creditAmount){addCredit(creditAmount)},register:function(callback){!function(callback){eventHandlers.creditAddedHandlers.push(callback)}(callback)},getCredit:function(){return credit},getSkuDetails:function(){return serviceBase.getData(getCpaasDetailsApi())}}}),avayaBlog.factory("customerSearchService",function(serviceBase,$q){return{getCustomerBySoldToId:function(soldToId){return url=soldToId,deferred=$q.defer(),endpointUrl=getCustomerBySoldToApi()+("localhost"===window.location.hostname?"":"/"+url+"/"),serviceBase.getData(endpointUrl,"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var url,deferred,endpointUrl},getCustomerByAddress:function(address){return payload=address,deferred=$q.defer(),serviceBase.postData(getCustomerByAddressApi(),payload).then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var payload,deferred}}}),avayaBlog.factory("dashboardService",function($http,$q,serviceBase){return{getLacData:function(){return serviceBase.getData(getLacDataApi())},getLicenseData:function(){return serviceBase.getData(getlicenseDataApi())},getDownloadsData:function(lacNumber){var payLoad={lac:lacNumber,funcLocation:"",customerPO:"",salesOrderNumber:""};return serviceBase.postData(getdownloadsDataApi(),payLoad)},getdownloadLink:function(token){return 1==App.debug?serviceBase.getData(getdownloadLinkApi()):serviceBase.getData(getdownloadLinkApi()+"/"+token)},activateLicense:function(lacData){return serviceBase.postData(getActivateLicenseApi(),lacData)},getActivationStatus:function(lacData){var lacCounter=0,deferred=$q.defer(),noActivations=!0,filteredLacList=[],index=0;_.each(lacData.EcommerceOrders,function(lac){lac&&lac.LACNumber&&(index+=1)<=20&&filteredLacList.push(lac)});var totalLacEntries=(lacData.filteredLacList=filteredLacList).length;return _.each(lacData.filteredLacList,function(lac){serviceBase.getData(getActivationStatusApi()+lac.LACNumber).then(function(response){lacCounter+=1,response.data.lacDetails[0]?(lac.canActivate="YES"==response.data.lacDetails[0].canActivate,"YES"==response.data.lacDetails[0].canActivate&&(noActivations=!1)):(lac.disableActivation=!0,lac.canActivate=!1),lacCounter==totalLacEntries&&(lacData.noActivations=noActivations,deferred.resolve(lacData))},function(error){(lacCounter+=1)==totalLacEntries&&deferred.reject(lacData),console.log("error fetching activation status")})}),deferred.promise},getZangCredit:function(){return serviceBase.getData(getZangCreditApi())}}}),avayaBlog.factory("dataService",["$resource","$http","$q","$location",function($resource,$http,$q,$location){return this.dataService={getDataFrom:function(url,type,callback){callback=callback||"GET";if("JSONP_ARRAY"==(callback="GET"))var getData=$resource(url+"&q="+type,{},{query:{method:"JSONP",isArray:!0}});else getData=$resource(url+"&q="+type,{},{query:{method:callback,isArray:!0}});return getData.query().$promise}},this.dataService}]),avayaBlog.factory("dateService",function(){var monthArray=["January","February","March","April","May","June","July","August","September","October","November","December"];return{getDateInWords:function(date){var today=new Date;return monthArray[today.getMonth()]+" "+today.getDate()+", "+today.getFullYear()}}}),avayaBlog.factory("estimatorService",function($http,cartService,commerceProductService){var estimatedCartStore={productBundle:"",currentIndex:1,oneTimeTotal:0,oneTimeHardwareTotal:0,bundle:{},recurring:{items:[]},nonRecurring:{items:[]},selectedTerm:1},appliedCreditsList=[],estimatedCart=angular.copy(estimatedCartStore),adjustTotal=(getAtaItemId(),function(price,recurring,itemType){price=Number(price),1==recurring?(estimatedCart.subTotal+=price,estimatedCart.monthlyPayment+=price):(estimatedCart.oneTimeTotal=price,estimatedCart.oneTimeHardwareTotal=0,estimatedCart.ataAccessoryTotal=0,_.each(estimatedCart.nonRecurring.items,function(item){estimatedCart.oneTimeHardwareTotal+=Number(item.total)})),estimatedCart.total=estimatedCart.monthlyPayment+(estimatedCart.oneTimeTotal?estimatedCart.oneTimeTotal:0),"50"!=itemType&&"12"!=itemType||(estimatedCart.total=estimatedCart.monthlyPayment+(estimatedCart.oneTimeHardwareTotal?estimatedCart.oneTimeHardwareTotal:0))}),getTerm=function(){return estimatedCart.selectedTerm},getEsimate=function(){return estimatedCart},getTotal=function(estimatedCart){var total=0,totalQty=0,addonPrice=0;if(0<estimatedCart.bundle.length){estimatedCart.bundle.forEach(function(item){item.isAddOn?addonPrice="Per Minute, Per Agent"===item.description?0:item.pricingInfo&&item.pricingInfo.listpriceAPL||0:(totalQty+=item.qty,total+=item.total,item.pricingInfo.extendedNet=item.total)});var addOnTotal=addonPrice*totalQty;estimatedCart.bundle.forEach(function(item){item.isAddOn&&(item.total=addOnTotal,item.qty=totalQty,item.pricingInfo.extendedNet=addOnTotal)})}estimatedCart.subTotal=total+addOnTotal},addItem=function(itemId,description,price,pricingInfo,quantity,itemType,billingCycle,term,recurring,type,mandatory){var item;1==recurring?(item=_.find(estimatedCart.recurring.items,function(recurringItem){return recurringItem.sku==itemId}))?(adjustTotal(-Number(item.quantity*price),!0),item.quantity=quantity,0==item.quantity&&_.remove(estimatedCart.recurring.items,{sku:itemId}),item.total=Number(quantity*price),adjustTotal(Number(quantity*price),!0)):(estimatedCart.recurring.items.push({sku:itemId,description:description,quantity:quantity,price:price,itemType:itemType,billingCycle:billingCycle,term:term,total:Number(quantity*price).toFixed(2),type:type}),adjustTotal(Number(quantity*price).toFixed(2),!0)):((item=function(itemId,itemsList){return _.find(itemsList,function(item){return item.sku==itemId})}(itemId,estimatedCart.nonRecurring.items))?(adjustTotal(-Number(quantity*price).toFixed(2),!1),item.sku=itemId,item.description=description,item.quantity=quantity,item.price=price,0==item.quantity&&_.remove(estimatedCart.nonRecurring.items,{sku:itemId}),item.total=Number(quantity*price).toFixed(2)):0==quantity?_.remove(estimatedCart.nonRecurring.items,{sku:itemId}):estimatedCart.nonRecurring.items.push({sku:itemId,description:description,quantity:quantity,price:price,total:Number(quantity*price).toFixed(2),billingCycle:billingCycle,term:term,type:type,mandatory:mandatory,pricingInfo:pricingInfo}),adjustTotal(Number(quantity*price).toFixed(2),!1,itemType))};return{setVal:function(val){someValue=val},getVal:function(){return someValue},getEsimate:function(){return getEsimate()},updateEsimate:function(){estimatedCartStore=angular.copy(estimatedCart)},cancelEstimate:function(){estimatedCart=angular.copy(estimatedCartStore)},addBundle:function(bundle){bundle.itemId!=estimatedCart.bundle.itemId&&(estimatedCart.recurring.items=[],estimatedCart.nonRecurring.items=[],estimatedCart.currentIndex=1,estimatedCart.oneTimeTotal=0),estimatedCart.bundleTitle=bundle.title,estimatedCart.subTotal=bundle.price,estimatedCart.taxes=0,estimatedCart.monthlyPayment=bundle.price,estimatedCart.total=bundle.price,function(bundle){bundle.mandatoryItems&&0<bundle.mandatoryItems.length&&_.each(bundle.mandatoryItems,function(mandatoryItem){commerceProductService.getItemData(mandatoryItem.itemId,null,null,mandatoryItem.itemType).then(function(response){var itemDetails=response.data.avaPriceDetail[0];addItem(itemDetails.itemId,itemDetails.productName,itemDetails.price,1,null,itemDetails.billingCycle,itemDetails.term,!1,null,!0)},function(error){})})}(estimatedCart.bundle=bundle)},addItem:function(itemId,description,price,quantity,itemType,billingCycle,term,recurring,type){addItem(itemId,description,price,quantity,itemType,billingCycle,term,recurring,type)},addSpokenItem:function(item){!function(item){item.pricingInfo.unitNet=item.unitNet,item.pricingInfo.listpriceAPL=item.selectedPrice,item.pricingInfo.extendedNet=item.total;var qtyTotal=0;if(0<estimatedCart.bundle.length)for(var i=0;i<estimatedCart.bundle.length;i++)if(estimatedCart.bundle[i].itemMasterId==item.itemMasterId&&estimatedCart.bundle[i].productRatePlanId==item.productRatePlanId)return estimatedCart.bundle[i].qty=item.qty,estimatedCart.bundle[i].total=item.total,getTotal(estimatedCart);if(item.isAddOn){var tempEstimatedCart=estimatedCart.bundle.filter(function(item){return 0==item.isAddOn});estimatedCart.bundle=tempEstimatedCart}""==estimatedCart.productBundle&&(estimatedCart.productBundle="Spoken",estimatedCart.bundle=[],estimatedCart.subTotal=0),estimatedCart.bundle.push({itemMasterId:item.itemMasterId,qty:item.qty,description:item.description,total:item.total,billingCycle:item.billingCycle,term:item.term,productRatePlanId:item.productRatePlanId,pricingInfo:item.pricingInfo,isAddOn:item.isAddOn,isUcAddOn:item.isUcAddOn});for(i=0;i<estimatedCart.bundle.length;i++)estimatedCart.bundle[i].isAddOn||(qtyTotal+=estimatedCart.bundle[i].qty);for(i=0;i<estimatedCart.bundle.length;i++)estimatedCart.bundle[i].isAddOn&&("Per Minute, Per Agent"===estimatedCart.bundle[i].description?estimatedCart.bundle[i].total=0*qtyTotal:estimatedCart.bundle[i].total=qtyTotal*estimatedCart.bundle[i].pricingInfo.extendedNet);getTotal(estimatedCart)}(item)},addDataMinutes:function(refillAmount){},removeDataMinutes:function(refillAmount){},addToCart:function(){return cartService.finishEstimate(estimatedCart)},updateQuoteToCart:function(){return cartService.finishEstimate(estimatedCart)},getCreditDetails:function(){return function(){var termDiscountPercentage,totalCredit=0,term=getTerm(),estimatedCart=getEsimate(),qtyPerItem=0;if(0<estimatedCart.bundle.length){appliedCreditsList=[];for(var i=0;i<estimatedCart.bundle.length;i++){qtyPerItem=estimatedCart.bundle[i].qty;var productRatePlanCharges=estimatedCart.bundle[i]&&estimatedCart.bundle[i].pricingInfo&&estimatedCart.bundle[i].pricingInfo.productRatePlanCharges;if(void 0!==productRatePlanCharges){var extractedDiscountObject=productRatePlanCharges&&productRatePlanCharges.find(function(item){return 0<=item.name.indexOf("Promotion "+term+"Yr")}),discountAmount=extractedDiscountObject&&extractedDiscountObject.pricing&&0<extractedDiscountObject.pricing.length&&extractedDiscountObject.pricing[0].discountAmount;if(void 0!==discountAmount){var formattedDiscountValue=parseFloat(parseFloat(discountAmount).toFixed(2));totalDiscountPerUser=formattedDiscountValue*qtyPerItem,totalCredit=parseFloat(parseFloat(totalCredit+totalDiscountPerUser).toFixed(2))}estimatedCart.hardwareCreditDiscountAmount=discountAmount,appliedCreditsList.push(extractedDiscountObject);var extractedTermDiscountObject=productRatePlanCharges&&productRatePlanCharges.find(function(item){return 0<=item.name.indexOf("Term Discount "+term+" Year")});estimatedCart.bundle[i].ccPromotionalCharges=extractedTermDiscountObject||null;var termDiscountPercentageTemp=extractedTermDiscountObject&&extractedTermDiscountObject.pricing&&0<extractedTermDiscountObject.pricing.length&&extractedTermDiscountObject.pricing[0].discountPercentage;termDiscountPercentageTemp&&(termDiscountPercentage=parseFloat(parseFloat(termDiscountPercentageTemp).toFixed(0)))}}}return{termDiscountPercentage:termDiscountPercentage,totalCredit:totalCredit,appliedCreditsList:appliedCreditsList}}()},setTerm:function(item){var term;term=item,estimatedCart.selectedTerm=term},getTerm:function(){return getTerm()},removeItem:function(item){!function(itemObject){for(var bundleObj=estimatedCart.bundle,i=0;i<bundleObj.length;i++){var selectedItemObj=bundleObj[i];if(selectedItemObj.itemMasterId==itemObject.itemMasterId&&selectedItemObj.productRatePlanId==itemObject.productRatePlanId){estimatedCart.bundle.splice(i,1);break}}getTotal(estimatedCart)}(item)},getTotal:function(estimatedCart){return getTotal(estimatedCart)},getSubscriptionsTotalQty:function(){return function(){for(var totalSubscriptionQty=0,addOnTotalQty=0,totalQty=0,i=0;i<estimatedCart.bundle.length;i++)totalQty+=Number(estimatedCart.bundle[i].qty),!0!==estimatedCart.bundle[i].isAddOn&&!0!==estimatedCart.bundle[i].isUcAddOn||(addOnTotalQty+=Number(estimatedCart.bundle[i].qty)),totalSubscriptionQty=totalQty-addOnTotalQty;return totalSubscriptionQty}()},getSubscriptionsTotalDeltaQty:function(){return function(){for(var totalSubscriptionDeltaQty=0,totalQty=0,deltaQty=0,i=0;i<estimatedCart.bundle.length;i++)deltaQty=Number(estimatedCart.bundle[i].pricingInfo.deltaQty),totalSubscriptionDeltaQty=(totalQty+=isNaN(deltaQty)?0:deltaQty)-0;return totalSubscriptionDeltaQty}()},getHardwareTotalQty:function(){return function(){for(var totalHardwareQty=0,i=0;i<estimatedCart.nonRecurring.items.length;i++)!0!==estimatedCart.nonRecurring.items[i].pricingInfo.isHardwareAddOn&&(totalHardwareQty+=Number(estimatedCart.nonRecurring.items[i].quantity));return totalHardwareQty}()},addHardwareAddonItem:function(item){return function(item){if(0<estimatedCart.nonRecurring.items.length)for(var i=0;i<estimatedCart.nonRecurring.items.length;i++)if(estimatedCart.nonRecurring.items[i].sku==item.itemId&&estimatedCart.nonRecurring.items[i].pricingInfo.productRatePlanId==item.productRatePlanId)return estimatedCart.nonRecurring.items[i].quantity=item.quantity,estimatedCart.nonRecurring.items[i].total=Number(item.quantity*item.listpriceAPL),void adjustTotal(Number(item.quantity*item.listpriceAPL).toFixed(2),!1,null);estimatedCart.nonRecurring.items.push({sku:item.itemId,description:item.planName,quantity:item.quantity,price:item.listpriceAPL,total:Number(item.quantity*item.listpriceAPL).toFixed(2),billingCycle:item.billingCycle,term:item.term,type:item.type,mandatory:item.mandatory,pricingInfo:item}),adjustTotal(Number(item.quantity*item.listpriceAPL).toFixed(2),!1,null)}(item)},removeHardwareAddonItem:function(item){return function(item){for(var i=0;i<estimatedCart.nonRecurring.items.length;i++)if(estimatedCart.nonRecurring.items[i].sku==item.itemId&&estimatedCart.nonRecurring.items[i].pricingInfo.productRatePlanId==item.productRatePlanId){estimatedCart.nonRecurring.items.splice(i,1);break}adjustTotal(Number(item.quantity*item.listpriceAPL).toFixed(2),!1,null)}(item)}}}),avayaBlog.factory("labService",function($http,serviceBase){var labNameChangeCallbackList=[],labActivateCallbackList=[],awsRegions=[{id:"us-west-2",description:"US West (Oregon)"},{id:"us-west-1",description:"US West (N. California)"},{id:"us-east-2",description:"US East (Ohio)"},{id:"us-east-1",description:"US East (N. Virginia)"},{id:"ap-northeast-1",description:"Asia Pacific (Tokyo)"},{id:"ap-northeast-2",description:"Asia Pacific (Seoul)"},{id:"ap-southeast-1",description:"Asia Pacific (Singapore)"},{id:"ap-southeast-2",description:"Asia Pacific (Sydney)"},{id:"ca-central-1",description:"Canada (Central)"},{id:"eu-central-1",description:"EU (Frankfurt)"},{id:"eu-west-1",description:"EU (Ireland)"},{id:"eu-west-2",description:"EU (London)"},{id:"",description:"AWS GovCloud (US)"}];return{getLabDetails:function(labId){if(1==App.debug)return serviceBase.getData(getLabStatus());return serviceBase.getData(getLabStatus()+"/"+labId)},getLabProducts:function(labId){if(1==App.debug)return serviceBase.getData(getLabProducts());return serviceBase.getData(getLabProducts())},getEnvironments:function(labId){if(1==App.debug)return serviceBase.getData(getLabEnvironments());return serviceBase.getData(getLabEnvironments())},startLab:function(labId){return 1==App.debug?serviceBase.getData(startLab()):serviceBase.getData(startLab()+"/"+labId)},stopLab:function(labId){return 1==App.debug?serviceBase.getData(suspendLab()):serviceBase.getData(suspendLab()+"/"+labId)},deleteLab:function(labId){return 1==App.debug?serviceBase.getData(deleteLab()):serviceBase.getData(deleteLab()+"/"+labId)},destroyLab:function(labId){return 1==App.debug?serviceBase.getData(destroyLab()):serviceBase.getData(destroyLab()+"/"+labId)},suspendLab:function(labId){return 1==App.debug?serviceBase.getData(suspendLab()):serviceBase.getData(suspendLab()+"/"+labId)},setLabName:function(labData){return $http({method:"POST",url:updateLabName(),data:labData,headers:{Accept:"application/json","Content-Type":"application/json"}})},activateLab:function(setupData){return 1==App.debug?serviceBase.getData(getActivateLab()):serviceBase.postData(getActivateLab(),setupData)},getAwsRegionCodes:function(){return awsRegions},registerLabNameChange:function(callback){labNameChangeCallbackList.push(callback)},notifyLabNameChange:function(){labNameChangeCallbackList.forEach(function(handler){handler()})},registerLabActivate:function(callback){labActivateCallbackList.push(callback)},notifyLabActivate:function(){labActivateCallbackList.forEach(function(handler){handler()})}}}),avayaBlog.factory("midmarketAgentDashboardService",function($http,$q,serviceBase){return{getdata:function(){return deferred=$q.defer(),serviceBase.getData(getCompanyApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getagentdata:function(){return deferred=$q.defer(),serviceBase.getData(getMyAgentsApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getagentusersdata:function(){return deferred=$q.defer(),serviceBase.getData(getMyAgentsUserApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getmycustomerdata:function(){return deferred=$q.defer(),serviceBase.getData(getMyCustomersApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},get:function(){return deferred=$q.defer(),serviceBase.getData(getMyAdminsApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getsearchAgents:function(data){return payload=data,deferred=$q.defer(),serviceBase.getData(getsearchAgentsUserApi(),payload).then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var payload,deferred},getRolesType:function(){return deferred=$q.defer(),serviceBase.getData(getRolesTypeApi(),"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getusertype:function(){return deferred=$q.defer(),serviceBase.getData(getUserTypeApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},postAction:function(data){return payload=data,deferred=$q.defer(),serviceBase.postData(submitAdminActionApi(),payload).then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var payload,deferred}}}),avayaBlog.factory("midmarketDashboardService",function($http,$q,serviceBase){return{getdata:function(){return deferred=$q.defer(),serviceBase.getData(getCompanyApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getagentdata:function(){return deferred=$q.defer(),serviceBase.getData(getMyAgentsApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getagentusersdata:function(){return deferred=$q.defer(),serviceBase.getData(getMyAgentsUserApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getmycustomerdata:function(){return deferred=$q.defer(),serviceBase.getData(getMyCustomersApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getAdmindata:function(){return deferred=$q.defer(),serviceBase.getData(getMyAdminsApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},get:function(type){return function(type){url="Customer"==type?getOrderApi():getAgentQuoteDetails();var deferred=$q.defer();return serviceBase.getData(url,"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise}(type)},getAccountDetails:function(){return deferred=$q.defer(),serviceBase.getData(getAccountDetailsApi(),"").then(function(response){deferred.resolve(response)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getSubscriptions:function(){return deferred=$q.defer(),serviceBase.getData(getSubscriptionsApi(),"").then(function(response){deferred.resolve(response)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getsearchAgents:function(searchterm){return function(searchterm){var deferred=$q.defer(),endpointUrl=getsearchAgentsUserApi()+("localhost"===window.location.hostname?"":"/?searchterm="+searchterm);return serviceBase.getData(endpointUrl).then(function(response){var headers=response.headers();deferred.resolve(response,headers)},function(error){deferred.reject(error)}),deferred.promise}(searchterm)},getsearchAgentsCheckout:function(searchterm,linked,entityId){return function(searchterm,linked,entityId){var deferred=$q.defer(),endpointUrl=getsearchAgentsUserApi()+"/?searchterm="+searchterm+"&linked="+!0+"&entityId="+entityId;return serviceBase.getData(endpointUrl).then(function(response){var headers=response.headers();deferred.resolve(response,headers)},function(error){deferred.reject(error)}),deferred.promise}(searchterm,0,entityId)},postSubscriptionItems:function(){return deferred=$q.defer(),serviceBase.postData(postSubscriptionItemsApi(),"").then(function(response){deferred.resolve(response)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getRolesType:function(){return deferred=$q.defer(),serviceBase.getData(getRolesTypeApi(),"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getusertype:function(){return deferred=$q.defer(),serviceBase.getData(getUserTypeApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},postAction:function(data){return payload=data,deferred=$q.defer(),serviceBase.postData(submitAdminActionApi(),payload).then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var payload,deferred},getCancelOrder:function(solutionId){return function(solutionId){var deferred=$q.defer(),endpointUrl=getRemoveCartApi()+("localhost"===window.location.hostname?"":"?solutionId="+solutionId);return serviceBase.getData(endpointUrl,"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(solutionId)},getSubscriptionInfoData:function(subscription){return function(subscription){var deferred=$q.defer();if(url=getSubscriptionsInfoApi(),1==App.debug){parameters="";var spacesItemId=getSpacesItemId();subscription.entityId==spacesItemId&&(url="/static/avaya/mocks/commerce/subscriptions-info-spaces.html")}else parameters=subscription.subscriptionId+"/"+subscription.entityId,url+=parameters;return serviceBase.getData(url,"").then(function(response){deferred.resolve(response)},function(error){deferred.reject(error)}),deferred.promise}(subscription)},submitHelpForm:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(submitHelpApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(payload)},cancelSubscription:function(subscriptionId,entityId){return function(subscriptionId,entityId){var deferred=$q.defer(),endpointUrl=cancelSubscriptionApi()+("localhost"===window.location.hostname?"":"/"+subscriptionId+"/"+entityId);return serviceBase.getData(endpointUrl,"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(subscriptionId,entityId)},getSelectAgent:function(companyId){return function(companyId){var deferred=$q.defer(),endpointUrl=getSelectAgentApi()+("localhost"===window.location.hostname?"":companyId+"/");return serviceBase.getData(endpointUrl,"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(companyId)},resetSelectAgent:function(){return deferred=$q.defer(),endpointUrl=resetSelectAgentApi(),serviceBase.getData(endpointUrl,"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred,endpointUrl},submitPaymentDetails:function(paymentInfo,selectedBillTo){return function(paymentInfo,billingInfo){var payload={paymentInfo:paymentInfo,billingInfo:billingInfo},deferred=$q.defer();return serviceBase.postData(postMyPaymentInfoApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(paymentInfo,selectedBillTo)},getInvoiceData:function(){return deferred=$q.defer(),serviceBase.getData(getInvoiceDetailsApi(),"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred},saveSelectedAgent:function(payload){return function(payload){var deferred=$q.defer(),endpointUrl=saveSelectedAgentApi()+("localhost"===window.location.hostname?"":payload.solutionId+"/");return serviceBase.postData(endpointUrl,payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(payload)},updateAgentUrl:function(shortName){return function(shortName){var deferred=$q.defer(),endpointUrl=updateUrlActionApi()+("localhost"===window.location.hostname?"":shortName+"/");return serviceBase.getData(endpointUrl,"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(shortName)},getExportPdfForm:function(solutionId){return deferred=$q.defer(),serviceBase.getData(getExportPdfFormApi(),"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getExportExcelForm:function(solutionId){return deferred=$q.defer(),serviceBase.getData(getExportExcelFormApi(),"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred},submitExportPdfForm:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(submitExportPdfApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(payload)},submitExportExcelForm:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(submitExportExcelApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(payload)},submitforgotPasswordForm:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(submitforgotPasswordFormApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(payload)},submitOtpPassword:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(submitOtpPasswordApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(payload)},submitResetPassword:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(submitResetPasswordApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(payload)}}}),avayaBlog.factory("modalService",function($http){var modal=$(".av-modal.av-remove-item"),callbackFunction=null,backdrop=$(".commerce-modal-backdrop"),showBackdrop=function(){backdrop.addClass("fade")},hideBackdrop=function(){backdrop.removeClass("fade")};return modal.find(".remove").on("click",function(){callbackFunction("remove"),modal.css("display","none"),hideBackdrop()}),modal.find(".cancel").on("click",function(){modal.css("display","none"),hideBackdrop()}),{showModal:function(callback){modal.css("display","block"),showBackdrop(),callbackFunction=callback},hideModal:function(modalId){modal.css("display","none"),hideBackdrop()},showBackdrop:function(){showBackdrop(),(modal=$(".av-modal.av-remove-item")).css("display","block")},hideBackdrop:function(){hideBackdrop(),modal.css("display","none")}}}),avayaBlog.factory("partnerInfoServiceT1",function($http,$q,serviceBase){var partnerInfo=null;return{get:function(url){return function(url){var deferred=$q.defer(),endpointUrl=getPartnerInfoT1Api()+("localhost"===window.location.hostname?"":url);return serviceBase.getData(endpointUrl,"").then(function(response){partnerInfo=response.data["T1-Data"];var headers=response.headers();deferred.resolve(partnerInfo,headers)},function(error){deferred.reject("Error fetching T1 data "+error)}),deferred.promise}("/"+url+"/")},getSoldToAddress:function(url){return function(url){var deferred=$q.defer(),endpointUrl=getPartnerInfoT1Api()+("localhost"===window.location.hostname?"":url);serviceBase.getData(endpointUrl,"").then(function(response){deferred.resolve(response.data,response.headers())},function(error){deferred.reject("Error fetching Sold To Address "+error)})}("/"+url+"/")}}}),avayaBlog.factory("partnerInfoServiceT2",function($http,$q,serviceBase){var partnerInfo=null;return{get:function(url){return function(url){var deferred=$q.defer(),endpointUrl=getPartnerInfoT1Api()+("localhost"===window.location.hostname?"":url);return serviceBase.getData(endpointUrl,"").then(function(response){partnerInfo=response.data["T2-Data"];var headers=response.headers();deferred.resolve(partnerInfo,headers)},function(error){deferred.reject(error)}),deferred.promise}("/"+url+"/")}}}),avayaBlog.factory("partnerInfoService",function($http,$q,serviceBase){var partnerInfo=null;return{get:function(){return deferred=$q.defer(),serviceBase.getData(getPartnerInfoApi(),"").then(function(response){partnerInfo=response.data["me-Data"];var headers=response.headers();deferred.resolve(partnerInfo,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred}}}),avayaBlog.factory("phoneNumberService",function($http,$q,serviceBase){return{get:function(url){return function(url){var deferred=$q.defer(),endpointUrl=getTollFreeNumberApi()+("localhost"===window.location.hostname?"":"/"+url+"/");return serviceBase.getData(endpointUrl,"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise}(url)},getNumber:function(url){return function(url){var deferred=$q.defer(),endpointUrl=getLocalNumberApi()+("localhost"===window.location.hostname?"":"/"+url+"/");return serviceBase.getData(endpointUrl,"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise}(url)},postData:function(data){return deferred=$q.defer(),serviceBase.postData(submitPhoneNumberApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},postPhoneFormData:function(files){return formData=files,deferred=$q.defer(),config={headers:{"Content-Type":void 0},transformRequest:angular.identity,transformResponse:angular.identity},$http.post(phoneFileUploadApi(),formData,config).then(function(response){deferred.resolve(response)}),deferred.promise;var formData,deferred,config},postLNPForm:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(postLNPFormDataApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(payload)},postRODAAForm:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(postRODAAFormDataApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(payload)}}}),avayaBlog.factory("preBoardingService",function($http){var preBoardingData={result:{rooms:[{title:"Avaya Pre-boarding Home",subTitle:"Your space to play before your first day.",welcomeTitle:"We’re Excited You’re Here!",welcomeDescription:"Welcome to Avaya.  We’re so glad you’ve made the choice to join the Avaya family.  While you’re waiting for your start date to arrive, we’ve created this pre-boarding page for you to become familiar with Avaya’s story. There are several videos for you to enjoy along with links to Avaya’s social media presence. Viewing the videos is optional, but we hope you’ll use them to get to know your new company and begin to see that at Avaya, experience is everything!",featuredVideo:{title:"Welcome",description:"Description not available",length:"1:59",kalturaId:"1_5se8ybie"},sections:[{id:"001",title:"This is Avaya",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-this-is-avaya.png",videos:[{title:"The Avaya Story",description:"Communication has come a long way since the invention of the telephone.  This trip down memory lane highlights the rich roots of Avaya’s history. ",length:"1:59",kalturaId:"1_uwh7edth"},{title:"This is Avaya",description:"Communication is at the heart of what drives relationships. We keep pushing technological boundaries and communication has become an experience.  This is what we do…it’s who we are…this is Avaya.",length:"1:59",kalturaId:"1_il5n27uq"},{title:"User Defined Engagement is in our DNA",description:"Gary Barnett explains that customers are demanding a different experience...one that’s contextual, persistent and proactive. Solve business problems and communication needs with User Defined experience in the digital world: a vision of a smart, digital world where engagement across devices and software is always secure, always in context, always user defined.",length:"1:59",kalturaId:"0_pdvzxemd"}]},{id:"002",title:"The Avaya Way",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-avaya-way.png",videos:[{title:"The Avaya Way",description:"The Avaya Way is a strategy for maximizing sales performance.  Selling is getting more complex and we have some big challenges in sales.  Jonathan Buckle, Area Channel Leader - US West walks us through how to leverage the Avaya Way behaviors for success in selling. ",length:"1:59",kalturaId:"1_xf9f9afq"}]},{id:"003",title:"Customer Engagement",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-customer-engagement.png",videos:[{title:"Customer Engagement in the Digital Age",description:"In this video, watch as Joe Burton, EVP and CCO of Plantronics, and Laurent Philonenko, SVP of Corporate Strategy and Development and CTO at Avaya, discuss the importance of customer engagement in the digital age. Avaya and Plantronics partnership gave the San Jose Earthquakes the ability to engage with their customers on a personal level.",length:"1:59",kalturaId:"1_bcvskdx8"},{title:"Avaya Oceana - Managing the Customer Journey",description:"To know where a customer wants to go, you need to know where they've been. That's why Avaya Oceana gives your agents a complete picture of each customer's journey. This 45 second video provides a quick overview of managing the customer journey with Avaya Oceana.",length:"1:59",kalturaId:"0_krh8ymdy"},{title:"Avaya Oceana Solution: Redefine Your Customer’s Experience",description:"The Avaya Oceana Solution provides a personalized, relevant customer buying journey. Let’s look at how Avaya envisions engagement with perspective customers in this short video.",length:"1:59",kalturaId:"0_l1arvvz8"},{title:"Avaya Agent for Chrome",description:"Avaya Agent for Chrome combines Avaya expertise and customer engagement technologies. Set up a new contact center in a regional office, roll out a network of home based agents, or enable a disaster recovery plan that can quickly kick in in the event of a storm or another disruption. Thanks to Avaya and Google Chrome solutions, the tools needed to engage customers can be implemented anywhere.",length:"1:59",kalturaId:"0_o19kxzo6"},{title:"The Self Service Customer Journey",description:"The Self Service Customer Journey.  A look at how customers can utilize various self-service options to meet their needs on their schedule, from any location and on any device.",length:"1:59",kalturaId:"0_jslaxlhu"}]},{id:"004",title:"Team Engagement",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-team-engagement.png",videos:[{title:"Avaya Aura Platform: The Solution for Engagement",description:"Keeping your employees connected is a given in modern enterprises, but to go to the next level they need to engage. Avaya Aura Platform is the solution for engagement allowing you to integrate video and voice into any application on any device and to get persistent communications. There’s a reason 97% of Fortune’s fastest growing companies rely on Avaya. Stop waiting and switch to the leading solution today.",length:"1:59",kalturaId:"1_lezy81va"},{title:"Avaya Equinox Experience - Accelerate Your Business",description:"Avaya Equinox is a new kind of communications experience.  Call, message, meet, share-in the way that works best for you.  Experience this promotional video showing how Equinox accelerates the speed of business.",length:"1:59",kalturaId:"0_usln2rca"},{title:"Avaya Breeze",description:"Avaya Breeze Video",length:"1:59",kalturaId:"0_h3ucwc6y"},{title:"Avaya Breeze Customer Service Scenario",description:"Avaya Breeze is a new way to design, build, and implement communications applications. Customer experience is all about getting the connections working together for every customer, every time, and every device. Applications in your business such as event triggers, dynamic team formation, and prioritized customer communications can be enhanced with the latest collaboration and engagement capabilities.",length:"1:59",kalturaId:"1_hi5htnfz"},{title:"Get Work Done Fast - Avaya Communicator",description:"Wish there was a way to work with your team without all of them being in the same room or even region? Introducing Avaya Communicator, a platform that makes it simple to collaborate with your team. Communicator provides a way for embedding real time communications across applications like Salesforce, Google, and Office 365 and helps you get work done fast.",length:"1:59",kalturaId:"0_h6n2a5bp"},{title:"Welcome to Zang",description:"Learn about Zang, the most powerful cloud-based phone service.  The Zang Office phone app can work right from your laptop or mobile device.  Easy, reliable, scaleable…Zang Office.",length:"1:59",kalturaId:"0_5q4rpav2"}]},{id:"005",title:"Cloud",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-cloud.png",videos:[{title:"Avaya Cloud Services",description:"For today’s enterprise, the cloud is big.  Replace an up-front and often unpredictable capital expense with a predictable, stable operating expense.  Use the cloud to streamline the way you collaborate and engage resources. Avaya understands what it takes to deliver cloud solutions—take a look at this video to see just how.",length:"1:59",kalturaId:"1_8ujyk5qh"},{title:"Kroenke Case Study - Delivering the Ultimate Fan Experience",description:"See how Avaya and Kroenke Sports and Entertainment are changing the game by delivering extraordinary fan experiences. From WiFi to interactive fan engagement walls, the Pepsi Center stands out as one of the most innovative communications experiences for fans, and a reliable and more secure networking environment for its owners.",length:"1:59",kalturaId:"0_a3kjgxen"},{title:"San Jose Earthquakes Case Study",description:"Welcome to the Avaya Stadium, home of the San Jose Earthquakes. A team with a rich history in the Silicon Valley now has a stadium equipped with the cloud. Fans can get stats on the players easier, get video updates, order food from your seat, and have your actual ticket on your iPhone or Android device. This brand connection and engagement builds loyalty between the team and the fans, creating a one-of-a-kind sports environment that you’ll have to see to believe.",length:"1:59",kalturaId:"0_hnb1q11d"}]},{id:"006",title:"What's Next?",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-whats-next.png",videos:[{title:"Get Ready for Waypoints",description:"Once your start date arrives, you’ll begin our sales new hire onboarding program, WayPoints.  Watch this informative video for a sneak peek of what to expect as you begin your  Avaya WayPoints journey. ",length:"1:59",kalturaId:"1_bs4tzjuk"}]}]}]}},academyData={result:{rooms:[{title:"Avaya Pre-boarding Home",subTitle:"Your space to play before your first day.",welcomeTitle:"We’re Excited You’re Here!",welcomeDescription:"Welcome to Avaya.  We’re so glad you’ve made the choice to join the Avaya family.  While you’re waiting for your start date to arrive, we’ve created this pre-boarding page for you to become familiar with Avaya’s story. There are several videos for you to enjoy along with links to Avaya’s social media presence. Viewing the videos is optional, but we hope you’ll use them to get to know your new company and begin to see that at Avaya, experience is everything!",featuredVideo:{title:"Welcome",description:"Description not available",length:"1:59",kalturaId:"1_5se8ybie"},sections:[{id:"001",title:"This is Avaya",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-this-is-avaya.png",videos:[{title:"The Avaya Story",description:"Communication has come a long way since the invention of the telephone.  This trip down memory lane highlights the rich roots of Avaya’s history. ",length:"1:59",kalturaId:"1_uwh7edth"},{title:"This is Avaya",description:"Communication is at the heart of what drives relationships. We keep pushing technological boundaries and communication has become an experience.  This is what we do…it’s who we are…this is Avaya.",length:"1:59",kalturaId:"1_il5n27uq"}]},{id:"002",title:"The Avaya Way",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-avaya-way.png",videos:[{title:"The Avaya Way",description:"The Avaya Way is a strategy for maximizing sales performance.  Selling is getting more complex and we have some big challenges in sales.  Jonathan Buckle, Area Channel Leader - US West walks us through how to leverage the Avaya Way behaviors for success in selling. ",length:"1:59",kalturaId:"1_xf9f9afq"}]},{id:"003",title:"Customer Engagement",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-customer-engagement.png",videos:[{title:"Customer Engagement in the Digital Age",description:"In this video, watch as Joe Burton, EVP and CCO of Plantronics, and Laurent Philonenko, SVP of Corporate Strategy and Development and CTO at Avaya, discuss the importance of customer engagement in the digital age. Avaya and Plantronics partnership gave the San Jose Earthquakes the ability to engage with their customers on a personal level.",length:"1:59",kalturaId:"1_bcvskdx8"},{title:"Avaya Oceana - Managing the Customer Journey",description:"To know where a customer wants to go, you need to know where they've been. That's why Avaya Oceana gives your agents a complete picture of each customer's journey. This 45 second video provides a quick overview of managing the customer journey with Avaya Oceana.",length:"1:59",kalturaId:"0_krh8ymdy"},{title:"Avaya Oceana Solution: Redefine Your Customer’s Experience",description:"The Avaya Oceana Solution provides a personalized, relevant customer buying journey. Let’s look at how Avaya envisions engagement with perspective customers in this short video.",length:"1:59",kalturaId:"0_l1arvvz8"},{title:"Avaya Agent for Chrome",description:"Avaya Agent for Chrome combines Avaya expertise and customer engagement technologies. Set up a new contact center in a regional office, roll out a network of home based agents, or enable a disaster recovery plan that can quickly kick in in the event of a storm or another disruption. Thanks to Avaya and Google Chrome solutions, the tools needed to engage customers can be implemented anywhere.",length:"1:59",kalturaId:"0_o19kxzo6"},{title:"The Self Service Customer Journey",description:"The Self Service Customer Journey.  A look at how customers can utilize various self-service options to meet their needs on their schedule, from any location and on any device.",length:"1:59",kalturaId:"0_jslaxlhu"}]},{id:"004",title:"Team Engagement",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-team-engagement.png",videos:[{title:"Avaya Aura Platform: The Solution for Engagement",description:"Keeping your employees connected is a given in modern enterprises, but to go to the next level they need to engage. Avaya Aura Platform is the solution for engagement allowing you to integrate video and voice into any application on any device and to get persistent communications. There’s a reason 97% of Fortune’s fastest growing companies rely on Avaya. Stop waiting and switch to the leading solution today.",length:"1:59",kalturaId:"1_lezy81va"},{title:"Avaya Equinox Experience - Accelerate Your Business",description:"Avaya Equinox is a new kind of communications experience.  Call, message, meet, share-in the way that works best for you.  Experience this promotional video showing how Equinox accelerates the speed of business.",length:"1:59",kalturaId:"0_usln2rca"},{title:"Avaya Breeze",description:"Avaya Breeze Video",length:"1:59",kalturaId:"0_h3ucwc6y"},{title:"Avaya Breeze Customer Service Scenario",description:"Avaya Breeze is a new way to design, build, and implement communications applications. Customer experience is all about getting the connections working together for every customer, every time, and every device. Applications in your business such as event triggers, dynamic team formation, and prioritized customer communications can be enhanced with the latest collaboration and engagement capabilities.",length:"1:59",kalturaId:"1_hi5htnfz"},{title:"Get Work Done Fast - Avaya Communicator",description:"Wish there was a way to work with your team without all of them being in the same room or even region? Introducing Avaya Communicator, a platform that makes it simple to collaborate with your team. Communicator provides a way for embedding real time communications across applications like Salesforce, Google, and Office 365 and helps you get work done fast.",length:"1:59",kalturaId:"0_h6n2a5bp"},{title:"Welcome to Zang",description:"Learn about Zang, the most powerful cloud-based phone service.  The Zang Office phone app can work right from your laptop or mobile device.  Easy, reliable, scaleable…Zang Office.",length:"1:59",kalturaId:"0_5q4rpav2"}]},{id:"005",title:"Cloud",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-cloud.png",videos:[{title:"Avaya Cloud Services",description:"For today’s enterprise, the cloud is big.  Replace an up-front and often unpredictable capital expense with a predictable, stable operating expense.  Use the cloud to streamline the way you collaborate and engage resources. Avaya understands what it takes to deliver cloud solutions—take a look at this video to see just how.",length:"1:59",kalturaId:"1_8ujyk5qh"},{title:"Kroenke Case Study - Delivering the Ultimate Fan Experience",description:"See how Avaya and Kroenke Sports and Entertainment are changing the game by delivering extraordinary fan experiences. From WiFi to interactive fan engagement walls, the Pepsi Center stands out as one of the most innovative communications experiences for fans, and a reliable and more secure networking environment for its owners.",length:"1:59",kalturaId:"0_a3kjgxen"},{title:"San Jose Earthquakes Case Study",description:"Welcome to the Avaya Stadium, home of the San Jose Earthquakes. A team with a rich history in the Silicon Valley now has a stadium equipped with the cloud. Fans can get stats on the players easier, get video updates, order food from your seat, and have your actual ticket on your iPhone or Android device. This brand connection and engagement builds loyalty between the team and the fans, creating a one-of-a-kind sports environment that you’ll have to see to believe.",length:"1:59",kalturaId:"0_hnb1q11d"}]},{id:"006",title:"What's Next?",description:"",icon:"/static/avaya/assets/images/pre-boarding/icon-whats-next.png",videos:[{title:"Get Ready for Waypoints",description:"Once your start date arrives, you’ll begin our sales new hire onboarding program, WayPoints.  Watch this informative video for a sneak peek of what to expect as you begin your  Avaya WayPoints journey. ",length:"1:59",kalturaId:"1_bs4tzjuk"}]}]}]}};return{getRoomsData:function(){return preBoardingData},getAcademyData:function(){return academyData}}}),avayaBlog.factory("presslyService",function($http){var getHttpData=function(url,requestType){return $http({method:requestType,url:url})};return{getPerspectivesFeed:function(url,requestType){return getHttpData(url,requestType)},getDevelopersFeed:function(url,requestType){return getHttpData(url,requestType)}}}),avayaBlog.factory("purchaseOrderService",function($http,serviceBase,$q){return{savePO:function(fileData){return formData=fileData,deferred=$q.defer(),config={headers:{"Content-Type":void 0},transformRequest:angular.identity,transformResponse:angular.identity},$http.post(getFileUploadApi(),formData,config).then(function(response){deferred.resolve(response)}),deferred.promise;var formData,deferred,config},editPO:function(fileData){return formData=fileData,deferred=$q.defer(),config={headers:{"Content-Type":void 0},transformRequest:angular.identity,transformResponse:angular.identity},$http.post(editPOApi(),formData,config).then(function(response){deferred.resolve(response)}),deferred.promise;var formData,deferred,config},deletePO:function(fileData){return formData=fileData,deferred=$q.defer(),config={headers:{"Content-Type":void 0},transformRequest:angular.identity,transformResponse:angular.identity},$http.post(deletePOApi(),formData,config).then(function(response){deferred.resolve(response)}),deferred.promise;var formData,deferred,config},get:function(){return deferred=$q.defer(),setTimeout(function(){serviceBase.getData(getPurchaseOrderApi(),"").then(function(response){deferred.resolve(response.data.PO)},function(error){deferred.reject(error)})},1500),deferred.promise;var deferred}}}),avayaBlog.factory("serviceBase",function($http){return{getData:function(url,payLoad){return function(url,payload){return 1==App.debug?$http({method:"GET",url:url}):$http({method:"GET",url:url,headers:{Accept:"application/json","Content-Type":"application/json"}})}(url)},postData:function(url,payLoad){return function(url,payload){return"www-staging.avaya.com"!==window.location.hostname&&"localhost"!==window.location.hostname||console.log("Debug - serviceBase.postData payload",payload),$http({method:"POST",url:url,data:payload,headers:{Accept:"application/json","Content-Type":"application/json"}})}(url,payLoad)}}}),avayaBlog.factory("soldToService",function($http,$q,serviceBase,cartService){var shipToList=null;return{get:function(){return deferred=$q.defer(),serviceBase.getData(getShipToApi(),"").then(function(response){shipToList=response.data,deferred.resolve(shipToList)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getSoldToAddress:function(){return deferred=$q.defer(),serviceBase.getData(getSoldToListApi(),"").then(function(response){soldToList=response.data,deferred.resolve(soldToList)},function(error){deferred.reject(error)}),deferred.promise;var deferred},getCompanyDomain:function(){return deferred=$q.defer(),serviceBase.getData(getCompanyDomainApi(),"").then(function(response){deferred.resolve(response.data.data)},function(error){deferred.reject(error)}),deferred.promise;var deferred},validateCompanyDomain:function(val){return function(val){var payload={selectedDomain:val},deferred=$q.defer();return serviceBase.postData(validateCompanyDomainApi(),payload).then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(val)},getFreeTrialInfo:function(featuredSku){return function(featuredSku){var deferred=$q.defer();if(1==App.debug)var url=freetrialExceededCheck();else url=freetrialExceededCheck()+featuredSku+"/";return serviceBase.getData(url,"").then(function(response){deferred.resolve(response.data)},function(error){deferred.reject(error)}),deferred.promise}(featuredSku)}}}),avayaBlog.factory("standardTncService",function($http,$q,serviceBase){return{get:function(){return deferred=$q.defer(),serviceBase.getData(getstandardTncApi(),"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise;var deferred},sendGeneralTncDocument:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(sendGeneralTermsConditionsApi(),payload).then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise}(payload)}}}),avayaBlog.factory("termsConditionsService",function($http,$q,serviceBase){return{get:function(entityId){return function(entityId){var deferred=$q.defer(),param=entityId?entityId+"/":"",url=gettermsConditionsApi()+param;1==App.debug&&(url=gettermsConditionsApi());return serviceBase.getData(url,"").then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise}(entityId)},sendTncDocument:function(payload){return function(payload){var deferred=$q.defer();return serviceBase.postData(sendTermsConditionsDocumentApi(),payload).then(function(response){var headers=response.headers();deferred.resolve(response.data,headers)},function(error){deferred.reject(error)}),deferred.promise}(payload)}}}),avayaBlog.factory("tvActionService",function($resource,tvDataService){var tvData={selectedCategoryId:null,selectedCategoryDescription:null,browseTopicsList:[],searchData:{topic:null,searchKeywords:null},searchResults:{videos:[]},viewType:null};function saveSessionData(varName,value){document.cookie=varName+"="+value+";path=/"}function getSessionData(varName){var str=document.cookie;str=str.split("; ");for(var result={},i=0;i<str.length;i++){var cur=str[i].split("=");result[cur[0]]=cur[1]}return result[varName]}return{getInitialState:function(stateName){var browseTopic="CATEGORY"==stateName?getSessionData("browseTopic"):"FILTER";browseTopic&&(tvData.searchData.browseTopic=browseTopic);var searchKeywords="SEARCH"==stateName?getSessionData("searchKeywords"):"";return searchKeywords&&(tvData.searchData.searchKeywords=searchKeywords),tvData},saveViewType:function(viewType){tvData.viewType=viewType},getViewType:function(){return tvData.viewType},saveCategory:function(topic){},saveTopic:function(topic){saveSessionData("browseTopic",topic)},saveTopicIdList:function(topic){saveSessionData("browseTopicIdList",JSON.stringify(topic))},getTopicIdList:function(topic){var topicIdList=getSessionData("browseTopicIdList");return topicIdList?JSON.parse(topicIdList):{}},saveKeywords:function(keywords){saveSessionData("searchKeywords",keywords)}}}),avayaBlog.factory("tvDataService",function($resource){function urlEncode(value){return value.replace(" ","").replace(":","").replace("&","").replace("?","")}function getData(url){return $resource(url,{},{query:{method:App.constants.requestType}}).query().$promise}return{getVideoList:function(channel,topic,tag,limit,locale){var searchQueryString=function(channel,topic,tag,limit,locale){var queryString="&channel="+("ALL"==channel?"":urlEncode(channel));return queryString+="&topic="+("ALL"==topic?"":urlEncode(topic)),queryString+="&tag="+tag,queryString+="&limit="+limit,queryString+="&locale="+locale,queryString+="&startrow=1",queryString+="&endrow="+limit}(channel,topic,tag,limit,locale);return $resource(App.urls.tvDataUrl+searchQueryString,{},{query:{method:App.constants.requestType}}).query().$promise},getCategoryList:function(){return getData(App.urls.tvHomePageDataUrl)},getVideos:function(searchData,categoryId,idList){if("no data"==searchData.searchKeywords||"Cloud"==searchData.browseTopic)return getData(App.urls.tvNoDataUrl);return getData(searchData.browseTopic&&0<searchData.browseTopic.length?App.urls.tvCategoryUrl+encodeURIComponent(JSON.stringify(idList)):App.urls.tvSearchUrl+searchData.searchKeywords)},getTopics:function(){return getData(App.urls.tvTopicUrl)},getVideoDetails:function(videoId,category){return getData(App.urls.tvDetailUrl+videoId+"&category="+category)},getIdList:function(category,mapping){var categoryList=category.split("|"),idMapping={};_.each(mapping,function(category){idMapping[category.description.replace("-"," ").replace("&","").toLowerCase()]=category});var idList={channel:[],contenttype:[],language:[]};return _.each(categoryList,function(item){item&&idList[idMapping[item.toLowerCase().replace("&","")].type.toLowerCase()].push(idMapping[item.toLowerCase().replace("&","")].id)}),idList},getFeaturedList:function(locale){return getData(App.urls.tvFeaturedDataUrl+"&locale="+locale)},getTranscripts:function(language,videoId){return getData(App.urls.tvTranscriptsDataUrl+"&lang="+language+"&vid="+videoId)}}}),avayaBlog.factory("userSession",function($http,serviceBase){function getCookie(cookieName){for(var name=cookieName+"=",ca=decodeURIComponent(document.cookie).split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}return{getDetails:function(){return{firstName:getCookie("first_name")}},valid:function(){return!(!(sessionCookie=getCookie("SMSESSION"))||"No"==sessionCookie||"LOGGEDOFF"==sessionCookie||""==sessionCookie);var sessionCookie},isLoggedIn:function(){return!(!(smSession=$(".app-urls").find("#smsession-cookie").text())||"No"==smSession||"LOGGEDOFF"==smSession||""==smSession);var smSession}}}),avayaBlog.factory("webtrendsService",function(){var locatorData={areaSearched:"",country:"",partnerName:"",capability:"",level:"",solutionSize:""},locatorEventTypes={landingPage:{z_engage:"",dl:"0",dcsuri:"/en/flexpartnerlocator/",ti:"Partner Search - Landing"},searchResults:{z_engage:"",dl:"0",dcsuri:"/en/flexpartnerlocator/results",ti:"Partner Search - Results"},searchFilterUpdate:{z_engage:"Partner Filter Update",dl:"36",dcsuri:"/en/flexpartnerlocator/results/filterupdate",ti:"Partner Search - Filter Update"},partnerViewList:{z_engage:"Partner View",dl:"0",dcsuri:"/en/flexpartnerlocator/results/partnerview/list",ti:"Partner Search - View Partner"},partnerViewMap:{z_engage:"Partner View",dl:"0",dcsuri:"en/flexpartnerlocator/results/partnerview/map",ti:"Partner Search - View Partner"}},currentStep=null,locale=$("html").attr("lang"),multiTrack=function(si_n,si_p,si_e,uri){window.Webtrends?window.Webtrends.multiTrack({argsa:["WT.si_n",si_n,"WT.si_p",si_p,"WT.si_e",si_e,"DCS.dcsuri",uri,"WT.ti","solutions finder","WT.dl","36"]}):console.log(JSON.stringify({argsa:["WT.si_n",si_n,"WT.si_p",si_p,"WT.si_e",si_e,"DCS.dcsuri",uri,"WT.ti","solutions finder","WT.dl","36"]}))},steps={q1:{si_p:"business industry",uri:"/"+locale+"/solutions-finder/industry/"},q2:{si_p:"business size",uri:"/"+locale+"/solutions-finder/size/"},q3:{si_p:"area of interest",uri:"/"+locale+"/solutions-finder/area-of-interest/"},q4:{si_p:"business challenges",uri:"/"+locale+"/solutions-finder/business-challenges/"}};return{init:function(locale){},entry:function(){multiTrack("solutions finder",currentStep="sf entry",null,"/"+locale+"/solutions-finder/entry/")},step:function(step){currentStep=steps[step].si_p,multiTrack("solutions finder",steps[step].si_p,null,steps[step].uri)},restart:function(){multiTrack("solutions finder",currentStep,"restart","/"+locale+"/solutions-finder/restart/")},restartCancel:function(){multiTrack("solutions finder",currentStep,"restart cancel","/"+locale+"/solutions-finder/restart/cancel/")},restartConfirm:function(){multiTrack("solutions finder",currentStep,"restart confirm","/"+locale+"/solutions-finder/restart/confirm/")},complete:function(){multiTrack("solutions finder",currentStep="solutions finder complete",null,"/"+locale+"/solutions-finder/complete/")},skipName:function(){multiTrack("solutions finder",currentStep,"skip","/"+locale+"/solutions-finder/skip/")},minimize:function(){multiTrack("solutions finder",currentStep,"minimize","/"+locale+"/solutions-finder/minimize/")},maximize:function(){multiTrack("solutions finder",currentStep,"maximize","/"+locale+"/solutions-finder/maximize/")},close:function(){multiTrack("solutions finder",currentStep,"close","/"+locale+"/solutions-finder/close/")},viewResults:function(){multiTrack("solutions finder",currentStep="see my results button click",null,"/"+locale+"/solutions-finder/see-my-results/")},getResults:function(industry,size,interest,challenge,update){var argumentsArray=["WT.sitesection","Solutions Finder","WT.cg_n","Solutions Finder Results","WT.sf_industry",industry,"WT.sf_bsize",size,"WT.sf_interest",interest,"WT.sf_challenge",challenge];update&&(argumentsArray=argumentsArray.concat(["WT.dl","36","WT.z_engage","Solutions Finder Update"])),window.Webtrends&&Webtrends.multiTrack({argsa:argumentsArray})},emailResults:function(){window.Webtrends&&Webtrends.multiTrack({argsa:["WT.sitesection","Solutions Finder","WT.cg_n","Solutions Finder Results","WT.dl","36","WT.z_engage","Solutions Finder Email My Results"]})},clickTab:function(tabTitle){window.Webtrends&&Webtrends.multiTrack({argsa:["WT.sitesection","Solutions Finder","WT.cg_n","Solutions Finder Results","WT.dl","36","WT.z_engage","Tab Click: "+tabTitle]})},playVideo:function(id,title,duration){window.Webtrends?setTimeout(function(){Webtrends.multiTrack({argsa:["WT.dl","40","WT.clip_ev","Play","WT.clip_n",title,"WT.clip_id",id,"WT.clip_duration",duration,"WT.clip_player","KalturaJS"]})},3e3):console.log(JSON.stringify({argsa:["WT.dl","40","WT.clip_ev","Play","WT.clip_n",title,"WT.clip_id",id,"WT.clip_duration",duration,"WT.clip_player","KalturaJS"]}))},clickCard:function(ip,uri,title,section,dl){window.Webtrends&&Webtrends.multiTrack({argsa:["WT.sitesection","Solutions Finder","WT.cg_n","Solutions Finder Results","WT.dl",dl||36,"DCS.dcssip",ip,"DCS.dcsuri",uri,"WT.ti","Click - "+title,"WT.nv",section]}),console.log(JSON.stringify({argsa:["WT.sitesection","Solutions Finder","WT.cg_n","Solutions Finder Results","WT.dl",dl||36,"DCS.dcssip",ip,"DCS.dcsuri",uri,"WT.ti","Click - "+title,"WT.nv",section]}))},setLocatorAreaSearched:function(area){locatorData.areaSearched=area},setLocatorCountry:function(country){locatorData.country=country},setLocatorPartnerName:function(partnerName){locatorData.partnerName=partnerName},setLocatorCapability:function(capability){locatorData.capability=capability},setLocatorLevel:function(level){locatorData.level=level},setLocatorSolutionSize:function(size){locatorData.size=size},multiTrackLocatorEvent:function(eventType){var action=locatorEventTypes[eventType];window.Webtrends?Webtrends.multiTrack({argsa:["WT.z_engage",action.z_engage,"WT.dl",action.dl,"WT.z_partner_search",locatorData.areaSearched,"WT.partner_country",locatorData.country,"WT.z_partner",locatorData.partnerName,"WT.z_partner_capability",locatorData.capability,"WT.z_partner_level",locatorData.level,"WT.z_partner_solutionsize",locatorData.size,"DCS.dcsuri",action.dcsuri,"WT.ti",action.ti]}):console.log(JSON.stringify({argsa:["WT.z_engage",action.z_engage,"WT.dl",action.dl,"WT.z_partner_search",locatorData.areaSearched,"WT.partner_country",locatorData.country,"WT.z_partner",locatorData.partnerName,"WT.z_partner_capability",locatorData.capability,"WT.z_partner_level",locatorData.level,"WT.z_partner_solutionsize",locatorData.size,"DCS.dcsuri",action.dcsuri,"WT.ti",action.ti]}))}}}),avayaBlog.directive("_mapView",function(locatorService){return{restrict:"EA",template:'<div id="mapView" layout="row" style="height: 700px;width: 100%";">\t\t\t\t\t  <div class="map" id="map-canvas" style="width: 100%; height: inherit;"></div>\t\t\t\t\t  </div>',link:function($scope,element,attr){var loader=$(".page-level-loader");loader.addClass("show-loader");var createMarkers=function(info,map){var marker=new google.maps.Marker({map:map,position:new google.maps.LatLng(info.latitude,info.longitude),loc:info.location,location:info,label:"4.5"});google.maps.event.addListener(marker,"click",function(){$scope.displayLocation(marker.location)}),google.maps.event.addListener(marker,"mouseover",function(){infoWindow.setContent("<div>"+info.name+"</div>"),infoWindow.open($scope.map,marker)}),google.maps.event.addListener(marker,"mouseout",function(){infoWindow.close()}),$scope.markers.push(marker);var infoWindow=new google.maps.InfoWindow({pixelOffset:new google.maps.Size(100,50)});$scope.openInfoWindow=function(e,selectedMarker){e.preventDefault(),google.maps.event.trigger(selectedMarker,"click")}};$scope.clearMarkers=function(){for(var i=0;i<$scope.markers.length;i++)$scope.markers[i].setMap(null)},$scope.mapNodes=function(num,map){if($scope.markers=[],$scope.clearMarkers(),$scope.nodes=num,null!=$scope.nodes)for(var i=0;i<$scope.nodes.length;i++)createMarkers($scope.nodes[i],map),$scope.mapDataFetched=!0};var input=document.getElementById("pac-input"),map=new google.maps.Map(document.getElementById("map-canvas"),{center:{lat:32.94161,lng:-97.01155},zoom:16});$(".overlay").addClass("show"),$(".partner-details-wrap").addClass("show");var mapPartner=new google.maps.Map(document.getElementById("map-canvas-partner"),{center:{lat:32.94161,lng:-97.01155},zoom:16});map.addListener("zoom_changed",function(event){if($scope.enableEvents){map.getBounds();$scope.redoMap=!0;var center=map.getCenter();console.log("Center: "+center.lat()+" "+center.lng())}}),google.maps.event.addListener(map,"center_changed",function(){if(this.mouseDown,$scope.enableEvents){$scope.redoMap=!0;var center=map.getCenter();console.log("Center: "+center.lat()+" "+center.lng())}}),$scope.nearbyPartnersList=[{location:"4462623",address:"5331 E MOCKINGBIRD LN~DALLAS~Texas~US",lat:32.8373077,lng:-96.77639699999999,name:"Universal Exports",addressMap:{street:"5331 E MOCKINGBIRD LN",state:"Texas",country:"US",city:"DALLAS"}}],$scope.mapNodes($scope.nearbyPartnersList,mapPartner);var laLatLng=new google.maps.LatLng(32.8373077,-96.77639699999999);mapPartner.panTo(laLatLng),setTimeout(function(){$(".partner-details-wrap").removeClass("show"),$(".overlay").removeClass("show"),loader.removeClass("show-loader")},1e3);var marker=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});google.maps.MapTypeId.ROADMAP;(new google.maps.Geocoder).geocode({address:"United Kingdom"},function(results,status){status==google.maps.GeocoderStatus.OK?(map.setCenter(results[0].geometry.location),map.setZoom(3)):alert("Could not find location: "+location)});var autocomplete=new google.maps.places.Autocomplete(input,{types:["(regions)"]});autocomplete.addListener("place_changed",function(){marker.setVisible(!1);var place=autocomplete.getPlace(),latitude=place.geometry.location.lat(),longitude=place.geometry.location.lng();if(place.geometry){displayPartners(latitude,longitude),place.geometry.viewport?map.fitBounds(place.geometry.viewport):map.setCenter(place.geometry.location),$scope.enableEvents=!0;place.address_components&&[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")}else window.alert("No details available for input: '"+place.name+"'")});var displayPartners=function(latitude,longitude){locatorService.getLocations(latitude,longitude).then(function(response){$scope.locationList=response.location,$scope.mapNodes($scope.locationList,map)},function(error){console.log("error fetching locations.")})}}}}),avayaBlog.directive("countryDropdown",function(locatorService,layoutService){return{restrict:"EA",template:'<div class="filter-dropdown country-dropdown" ng-class="{ \'show\': showCountryDropdown }">\t\t\t\t\t\t<div class="column wide">\t\t\t\t\t\t\t<div class="section">\t\t\t\t\t\t\t\t<div class="title" ng-bind="labels.PLselectcountry"></div>\t\t\t\t\t\t\t\t<div class="list">\t\t\t\t\t\t\t\t\t<div ng-repeat="country in countries" ng-click="selectCountry( country )"><span><i class="fa" ng-class="{ \'fa-check\': country.code == selectedCountry }"></i><span class="item">{{ country.name }}</span></span></div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t</div>',link:function($scope,element,attr){layoutService.registerCountryChange(function(){$scope.selectedCountry=layoutService.getCountry().code}),$scope.selectCountry=function(country){layoutService.setCountry(country),$scope.showCountryDropdown=!1,$scope.selectedCountry=country.code};var keyword="",startTime=0,labelButton=$(".title.country-button"),listItems=$(element).find(".list");labelButton.on("keydown",function(event){if(63<event.which&&event.which<91){var found=!1;if(0==Number(startTime))startTime=(new Date).getTime(),keyword+=String.fromCharCode(event.which).toLowerCase();else{var newKeyTime=(new Date).getTime()-Number(startTime);Number(newKeyTime)<1e3?(startTime=(new Date).getTime(),keyword+=String.fromCharCode(event.which).toLowerCase()):(startTime=0,keyword=String.fromCharCode(event.which).toLowerCase())}_.each(listItems.find(".item"),function(listItem){0==found&&$(listItem).text().toLowerCase().startsWith(keyword)&&(listItems.find(".item").removeClass("hover"),$(listItem).addClass("hover"),found=!0,$(element).find(".filter-dropdown")[0].scrollTop=$(listItem)[0].offsetTop-50)})}if(13==event.which){var selectedItem=listItems.find(".item.hover");0<selectedItem.length&&($scope.displayValue=selectedItem.text(),selectedItem.removeClass("hover"),selectedItem.click())}event.stopPropagation(),event.preventDefault()})}}}),avayaBlog.directive("directoryListings",function(locatorService,directoryService,$window){return{restrict:"EA",template:'<div class="results">\t\t\t\t\t\t<div class="search-status" ng-show=" resultsFetched == true ">\t\t\t\t\t\t\t<span class="directory-result-status">\t\t\t\t\t\t\t\t<span>{{ resultsText }}</span>\t\t\t\t\t\t\t\t. <span ng-hide="noResults == true">{{ labels.PLClickLinkViewDetails }}.</span></span>\t\t\t\t\t\t\t</span>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="locations-grid">\t\t\t\t\t\t\t<div ng-repeat="location in directoryListing" ng-click="displayDirectoryLocation( location.partnerId, location.distance )">\t\t\t\t\t\t\t\t<span ng-bind="location.name"></span><span ng-show="location.city">, {{ location.city }}</span>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t</div>',link:function($scope,element,attr){var loader=$(".page-level-loader"),partnerDetailsWrap=$(".partner-details-wrap"),mapCenter_lat=0,mapCenter_lng=0,header=$(".app-header");$scope.displayDirectoryLocation=function(partnerId,distance){loader.addClass("show-loader"),header.css("display","none"),locatorService.getPartnerDetails(partnerId).then(function(response){$scope.selectedPartner=response.data.data.partner,$scope.selectedPartner.distance=distance,$scope.nearbyLocations=response.data.data.nearByPartners,$(".partner-details").css("display",""),partnerDetailsWrap.addClass("show"),$(".detail-wrap").css("display","block"),$(".main-container").css("display","none"),window.mapPartner.setCenter(new google.maps.LatLng(Number(mapCenter_lat),Number(mapCenter_lng)));var marker=new google.maps.Marker({position:{lat:Number($scope.selectedPartner.latitude),lng:Number($scope.selectedPartner.longitude)},map:window.mapPartner}),bounds=new google.maps.LatLngBounds;bounds.extend(marker.getPosition()),window.mapPartner.fitBounds(bounds),window.mapPartner.setZoom(16),loader.removeClass("show-loader")},function(){loader.removeClass("show-loader"),console.log("unable to retrieve partner details.")})}}}}),avayaBlog.directive("directorySearch",function(locatorService,directoryService,layoutService){return{restrict:"EA",template:'<div class="directory-search" ng-show="searchType == \'name\'">\t\t\t\t\t\t<div class="description" ng-bind="labels.PLSelectLocationPartnerName"></div>\t\t\t\t\t\t<div class="search-bar search-bar-name">\t\t\t\t\t\t\t<div class="controls">\t\t\t\t\t\t\t\t<div class="step-label" ng-bind="labels.PLSelectLocation"></div>\t\t\t\t\t\t\t\t<div locator-dropdown class="select-country" title="Select country..." list="countries" selectedcode="selectedDirectoryCountry" callback="countrySelectedCallback( code, id, name, total )"></div>\t\t\t\t\t\t\t\t<div locator-dropdown class="select-state" ng-hide="hideState == true" title="{{labels.PLSelectState}}" list="states" selectedcode="selectedState" callback="stateSelectedCallback( code, id, name )"></div>\t\t\t\t\t\t\t\t\x3c!--<div locator-dropdown class="select-city" ng-hide="hideCity == true" title="Select city..." list="cities" selectedcode="selectedCity" callback="citySelectedCallback( code, id, latitude, longitude, name)"></div>--\x3e\t\t\t\t\t\t\t\t<div class="instructions"><span ng-hide="enableSearch() == true || countryCategory == \'4\' " ng-bind="labels.PLSelectLocationContinue"></span></div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="search-box">\t\t\t\t\t\t\t\t<div class="step-label" ng-bind="labels.PLSearchForAvayaPartner"></div>\t\t\t\t\t\t\t\t<input type="text" class="partner-name" ng-model="keywords" aria-label="{{ labels.PLSearchPartnerName }}" placeholder="{{ labels.PLSearchPartnerName }}">\t\t\t\t\t\t\t\t<i class="fa fa-search" ng-click="searchDirectory();" ng-class="{ \'disabled\': enableSearch() == false }"></i>\t\t\t\t\t\t\t\t<div class="instructions">\t\t\t\t\t\t\t\t\t<span ng-hide="countryCategory == \'4\' || keywords.length > 0 " ng-bind="labels.PLEnterPartnerNameToSeeResults"></span>\t\t\t\t\t\t\t\t\t<span ng-hide="countryCategory == \'4\' || keywords.length > 2 || keywords.length == 0 || enableSearch() == false " ng-bind="labels.PLMinumumCharactersRequired"></span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="directory-listings" id="directory-listings" directory-listings>\t\t\t\t\t\t</div>\t\t\t\t\t</div>',replace:!0,link:function($scope,element,attr){var countryDetected=!1,highliter=new Highliter("directory-listings");$scope.selectedState="",$scope.selectedCity="",$scope.hideState=!0,$scope.hideCity=!0,$scope.countryCategory=0;layoutService.registerCountryChange(function(){0==countryDetected&&(countryDetected=!0,$scope.selectedDirectoryCountry=layoutService.getCountry().code)}),$scope.selectCountry=function(country){$scope.clearResults(),layoutService.setCountry(country),$scope.showCountryDropdown=!1,$scope.selectedDirectoryCountry=country.code,directoryService.setCountry(country.code)};$scope.countrySelectedCallback=function(code,id,name,total){$scope.selectedDirectoryCountry=code,$scope.selectedDirectoryCountryId=id,$scope.selectedCountryName=name,$scope.keywords="",$scope.selectedState="",$scope.selectedCity="",$scope.latitude=null,$scope.longitude=null,$scope.resultsFetched=!1,"US"==code||"CA"==code?(!function(id){$scope.hideState=!0,$scope.hideCity=!0,directoryService.getStates(id).then(function(response){$scope.states=response.data.data.states,$scope.hideState=!1},function(){console.log("unable to fetch states for: US"),$scope.states=[]})}(id),$scope.countryCategory="1"):49<total?(!function(code,id){$scope.hideCity=!0,directoryService.getCitiesByCountry(code,id).then(function(response){if($scope.hideCity=!1,1==App.debug)if("a0B30000002tF8eEAE"==id)$scope.cities=response.data.data.cities;else{var cities;cities=_.filter(response.data.data.cities,function(item){return item.state==code}),$scope.cities=cities}else $scope.cities=response.data.data.cities},function(){console.log("unable to fetch cities for: US")})}(code,id),$scope.hideState=!0,$scope.countryCategory="2"):4<total?($scope.hideState=!0,$scope.hideCity=!0,$scope.countryCategory="3"):($scope.countryCategory="4",$scope.hideState=!0,$scope.hideCity=!0,$scope.keywords="",$scope.searchDirectory("",$scope.selectedDirectoryCountryId)),$scope.directoryListing=[]},$scope.stateSelectedCallback=function(code,id,name){$scope.selectedStateName=name,$scope.selectedState=code,$scope.selectedStateId=id,$scope.keywords="",$scope.selectedCity="",$scope.latitude=null,$scope.longitude=null,$scope.clearResults()},$scope.citySelectedCallback=function(code,id,latitude,longitude,name){$scope.selectedCity=name,$scope.latitude=latitude,$scope.longitude=longitude,$scope.clearResults()},$scope.searchDirectory=function(){("4"==$scope.countryCategory||$scope.keywords&&2<$scope.keywords.length)&&($scope.showLoader(),directoryService.getListing($scope.keywords,$scope.selectedDirectoryCountryId,null,null,"1"==$scope.countryCategory?$scope.selectedStateId:null).then(function(response){$scope.directoryListing=response.data.data.locations,$scope.highlightedKeywords=$scope.keywords,$scope.resultsFetched=!0,$scope.prepareFilterMetadata(response.data.data.filters);var selectedRegion=$scope.selectedCountryName;"1"==$scope.countryCategory&&(selectedRegion=$scope.selectedStateName+", "+selectedRegion),$scope.directoryListing&&0<$scope.directoryListing.length?($scope.noResults=!1,$scope.resultsText=$scope.labels.PLResultsText.replace("{var3country}",selectedRegion).replace("{var1nbr}",$scope.directoryListing.length),setTimeout(function(){highliter.setMatchType("left"),highliter.apply($scope.highlightedKeywords)},20)):($scope.resultsText=$scope.labels.PLResultsText.replace("{var3country}",selectedRegion).replace("{var1nbr}","0"),$scope.noResults=!0),$scope.hideLoader(0)},function(error){$scope.resultsFetched=!0,$scope.noResults=!0,$scope.hideLoader(0),console.log("directory search failed")}))},$scope.clearResults=function(){$scope.directoryListing=[],$scope.resultsFetched=!1,highliter.apply("")},$scope.enableSearch=function(){return!(1!=$scope.countryCategory||!$scope.selectedState)||(2==$scope.countryCategory||(3==$scope.countryCategory||($scope.countryCategory,!1)))},$(element).find(".partner-name").on("keydown",function(event){13==event.which&&(event.stopPropagation(),event.preventDefault(),1==$scope.enableSearch()&&$scope.searchDirectory())})}}}),avayaBlog.directive("filterBar",function(locatorService,layoutService){return{restrict:"EA",template:'<span class="filter-bar"><span class="icon country-icon" ng-class="{ \'active\': showCountryDropdown }" ng-click="showCountries( $event )"><i class="fa fa-globe"></i><input type="button" class="title country-button" aria-label="Country Name" value="{{ countryName }}"></span>\t\t\t\t\t<span class="icon filter-icon" ng-class="{ \'active\': showFilterDropdown, \'disabled\': disableFilter }" ng-click="showFilter()"><i class="fa fa-filter"></i><span class="title" ng-bind="labels.PLFilter"></span><span class="filter-count"><p ng-class="{ \'show\': filterCount > 0 }">{{ filterCount }}</p></span></span>\t\t\t\t\t<span class="icon list-toggle" ng-click="displayMap()">\t\t\t\t\t\t<i class="fa" ng-class="showListIcon == true ? \'fa-list\' : \'fa-map-marker\' "></i><span class="title" ng-show="showListIcon == true">{{ labels.PLListView }}</span><span class="title" ng-show="showListIcon != true">{{ labels.PLMapView }}</span>\t\t\t\t\t</span>\t\t\t\t\t</span>',replace:!0,link:function($scope,element,attr){$scope.disableFilter=!0,locatorService.register(function(){var locations=locatorService.getData().locations;$scope.disableFilter=!(locations&&0<locations.length)}),locatorService.registerFilterChange(function(){var filter=locatorService.getFilter();$scope.filterCount=filter.count})}}}),avayaBlog.directive("filterDropdown",function(locatorService){return{restrict:"EA",template:'<div>\t\t\t\t\t<div class="filter-dropdown filter-mobile" ng-class="{ \'show\': showFilterDropdown }">\t\t\t\t\t\t<div class="column-wrap">\t\t\t\t\t\t\t<div class="column wide">\t\t\t\t\t\t\t\t<div class="section">\t\t\t\t\t\t\t\t\t<div class="title" ng-bind="filters.capability.description"></div>\t\t\t\t\t\t\t\t\t<div class="list">\t\t\t\t\t\t\t\t\t\t<div ng-repeat="(key, value) in filters.capability.types" ng-click="checkFilter( \'capability\', key, $event )">\t\t\t\t\t\t\t\t\t\t\t<input type="checkbox">\t\t\t\t\t\t\t\t\t\t\t<label class="checkbox-label"></label>\t\t\t\t\t\t\t\t\t\t\t<span class="item-label" ng-bind-html="value"></span></div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="column wide">\t\t\t\t\t\t\t\t<div class="section">\t\t\t\t\t\t\t\t\t<div class="title"><p ng-bind="filters.partnerLevel.description"></p><i class="fa fa-info-circle" ng-click="showPartnerLevels()"></i></div>\t\t\t\t\t\t\t\t\t<div class="list">\t\t\t\t\t\t\t\t\t\t<div ng-repeat="(key, value) in filters.partnerLevel.types" ng-click="checkFilter( \'partnerLevel\', key, $event )">\t\t\t\t\t\t\t\t\t\t\t<input type="checkbox">\t\t\t\t\t\t\t\t\t\t\t<label class="checkbox-label"></label>\t\t\t\t\t\t\t\t\t\t\t<span class="item-label" ng-bind-html="value"></span></div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="column">\t\t\t\t\t\t\t\t<div class="section">\t\t\t\t\t\t\t\t\t<div class="title" ng-bind="filters.solutionSize.description"></div>\t\t\t\t\t\t\t\t\t<div class="list">\t\t\t\t\t\t\t\t\t\t<div ng-repeat="(key, value) in filters.solutionSize.types" ng-click="checkFilter( \'solutionSize\', key, $event )">\t\t\t\t\t\t\t\t\t\t\t<input type="checkbox">\t\t\t\t\t\t\t\t\t\t\t<label class="checkbox-label"></label>\t\t\t\t\t\t\t\t\t\t\t<span class="item-label" ng-bind-html="value"></span></div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="clear-all" ng-click="clearAllFilters()"><a>X {{ labels.PLClearAllFilters }}</a></div>\t\t\t\t\t</div>\t\t\t\t\t<div class="partner-levels" ng-class="{ \'show\': displayPartnerLevels == true }">\t\t\t\t\t\t<div class="content">\t\t\t\t\t\t\t<div class="name"><p ng-bind="partnerLevels.labelkey"></p><i class="fa fa-close" ng-click="hidePartnerLevels()"></i></div>\t\t\t\t\t\t\t<p ng-bind-html="partnerLevels.labelvalue"></p>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>',link:function($scope,element,attr){locatorService.getPartnerLevels().then(function(response){$scope.partnerLevels=response.data.data.Labels[0]},function(error){});var filterCount=0,filterData={capability:[],solutionSize:[],partnerLevel:[]};locatorService.register(function(){$scope.filters=locatorService.getData().filters}),$scope.checkFilter=function(type,key,event){var removed=_.remove(filterData[type],function(item){return item===key}),eventObject="DIV"==event.target.nodeName?$(event.target):$(event.target).parent();0==removed?(filterData[type].push(key),filterCount+=1,eventObject.find(".item-label").addClass("selected"),eventObject.find(".checkbox-label").addClass("selected"),eventObject.find("input").attr("checked",!0)):(filterCount-=1,eventObject.find(".item-label").removeClass("selected"),eventObject.find(".checkbox-label").removeClass("selected"),eventObject.find("input").attr("checked",!1)),filterData.count=filterCount,locatorService.changeFilter(filterData)};$scope.clearAllFilters=function(){filterData.capability=[],filterData.solutionSize=[],filterData.partnerLevel=[],$(element).find(".item-label").removeClass("selected"),$(element).find(".checkbox-label").removeClass("selected"),$(element).find("input").attr("checked",!1),$scope.filterCount=0,filterData.count=0,filterCount=0,locatorService.changeFilter(filterData)}}}}),avayaBlog.directive("locationDetails",function(locatorService){return{restrict:"EA",template:'<div class="location-details" ng-class="{ \'show\': displayLocationDetails == true }">\t\t\t\t\t\t<div class="content">\t\t\t\t\t\t\t<div class="name"><p ng-click="locationDetails( partnerDetails );" ng-bind-html="partnerDetails.name"></p><i class="fa fa-close" ng-click="hideLocation()"></i></div>\t\t\t\t\t\t\t\x3c!--<p class="rating-badge">4.0&nbsp;&nbsp;<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star gray"></i><strong>&nbsp;&nbsp;&nbsp;8 reviews</strong></p>--\x3e\t\t\t\t\t\t\t<div class="status">\t\t\t\t\t\t\t\t<span class="level" ng-click="showPartnerLevels()">{{ partnerLevelDescriptions[ partnerDetails.partnerLevel[ 0 ] ] }}<i class="fa fa-info-circle"></i></span>\t\t\t\t\t\t\t\t<span class="level excellence" ng-show="partnerDetails.excellenceDesc">{{ labels.PLExcellenceDesc }}</span>\t\t\t\t\t\t\t\t\x3c!--<span class="logo"><img src="/static/avaya/assets/images/partner-locator/buynlarge-logo.png"></span>--\x3e\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="features">\t\t\t\t\t\t\t\t<div class="title" ng-bind="filters.capability.description"></div>\t\t\t\t\t\t\t\t<div class="features-list">\t\t\t\t\t\t\t\t\t<span ng-repeat="capability in partnerDetails.capability" track by $index><i class="fa {{ iconMap[ capability ] }}"></i>{{ formatFeature( filters.capability.types[ capability ] ) }}</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="features" ng-show="partnerDetails.size && partnerDetails.size.length > 0">\t\t\t\t\t\t\t\t<div class="title" ng-bind="filters.solutionSize.description"></div>\t\t\t\t\t\t\t\t<div class="features-list">\t\t\t\t\t\t\t\t\t<span ng-repeat="size in partnerDetails.size track by $index"><i class="fa {{ iconMap[ size ] }}"></i>{{ formatFeature( filters.solutionSize.types[ size ] ) }}</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t</div>',link:function($scope,element,attr){locatorService.register(function(){$scope.filters=locatorService.getData().filters}),$scope.formatFeature=function(value){return value.substring(0,value.indexOf("(")-1)},$scope.locationDetails=function(partner){$scope.displayLocationDetails=!1,$scope.hidePartnerLevels(),window.displayPartner(partner.partnerId,partner.distance)}}}}),avayaBlog.directive("locatorDropdown",function(locatorService,layoutService){return{restrict:"EA",scope:{title:"@",list:"=",selectedcode:"=",callback:"&"},template:'<div class="locator-dropdown country-dropdown" g-class="{ \'show\': showCountryDropdown }">\t\t\t\t\t\t<div ng-click="toggleDropdown()">\t\t\t\t\t\t\t<div class="title"><input class="label-button" type="button" value="{{ displayValue || title }}"><i class="fa fa-chevron-down"></i></div>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="list-wrap" ng-show="showList == true">\t\t\t\t\t\t\t<div class="selected-item" ng-show="displayValue"><i class="fa fa-check"></i>{{ displayValue }}</div>\t\t\t\t\t\t\t<div class="list">\t\t\t\t\t\t\t\t<span ng-repeat="item in list" class="item" ng-click="selectItem( item )" ng-hide="item.code == selectedcode">{{ item.name }}\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t</div>',replace:!0,link:function($scope,element,attr){var title=$(element).find(".title"),listItems=$(element).find(".list"),labelButton=$(element).find(".label-button"),keyword="",startTime=0;title.on("keydown",function(event){if(63<event.which&&event.which<91){var found=!1;if(0==Number(startTime))startTime=(new Date).getTime(),keyword+=String.fromCharCode(event.which).toLowerCase();else{var newKeyTime=(new Date).getTime()-Number(startTime);Number(newKeyTime)<1e3?(startTime=(new Date).getTime(),keyword+=String.fromCharCode(event.which).toLowerCase()):(startTime=0,keyword=String.fromCharCode(event.which).toLowerCase())}_.each(listItems.find(".item"),function(listItem){0==found&&$(listItem).text().toLowerCase().startsWith(keyword)&&(listItems.find(".item").removeClass("hover"),$(listItem).addClass("hover"),$(element).find(".list")[0].scrollTop=$(listItem)[0].offsetTop-50,found=!0)})}if(13==event.which){var selectedItem=listItems.find(".item.hover");0<selectedItem.length&&($scope.displayValue=selectedItem.text(),selectedItem.removeClass("hover"),selectedItem.click(),$scope.showList=!1)}event.stopPropagation(),event.preventDefault()}),$scope.$watch("selectedcode",function(newValue,oldValue){if(newValue&&newValue!=oldValue){var selectedItem=_.find($scope.list,function(item){return item.code==newValue||item.name==newValue});$scope.selectedcode=selectedItem.code||selectedItem.name,$scope.displayValue=selectedItem.name,$scope.callback({code:$scope.selectedcode,id:selectedItem.id,name:selectedItem.name,total:selectedItem.total,latitude:selectedItem.latitude,longitude:selectedItem.longitude})}}),$scope.$watch("list",function(newValue,oldValue){newValue&&($scope.selectedcode="",$scope.displayValue="")}),$scope.selectItem=function(item){$scope.selectedcode=item.code||item.name,$scope.displayValue=item.name,$scope.showList=!$scope.showList},$(document).on("click",function(event){var className=event.target.className.split(" ")[0];"title"!=className&&"label-button"!=className&&"fa"!=className?$scope.showList=!1:$(element).has($(event.target)).length||($scope.showList=!1)}),$scope.toggleDropdown=function(){0==$scope.showList&&labelButton.focus(),$scope.showList=!$scope.showList}}}}),avayaBlog.directive("mapView",function(locatorService,layoutService,directoryService,webtrendsService){return{restrict:"EA",template:'<div id="mapView" layout="row" style="height: 700px;width: 100%";">\t\t\t\t\t  <div class="map" id="map-canvas" style="width: 100%; height: inherit;"></div>\t\t\t\t\t  </div>',link:function($scope,element,attr){var countryDetected=!1,locationsGrid=$(".locations-grid");var showLoader=function(){layout.loader.addClass("show-loader")},hideLoader=function(){0!=countryDetected&&setTimeout(function(){layout.loader.removeClass("show-loader")},1e3)},geocoder=new google.maps.Geocoder;$scope.prepareFilterMetadata=function(filters){if(!$scope.partnerLevelDescriptions){var partnerLevelDescriptions={},partnerCapabilityDescriptions={},partnerSizeDescriptions={},partnerLevels=filters.partnerLevel.types;for(var property in partnerLevels)partnerLevels.hasOwnProperty(property)&&(partnerLevelDescriptions[property]||(partnerLevelDescriptions[property]=partnerLevels[property].substring(0,partnerLevels[property].indexOf("(")-1)));$scope.partnerLevelDescriptions=partnerLevelDescriptions;var partnerCapabilities=filters.capability.types;for(var property in partnerCapabilities)partnerCapabilities.hasOwnProperty(property)&&(partnerCapabilityDescriptions[property]||(partnerCapabilityDescriptions[property]=partnerCapabilities[property].substring(0,partnerCapabilities[property].indexOf("(")-1)));$scope.partnerCapabilityDescriptions=partnerCapabilityDescriptions;var partnerSizes=filters.solutionSize.types;for(var property in partnerSizes)partnerSizes.hasOwnProperty(property)&&(partnerSizeDescriptions[property]||(partnerSizeDescriptions[property]=partnerSizes[property].substring(0,partnerSizes[property].indexOf("(")-1)));$scope.partnerSizeDescriptions=partnerSizeDescriptions}},locatorService.getCountries().then(function(response){if($scope.labels=response.data.data.label[0],$scope.iconMap=response.data.data.iconMap,$scope.countries=response.data.data.countries,$scope.sortByList=response.data.data.sortByList,$scope.iconMap=response.data.data.iconMap,$scope.sortByList){var defaultSortOption=_.find($scope.sortByList,function(option){return 1==option.default});defaultSortOption&&($scope.sortLabel=defaultSortOption.displayLabel)}navigator.geolocation?navigator.geolocation.getCurrentPosition(function(position){position.coords.latitude,position.coords.longitude;var latlng={lat:position.coords.latitude,lng:position.coords.longitude};geocoder.geocode({location:latlng},function(results,status){if("OK"===status)if(results[0]){for(var i=0;i<results[0].address_components.length;i++)for(var j=0;j<results[0].address_components[i].types.length;j++)"country"==results[0].address_components[i].types[j]&&(country=results[0].address_components[i],console.log(country.long_name),console.log(country.short_name));geocodeCountry(country.long_name),map.setCenter(results[0].geometry.location),_.each($scope.countries,function(item){item.code==country.short_name&&$scope.$apply(function(){layoutService.setCountry(item)})})}else console.log("geocoder: no results found");else console.log("geocoder error: "+status)})},function(error){setTimeout(function(){geocodeCountry()},1e3)}):geocodeCountry()},function(){console.log("error fetching countries")});var geocodeCountry=function(country){var countryFound=!0;country||(country=$scope.labels.PLlocale?(countryFound=!1,locatorService.getLocales()[$scope.labels.PLlocale].name):"United States"),"United Kingdom"==country&&(country="Great Britain"),geocoder.geocode({address:country},function(results,status){if("OK"===status){if(results[0])return map.setCenter(results[0].geometry.location),map.fitBounds(results[0].geometry.viewport,0),!0;console.log("No results found")}else console.log("Geocoder error:: "+status);return!1}),0==countryFound&&setTimeout(function(){var countryCode=locatorService.getLocales()[$scope.labels.PLlocale].code;"Great Britain"==country&&(countryCode="GB");var countryEntry=_.find($scope.countries,function(item){return item.code==countryCode});$scope.$apply(function(){layoutService.setCountry(countryEntry),hideLoader()})},1e3)};layoutService.registerCountryChange(function(){layout.country=layoutService.getCountry().code,options={types:["(regions)"],componentRestrictions:{country:layout.country}},autocomplete.setOptions(options),countryDetected=!0,hideLoader()});var center=null,locationList=[],layout={mobile:!1,map:{pristine:!0,radius:0,center:{latitude:0,longitude:0}},search:$(".search-wrap"),mapDetails:$(".map-details-wrap"),loader:$(".page-level-loader")},bounds=new google.maps.LatLngBounds;$(window).resize(function(){767<(windowWidth=$(window).width())?1==layout.mobile&&(layout.mobile=!1,layout.search.css("display","inline-block"),layout.mapDetails.css("display","inline-block")):0==layout.mobile&&(layout.mobile=!0,showLoader(),setTimeout(function(){"none"==layout.mapDetails.css("display")?setTimeout(function(){layout.search.css("display","block"),layout.mapDetails.css("display","block")},0):setTimeout(function(){layout.search.css("display","block"),layout.mapDetails.css("display","none")},0),hideLoader()},500)),map&&(google.maps.event.trigger(map,"resize"),map.setCenter(center)),mapPartner&&google.maps.event.trigger(mapPartner,"resize")});var windowWidth=$(window).width();locatorService.register(function(){locationList=locatorService.getData().locations,$scope.filters=locatorService.getData().filters,$scope.prepareFilterMetadata($scope.filters);var filter=locatorService.getFilter();locationList=locatorService.applyFilters(locationList,filter,$scope.partnerCapabilityDescriptions,$scope.partnerSizeDescriptions,$scope.partnerLevelDescriptions),render(),locationsGrid.scrollTop(0)}),locatorService.registerFilterChange(function(){var filter=locatorService.getFilter();locationList=locatorService.applyFilters(locationList,filter,$scope.partnerCapabilityDescriptions,$scope.partnerSizeDescriptions,$scope.partnerLevelDescriptions),render()});var render=function(){$scope.mapNodes(locationList,map),$scope.enableEvents=!0};showLoader(),$(".search-wrap").addClass("hide");var createMarkers=function(info,map){var marker=new google.maps.Marker({map:map,position:new google.maps.LatLng(info.latitude,info.longitude),loc:info.location,location:info,label:""});marker.setVisible(info.show);info.latitude&&info.longitude&&bounds.extend(marker.getPosition()),google.maps.event.addListenerOnce(map,"idle",function(){$(".gm-style-iw").prev("div").remove()}),google.maps.event.addListener(marker,"click",function(){webtrendsService.setLocatorPartnerName(marker.location.name),webtrendsService.multiTrackLocatorEvent("partnerViewMap"),$scope.displayLocation(marker.location)}),google.maps.event.addListener(marker,"mouseover",function(){infoWindow.setContent("<div style='color: $color-red; font-weight: bold;'>"+info.name+"</div>"),infoWindow.open($scope.map,marker)}),google.maps.event.addListener(marker,"mouseout",function(){infoWindow.close()}),$scope.markers.push(marker);var infoWindow=new google.maps.InfoWindow({pixelOffset:new google.maps.Size(0,0)});$scope.openInfoWindow=function(e,selectedMarker){e.preventDefault(),google.maps.event.trigger(selectedMarker,"click")}};$scope.clearMarkers=function(){for(var i=0;i<$scope.markers.length;i++)$scope.markers[i].setMap(null)};var setMapAttributes=function(){var mapBounds=map.getBounds(),center=map.getCenter();if(mapBounds&&center)var ne=mapBounds.getNorthEast(),radius=google.maps.geometry.spherical.computeDistanceBetween(center,ne);var mapDetailsWrap=$(".map-details-wrap"),width=mapDetailsWrap.width(),height=mapDetailsWrap.height(),hypotenuse=Math.sqrt(Math.pow(width,2)+Math.pow(height,2)),actualRadius=Math.min(width,height)/hypotenuse*(621371e-9*radius);layout.map.radius=parseInt(actualRadius),center&&(layout.map.center.latitude=center.lat(),layout.map.center.longitude=center.lng())};$scope.mapNodes=function(num,map){var mapDetailsWrap=$(".map-details-wrap"),searchWrap=$(".search-wrap"),mapHidden=!1;if("none"==mapDetailsWrap.css("display")&&(mapHidden=!0,mapDetailsWrap.css("display","block"),searchWrap.css("display","none")),$scope.markers&&$scope.clearMarkers(),$scope.markers=[],$scope.nodes=num,null!=$scope.nodes){bounds=new google.maps.LatLngBounds;for(var i=0;i<$scope.nodes.length;i++)createMarkers($scope.nodes[i],map),$scope.mapDataFetched=!0;0<$scope.nodes.length&&(1==layout.map.pristine&&map.fitBounds(bounds),setMapAttributes())}showLoader(),setTimeout(function(){1==mapHidden&&(mapDetailsWrap.css("display","none"),searchWrap.css("display","block")),hideLoader()},1e3)};var input=document.getElementById("pac-input");layout.country="US";var options={types:["(regions)"]},map=new google.maps.Map(document.getElementById("map-canvas"),{center:{lat:32.94161,lng:-97.01155},zoom:16,gestureHandling:"greedy",scrollwheel:!1,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_LEFT},fullscreenControl:!1});$(".overlay").addClass("show"),$(".partner-details-wrap").addClass("show");var mapPartner=new google.maps.Map(document.getElementById("map-canvas-partner"),{center:{lat:32.94161,lng:-97.01155},zoom:16,gestureHandling:"greedy",scrollwheel:!1,disableDefaultUI:!1});window.mapPartner=mapPartner,google.maps.event.addListener(window.mapPartner,"zoom_changed",function(){google.maps.event.addListener(window.mapPartner,"bounds_changed",function(event){this.getZoom()})}),map.addListener("zoom_changed",function(event){if($scope.enableEvents){layout.map.pristine=!1;map.getBounds(),map.getCenter();$scope.redoMap=!0,setMapAttributes()}}),google.maps.event.addListener(map,"center_changed",function(){this.mouseDown,$scope.enableEvents&&(layout.map.pristine=!1,$scope.redoMap=!0,center=map.getCenter(),setMapAttributes())}),setTimeout(function(){$(".partner-details-wrap").removeClass("show"),$(".overlay").removeClass("show"),$(".map-details-wrap").removeClass("show"),$(".search-wrap").removeClass("hide"),$(".detail-wrap").css("display","none"),$(".detail-wrap").css("visibility","visibility"),windowWidth<768&&$(".map-details-wrap").css("display","none"),hideLoader()},1e3);var marker=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)}),country="United States",autocomplete=(google.maps.MapTypeId.ROADMAP,new google.maps.places.Autocomplete(input));autocomplete.setOptions(options),autocomplete.addListener("place_changed",function(){$scope.showCountryDropdown=!1,$scope.showFilterDropdown=!1,$scope.displayLocationDetails=!1,$scope.enableEvents=!1,marker.setVisible(!1);var place=autocomplete.getPlace();webtrendsService.setLocatorCountry(layoutService.getCountry().name),webtrendsService.setLocatorAreaSearched(place.formatted_address),webtrendsService.multiTrackLocatorEvent("searchResults");var latitude=place.geometry.location.lat(),longitude=place.geometry.location.lng();if(place.geometry){if(place.geometry.viewport?map.fitBounds(place.geometry.viewport):map.setCenter(place.geometry.location),layout.map.pristine=!0,"administrative_area_level_1"==place.types[0]&&"locality"!=place.types[1]){var radius=0,mapBounds=map.getBounds(),center=map.getCenter();if(mapBounds&&center){var ne=mapBounds.getNorthEast();radius=google.maps.geometry.spherical.computeDistanceBetween(center,ne),radius*=621371e-9}layout.map.radius=radius,$scope.displayPartners(latitude,longitude,radius)}else $scope.displayPartners(latitude,longitude);place.address_components&&[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" "),$scope.redoMap=!1,setTimeout(function(){$scope.enableEvents=!0},500)}else window.alert("No details available for input: '"+place.name+"'")}),$scope.displayPartners=function(latitude,longitude,radius){latitude||(latitude=layout.map.center.latitude,longitude=layout.map.center.longitude,radius=layout.map.radius),showLoader(),locatorService.getLocations(latitude,longitude,radius)},setTimeout(function(){webtrendsService.multiTrackLocatorEvent("landingPage")},1e3)}}}),avayaBlog.directive("mobileFooter",function(locatorService,layoutService){return{restrict:"EA",template:'<div class="mobile-footer" ng-class="{ \'expand\': showFilterDropdown || showCountryDropdown }">\t\t\t\t\t\t<div class="icons">\t\t\t\t\t\t\t<span filter-bar></span>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="mobile-footer-content">\t\t\t\t\t\tShow something here.\t\t\t\t\t\t</div>\t\t\t\t\t</div>',replace:!0,link:function($scope,element,attr){}}}),avayaBlog.directive("partnerDetails",function(locatorService){return{restrict:"EA",template:'<div class="partner-details-wrap">\t\t\t\t\t\t<div class="partner-details">\t\t\t\t\t\t\t<div style="display: block;"><a class="btn btn-primary" ng-click="hidePartner();"><i class="fa fa-chevron-left"></i> {{ labels.PLBack }}</a></div>\t\t\t\t\t\t\t<div class="basic-info">\t\t\t\t\t\t\t\t<h1 class="name" ng-bind="selectedPartner.name"></h1>\t\t\t\t\t\t\t\t\x3c!--<p class="rating-badge">4.0&nbsp;&nbsp;<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star gray"></i><strong>&nbsp;&nbsp;&nbsp;8 reviews</strong></p>--\x3e\t\t\t\t\t\t\t\t<p class="level" g-bind="selectedPartner.levelDesc">{{ partnerLevelDescriptions[ selectedPartner.partnerLevel[ 0 ] ] }}</p>\t\t\t\t\t\t\t\t<p class="level excellence" ng-show="selectedPartner.excellenceDesc" ng-bind="labels.PLExcellenceDesc"></p>\t\t\t\t\t\t\t\t\x3c!--<div class="logo"><img src="/static/avaya/assets/images/partner-locator/buynlarge-logo.png"></div>--\x3e\t\t\t\t\t\t\t\t<p class="link"><a class="button" ng-href="{{ formatWebAddress( selectedPartner.website ) }}" target="_new">{{ labels.PLWebSite }}</a></p>\t\t\t\t\t\t\t\t<p class="phone"><br><br>{{ selectedPartner.phone }}</p>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="features">\t\t\t\t\t\t\t\t<div class="title" ng-bind="filters.capability.description"></div>\t\t\t\t\t\t\t\t<div class="features-list">\t\t\t\t\t\t\t\t\t<span ng-repeat="capability in selectedPartner.capability" track by $index><i class="fa {{ iconMap[ capability ] }}"></i>{{ partnerCapabilityDescriptions[ capability ] }}</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="features" ng-show="selectedPartner.size && selectedPartner.size.length > 0">\t\t\t\t\t\t\t\t<div class="title" ng-bind="filters.solutionSize.description"></div>\t\t\t\t\t\t\t\t<div class="features-list">\t\t\t\t\t\t\t\t\t<span ng-repeat="size in selectedPartner.size" track by $index><i class="fa {{ iconMap[ size ] }}"></i>{{ partnerSizeDescriptions[ size ] }}</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="nearby-details">\t\t\t\t\t\t\t<div id="mapViewPartner" layout="row" style="height: 400px;width: 100%";>\t\t\t\t\t\t\t \t<div class="map" id="map-canvas-partner" style="width: 100%; height: 400px;"></div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="more-locations">\t\t\t\t\t\t\t\t<strong ng-hide="searchType==\'name\'">{{ labels.PLNearestLocation }} - <span ng-bind="selectedPartner.distance"></span> {{ labels.PLDistanceDesc }}<br></strong>\t\t\t\t\t\t\t\t<span>{{ selectedPartner.address1 }}&nbsp;{{ selectedPartner.address2 }}</span><br>\t\t\t\t\t\t\t\t<span ng-show="selectedPartner.city">{{ selectedPartner.city }}, </span><span ng-show="selectedPartner.state ">{{ selectedPartner.state }}, </span>{{ selectedPartner.zip }}\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="nearby-partners" ng-show="( nearbyLocations.length > 0 )">\t\t\t\t\t\t\t\t<div class="nearby-title" ng-click="( showNearby = !showNearby )">\t\t\t\t\t\t\t\t{{ nearbyLocations.length }} {{ labels.PLMoreLocations }}<i class="fa" ng-class="showNearby == true ? \'fa-chevron-up\' : \'fa-chevron-down\' "></i>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class="nearby-list" ng-show="( showNearby == true )">\t\t\t\t\t\t\t\t\t<div class="location" ng-repeat="nearbyLocation in nearbyLocations">\t\t\t\t\t\t\t\t\t\t<div>{{ nearbyLocation.address1 }} {{ nearbyLocation.address2 }}</div>\t\t\t\t\t\t\t\t\t\t<div><span ng-show="nearbyLocation.city">{{ nearbyLocation.city }}, </span><span ng-show="nearbyLocation.state ">{{ nearbyLocation.state }}, </span>{{ nearbyLocation.zip }}\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="about">\t\t\t\t\t\t\t\x3c!--\t<h2 ng-bind="selectedPartner.name"></h2>\t\t\t\t\t\t\t\t<div ng-bind-html="selectedPartner.description"></div>--\x3e\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t</div>',link:function($scope,element,attr){$scope.formatWebAddress=function(value){return value&&value.indexOf("http")<0?"http://"+value:value},$scope.displayPartnerLevels=!0}}}),avayaBlog.directive("partnerListing",function(locatorService,$window,webtrendsService){return{restrict:"EA",template:'<div class="results">\t\t\t\t\t\t<div class="search-status">\t\t\t\t\t\t\t<span class="result-status" ng-bind="labels.PLViewResults"></span>\t\t\t\t\t\t\t<span class="sort-wrap" ng-show="( showSortFilter == true )">{{ labels.PLSortBy }}: \t\t\t\t\t\t\t\t<span class="sort-type" ng-click="showSort();">{{ sortLabel }} <i class="fa fa-chevron-down"></i></span>\t\t\t\t\t\t\t</span>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="locations-grid">\t\t\t\t\t\t</div>\t\t\t\t\t</div>',link:function($scope,element,attr){var locationsGrid=$(".results .locations-grid");locationsGrid=locationsGrid.first();var partnerDetailsWrap=$(".partner-details-wrap"),resultStatus=$(".result-status"),mapCenter=($(".search-wrap"),$(".map-details-wrap"),{lat:0,lng:0}),loader=$(".page-level-loader"),header=$(".app-header"),marker=null;$scope.showSortFilter=!1,locatorService.register(function(){mapCenter.lat=locatorService.getData().latitude,mapCenter.lng=locatorService.getData().longitude;var locations=locatorService.getData().locations;$scope.showSortFilter=locations&&0<locations.length}),locatorService.registerFilterChange(function(){locatorService.getFilter()}),locatorService.registerApplyFilter(function(){$scope.locationList=locatorService.getFilteredLocations(),sortLocations(),render()}),locatorService.registerSortTypeChange(function(){$scope.sortType=locatorService.getSortType(),sortLocations(),render()});var sortLocations=function(){"name"==$scope.sortType&&$scope.locationList.sort(function(a,b){return a.name.toLowerCase()<b.name.toLowerCase()?-1:a.name.toLowerCase()>b.name.toLowerCase()?1:0}),"distance"==$scope.sortType&&$scope.locationList.sort(function(a,b){return a.distance<b.distance?-1:a.distance>b.distance?1:0}),"level"==$scope.sortType&&$scope.locationList.sort(function(a,b){return a.partnerLevel[0]+(a.partnerLevel[1]||"99")+a.distance.toFixed(2).padStart(6,0)<b.partnerLevel[0]+(b.partnerLevel[1]||"99")+b.distance.toFixed(2).padStart(6,0)?-1:a.partnerLevel[0]+(a.partnerLevel[1]||"99")+a.distance.toFixed(2).padStart(6,0)>b.partnerLevel[0]+(b.partnerLevel[1]||"99")+b.distance.toFixed(2).padStart(6,0)?1:0})},render=function(){var count=0;locationsGrid.empty(),$scope.locationList.map(function(value,index){1==value.show&&(count+=1,locationsGrid.append('<div class="box" onclick="displayPartner( \''+value.partnerId+"', "+value.distance+",'"+value.name+'\' )">\t\t                    <span class="name">'+value.name+'</span>\t\t                    <span class="more-info">'+$scope.partnerLevelDescriptions[value.partnerLevel[0]]+" - "+value.distance+" "+$scope.labels.PLDistanceDesc+(value.excellenceDesc?"<br><span class='excellence'>"+$scope.labels.PLExcellenceDesc:"")+"</span></span>\t\t               \t</div>"))}),resultStatus.text(0<count?count+" "+$scope.labels.results:$scope.labels.PLNoResults),$scope.showSortFilter=0<count};$window.displayPartner=function(partnerId,distance,partnerName){webtrendsService.setLocatorPartnerName(partnerName),webtrendsService.multiTrackLocatorEvent("partnerViewList"),loader.addClass("show-loader"),header.css("display","none"),$scope.hidePartnerLevels();var partner=_.find($scope.locationList,function(item){return item.partnerId==partnerId});locatorService.getPartnerDetails(partnerId).then(function(response){$scope.selectedPartner=response.data.data.partner,$scope.selectedPartner.distance=distance,$scope.nearbyLocations=response.data.data.nearByPartners,$scope.selectedPartner.capability=partner.capability,$scope.selectedPartner.size=partner.size,$scope.selectedPartner.partnerLevel=partner.partnerLevel,$(".partner-details").css("display",""),partnerDetailsWrap.addClass("show"),$(".detail-wrap").css("display","block"),$(".main-container").css("display","none"),window.mapPartner.setCenter(new google.maps.LatLng(Number(mapCenter.lat),Number(mapCenter.lng))),marker&&marker.setMap(null),marker=new google.maps.Marker({position:{lat:Number($scope.selectedPartner.latitude),lng:Number($scope.selectedPartner.longitude)},map:window.mapPartner});var bounds=new google.maps.LatLngBounds;bounds.extend(marker.getPosition()),window.mapPartner.fitBounds(bounds),window.mapPartner.setZoom(16),loader.removeClass("show-loader")},function(){loader.removeClass("show-loader"),console.log("unable to retrieve partner details.")})}}}}),avayaBlog.directive("partnerLocator",function(locatorService){return{restrict:"EA",template:'<div class="partner-search">\t\t\t\t\t\t<div partner-details class="detail-wrap" style="display: block; width: 100%;" ng-class="{ \'show\': displayPartnerDetails }"></div>\t\t\t\t\t\t<div class="app-header" ng-class="searchType == \'location\' ? \'location\' : \'name\' ">\t\t\t\t\t\t\t<h2 class="title-left"><span ng-show="searchType == \'location\'" ng-bind="labels.PLFindChannelPartner"></span><span ng-show="searchType == \'name\'" ng-bind="labels.PLChannelPartnerDirectory"></span></h2>\t\t\t\t\t\t\t<h2 class="title-right"><span ng-show="searchType == \'location\'" ng-click="searchByName()">{{ labels.PLFindPartnerByName }} <i class="fa fa-chevron-right"></i></span><span ng-show="searchType == \'name\'" ng-click="searchType=\'location\'">{{ labels.PLFindPartnerByLocation }} <i class="fa fa-chevron-right"></i></span></h2>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="main-container" ng-class="(searchType == \'name\' ? \'full-height\': \'\' )">\t\t\t\t\t\t\t<div class="search-by-location" ng-show="searchType == \'location\'">\t\t\t\t\t\t\t\t<div class="search-bar">\t\t\t\t\t\t\t\t\t<input id="pac-input" ng-model="cityKeywords" type="text" aria-label="{{ labels.PLEnterCityOrPostalCode }}" placeholder="{{ labels.PLEnterCityOrPostalCode }}">\t\t\t\t\t\t\t\t\t<i class="fa fa-close" ng-class="{ \'show\': cityKeywords.length > 0 }" ng-click="( cityKeywords = \'\' )"></i>\t\t\t\t\t\t\t\t\t<span class="filter">\t\t\t\t\t\t\t\t\t\t<span filter-bar></span>\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div search-panel></div>\t\t\t\t\t\t\t\t<div class="map-details-wrap">\t\t\t\t\t\t\t\t\t<div class="map-container" style="background: none;">\t\t\t\t\t\t\t\t\t\t<a class="button redo-search" ng-show="redoMap == true" ng-click="redoSearch()">{{ labels.PLRedoSearch }} <i class="fa fa-refresh"></i></a>\t\t\t\t\t\t\t\t\t\t<div map-view class="map-locations col-lg-12" g-show="showMap" location-list="locationList"></div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t<div location-details></div>\t\t\t\t\t\t\t\t\t\x3c!-- <div class="search-results">\t\t\t\t\t\t\t\t\t\t<h2>There were no perfect matches for your criteria</h2>\t\t\t\t\t\t\t\t\t\t<h2>There are <span>24 partners</span> that match all of your selections below</h2>\t\t\t\t\t\t\t\t\t</div> --\x3e\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div mobile-footer></div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div directory-search></div>\t\t\t\t\t\t\t<div filter-dropdown></div>\t\t\t\t\t\t\t<div country-dropdown></div>\t\t\t\t\t\t\t<div sort-dropdown></div>\t\t\t\t\t\t\t<div class="overlay" ng-class="{ \'show\': ( showFilterDropdown || showCountryDropdown || showSortDropdown ) }">\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t</div>',replace:!0,link:function($scope,element,attr){$scope.labels={},$scope.redoMap=!1,$scope.mapDataFetched=!1,$scope.enableEvents=!1,$scope.searchType="location",$scope.showFilterDropdown=!1,$scope.filters=[],$scope.showListIcon=!1,$scope.filterCount=0,$scope.displayPartnerLevels=!1;var partnerDetailsWrap=$(".partner-details-wrap"),searchWrap=$(".search-wrap"),mapDetailsWrap=$(".map-details-wrap"),header=$(".app-header");locatorService.register(function(){$scope.filters=locatorService.getData().filters}),String.prototype.startsWith||(String.prototype.startsWith=function(searchString,position){return position=position||0,this.substr(position,searchString.length)===searchString}),$scope.searchByName=function(){$scope.searchType="name",$scope.showCountryDropdown=!1,$scope.showSortDropdown=!1,$scope.showFilterDropdown=!1},$scope.displayLocation=function(location){$scope.$apply(function(){$scope.partnerDetails=location,$scope.displayLocationDetails=!0,$scope.selectedLocation=location})},$scope.displayPartner=function(location){$scope.displayPartnerDetails=!0,$scope.selectedLocation=location},$scope.hidePartner=function(location){header.css("display","block"),partnerDetailsWrap.removeClass("show"),$(".main-container").css("display","block"),$(".detail-wrap").css("display","none")},$scope.hideLocation=function(){$scope.displayLocationDetails=!1},locatorService.registerFilterChange(function(){$scope.showFilter()}),$scope.showFilter=function(){$scope.showCountryDropdown=!1,$scope.displayPartnerLevels=!1,$scope.showSortDropdown=!1,$scope.hideLocation(),$scope.showFilterDropdown=!$scope.showFilterDropdown},$scope.showCountries=function(event){$scope.showFilterDropdown=!1,$scope.showSortDropdown=!1,$scope.displayPartnerLevels=!1,$scope.hideLocation(),$scope.showCountryDropdown=!$scope.showCountryDropdown,$(event.target).parent().find("input").focus()},$scope.showSort=function(){$scope.showFilterDropdown=!1,$scope.showCountryDropdown=!1,$scope.displayPartnerLevels=!1,$scope.hideLocation(),$scope.showSortDropdown=!$scope.showSortDropdown},$scope.redoSearch=function(){$scope.redoMap=!1,$scope.displayPartners()},$scope.displayMap=function(location){$scope.showCountryDropdown=!1,$scope.showFilterDropdown=!1,"none"==mapDetailsWrap.css("display")?(mapDetailsWrap.css("display","block"),$scope.showListIcon=!0,searchWrap.css("display","none")):(mapDetailsWrap.css("display","none"),$scope.showListIcon=!1,searchWrap.css("display","block"))},$scope.showPartnerLevels=function(){$scope.displayPartnerLevels=!0},$scope.hidePartnerLevels=function(){$scope.displayPartnerLevels=!1}}}}),avayaBlog.directive("searchPanel",function(locatorService,layoutService){return{restrict:"EA",template:'<div id="pc-container" class="search-wrap">\t\t\t\t\t<div partner-listing></div>\t\t\t\t</div>',replace:!0,link:function($scope,element,attr){layoutService.registerCountryChange(function(){$scope.countryName=layoutService.getCountry().name})}}}),avayaBlog.directive("sortDropdown",function(locatorService,layoutService){return{restrict:"EA",template:'<div class="filter-dropdown sort-dropdown" ng-class="{ \'show\': showSortDropdown }">\t\t\t\t\t\t<i class="fa fa-close" ng-click="showSortDropdown = false"></i>\t\t\t\t\t\t<div class="column wide">\t\t\t\t\t\t\t<div class="section">\t\t\t\t\t\t\t\t<div class="list no-padding">\t\t\t\t\t\t\t\t\t<div">\t\t\t\t\t\t\t\t\t\t<div ng-repeat="sortOption in sortByList">\t\t\t\t\t\t\t\t\t\t\t<input type="radio" ng-click="selectSortType( sortOption.id )" id="{{ sortOption.id }}" name="sortType" aria-label="{{sortOption.label}}">{{ sortOption.label }}\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t</div>',link:function($scope,element,attr){$scope.selectSortType=function(sortType){var selectedSortOption=_.find($scope.sortByList,function(sort){return sort.id==sortType});selectedSortOption&&($scope.sortLabel=selectedSortOption.displayLabel),locatorService.changeSortType(sortType),$scope.showSortDropdown=!1,$scope.selectedSortType=sortType},$scope.$watch("sortByList",function(newValue,oldValue){newValue!=oldValue&&($scope.selectedSortType="distance",setTimeout(function(){$(element).find("#distance").prop("checked",!0)},100))})}}}),avayaBlog.factory("directoryService",function($http,$q,serviceBase){$("html").attr("lang");var directory={country:"",state:"",city:"",keywords:""},eventHandlers={countryChangedHandlers:[]};return{setCountry:function(countryCode){directory.country=countryCode,eventHandlers.countryChangedHandlers.forEach(function(handler){handler()})},setState:function(stateCode){directory.state=stateCode},setCity:function(cityCode){directory.city=cityCode},getData:function(){return directory},getCities:function(code,id){return 1==App.debug?"a0B30000002tF8eEAE"==id?serviceBase.getData("/static/avaya/mocks/partner-locator/br-cities.html?&id="+id):"a0B30000002tF8mEAE"==id?serviceBase.getData("/static/avaya/mocks/partner-locator/ca-cities.html?&id="+id):serviceBase.getData("/static/avaya/mocks/partner-locator/us-cities.html?&id="+id):serviceBase.getData(findCitiesList()+"&id="+id)},getCitiesByCountry:function(code,id){return 1==App.debug?"a0B30000002tF8eEAE"==id?serviceBase.getData("/static/avaya/mocks/partner-locator/br-cities.html?&id="+id):"a0B30000002tF8mEAE"==id?serviceBase.getData("/static/avaya/mocks/partner-locator/ca-cities.html?&id="+id):serviceBase.getData("/static/avaya/mocks/partner-locator/us-cities.html?&id="+id):serviceBase.getData(findCitiesByCountryList()+"&id="+id)},getStates:function(id){return 1==App.debug?"a0B30000002tF7wEAE"==id?serviceBase.getData("/static/avaya/mocks/partner-locator/us-states.html?&id="+id):"a0B30000002tF8mEAE"==id?serviceBase.getData("/static/avaya/mocks/partner-locator/ca-states.html?&id="+id):serviceBase.getData("/static/avaya/mocks/partner-locator/us-states.html?&id="+id):serviceBase.getData(findStatesList()+"&id="+id)},getListing:function(keywords,id,latitude,longitude,stateId){if(keywords&&(keywords=encodeURIComponent(keywords)),1!=App.debug)return keywords?stateId?serviceBase.getData(getDirectoryListingsByState()+"&id="+id+"&stateid="+stateId+"&name="+keywords):serviceBase.getData(getDirectoryListingsByKeywords()+"&id="+id+"&name="+keywords):serviceBase.getData(getDirectoryListingsByCountry()+"&id="+id);if("none"==keywords)return serviceBase.getData("/static/avaya/mocks/partner-locator/directory-search-no-result.html?&keyword="+keywords+"&latitude="+latitude+"&longitue="+longitude+"&id="+id);if(keywords){if(-1<keywords.indexOf("win"))return serviceBase.getData("/static/avaya/mocks/partner-locator/directory-search.html?&keyword="+keywords+"&latitude="+latitude+"&longitue="+longitude+"&id="+id);if(-1<keywords.indexOf("com"))return serviceBase.getData("/static/avaya/mocks/partner-locator/directory-search-communications.html?&keyword="+keywords+"&latitude="+latitude+"&longitue="+longitude+"&id="+id)}return serviceBase.getData("/static/avaya/mocks/partner-locator/directory-search-category-four.html?&id="+id)}}}),avayaBlog.factory("layoutService",function($http,$q,serviceBase){var country="",eventHandlers={layoutHandlers:[],countryChangeHandlers:[]},setCountry=function(countryCode){country=countryCode,eventHandlers.countryChangeHandlers.forEach(function(handler){handler()})};return{setCountry:function(countryCode){setCountry(countryCode)},getCountry:function(){return country},registerCountryChange:function(callback){!function(callback){eventHandlers.countryChangeHandlers.push(callback)}(callback)}}}),avayaBlog.factory("locatorService",function($http,$q,serviceBase,webtrendsService){var locations={},filteredLocations=[],filter={},sortType="distance",locales=($("html").attr("lang"),{en_US:{code:"US",name:"United States"},fr_FR:{code:"FR",name:"France"},de_DE:{code:"DE",name:"Germany"},es_MX:{code:"MX",name:"Mexico"},it_IT:{code:"IT",name:"Italy"},pt_BR:{code:"BR",name:"Brazil"},ru_RU:{code:"RU",name:"Russian Federation"},zh_CN:{code:"CN",name:"China"},ja_JP:{code:"JP",name:"Japan"},ko_KR:{code:"KR",name:"Korea Republic of"}}),eventHandlers={getLocationsHandlers:[],filterChangedHanders:[],sortChangedHanders:[],applyFilterHanders:[]},notify=function(){eventHandlers.getLocationsHandlers.forEach(function(handler){handler()})};return{getLocations:function(latitude,longitude,radius){var radiusFragment="";if(radius&&(radiusFragment+="&radius="+radius),1==App.debug){var url="/static/avaya/mocks/partner-locator/newyork.html";url=(latitude="-74.0059728"==longitude)?"/static/avaya/mocks/partner-locator/new-york.html":(latitude="-0.09364959999993516"==longitude)?"/static/avaya/mocks/partner-locator/london.html":(latitude="-74.46428609999998"==longitude&&!radius)?"/static/avaya/mocks/partner-locator/piscataway.html":(latitude="2.3522219000000177"==longitude&&!radius)?"/static/avaya/mocks/partner-locator/paris.html":radius?60<radius?"/static/avaya/mocks/partner-locator/piscataway-zoom-75miles.html":"/static/avaya/mocks/partner-locator/piscataway.html":"/static/avaya/mocks/partner-locator/philadelphia.html",serviceBase.getData(url+"?"+radiusFragment).then(function(response){locations=response.data.data,notify()},function(){console.log("error fetching locations")})}else{url=getLocations()+"&lng="+longitude+"&lat="+latitude;serviceBase.getData(url+radiusFragment).then(function(response){locations=response.data.data,notify()},function(){console.log("error fetching locations")})}},register:function(callback){!function(callback){eventHandlers.getLocationsHandlers.push(callback)}(callback)},registerFilterChange:function(callback){!function(callback){eventHandlers.filterChangedHanders.push(callback)}(callback)},registerSortTypeChange:function(callback){!function(callback){eventHandlers.sortChangedHanders.push(callback)}(callback)},registerApplyFilter:function(callback){!function(callback){eventHandlers.applyFilterHanders.push(callback)}(callback)},getData:function(){return locations},getLocales:function(){return locales},getFilter:function(){return filter},getSortType:function(){return sortType},findCountry:function(lat,lng){return 1==App.debug?serviceBase.getData("/static/avaya/mocks/partner-locator/find-country.html"):serviceBase.getData("/cs/Satellite?pagename=Avaya/Service/FindCountry&lat="+lat+"&lng="+lng)},getFilteredLocations:function(){return filteredLocations},getCountries:function(){return 1==App.debug?serviceBase.getData("/static/avaya/mocks/partner-locator/countries.html"):serviceBase.getData(getCountries())},getPartnerLevels:function(){return 1==App.debug?serviceBase.getData("/static/avaya/mocks/partner-locator/partner-levels.html"):serviceBase.getData(getPartnerLevels())},getPartnerDetails:function(partnerId){return 1==App.debug?serviceBase.getData("/static/avaya/mocks/partner-locator/partner-details.html?&partnerId="+partnerId):serviceBase.getData(getPartnerDetails()+"&partnerId="+partnerId)},changeFilter:function(changedFilter){filter=changedFilter,eventHandlers.filterChangedHanders.forEach(function(handler){handler()})},changeSortType:function(sort){sortType=sort,eventHandlers.sortChangedHanders.forEach(function(handler){handler()})},applyFilters:function(locationList,filterList,partnerCapabilityList,partnerSizeDescriptions,partnerLevelDescriptions){var capabilityList="";filterList.capability&&0<filterList.capability.length&&_.each(filterList.capability,function(capability){capabilityList+=partnerCapabilityList[capability]+";"});var sizeList="";filterList.solutionSize&&0<filterList.solutionSize.length&&_.each(filterList.solutionSize,function(size){sizeList+=partnerSizeDescriptions[size]+";"});var levelList="";filterList.partnerLevel&&0<filterList.partnerLevel.length&&_.each(filterList.partnerLevel,function(level){levelList+=partnerLevelDescriptions[level]+";"}),webtrendsService.setLocatorCapability(capabilityList),webtrendsService.setLocatorLevel(levelList),webtrendsService.setLocatorSolutionSize(sizeList),webtrendsService.multiTrackLocatorEvent("searchFilterUpdate");var show=!0,partnerLevelArray=[],excellenceArray=[];return filterList.partnerLevel&&filterList.partnerLevel.forEach(function(elem,index){"18"==elem?excellenceArray.push(elem):partnerLevelArray.push(elem)}),_.each(locationList,function(location){show=!0,partnerLevelArray&&0<partnerLevelArray.length&&(show=0===_.difference([location.partnerLevel[0]],partnerLevelArray).length),1==show&&0<excellenceArray.length&&!location.excellenceDesc&&(show=!1),1==show&&filterList.solutionSize&&0<filterList.solutionSize.length&&(show=0===_.difference(filterList.solutionSize,location.size).length),1==show&&filterList.capability&&0<filterList.capability.length&&(show=0===_.difference(filterList.capability,location.capability).length),location.show=show}),filteredLocations=locationList,eventHandlers.applyFilterHanders.forEach(function(handler){handler()}),locationList}}});